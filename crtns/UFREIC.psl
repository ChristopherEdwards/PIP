UFREIC	// FREQUENCY INTEGRITY CHECK
	/*
	       ORIG:  Neal E. Gorman (5053) - 08/01/88

	---- Revision History ------------------------------------------------

	05/22/03 - GRAY - 51351
		   Converted to PSL.


	*/

	type Date JD
	type Number %PAGE,%PG
	type String OLNTB,VFMQ

	set %PG=1 set %PAGE=1
	set JD=%SystemDate

	// Page control
	
	do VPG01

	if "DFQ"[VFMQ do VER

     	quit


VPG01	// Screen
	
	type String %READ,%TAB

	set %TAB("CDEP")=".CDEP1"
	set %TAB("CLN")=".CLN1"

	set %READ="@@%FN,,,CLN/REQ,CDEP/REQ"

	do ^UTLREAD

	quit


VER	//
	
	type Public String VFMQ

	if %ProcessMode=2!(%ProcessMode=4)!(VFMQ="Q") do END quit

	// File data

	type String ET,X
	type Public Boolean CDEP,CLN
	type Public String F()

	// I18N=OFF

	if CLN do {
		type DbSet lnds=Db.selectDbSet("LN","STAT NOT=4")
		while lnds.next() do {
			type RecordLN ln=lnds.getRecord("LN")
			type Number CID
			set CID=ln.cid

			// Coupon Book Production Frequency
			set X=ln.cbfre if X'="" do F if F(X) set ET="[LN]CBFRE: "_X do ER
	
			// Int/Div Check Frequency
			set X=ln.intfre if X'="" do F if F(X) set ET="[LN]INTFRE: "_X do ER

			// Payment Change Frequency
			set X=ln.pcfre if X'="" do F if F(X) set ET="[LN]PCFRE: "_X do ER
	
			// Re-amortization Frequency
			set X=ln.rafre if X'="" do F if F(X) set ET="[LN]RAFRE: "_X do ER

			// Distribution 1 Frequency
			set X=ln.dist1fre if X'="" do H if F(X) set ET="[LN]DIST1FRE: "_X do ER

			// Distribution 2 Frequency
			set X=ln.dist2fre if X'="" do G do F if F(X) set ET="[LN]DIST2FRE: "_X do ER

			// Distribution 3 - Frequency
			set X=ln.dist3fre if X'="" do G do F if F(X) set ET="[LN]DIST3FRE: "_X do ER

			// Distribution 4 - Frequency
			set X=ln.dist4fre if X'="" do F if F(X) set ET="[LN]DIST4FRE: "_X do ER

			// Analysis Frequency
			set X=ln.anfre if X'="" do F if F(X) set ET="[LN]ANFRE: "_X do ER
			}
		}

	if CDEP do {
		type DbSet depds=Db.selectDbSet("DEP","STAT NOT=4")
		while depds.next() do {
			type RecordDEP dep=depds.getRecord("DEP")
			type Number CID
			set CID=dep.cid

			// Int/Div Compounding Frequency
			set X=dep.icf if X'="" do F if F(X) set ET="[DEP]ICF: "_X do ER
	
			// Int/Div Posting Frequency
			set X=dep.ipf if X'="" do F if F(X) set ET="[DEP]IPF: "_X do ER

			// Int/Div Check Frequency
			set X=dep.intfre if X'="" do F if F(X) set ET="[DEP]INTFRE: "_X do ER

			// Service Charge Frequency
			set X=dep.scfre if X'="" do F if F(X) set ET="[DEP]SCFRE: "_X do ER

			// Int/Div Compounding Frequency (Analysis)
			set X=dep.anlicf if X'="" do F if F(X) set ET="[DEP]ANLICF: "_X do ER

			// Int/Div Review Frequency (Analysis)
			set X=dep.anlirf if X'="" do F if F(X) set ET="[DEP]ANLIRF: "_X do ER

			// MMDA Cycle Frequency
			set X=dep.mmda4 if X'="" do F if F(X) set ET="[DEP]MMDA4: "_X do ER
			}
		}
	
	// I18N=ON

	do END

	quit


F	// Frequency check
	
	type Number ER=0
	type Public String F()

	if 'F(X).data() do EDT^UFRE set F(X)=ER

	quit


G	// Required for frequency = "*" to pass edit

	type String I()

	set I(2)="[]DIST"

	quit


H	// "*" frequencies

	type Number %INT,ER
	type Public String F()

	set (%INT,ER)=0

	if 'F(X).data() do EDT2^UFRE("[]DIST") set F(X)=ER

	quit


ER	// Log errors in ^DAYEND(,"EXC"

	type Public Number CID
	type Public String ET

	// Frequency Integrity Check
	do LOG^UTLEXC(%RoutineName,"*",$$^MSG(5242),CID,"",ET)

	quit


END	//

	type String RTN
	type Public String ER,RM
	type Public Boolean CDEP,CLN

	set ER="W"
	// Process stopped
	if '(CLN.get()+CDEP.get()) set RM=$$^MSG(2238) quit

	// Process complete
	set RM=$$^MSG(2237)

	set RTN=%RoutineName

	type ResultSet rs=Db.select("SEQ","DAYENDEXC","TJD=:%SystemDate AND RTN=:RTN")
	// ~p1  no errors logged
	if rs.isEmpty() set RM=$$^MSG(2998,RM) quit

	// ~p1  errors logged in exception file
	set RM=$$^MSG(2997,RM)

	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "59886^43625^Sanchez SCM Administrator^3605"	// Signature - LTD^TIME^USER^SIZE
