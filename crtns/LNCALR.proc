public LNCALR(RecordLN ln)	// Model Fixed Principal/Interest Loan
	/*
	       ORIG:  Chuck Hardy (6721) - 11/4/88

	---- Revision History ------------------------------------------------
    
	10/13/05 - S.Krishnan - CR16885
		   Top of the procedure is made as Public.

        07/26/05 - SkariahV- CR16679
	           Removed #WARN and #OPTIMIZE directives.
	              	
	12/09/03 - CARROLLJ - CR7239
		   Corrected precedence errorin section APR.

	03/27/03 - GRAY - 51351
		   Converted to PSL.
	

	*/
	
	type Number DISAMF,FV,PRODIRC
	type String %PR(),GRP,LNP()

	// Product Group
	set GRP=ln.grp

	// Original Disbursement Date
	set ln.odd=%SystemDate

	set LNP(1)=""

	set FV=0
	do DIS1^LNCALC(.ln)

	// Disclosure - Prepaid Interest Amount
	set DISAMF=ln.crlmt-ln.orgfa-ln.comfa-ln.disppi

	// Distribution 1 Next Due
	set ln.schnd=ln.dist1nd

	// Distribution 1 Last Due
	set ln.schld=ln.dist1ld

	set PRODIRC=1

	set %PR(1)="I|1|1"
	set %PR(2)="P|1|1"

	do APR(.ln)

	quit


Public APR(RecordLN ln)	// Calculate APR

	type Boolean AMOPT
	type Number DISTPTS,IRR
	type Public String CF(),LNP()
	
	set AMOPT=1
	do CLS^LNAPR(.ln)

	/* 
	Calculate net investment yield

	If the loan is modeled without deferred costs, skip the NINV calcula-
	tion and use APR (which should be the same as NINV).
	*/

	// Original Int/Div Rate
	if 'LNP(1).piece("|",4) set ln.iro=+ln.disapr quit

	set CF(0)=((((((ln.crlmt)-ln.orgfa)-ln.comfa)-ln.aprapp)-ln.aprapp1)+LNP(1).piece("|",4))*(-1)

	set IRR=$$^UIRR(.CF,ln.dist1fre,ln.piacm,ln.iacm,ln.schld)

	// Original Int/Div Rate
	set ln.iro=IRR

	// Credit Limit - Current
	set DISTPTS=ln.crlmt+LNP(1).piece("|",4)+CF(0)

	// if $G(%IPMODE)["NOINT" set SID="LNMDLR3" set AMORT=1

	quit

vSIG()	quit "60186^24678^S. Krishnan^1580"	// Signature - LTD^TIME^USER^SIZE
