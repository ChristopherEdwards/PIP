LNAEU3	//Private;Loan On-Demand Auto Escrow Maintenance (Mass Change) + Delete
	/*
	   ORIG: GORMAN - 11/04/93
	   DESC: Loan On-Demand Auto Escrow Maintenance - Mass Change + Delete

	  ---- Revision History ------------------------------------------------
	 
	  08/02/06 - Srinivar - CR 19137
	  	      Modified the section VPG01 to pass LNAEU2,LNAEU1 objects
	  	      instead of LN,fLNAEU2,fNAEU3,fLNAEU4.
	  
	  11/25/05 -  Srinivar - CR16890
	 	     
	 	      Modified the VPG01 section to initialize following objects
	 	      LN,fLNAEU2,fLNAEU4 before passing it to screen to avoid the
	 	      GTM error. 
	 	       	
	 
	 
	   09/24/02 - CHHABRIAS - 49451
		      Converted to PSL
	
	  ----------------------------------------------------------------------

	*/
	do UPD 
	
	quit

UPD	//
	
	type String SID
	
	set SID="LNESCADJ2"
	do INIT(1)
	quit


DEL	//
	
	type String SID
	
	set SID="LNESCADJ3"
	do INIT(3)
	quit


INIT(%ProcessMode)	//

	type Number OLNTB,%PAGE,%PG
	type String VFMQ
	
	set %PG=0
	set %PAGE=1
	type RecordLN LN
        type RecordLNAEU1 fLNAEU1
	do VPG(.fLNAEU1,.LN)
        quit


VPG(RecordLNAEU1 fLNAEU1,RecordLN LN)	// Page control

	type public Number %PG
	type public String VFMQ
	
	type Boolean FINISH
	
        set FINISH=0
        for  do { quit:FINISH
                if %PG=0 do VPG00 if VFMQ="Q" set FINISH=1 quit
                if %PG>0 do VPG01(.fLNAEU1,.LN)
                if "DFQ"[VFMQ do VER(.fLNAEU1) set FINISH=1 quit
                set %PG=%PG+1
                }
        quit


VPG00	// Set up

	type public String %TAB,%READ,VFMQ,IO

	set %TAB("EFD")=".FDATE1/HLP=[LNEXCEXT]EFD/TBL=[LNAEU1]EFD:DISTINCT"
	set %TAB("EXTSEQ")=".SEQ2/HLP=[LNESCEXT]EXTSEQ/TBL=[LNAEU1]EXTSEQ:QU ""[LNAEU1]EFD=<<EFD>>"""
	set %READ="@@%FN,,,EFD/REQ,EXTSEQ/REQ"

	do ^UTLREAD

	if VFMQ="Q" quit

	if %ProcessMode=2,IO'=$I do OPEN^SCAIO

	quit


VPG01(RecordLNAEU1 fLNAEU1,RecordLN LN)	// Screen

	
        type public Date EFD,EXTSEQ
	type public String LNAEU(),SID
	
	type RecordLNAEU2 fLNAEU2
	type Number CTR
	
	
	set fLNAEU1=Db.getRecord("LNAEU1","EFD=:EFD,EXTSEQ=:EXTSEQ",1)
	
	type RecordLN ln=Class.new("RecordLN")
	
	type RecordLNAEU2 fLNAEU2=Class.new("RecordLNAEU2")
	
	
	if SID="LNESCADJ2" do DRV^USID(%ProcessMode,SID,.fLNAEU2,.fLNAEU1,.ln)

	if SID="LNESCADJ3" do DRV^USID(%ProcessMode,SID,.fLNAEU2,.fLNAEU1)

	quit


VER(RecordLNAEU1 fLNAEU1)	// Verification
	
	type public String VFMQ

	if %ProcessMode=2!(%ProcessMode=4)!(VFMQ="Q") do END quit

	do FILE(.fLNAEU1)

	do END

	quit


FILE(RecordLNAEU1 fLNAEU1)	// File data

	if %ProcessMode=1 do FILE1(.fLNAEU1)

	if %ProcessMode=3 do FILE3

	quit


FILE1(RecordLNAEU1 fLNAEU1)	// Mass Maintenance
	
	type public Number EXTSEQ
	type public Date EFD
	type public String LNAEU,RECORD
	
	type String IGNORE
	
	
	type Number SEQUENCE,CID
	

	set SEQUENCE=""
	for  set SEQUENCE=$O(LNAEU(SEQUENCE)) quit:SEQUENCE=""  do {
		set RECORD=LNAEU(SEQUENCE)

		set CID=$P(RECORD,"|",1)
		if CID="" quit

		type RecordLNAEU2 fLNAEU2=Db.getRecord("LNAEU2","EFD=:EFD,EXTSEQ=:EXTSEQ,CID=:CID",1)
		if fLNAEU2.getMode() set IGNORE=fLNAEU2.ignore 
		
		if IGNORE.get().isNull() quit
	
		// Quit if already marked to ignore
		if fLNAEU2.ignore quit
		set fLNAEU2.ignore=1

	        do fLNAEU2.bypassSave()
		}

	do fLNAEU1.bypassSave()

	quit


FILE3	// File Delete

	do Db.delete("LNAEU1","EFD=:EFD AND EXTSEQ=:EXTSEQ")
	do Db.delete("LNAEU2","EFD=:EFD AND EXTSEQ=:EXTSEQ")
	do Db.delete("LNAEU3","EFD=:EFD AND EXTSEQ=:EXTSEQ")
	do Db.delete("LNAEU4","EFD=:EFD AND EXTSEQ=:EXTSEQ")

	quit


END	// End of processing
	
	type public Boolean ER
	type public String VFMQ,RM

	if $G(ER)!(%ProcessMode=2)!(%ProcessMode=4) quit

	set ER="W"

	// Process Aborted
	if VFMQ="Q" set RM=$$^MSG(2238) quit

	// Process Completed
	set RM=$$^MSG(2237)
	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "60306^20659^Srinivasan, Rajesh^3543"	// Signature - LTD^TIME^USER^SIZE
