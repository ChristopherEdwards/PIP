DEPSFV		/*
	ORIG: CARROLLJ - 02/20/2002
	DESC: Deposit frequency verification utility


	      Secondary Frequency Verification Utility

	      The purpose of this utility is to provide a means to
	      verify that:

	      1)  Secondary frequencies (i.e. interest, payment change,
		  reamortization) correspond to primary frequencies
		  (usually master payment frequencies).  All secondary
		  frequency "hits" fall on those of the primary freq-
		  uency.

	      2)  Secondary next dates (i.e. next interest change date)
		  falls on a regular "hit" of the primary frequency.

	   GLOBALS -
	       READ:
	        SET:

	      INPUT:

	   Variables: None


	     OUTPUT:

	   Variables:  ER - Error Flag
	               RM - Error Message (if appropriate)

	   Parameters: None

	              Note:  Routine verifies propriety of D2 and F2

	---- Revision History ------------------------------------------------

	07/11/02 - CARROLLJ - 43583
		   PSL conversion cleanup.

	02/20/02 - CARROLLJ - 43583
		   Create from LNUSFV for PSL conversion.

	----------------------------------------------------------------------

	*/
	quit

Public VER(D1,F1,P1,D2,F2,P2)	// Verification of secondary frequency

	/*

	Arugments:
	     D1 - Start date for primary frequency array
	     F1 - Primary Frequency (usually master pymt frequency)
	     P1 - Text describing 1st frequency (for error message
	     D2 - "Hit" Date on Secondary Frequeny
	     F2 - Secondary Frequency
	     P2 - Text describing 2nd frequency (for error message)

	*/

	// master payment
	if $G(P1)="" set P1=$$^MSG(4209)

	if F1=""!(F2="") set ER=1 set ET="LNUSFV3" do ^UTLERR quit

	if 'D2 set D2=D1
	if '$D(MFRE(D1,F1)) do MFRE if AF>364 quit
	set JD=D2 do VER1
	if ER set ET="LNUSFV1" do ^UTLERR quit

	set FRE=F2 
	set JD=D2 
	set NJD=$$NJD^UFRE(JD,FRE) quit:ER
	set (D2,JD)=NJD do VER1
	if ER set ET="LNUSFV2" do ^UTLERR
	quit

VER1	// Verification

	set NJD=$O(MFRE(D1,F1,"")) 
	set FRE=NGFRE
	if D2<NJD for  set JD=NJD set NJD=$$NJD^UFRE(JD,FRE) quit:ER  set MFRE(D1,$E(FRE,2,99),NJD)="" if D2'<NJD quit
	set NJD=$O(MFRE(D1,F1,""),-1) 
	set FRE=F1
	if D2>NJD for  set JD=NJD set NJD=$$NJD^UFRE(JD,FRE) quit:ER  set MFRE(D1,FRE,NJD)="" if D2'>NJD quit

	if '$D(MFRE(D1,F1,D2)) set ER=1
	quit


MFRE	// Builds master payment frequency array

	set JD=D1 

	set NJD=$$NJD^UFRE(JD,F1,.AF,1) quit:ER 
	if AF>364 quit
	for  set JD=NJD set NJD=$$NJD^UFRE(JD,F1,,1) quit:ER  set MFRE(D1,F1,NJD)="" if %SystemDate+366<NJD quit
	quit

vSIG()	quit "59886^43512^Sanchez SCM Administrator^2388"	// Signature - LTD^TIME^USER^SIZE
