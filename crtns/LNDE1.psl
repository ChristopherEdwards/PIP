LNDE1

	/*
	       ORIG:  Chuck Hardy (6721) - 08/05/86
	       DESC: Backdated loan creation/disbursal

	---- Revision History ------------------------------------------------
	
	02/09/06 - SmithCD - CR 19505
		   Removed 4th and 5th parameters in call to EXEC^UANTIC to 
		   match changes made to that tag with CR 19343.
	
	05/31/05 - SmithCD - CR 15902
		   Modified FILE section to file changes to the ln object. 
		   This prevents integrity errors that occur on columns such 
		   as ln.schnd on backdated account openings that have an 
		   interest change frequency, for example. Performed some 
		   minor cleanup.
	
	01/13/04 - CARROLLJ - CR7900
		   Pass correct parameters to UANTIC

	03/12/03 - CARROLLJ - 51349
		   Converted to PSL.

	*/

	quit


public FILE(RecordLN ln)

	type public String TCMT
	type public Boolean ER
	
	type Date DTNT
	type String INDEX, IX()

	// Int/div Index
	set INDEX = ln.index

	// Date of Note
	set DTNT = ln.dtnt

	if 'ln.index.isNull() do {
		type Date %EffectiveDate = DTNT
		
		type RecordINDEX index=Db.getRecord("INDEX","INDEX=:INDEX")
		
		set IX(INDEX) = $$IND2STR^UINDX(.index)
		do LOADIX^INDEXMC(INDEX)
		}
		
	if DTNT < %SystemDate do {
		// Brought current from DTNT:
		set TCMT=$$^MSG(3480)_DTNT.toString()
		}
	else  quit

	do UANTIC(.ln, DTNT, %SystemDate) quit:ER
	
	do ln.bypassSave()

	quit


UANTIC(RecordLN ln, Date %SystemDate, Date %EffectiveDate)

	type public Number CID
	type public Boolean ER

	type String TCMT
	type Number ACRADJ

	// Restate accrual balance as of ODD
	set ACRADJ = -$$^SCARND(ln.acr, , CID)
	
	// Accrued Interest
	set ln.acr = 0

	type RecordTTX ttx = Class.new("RecordTTX")
	
	do EXEC^UANTIC(.ln, .ttx, , %EffectiveDate, 1, 11, .ACRADJ) quit:ER

	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "60306^40498^Chad Smith^1657"	// Signature - LTD^TIME^USER^SIZE
