QUEALRT	//;SCA - U - V2.0 - JOB SCHEDULER MAIL AND BROADCAST ALERT SYSTEM
	/*
	       ORIG:  Mike Winigrad (6969) - 11/17/86
	  CALLED BY:
	      CALLS:
	   PROJ #'S:  1459
	       DESC:

	   GLOBALS -
	       READ:
	        SET:

	      INPUT:
	     OUTPUT:

	  ---- Revision History ------------------------------------------------

	   04/12/02 - KRISHNAG - ARQ # 49794
                      Converted to PSL

	*/
	quit

MAIL(MSG,BCHNUM)	// Mail the message in MSG

	new I,IO,N,PARAM,SUBJ,USER,USERS,X,ZREC

	set IO=$$SCAU^%TRNLNM("SPOOL","MAIL"_$J_".TMP")

	type IO io=Class.new("IO")
	set io.fileName=IO
	set io.openParams="NEWV/WRITE"
	
	do io.open()

	set N="" for  set N=$O(MSG(N)) quit:N=""  do {

		set ZREC=MSG(N)

		do io.write(.ZREC)
		}

	do io.close()

	// Queuing Processing Status
	set SUBJ=$$^MSG(4541)

        type RecordQUEUEB queueb=Db.getRecord("QUEUEB","BCHNUM=:BCHNUM")
	set USERS=queueb.mailf

	for I=1:1 set USER=$P(USERS,",",I) quit:USER=""  do {
		set X=$$MAIL^%OSSCRPT(.MSG,USER,SUBJ,IO)	
		}

	set X=$$DELETE^%OSSCRPT(IO_";*")		
	quit


BRCD(MSG,BCHNUM)	// Broadcast the message in MSG

	new I,PARAM,USER,USERS,X

	type RecordQUEUEB queueb=Db.getRecord("QUEUEB","BCHNUM=:BCHNUM")
	set USERS=queueb.brcdf

	for I=1:1 set USER=$P(USERS,",",I) quit:USER=""  do {
		set X=$$BRCDMSG^%OSSCRPT(MSG,USER)		
		}
	quit

vSIG()	quit "59886^43598^Sanchez SCM Administrator^1198"	// Signature - LTD^TIME^USER^SIZE
