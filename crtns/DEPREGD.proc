DEPREGD	
	/*
	  Procedure ID: DEPREGD
	  DESC: Update Reg D fields on DEP.

	  ORIG: YURKOVICG - 49040 (PSL) / WALTONJ - 43395 (Non-PSL)

	  -----------------------  Revision History  -------------------------

	12/22/03 spier 7501
		changed table in resultset from DAYENDREGD to dep 
		as well as where clause to force the access to use the index

	   1/29/2002 - YURKOVICG - 49040
		This procedure updates regulation D reporting columns located
		on the DEP table.  This procedure is called by function QUE118.
		In ARQ 43395, it was retrofitted back to v5.3.  This procedure
		has been converted to PSL to be compliant with v6.3 directories.

	  --------------------------------------------------------------------

	*/

	new rs,XCID,XTJD
	set XTJD=%SystemDate

	type ResultSet rs
	set rs=Db.select("DISTINCT CID","dep","MMDA3=:XTJD AND REGD='5'")
	if 'rs.isEmpty() for  quit:'rs.next()  do {  set ER=0

		catch vERROR1 {
			new ET,RM
			set ET=vERROR1.type

			if ET["%GTM-" do ZE^UTLERR quit

			set ET=ET_"-"_vERROR1.thrownAt
			set RM=vERROR1.description
			do ^UTLERR
			}

		set XCID=rs.getCol(1)

		// Retrieve DEP record from database and update it.
		new dep
		type RecordDEP dep
		set dep=Db.getRecord("DEP","XCID")
		do dep.setAuditFlag(1)

		// Move monthly totals back one month
		set dep.mmdac12=dep.mmdac11
		set dep.mmdac11=dep.mmdac10
		set dep.mmdac10=dep.mmdac9
		set dep.mmdac9=dep.mmdac8
		set dep.mmdac8=dep.mmdac7
		set dep.mmdac7=dep.mmdac6
		set dep.mmdac6=dep.mmdac5
		set dep.mmdac5=dep.mmdac4
		set dep.mmdac4=dep.mmdac3
		set dep.mmdac3=dep.mmdac2
		set dep.mmdac2=dep.mmdac1
		set dep.mmdac1=dep.mmda1
		set dep.mmda1=0

		// Move limited transaction numbers back one month
		set dep.mmdat12=dep.mmdat11
		set dep.mmdat11=dep.mmdat10
		set dep.mmdat10=dep.mmdat9
		set dep.mmdat9=dep.mmdat8
		set dep.mmdat8=dep.mmdat7
		set dep.mmdat7=dep.mmdat6
		set dep.mmdat6=dep.mmdat5
		set dep.mmdat5=dep.mmdat4
		set dep.mmdat4=dep.mmdat3
		set dep.mmdat3=dep.mmdat2
		set dep.mmdat2=dep.mmdat1
		set dep.mmdat1=dep.mmda2
		set dep.mmda2=0

		// Compute MMDA cycle date
		set dep.mmda3=$$NJD^UFRE(XTJD,dep.mmda4)

		// Save the updated DEP record
		do dep.save()
		}

	quit

vSIG()	quit "59886^43512^Sanchez SCM Administrator^2104"	// Signature - LTD^TIME^USER^SIZE
