TPRFINI	// Initialize ^TPRF

	/*

	---- Revision History ------------------------------------------------

	10/18/05 - TITOVE - CR 17832
		   Modified to correct logic and remove code not needed
		   due to elimination of global kills.

	05/05/05 - TITOVE - CR 14192
	   	   Modified as part of DBI2 project. Removed unused code,
	   	   the only place that calls this procedure is PATPOS.

	-----------------------------------------------------------------------

	*/

	quit
	

public	SET(Number BRCD,			// Branch code
	     String UID,			// User ID
	        Date JD)			// Processing date


	// Reset TPCTRL table entry
	type RecordTPCTRL tpctrl = Db.getRecord("TPCTRL", "BRCD = :BRCD, UID = :UID, TPD = :JD", 1)	

	set tpctrl.lsttrn = ""
	set tpctrl.accmplt = ""

	do tpctrl.save()
	
	// Delete TPETC and TPPMTOT tables
	do Db.delete("TPETC","BRCD=:BRCD AND UID=:UID AND TPD=:JD")
		
	do Db.delete("TPPMTOT","BRCD=:BRCD AND UID=:UID AND TPD=:JD")

	// If there is PM activity, reset for that date also
	if tpctrl.pmdate,(tpctrl.pmdate '= JD) do SET(BRCD,UID,tpctrl.pmdate)

	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "60191^51143^Eugene Titov^1012"	// Signature - LTD^TIME^USER^SIZE
