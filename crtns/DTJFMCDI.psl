DTJFMCDI		/*
	 ORIG: ofaltr - 06/26/2000
	 DESC: Computed Fields for DTJFM
	
	---- Comments --------------------------------------------------------
  	 LIBRARY:
  	  $$  CHKHI	High Order Check Number
	  $$  STP3	Stop 3 Sequence
	  $$  AMT	Check Amount
	  $$  STP4 	Stop 4 Sequence
	  $$  ACH	Company Name
	  $$  STP5	Stop 5 Sequence
	  $$  PHSEQ	Permanent Hold Sequence Number
	  $$  CHKLO	Low Order Check Number
	  $$  FID	File ID
	  $$  CURRVAL	Current Value
	
	---- Revision History ------------------------------------------------
	
	03/22/05 - SmithCD - 13782
		   Modified CURRVAL section to correct undefined variable par, 
		   and to prevent invalid data item error.

	12/15/04 - JERUCHIMC - 13141
		   Remove many parameters from certain section and just pass
		   TCMT directly.
	
	09/25/00 - HAILEYK - 41904
		Added linetags FID and CURRVAL.  FID returns the File which
		was modified and CURRVAL returns the current value of the 
		field which was modified.
	
	07/25/00 - OFALTR - 40116
		Added Section CHKLO to calculate the Low Order Check
		Number.

	*/

	quit

CHKHI(Number XCID,String XTCMT)	//
	/*
        The function is used to compute [DTJFM]CHKHI field.
        
        ARGUMENTS:
        	
		XCID	Account Number		/TYPE=N/REQ/MECH=VAL
              XTCMT    Transaction Comment      /TYPE=T/REQ/MECH=VAL
        
         RETURNS: High Order Check Number
        
         EXAMPLE: $$CHKHI^DTJFMCDI(CID,TCMT)
	*/
 
	type Number XCHKHI,XSEQ
	 
	set XCHKHI=$P(XTCMT,"High Order Check Number ",2)
	if '(+XCHKHI) quit ""
	set XSEQ=$P(XCHKHI,"Sequence ",2),XCHKHI=+XCHKHI

	if 'Db.isDefined("STOP3","XCID,XCHKHI,XSEQ") quit ""

	quit +XCHKHI
	

	
STP3(String XTCMT)	//
	/*
        The function is used to compute [DTJFM]STP3 field.
        
        ARGUMENTS:
           
              XTCMT    Transaction Comment      /TYPE=T/REQ/MECH=VAL
        
        
         RETURNS: Stop 3 Sequence
        
         EXAMPLE: $$STP3^DTJFMCDI(TCMT)
	*/
	
	type Number XSTP3
	set XSTP3=$P(XTCMT,"High Order Check Number ",2)
	set XSTP3=$P(XTCMT,"Sequence ",2)
	quit XSTP3
	

AMT(Number XCID, String XTCMT)	//
	/*
        The function is used to compute [DTJFM]AMT field.
        
        ARGUMENTS:
		CID	Account Number		/TYPE=N/REQ/MECH=VAL
	      XTCMT    Transaction Comment      /TYPE=T/REQ/MECH=VAL
        
        
         RETURNS: Check Amount
        
         EXAMPLE: $$AMT^DTJFMCDI(CID,TCMT)
	*/
	 
	type Number XAMT,XSEQ
	 
	set XAMT=$P(XTCMT,"Check Amount ",2)
	if '(+XAMT) quit ""
	set XSEQ=$P(XAMT,"Sequence ",2),XAMT=+XAMT

	if 'Db.isDefined("STOP4","XCID,XAMT,XSEQ") quit ""

	quit +XAMT
	
STP4(String XTCMT)	//
	/*
        The function is used to compute [DTJFM]STP4 field.
        
        ARGUMENTS:
               
               XTCMT    Transaction Comment      /TYPE=T/REQ/MECH=VAL
        
         RETURNS: Stop 4 Sequence
        
         EXAMPLE: $$STP4^DTJFMCDI(TCMT)
	*/
	 
	type Number XSTP4 
	
	set XSTP4=$P(XTCMT,"Check Amount ",2)
	set XSTP4=$P(XSTP4,"Sequence ",2)
	quit XSTP4

ACH(Number XCID,String XTCMT)	//
	/*
        The function is used to compute [DTJFM]ACH field.
        
        ARGUMENTS:
		CID	Account Number		/TYPE=N/REQ/MECH=VAL
                XTCMT    Transaction Comment      /TYPE=T/REQ/MECH=VAL
        
         RETURNS: Company Name
        
         EXAMPLE: $$ACH^DTJFMCDI(TJD,CLS,GRP,TYP,CID,TSEQ)
	*/
  	
	type Number XACH,XSEQ
	
	set XACH=$P(XTCMT,"Company Name ",2)
	if '(+XACH) Q ""
	set XSEQ=$P(XACH,"Sequence ",2),XACH=+XACH

	if 'Db.isDefined("STOP5","XCID,XACH,XSEQ") quit ""

	quit +XACH
	

STP5(String XTCMT)	
	/*
        The function is used to compute [DTJFM]STP5 field.
        
        ARGUMENTS:
               
                XTCMT    Transaction Comment      /TYPE=T/REQ/MECH=VAL
        
         RETURNS: Stop 5 Sequence
        
         EXAMPLE: $$STP5^DTJFMCDI(TJD,CLS,GRP,TYP,CID,TSEQ)
	*/
 
	type Number XSTP5	

	set XTCMT=$P(XTCMT,"Company Name ",2)
	set XSTP5=$P(XTCMT,"Sequence ",2)
	quit XSTP5
	

PHSEQ(Number XCID, String XTCMT)	//
	/*
        The function is used to compute [DTJFM]PHSEQ field.
        
        ARGUMENTS:
		CID	Account Number		/TYPE=N/REQ/MECH=VAL
                XTCMT    Transaction Comment      /TYPE=T/REQ/MECH=VAL
        
         RETURNS: Permanent Hold Sequence Number
        
         EXAMPLE: $$PHSEQ^DTJFMCDI(TJD,CLS,GRP,TYP,CID,TSEQ)
	*/
	 
	type Number XPHSEQ
	
	set XPHSEQ=+$P(XTCMT,"Permanent hold Sequence Number ",2)

	if 'Db.isDefined("PHLD","XCID,XPHSEQ") quit ""

	quit XPHSEQ
	
CHKLO(Number XCID,String XTCMT)   //Low Order Check Number
        /*
        The function is used to compute [DTJFM]CHKLO field.
 
        ARGUMENTS:
                 
                CID     Account Number          /TYPE=N/REQ/MECH=VAL
              XTCMT    Transaction Comment      /TYPE=T/REQ/MECH=VAL
                
 
         RETURNS: High Order Check Number
 
         EXAMPLE: $$CHKLO^DTJFMCDI(CID,TCMT)
        */
	
	type Number XSEQ,XCHKHI,XCHKLO
	
	set XCHKHI=$$CHKHI(XCID,XTCMT)
	if XCHKHI="" quit ""
	set XSEQ=$$STP3(XTCMT)
	
	
	type RecordSTOP3 stop3
	
	set stop3=Db.getRecord("STOP3","XCID,XCHKHI,XSEQ")
	set XCHKLO=stop3.chklo
	
	quit XCHKLO


FID(String XTCMT)	// File that was modified

	/*
	The function is used to compute [DTJFM]FID field.

        ARGUMENTS:
                XTCMT    Transaction Comment      /TYPE=T/REQ/MECH=VAL

	RETURNS: File that was modified.
 
	EXAMPLE: $$FID^DTJFMCDI(XTCMT)
	*/
	
	type String FID
	 
	set FID=$P($P(XTCMT,"]",1),"[",2)
	quit FID


CURRVAL(Date %SystemDate,	// System processing date
	String CLS,		// Product class
	String GRP,		// Product group
	Number TYP,		// Product type
	Number CID,		// Product number
	Number TSEQ)		// Transaction Sequence Number

	/*

	Current value of field that was modified

	The function is used to compute [DTJFM]CURRVAL field.

        RETURNS: Current value of field that was modified
 
        EXAMPLE: $$CURRVAL^DTJFMCDI(TJD,CLS,GRP,TYP,CID,TSEQ)
        */
	 
	type String par, DI, ER, FID

	set (par, ER) = ""
	
	type RecordDTJFM dtjfm = Db.getRecord("DTJFM", "TJD=:TJD,CLS=:CLS,GRP=:GRP,TYP=:TYP,CID=:CID,TSEQ=:TSEQ")

	set DI = dtjfm.di
	set FID = dtjfm.fid
	
	if (DI.isNull()) ! (FID.isNull()) quit ""
	
	// If "CID" is not a field in the table definition, the dynamic select 
	// will fail
	if 'Db.isDefined("DBTBL1D", "%LIBS='SYSDEV',FID=:FID,DI='CID'") quit ""

	#ACCEPT DATE=12/15/04; PGM=Jeruchimc
	type ResultSet rs = Db.select(DI, FID, "CID=:CID")

 	if rs.next() set par = rs.getCol(1)

	quit:ER ""
	quit par
 #OPTION ResultClass ON
Public String vSIG()	quit "59987^38439^Chad Smith^6249"	// Signature - LTD^TIME^USER^SIZE
