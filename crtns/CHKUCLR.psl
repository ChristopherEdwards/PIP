CHKUCLR	//;CHECK REGISTER CHECK UNCLEAR FUNCTION
	/*
	       ORIG:  Jill Bulkin (6838) - 05/16/86
	   PROJ #'S:  1346
	       DESC:  MARK CHECKS IN THE CHECK REGISTER AS UNCLEARED -REMOVE DATE

	---- Revision History ------------------------------------------------
	02/15/07 - RussellDS - CR25382
		   Eliminated use of obsoleted routine DBSQRYA.  Corrected
		   logic.
		   
		   Removed old revision history.	   
	*/

	// init variables
	
	set %="|" 
	set %ProcessMode=0
	set (%PG,%PAGE)=1 
	set ER=0

	kill CHKCLR,OLNTB
	do VPG

	quit

VPG	// Page control
	if VFMQ.exists(),"DFQ"[VFMQ do VER quit

	if %PG>0 do VPG01 quit:ER  do VPG quit

	do VPG01
	
	quit	

VPG01	//
	set %TAB("CO")=".CO2/TBL=[CHKREG1]CO:DISTINCT:QU"
	set %TAB("CKTYP")=".CHKTYP1/TBL=[UTBLCHKS]/XPP=D POS^CHKCLR"
	set %TAB("CKNOQ")=".CKNO2/TBL=[CHKREG1]CKNO:DISTINCT:QU ""[CHKREG1]CO=<<CO>> AND [CHKREG1]CTYPE=<<CKTYP>> AND [CHKREG1]GL=<<GL>>""/HLP=[CHKREG1]CKNO/XPP=D EXT^DBSQRY"
	set %READ="@@%FN,,,CO/REQ,CKTYP/REQ,CKNOQ/REQ"

	// JMH - 02/07/01
	do ^UTLREAD 

	if VFMQ="Q" set ER=1 set RM=$$^MSG(8483) quit

	quit


VER	//
	if VFMQ="Q"!(ER) do EXIT quit    		// JMH - 02/01/01

	set ER=0 

	do CHECKS 

	quit
	

CHECKS //
	type public Number GL
	type public String CKNOQ
	
	type Number CKNO
	type String DQQRY(), WHERE
	
	set DQQRY(1) = "[CHKREG1]CKNO "_CKNOQ
	set WHERE = $$WHERE^SQLCONV(.DQQRY(), "CHKREG1")
	set WHERE = "CO=:CO AND GL=:GL AND ("_WHERE_")"
	
	#ACCEPT Date=02/15/07; Pgm=RussellDS; CR=25356; Group=Dynamic
	type DbSet ds = Db.selectDbSet("CHKREG1", WHERE, "CKNO")
	
	while ds.next() do {
		
		type RecordCHKREG1 chkreg1 = ds.getRecord("CHKREG1")

		// already voided
		if chkreg1.status=2 set ER=1 quit        

		// not cleared
		if chkreg1.status=0 set ER=1 quit         

		do FILE(.chkreg1)

	}
	
	do EXIT
	
	quit
	

FILE(RecordCHKREG1 chkreg1) 	// File data

	set chkreg1.status=0 
	set chkreg1.clear=""

	//Update check register
	do chkreg1.bypassSave()
	
	quit


EXIT	// Exit function

	//"Check clear correction completed"
	if 'ER set ER="W" set RM=$$^MSG(8482) quit

	set RID="CHKCLR2"
	do DRV^URID                            // call exception report

	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "60712^46292^Dan Russell^2001"	// Signature - LTD^TIME^USER^SIZE
