LNBLPRG	// BILL FILE PURGE
	/*
	       DESC:  Called by report SCA164 (@LNU003 function)

	---- Revision History ------------------------------------------------

	05/20/05 - KinI- 15524
		   Restructured to satisfy SCA165 report expectations.
		   
	05/22/03 - GRAY - 51351
		   Converted to PSL.  Purged records are no longer being 
		   written to RMS files, so the old code related to that
		   process has been removed.
	*/
	
	quit
	
public BILCHK(Number CID,	// Account Number	
	      Number SCHSEQ,	// Bill Sequence	
	      Number RET,	// Number of Bills to Retained
	      Number CNT)	// Number of Bills on file
	      
	// This function called from SCA164 report fetch post-processor
	// checks if the bill record qualifies for purging. 
	 
	type RecordLN ln=Db.getRecord("LN","CID=:CID")
	type RecordLNBIL1 lnbil1=Db.getRecord("LNBIL1","CID=:CID,SCHSEQ=:SCHSEQ",1)
	
	if lnbil1.getMode()=0 quit 0
	
	// Misc charges are not satisfied
	if ln.mchg quit 0
	
	// Pmt Amt Still Due
	if lnbil1.casd > 0 quit 0
	
	// There are less bills then Number of Satisfied Bills to Retain
	if (CNT < (RET+1)) quit 0
	
	// Pmt Due Date is after Sch Pmt Last Date
	if (lnbil1.cdpd '< ln.schld) quit 0
	
	quit 1
	
		
public BILPRG(Number CID,	// Account Number	
	      Number SCHSEQ)	// Bill Sequence	
	      
	type public Number ER

	do Db.delete("LNBIL1","CID=:CID AND SCHSEQ=:SCHSEQ") quit:ER
	do Db.delete("LNBIL5","CID=:CID AND SCHSEQ=:SCHSEQ") quit:ER	

	quit
	
	

vSIG()	quit "60030^45160^Irina Kin^1378"	// Signature - LTD^TIME^USER^SIZE
