LNPA	 /* 
    ORIG: GRAY - 01/18/2000
    DESC: Loan Profitability Analysis Summary
    
    ---- Comments --------------------------------------------------------
    
    ---- Revision History ------------------------------------------------
 
 	11/11/06 - SANTHUMS - CR 23493
 		 . Modified VPGOO section to pass the parameter CPE for the 
 		   call DAYS^PABOD, Since the error was getting displayed 
 		   actual list is absent from formal list. 
                 . Modified LNPA4 section to avoid undefined local variable 
                   on %PG.
	
 	02/07/06 - Carrie Baildon - CR 16889
 		   Modified section LNAP4 to control the pages within this
 		   section. Old screen drivers handled page control in sections
 		   VPG and VPG0 recursively. This is not an ideal coding practice
 		   and so the structure was changed to eliminate sections VPG and
 		   VPG0 and instead call the prompt driver VPG00 and screen 
 		   driver VPG01 within LNAP4. Replaced references to %O with 
 		   %ProcessMode.
 
	08/26/05 - Radhika - CR 16889
		   .Added code ZCLS=""L"" in VPG00 to allow only the selection
		    of loan accounts.
		   .Re-written the section VPG01.
		   .Clean up warnings.
		   .Removed ERR section.
		   .Removed the code "set SID="LNAP4" in LNPA4 section. 
		   		   
	12/08/99 - GRAY - 32507
		   Removed code no longer needed due to the Elimination
		   of Teller/Branch Character Interface and placed remaining
		   code into PSL'd procedure definition.  

 */
	
	quit
	
public LNAP4	//
	type public Number SCR, CID
	type public String Y
	type public Boolean ER
	type Number %PAGE
	type String VFMQ

	type RecordPAA fPAA 
	set SCR = 4
	set %PAGE = 1
	set %ProcessMode = 1
	set Y = ""
	set CID = ""
	set ER = 0
	
	// Prompts and set-up information
       
	do VPG00(.fPAA) if (VFMQ["Q")!(ER) quit
	do VPG01(.fPAA) if (VFMQ["Q")!(ER) quit 
        if VFMQ["F" do VER(.fPAA)
                
	quit
	
VPG00(RecordPAA fPAA)	// Set up
	type public String VFMQ
	type String %TAB(), %READ
	set %TAB("EFD") = ".EFD1/XPP=set CPE=X do DAYS^PABOD(.CPE)"
	set %TAB("CID") = ".CID1/XPP=set ZCLS=""L"",%EXT=1 do ^UACN"
	set %READ = "@@%FN,,,EFD/REQ,CID/REQ"
	do ^UTLREAD if VFMQ = "Q" quit
	set VFMQ = "C"

	set fPAA = Db.getRecord("PAA", "EFD=:EFD,CID=:CID", 1)
	quit
	
VPG01(RecordPAA fPAA)	// Screen
	type public Number CID
	
	type RecordLN ln = Db.getRecord("LN", "CID=:CID",1)
	type RecordPAD pad = Db.getRecord("PAD", "EFD=:%EffectiveDate", 1) 
	do DRV^USID(%ProcessMode, "LNAP4", .fPAA, .ln, .pad)
	quit
		
VER(RecordPAA fPAA)	//
	type public String VFMQ
	if %ProcessMode=2!(%ProcessMode=4)!(VFMQ="Q") do END quit
	do FILE(.fPAA)
	quit
	 
FILE(RecordPAA fPAA)	// File data
	do fPAA.bypassSave()
	do END
	quit
		
END	//lock
	type public Number ER, CID
	type public String RM, VFMQ

	quit:ER!(%ProcessMode = 2)!(%ProcessMode = 4)
	set CID = CID.get()
	// Account ~p1 not modified
	if VFMQ = "Q" set RM = $$^MSG(135,CID)

	// Account ~p1 modified
	else  set RM = $$^MSG(122,CID)
	set ER = "W"
	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "60582^18827^Sunitha Santhumayor^2899"	// Signature - LTD^TIME^USER^SIZE
