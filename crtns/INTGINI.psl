public	INTGINI
  /*
	ORIG: titove - 12/21/2004
	DESC: Integrity check setup

	---- Comments --------------------------------------------------------
	Initialization program for teller totals to define queries,
	needed by procedure CHKINT.
	---- Revision History ------------------------------------------------
	
	02/15/07 - RussellDS - CR25382
		   Eliminated use of obsoleted routine DBSQRYA.  Just return
		   A() array to CHKINT and it will construct queries.
		   
		   Added CHKTYP.

	03/03/05 - TITOVE - CR 13728
		   Converted into PSL.
	*/

	type public String A(), VFMQ, %UID
	type public Number BRCD, %EXT
	
	type String I, DFID, DLIB, DOCFID, DOCLIB, DQQRY(), KVAR, %READ, %TAB
	type Number QD()

        set A(1) = %SystemDate
        set A(11) = ""
	if BRCD.get() set A("BRCD") = BRCD 
	if %UserID.get() set A("UID") = %UserID

	for I = "BRCD","UID","TSEQ",5:1:10 if 'A(I).data() set A(I) = "ALL"

	set %TAB("A(1)") = ".XJD1/HLP=[TTX]TJD/XPP=D TJD^INTGINI"
	set %TAB("A(""BRCD"")") = ".A5/HLP=[TTX]BRCD/XPP=D EXT^DBSQRY"
	set %TAB("A(""UID"")") = ".A3/HLP=[TTX]UID/XPP=D EXT^DBSQRY"
	set %TAB("A(""TSEQ"")") = ".A6/HLP=[TTX]TSEQ/XPP=D EXT^DBSQRY"
	set %TAB("A(5)") = ".A7/HLP=[PRODCTL]CLS/XPP=D EXT^DBSQRY"
	set %TAB("A(6)") = ".A8/HLP=[PRODCTL]GRP/XPP=D EXT^DBSQRY"
	set %TAB("A(7)") = ".QI1/HLP=[PRODCTL]TYPE/XPP=D EXT^DBSQRY"
	set %TAB("A(8)") = ".A9/HLP=[TTX]ETC/XPP=D EXT^DBSQRY"
	set %TAB("A(9)") = ".A10/HLP=[TTX]TAMT/XPP=D EXT^DBSQRY"
	set %TAB("A(10)") = ".A11/HLP=[TTX]TIM/XPP=D EXT^DBSQRY"
	set %TAB("A(11)") = ".A12/HLP=[TTX]TCMT/XPP=D EXT^DBSQRY"
	set %TAB("IO") = $$IO^SCATAB($I)

	set %READ = "@@%FN,,,A(1)/REQ,IO/REQ,,A(""BRCD""),A(""UID""),A(""TSEQ""),A(5),A(6),A(7),A(8),A(9),A(10),A(11)"
	set DOCLIB = "SYS"
	set DOCFID = "TTX"
	set DLIB = "SYSDEV"
	set DFID = "TTX"

	do ^UTLREAD if VFMQ = "Q" kill A quit
	
	quit

	
TJD	// Date post processor

	type public Date X
	type public Boolean ER
	
	type Date %JD
	
	if X.isNull() quit
	
	set %JD = $$^SCAJD(X)
	
	// Invalid date ~p1
	if %JD < 0 do Runtime.setErrMSG("TTX",1308,%JD) quit:ER
	
	quit
	
	
private CHKTYP( Number CID,	// Account Number
		String WHERE)	// Where clause
		
	/*
	Check account TYPE if query on TYPE.
	
	Called by CHKINT.proc since cannot currently do two dynamic
	queries under same stack level.
	
	RETURNS:
		. $$	Indicator as to whether account		/TYP=L
			passes query on TYPE
			0 = does not pass
			1 = passes
	*/
	
	type Boolean isType
	
	#ACCEPT Date=12/16/07; Pgm=RussellDS; CR=25356; Group=Dynamic	
	type ResultSet rs = Db.select("CID", "ACN", "CID=:CID "_WHERE)
			
	if rs.isEmpty() set isType = 0
	else  set isType = 1
	
	quit isType
 #OPTION ResultClass ON
Public String vSIG()	quit "60712^46293^Dan Russell^2533"	// Signature - LTD^TIME^USER^SIZE
