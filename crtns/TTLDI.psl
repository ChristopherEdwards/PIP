TTLDI	
	/*
	     ORIG:  THAI -  2 OCT 1991
	CALLED BY:  Report SCA408
	     DESC:

	    INPUT:
	   OUTPUT:
	   
	---- Revision History ------------------------------------------------
	
	03/14/05 - SmithCD - CR 13782
		   Fixed RECNOFL error in BL section by passing the classNew 
		   parameter to the Db.getRecord on TTL. Modified to comply 
		   with current PSL standards. Consolidated like code into 
		   new $$TRBPROD function. Removed CRCD parameter (no longer 
		   used) from DAYNET, MONTHNET, and YEARNET tags.
	
	04/09/02 - CHHABRIAS - 49794
		   Converted to PSL.

	03/14/00 - TANY - 37587
	           Modified SCADAT calls by passing an additional
	           parameter to the calls to improve performance.
	           The parameter is a "1" which will return a known
	           julian date.


	*/

        quit

public	BL(Date BDATE,
	   String BCURR,		// Currency code
	   String BCLS,			// Product class
	   String BGRP,			// Product group
	   String BTYPE,		// Product type
	   String BGL,			// GL set code
	   Number BCC)			// Cost center

	// Get the beginning of the month balance
	
	type Date LMJD

	set LMJD = $$BOMJD^SCADAT(BDATE, 1) - 1
	type RecordTTL ttl = Db.getRecord("TTL", "TJD=:LMJD,CRCD=:BCURR,CLS=:BCLS,GRP=:BGRP,TYPE=:BTYPE,GLSC=:BGL,CC=:BCC", 1)

	quit ttl.bal
	

public	DAYNET(Number TYPE,		// Product type
	       Number DCR,		// Credit amount
	       Number DDR,		// Debit amount
	       Number DTRIN,		// TRansfer-in totals
	       Number DTROUT)		// Transfer-out totals

	// Calculate the daily net balance

	type Number DAYNET

	set DAYNET = (DCR + DTRIN) - (DDR + DTROUT)
	if $$TRBPROD(TYPE) = 1 set DAYNET = -DAYNET

	quit DAYNET


public	MONTHNET(Number TYPE,	// Product type
		 Number MCR,	// Month-to-date credit amount
		 Number MDR,	// Month-to-date debit amount
		 Number MTRIN,	// Month-to-date transfers-In -- totals
		 Number MTROUT)	// Month-to-date transfers-our -- totals

	// Calculate the monthly net balance

	type Number MONTHNET
		
	set MONTHNET = (MCR + MTRIN) - (MDR + MTROUT)
	if $$TRBPROD(TYPE) = 1 set MONTHNET = -MONTHNET

	quit MONTHNET


public	YEARNET(Number TYPE,	// Product type
		Number YCR,	// Year-to-date credit amount
		Number YDR,	// Year-to-date Debit amount
		Number YTRIN,	// Year-to-date transfers-in -- Totals
		Number YTROUT)	// Year-to-date transfers-out -- Totals

	// Calculate the yearly net balance
	
	type Boolean TRB
	type Number YEARNET


	set YEARNET = (YCR + YTRIN) - (YDR + YTROUT)
	if $$TRBPROD(TYPE) = 1 set YEARNET = -YEARNET

	quit YEARNET

	
TRBPROD(Number TYPE)		// Product type

	// Return the TRB value for the product type

	type Number TRB = ""

	type RecordPRODCTL prodctl = Db.getRecord("PRODCTL", "TYPE=:TYPE")

	if prodctl.cls = "D" do {
		type RecordPRODDFTD proddftd = Db.getRecord("PRODDFTD", "TYPE=:TYPE")
		set TRB = proddftd.trb
		}
		
	if prodctl.cls = "L" do {
		type RecordPRODDFTL proddftl = Db.getRecord("PRODDFTL", "TYPE=:TYPE")
		set TRB = proddftl.trb
		}

	quit TRB
	
 #OPTION ResultClass ON
Public String vSIG()	quit "59987^53656^Chad Smith^2867"	// Signature - LTD^TIME^USER^SIZE
