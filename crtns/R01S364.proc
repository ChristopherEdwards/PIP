R01S364	// SCA383 - RPA Statements
	// Copyright(c)2007 Sanchez Computer Associates, Inc.  All Rights Reserved - 01/31/2007 12:48 - shetyes

	type public Number ER=0
	type public Number vbatchq
	type public String IO,RM,VRWOPT()
	type public String FD,PAGE,TD,YEAR
	type String FIRST
	type Number OLNTB
	type String %READ,RID,RN,%TAB,VFMQ
	type String VIN1="ALL"
	type String VIN2="ALL"

	set RID="SCA383"
	set RN="RPA Statements"
	if IO.get()="" set IO=$I

	do INIT^%ZM()

	do VPREBQ quit:VFMQ.get()			// Pre-processor (before query)

	set %TAB("IO")=$$IO^SCATAB
	set %TAB("VIN1")="|255||[CIF]ACN|[CIF]ACN:DISTINCT:NOVAL||D EXT^DBSQRY||T|Customer Number|||||"
	set %TAB("VIN2")="|255||[DEP]IRA|[UTBLRSPDEF]:NOVAL||D EXT^DBSQRY||T|RPA Type|||||"

	set %READ="IO/REQ,VIN1#0,VIN2#0,"

	// Skip device prompt option
	if VRWOPT("NOOPEN").get() set %READ=%READ.piece(",",2,99)

	set VFMQ=""
	if %READ'="" do { quit:VFMQ.get()="Q"
		set OLNTB=30
		set %READ="@RN/CEN#1,,"_%READ
		do ^UTLREAD
		}

	if 'vbatchq.get() do V0
	quit

V0	// External report entry point

	type Boolean VHIT
	type public Number AUXPTR,ER,VTBLNAM
	type public String IO,IOPAR,IOSL,IOTYP,%MSKD,RM,VDISTKEY,VRWOPT()
	type public String FD,PAGE,TD,YEAR
	type public String FIRST
	type public String VIN1,VIN2
	type Number vcrt,VD(),VFMQ,vh(),vI,vlc,VLC,VNEWHDR,VOFFLG,VPN,VR,VRG,vs(),VSEQ,VT()
	type String VWHERE
	type Literal String VSELECT
	type String %TIM,ACN,ADDR(),BALBEG,BALTOT,CID,CONAM,FDT,IRA,IRN,MDT,MINDIST,ODT,RESETPG,RID,RN,RPASEQ,STAR,TACR,TEMP,TEMP1,TEMP2,TEMP3,V,VL,VLOF,VRF(),VSKIPREC,VSTATS(),vCOL,vHDG,vc1,vc10,vc11,vc12,vc2,vc3,vc4,vc5,vc6,vc7,vc8,vc9,vovc1,vovc2,vovc8,vrundate,vsysdate

	type RecordCUVAR cuvar=Db.getRecord("CUVAR")

	set CONAM=CUVAR.conam
	set ER=0,RID="SCA383",RN="RPA Statements"
	set VL=""

	use 0 if 'VRWOPT("NOOPEN").get() do { quit:ER
		if 'VRWOPT("IOPAR").get().isNull() set IOPAR = VRWOPT("IOPAR")
		else  if ((IOTYP.get()="RMS")!(IOTYP.get()="PNTQ")),('IOPAR.get().isLike("%/OCHSET=%")),$$VALID^%ZRTNS("UCIOENCD") do {
			// Accept warning if ^UCIOENCD does not exist
			#ACCEPT Date=07/26/06; Pgm=RussellDS; CR=22121; Group=MISMATCH
			type String CHRSET=$$^UCIOENCD("Report","SCA383","V0","*")
			if 'CHRSET.isNull() set IOPAR = IOPAR_"/OCHSET="_CHRSET
		}
		do OPEN^SCAIO
	}
	set vcrt=(IOTYP="TRM")
	if 'vcrt set IOSL=60				// Non-interactive
	else  do {					// Interactive
		do TERM^%ZUSE(IO,"WIDTH=81")
		write $$CLEARXY^%TRMVT
		}

	do INIT^%ZM()

	set vCOL="[DEP]GRP#1#4,[DEP]CID#8#12,[DEP]IPY#55#8"

	// Build WHERE clause to use for dynamic query
	do {
		type Number SEQ=1
		type String DQQRY(),FROM
		if VIN1.get()="" set VIN1="ALL"
		if VIN1'="ALL" set DQQRY(SEQ)="[CIF]ACN "_VIN1,SEQ=SEQ+1
		if VIN2.get()="" set VIN2="ALL"
		if VIN2'="ALL" set DQQRY(SEQ)="[DEP]IRA "_VIN2,SEQ=SEQ+1
		set DQQRY(SEQ)="[SYSDEV,DEP]DTC="""" OR [SYSDEV,DEP]DTC'< <<FD>>",SEQ=SEQ+1
		set DQQRY(SEQ)="[SYSDEV,DEP]IRA>0",SEQ=SEQ+1
		set FROM=$$DQJOIN^SQLCONV("DEP,CIF,IRATYPE") quit:ER
		set VWHERE=$$WHERE^SQLCONV(.DQQRY,"")
		}

	// Print Report Banner Page
	if cuvar.banner,'VRWOPT("NOBANNER").get(),IOTYP'="TRM",'AUXPTR.get() do {
		type String VBNRINFO()

		set VBNRINFO("PROMPTS",1)="WC2|"_"Customer Number"_"|VIN1|"_VIN1.get()
		set VBNRINFO("PROMPTS",2)="WC2|"_"RPA Type"_"|VIN2|"_VIN2.get()


		do {
			type Number SEQ
			type String VALUE,VAR,X
			set X=VWHERE
			set SEQ=""
			for  set SEQ=VBNRINFO("PROMPTS",SEQ).order() quit:SEQ=""  do {
				set VAR=VBNRINFO("PROMPTS",SEQ).piece("|",3))
				set VALUE=VBNRINFO("PROMPTS",SEQ).piece("|",4,99)
				set X=$$replace^DBSRWUTL(X,":"_VAR,"'"_VALUE_"'")
				}
			set VBNRINFO("WHERE")=X
			}

		set VBNRINFO("DESC")="RPA Statements"
		set VBNRINFO("PGM")="R01S364"
		set VBNRINFO("RID")="SCA383"
		set VBNRINFO("TABLES")="DEP,CIF,IRATYPE"

		set VBNRINFO("ORDERBY",1)="[SYSDEV,CIF]ACN"
		set VBNRINFO("ORDERBY",2)="[SYSDEV,DEP]RPASEQ"
		set VBNRINFO("ORDERBY",3)="[SYSDEV,DEP]CID"


		do ^DBSRWBNR(IO,.VBNRINFO)		// Print banner
		}

	// Initialize variables
	set (vc1,vc2,vc3,vc4,vc5,vc6,vc7,vc8,vc9,vc10,vc11,vc12)=""
	set (VFMQ,vlc,VLC,VOFFLG,VPN,VRG)=0
	set VHIT = 0
	set VNEWHDR=1
	set VLOF=""
	set %TIM=$$TIM^%ZM
	set vrundate=%CurrentDate.toString(),vsysdate=%SystemDate.toString()

	do {
		type Number I,J,K
		for I=0:1:3 do {
			set (vh(I),VD(I))=0,vs(I)=1	// Group break flags
			set VT(I)=0			// Group count
			for J=1:1:3 do {
				for K=1:1:3 set VT(I,J,K)=""	// Initialize function stats
				}
			}
		}

	do Db.delete("TMPRPTBR","JOBNO=:%ProcessID")	// Report browser data
	if VDISTKEY.get()="" do { quit:VFMQ		// Report Pre-processor (after query)
		do VPREAQ
		if VFMQ set vh(0)=1 do VEXIT(0)
		}

	set vh(0)=0

	// Run report directly
	do VINILAST

	set VSELECT=""
	set VSELECT=VSELECT_"DEP.RPASEQ,DEP.CID,DEP.ACN,DEP.IRA,DEP.ODT,DEP.IRN"
	set VSELECT=VSELECT_",DEP.MDT,CIF.ACN,CIF.TAXID,CIF.DOB,DEP.GRP,DEP.IPY"

	#ACCEPT DATE=01/31/2007;PGM=Report Writer Generator;CR=20967
	type ResultSet rwrs=Db.select(VSELECT,"DEP,CIF,IRATYPE",VWHERE,"CIF.ACN,DEP.RPASEQ,DEP.CID","","DQMODE=1")
	if ER.get() use 0 write $$MSG^%TRMVT(RM.get(),"",1)	// Debug Mode
	if rwrs.isEmpty() do VEXIT(1) quit
	while rwrs.next() do { quit:VFMQ
	type Boolean VSKIPREC = 0
		type String V,VI
		set V=rwrs.getRow().toString()
		set VI=""
		do VGETDATA(V,VI)
		do VFPOST quit:(VFMQ ! VSKIPREC)  set VHIT = 1
		do VPRINT quit:VFMQ
		do VSAVLAST
		}
	do VEXIT('VHIT)

	quit


VINILAST	// Initialize last access key values
	type Public String vovc8,vovc1,vovc2
	set vovc8="",vovc1="",vovc2=""
	quit

VSAVLAST	// Save last access keys values
	type Public String vovc8,vc8,vovc1,vc1,vovc2,vc2
	set vovc8=vc8,vovc1=vc1,vovc2=vc2
	quit


VGETDATA(String V,String VI)	//
	type Public String vc1,vc2,vc3,vc4,vc5,vc6,vc7,vc8,vc9,vc10,vc11,vc12
	set vc1=V.piece($C(9),1)			// DEP.RPASEQ
	set vc2=V.piece($C(9),2)			// DEP.CID
	set vc3=V.piece($C(9),3)			// DEP.ACN
	set vc4=V.piece($C(9),4)			// DEP.IRA
	set vc5=V.piece($C(9),5)			// DEP.ODT
	set vc6=V.piece($C(9),6)			// DEP.IRN
	set vc7=V.piece($C(9),7)			// DEP.MDT
	set vc8=V.piece($C(9),8)			// CIF.ACN
	set vc9=V.piece($C(9),9)			// CIF.TAXID
	set vc10=V.piece($C(9),10)			// CIF.DOB
	set vc11=V.piece($C(9),11)			// DEP.GRP
	set vc12=V.piece($C(9),12)			// DEP.IPY
	quit

	// User-defined pre/post-processor code

VFPOST	// FETCH post-processor

	type public String vc1,vc2,vc3,vc4,vc5,vc6,vc7
 type public Number ACN,BALTOT,CID,ER,IRA,IRN,RPASEQ,TACR
 type public Date FD,MDT,ODT,TD
 type public Boolean VSKIPREC
 type public String YEAR
 set RPASEQ=vc1
 set CID=vc2
 set ACN=vc3
 set IRA=vc4

 type RecordUTBLRSPDEF rspdef=Db.getRecord("UTBLRSPDEF","KEY=:IRA")
 
 set ODT=vc5

 if ODT>rspdef.pryrdte set VSKIPREC=1 quit

 type Number NXTYR=YEAR+1
 type RecordIRA ira1=Db.getRecord("IRA","ACN=:ACN,RPASEQ=:RPASEQ,TAXYR=:NXTYR",1)

 if (ODT>TD),(ira1.c2'>0) set VSKIPREC=1 quit

 do INIT^UAVB(,CID,FD,TD,1000011) if ER do ^UTLERR quit

 type RecordHIST0 hist0=Db.getRecord("HIST0","CID=:CID,JD=:TD",1)

 set TACR=hist0.acrcf
 set BALTOT=hist0.nacrat
 set IRN=hist0.yeirn

 if IRN.isNull() set IRN=vc6
 set MDT=hist0.yemdt
 if MDT.isNull() set MDT=vc7
	quit

VPREAQ	// Pre-processor (after query)

 type public String ADDR(),V
 type public Number RESETPG
 set RESETPG=0
	quit

VPREBQ	// Pre-processor (before query)

 /* 
 ---- Revision History -------------------------------------------------------

  09/26/05 - DHANALAKSHMI R - 16851
             PSL Conversion

 -----------------------------------------------------------------------------
 */ 

 //Incoming=FD,PAGE,TD,YEAR

 type public Date FD,TD
 type public Number FIRST,PAGE
 type public String YEAR
 type Number I

 // I18N=QUIT
 // Beginning of previous tax year
 set FD=$$BOTY^SCADAT($$BOTY^SCADAT(%SystemDate,1)-1,1)

 // End of previous tax year
 set TD=$$EOTY^SCADAT(FD,1)
 set YEAR=$$YEAR^SCADAT(TD,1)
 
 set PAGE=1,FIRST=1

	quit

VBRSAVE(Number LINE,String DATA)	// Save for report browser
	type RecordTMPRPTBR tmprptbr=Class.new("RecordTMPRPTBR")
	set tmprptbr.jobno=%ProcessID
	set tmprptbr.lineno=LINE
	set tmprptbr.pageno=0
	set tmprptbr.seq=0
	set tmprptbr.data=DATA
	do tmprptbr.bypassSave()
	quit

VEXIT(NOINFO)	// Exit from report
	type Public Number IOSL,vcrt,VFMQ,vh(),VLC,VPN,VRWOPT,VSTATS()
	type Public String IO,VTBLNAM
	type Number I,PN,vs(),z
	type String VL=""
	set vs(1)=0,vs(2)=0,vs(3)=0
	if 'VFMQ do VSUM
	if 'vh(0) do VHDG0
	if 'VFMQ do {
		// No information available to display
		if NOINFO=1 set VL=$$^MSG(4655) do VOM
		do VTRL0
		if vcrt set VL="" for z=VLC+1:1:IOSL do VOM

		if 'VTBLNAM.exists() do {
			set vs(2)=0
			do VBREAK,stat^DBSRWUTL(2)
			}
		}

	if 'VFMQ,vcrt set PN=-1 do ^DBSRWBR(2)
	if 'VRWOPT("NOCLOSE").get() do CLOSE^SCAIO
	do Db.delete("TMPRPTBR","JOBNO=:%ProcessID")	// Report browser data

	quit

VPRINT	// Print section
	type Public Number VD(),VFMQ,VH0,vh(),VNEWHDR,VR,VRG,VRWOPT,VSEQ
	type Number vskp()

	if VRWOPT("NODTL").get() set vskp(1)=1,vskp(3)=1	// Skip detail
	do VBREAK
	do VSUM quit:VFMQ

	if VH0.get() set vh(0)=0,VNEWHDR=1 kill VH0	// Page Break
	if 'vh(0) do VHDG0 quit:VFMQ
	if 'vskp(3).get() do VDTL3 quit:VFMQ
	do VSTAT
	quit

VBREAK	//
	type Public Number VD(),vh(),VH0,vs(),VT()
	quit:'VT(3)
	type Public String vc8,vovc8,vc1,vovc1,vc2,vovc2
	type Number vb1,vb2,vb3
	set (vb1,vb2,vb3)=0
	if vb1!(+vovc8'=+vc8) set vs(2)=0,vh(2)=0,VD(1)=0,vb2=1,vb3=1,VH0=1
	if vb2!(+vovc1'=+vc1) set vs(3)=0,vh(3)=0,VD(2)=0,vb3=1,VH0=1
	quit

VSUM	// Report Group Summary
	type Public Number VFMQ,vs()
	if 'vs(3) set vs(3)=1 do VSUM3 quit:VFMQ  do stat^DBSRWUTL(3)
	if 'vs(2) set vs(2)=1 do stat^DBSRWUTL(2)
	quit

VSTAT	// Data field statistics
	type Public Number VRWOPT(),VT(),BALTOT,TACR
	type Public String VSTATS

	set VT(3)=VT(3)+1
	set VT(3,1,1)=VT(3,1,1)+(BALTOT+TACR)		// @TOT(<<BALTOT+TACR>>)
	set VT(3,2,1)=VT(3,2,1)+BALTOT			// @TOT(<<BALTOT>>)
	set VT(3,3,1)=VT(3,3,1)+TACR			// @TOT(<<TACR>>)
	quit

VDTL3	// Detail
	type public String ACN,ADDR(),BALBEG,BALTOT,CID,ER,FD,FDT,FIRST,IOSL,IRA,IRN,MDT,MINDIST,ODT,PAGE,RESETPG,RPASEQ,STAR,TACR,TD,TEMP,TEMP1,TEMP2,TEMP3,V,VD(),VFMQ,VL,VLC,VO,VOFFLG,VRG,VSKIPREC,VT(),YEAR,vc1,vc10,vc11,vc12,vc2,vc3,vc4,vc5,vc6,vc7,vc8,vc9,verror,vh(),vovc1,vovc2,vovc8

	if VLC+3>IOSL do VHDG0 quit:VFMQ

	set VL=$E(vc11,1,4)
	set VL=VL_$J("",5-VL.length())_$J(vc2,14)
	set V=vc6,VO=V do VP1 quit:VFMQ!verror.get()  set V=$E(V,1,8)
	set VL=VL_$J("",20-VL.length())_V
	set VL=VL_$J("",29-VL.length())_$J($$DAT^%ZM(vc7),10)
	do VP2 quit:VFMQ!verror.get()  set V=$J(BALBEG,12,2)
	set VL=VL_$J("",40-VL.length())_V
	set VL=VL_$J("",53-VL.length())_$J(vc12,9,2)
	set VL=VL_$J("",64-VL.length())_$J(BALTOT,12,2)
	do VOM
	quit

VSUM3	// Summary
	type public String ACN,ADDR(),BALBEG,BALTOT,CID,ER,FD,FDT,FIRST,I,IOSL,IRA,IRN,MDT,MINDIST,ODT,PAGE,RESETPG,RPASEQ,STAR,TACR,TD,TEMP,TEMP1,TEMP2,TEMP3,V,VFMQ,VL,VLC,VO,VOFFLG,VSKIPREC,VT(),VX(),YEAR,vc1,vc10,vc11,vc12,vc2,vc3,vc4,vc5,vc6,vc7,vc8,vc9,verror,vh(),vovc1,vovc2,vovc8

	if 'VT(3) quit
	if VLC+21>IOSL do VHDG0 quit:VFMQ

	set VL="" do VOM
	set VL="                            "_"Total Plan Balance as of "
	set VL=VL_$J("",53-VL.length())_$J($$DAT^%ZM(TD),10)
	set V=VT(3,2,1)					// @TOT(<<BALTOT>>,)
	set VL=VL_$J("",64-VL.length())_$J(V,12,2)
	do VOM
	set VL="                  "_"Interest Earned But Not Paid as of "
	set VL=VL_$J("",53-VL.length())_$J($$DAT^%ZM(TD),10)
	set V=VT(3,3,1)					// @TOT(<<TACR>>,)
	set V=$J(V,8,2) do VP3 quit:VFMQ!verror.get()
	set VL=VL_$J("",68-VL.length())_V		// @TOT(<<TACR>>,)
	do VOM
	set VL="                             "_"Fair Market Value as of"
	set VL=VL_$J("",53-VL.length())_$J($$DAT^%ZM(TD),10)
	set V=VT(3,1,1)					// @TOT(<<BALTOT+TACR>>,)
	set VL=VL_$J("",64-VL.length())_$J(V,12,2)
	do VOM
	set VL="" do VOM
	do VP4 quit:VFMQ!verror.get()  set V=$E(MINDIST,1,80) set VL=V
	do VOM
	set VL="" do VOM
	set VL=" "_"This information is being furnished to the Internal Revenue Service "
	do VOM
	set VL="" do VOM
	set VL="================================================================================"
	do VOM
	set VL="" do VOM
	set VL="  "_"Contributions:"
	set VL=VL_$J("",31-VL.length())_"--"
	do VP5 quit:VFMQ!verror.get()  set V=$E(YEAR,1,4)
	set VL=VL_$J("",34-VL.length())_V
	set VL=VL_$J("",39-VL.length())_"--"
	do VP6 quit:VFMQ!verror.get()  set V=$E(TEMP,1,3)
	set VL=VL_$J("",57-VL.length())_V
	do VP7 quit:VFMQ!verror.get()  set V=$E(TEMP,1,3)
	set VL=VL_$J("",64-VL.length())_V
	set VL=VL_$J("",68-VL.length())_"For Prior"
	do VOM
	set VL="    "_"Current Year"
	set VL=VL_$J("",29-VL.length())_$J(TEMP1,12,2)
	do VOM
	set VL="    "_"Prior Year                               "
	set VL=VL_$J("",48-VL.length())_$J(TEMP2,12,2)
	do VP8 quit:VFMQ!verror.get()  set V=$J(TEMP3,12,2)
	set VL=VL_$J("",65-VL.length())_V
	do VP9 quit:VFMQ!verror.get()  set V=$E(STAR,1,1)
	set VL=VL_$J("",78-VL.length())_V
	do VOM
	do VP10 quit:VFMQ!verror.get()  set V=$E(TEMP,1,70) set VL="    "_V
	do VOM
	set VL="  "_"Distributions:"
	do VOM
	do VP11 quit:VFMQ!verror.get()  set V=$E(TEMP,1,70) set VL="    "_V
	do VOM
	set VL="  "_"Withholdings:"
	do VOM
	do VP12 quit:VFMQ!verror.get()  set V=$E(TEMP,1,70) set VL="    "_V
	do VOM
	set VL="" do VOM
	quit


VHDG0	// Page Header
	type Public Number ER,IOSL,vcrt,verror,VFMQ,vh(),VLC,VNEWHDR,VPN,VRG,VRWOPT()
	type public String %MSKD,%TIM,ACN,ADDR(),BALBEG,BALTOT,CID,CONAM,FD,FDT,FIRST,IRA,IRN,MDT,MINDIST,ODT,PAGE,RESETPG,RID,RN,RPASEQ,STAR,TACR,TD,TEMP,TEMP1,TEMP2,TEMP3,VL,VSKIPREC,YEAR,vc1,vc10,vc11,vc12,vc2,vc3,vc4,vc5,vc6,vc7,vc8,vc9,vovc1,vovc2,vovc8,vrundate,vsysdate
	type Number PN,V,VO
	if VRWOPT("NOHDR").get() quit			// Skip page header
	set vh(0)=1,VRG=0
	if VL'="" do VOM
	if VPN do VTRL0
	if vcrt,VPN>0 do { quit:VFMQ!'VNEWHDR
		type Number PN,X
		set VL=""
		for X=VLC+1:1:IOSL do VOM
		set PN=VPN
		do ^DBSRWBR(2)
		set VLC=0
		quit:VFMQ
		if VNEWHDR write $$CLEARXY^%TRMVT
		else  set VLC=VLC+30,VPN=VPN+1
		}

	set ER=0,VPN=VPN+1,VLC=0

	set VL="" do VOM
	set VL="" do VOM
	set VL="" do VOM
	set VL="" do VOM
	set VL="" do VOM
	set VL="" do VOM
	set VL="" do VOM
	set VL="" do VOM
	set VL="" do VOM
	set VL="" do VOM
	set VL="                                                           "_"TIN/SIN"
	do VOM
	set VL="" do VOM
	set VL="                                                           "_$E(vc9,1,11)
	do VOM
	set VL="" do VOM
	set VL="" do VOM
	do VP13 quit:VFMQ!verror.get()  set V=$E(ADDR(1),1,30) set VL="         "_V
	do VOM
	set VL="         "_$E(ADDR(2),1,30)
	set VL=VL_$J("",59-VL.length())_"Date of Birth"
	do VOM
	set VL="         "_$E(ADDR(3),1,30)
	do VOM
	set VL="         "_$E(ADDR(4),1,30)
	set VL=VL_$J("",59-VL.length())_$J($$DAT^%ZM(vc10),10)
	do VOM
	set VL="         "_$E(ADDR(5),1,30)
	do VOM
	set VL="" do VOM
	set VL="" do VOM
	set VL="" do VOM
	set VL="" do VOM
	set VL="              "_"Retirement Plan Annual Report For Tax Year "
	set VL=VL_$J("",57-VL.length())_$E(YEAR,1,4)
	do VOM
	set VL="" do VOM
	set VL="" do VOM
	set VL="Account     Account Interest   Maturity    Begin Bal   Int/Div    Ending Bal"
	do VOM
	set VL="Type         Number Rate       Date"
	do VP14 quit:VFMQ!verror.get()  set V=$J($$DAT^%ZM(FDT),10)
	set VL=VL_$J("",42-VL.length())_V
	set VL=VL_$J("",58-VL.length())_"Paid"
	set VL=VL_$J("",66-VL.length())_$J($$DAT^%ZM(TD),10)
	do VOM
	set VL="================================================================================"
	do VOM

	set VNEWHDR=0
	if vcrt set PN=VPN do ^DBSRWBR(2,1)		// Lock report page heading

	quit


VTRL0	// Page Trailer
	type Public Number IOSL,verror,vh,VFMQ,VLC,VT(),VX()
	type Public String ACN,ADDR(),BALBEG,BALTOT,CID,ER,FD,FDT,FIRST,IRA,IRN,MDT,MINDIST,ODT,PAGE,RESETPG,RPASEQ,STAR,TACR,TD,TEMP,TEMP1,TEMP2,TEMP3,V,VSKIPREC,YEAR,vc1,vc10,vc11,vc12,vc2,vc3,vc4,vc5,vc6,vc7,vc8,vc9,vovc1,vovc2,vovc8
	type Number I
	type String VL

	set VL=""
	for I=VLC:1:IOSL-2 do VOM

	set VL="                                  "_"Page "
	set V=$J(PAGE,2) do VP15 quit:VFMQ!verror.get()
	set VL=VL_$J("",39-VL.length())_V
	do VOM
	quit

VOM	// Output print line
	type Public Number AUXPTR,vcrt,vlc,VLC,VRG
	type Public String IO,VL

	use IO

	// Advance to a new page
	if 'VLC,'vcrt do {				// Non-CRT device (form feed)
		if 'AUXPTR.get() write $C(12),!
		else  write $$PRNTFF^%TRMVT,!
		set $Y=1
		}

	if vcrt<2 write VL,!				// Output line buffer
	if vcrt set vlc=vlc+1 do VBRSAVE(vlc,VL)	// Save in BROWSER buffer
	set VLC=VLC+1,VL=""				// Reset line buffer
	quit

	// Pre/post-processors

VP1	// Column pre-processor - Variable: IRN

 type public String IRN,TEXT,V
 
 set V=$$^SCARND(IRN,8,,,5)
 set TEXT=$$^MSG(6506)
	quit

VP2	// Column pre-processor - Variable: BALBEG

 type public Number BALBEG
 type public String UAVB()

 set BALBEG=UAVB(1).piece("|",19)
	quit

VP3	// Column post-processor - @TOT(<<TACR>>,,$,8)

 type public String %FN,V,VL

 if %FN.get().isNull() set (V,VL)=""
	quit

VP4	// Column pre-processor - Variable: MINDIST

	type public String vc10
 /*
 -------------------------------------------------------------------------

  09/26/05 - DHANALAKSHMI R - 16851
  Converted to PSL

 -------------------------------------------------------------------------
 */

 type public Number ACN,RPASEQ
 type public String MINDIST,YEAR

 type Number AGE,DAMT,DOPT
 type Date DDATE,YED

 type RecordIRA ira=Db.getRecord("IRA","ACN=:ACN , RPASEQ=:RPASEQ , TAXYR=:YEAR",1)
 set DAMT=ira.madamt

 type RecordIRATYPE iratype=Db.getRecord("IRATYPE","ACN=:ACN, RPASEQ=:RPASEQ",1)
 set DOPT=iratype.rspmado

 set YED="12/31/"_(YEAR)
 set AGE=$$NOY^SCADAT(vc10,YED,1)

 if (DAMT="")!(DOPT'=1)!(AGE<70.5) set MINDIST="" quit
 
 set DDATE="12/31/"_(YEAR+1)
 if AGE<71.5 set DDATE="4/1/"_(YEAR+1)

 // Required Minimum Distribution to be distributed by ~p1 is ~p2
 set MINDIST=$$^MSG(5183,DDATE,$$NUM^%ZM(DAMT,2))
	quit

VP5	// Column pre-processor - Variable: YEAR

 type public Number ACN,IRA,TEMP1,TEMP2,TEMP3
 type public Date FD
 type public String TEMP

 set TEMP=FD.toString("MM/DD/YYYY"),TEMP=TEMP.piece("/",3)

 if TEMP.length()<4 do { 
	if TEMP>88 set TEMP=19_TEMP
	else  set TEMP=20_TEMP
	}

 type RecordIRA ira=Db.getRecord("IRA","ACN=:ACN, RPASEQ=:IRA, TAXYR=:TEMP",1)
 set TEMP1=ira.c1
 set TEMP2=ira.c2

 type RecordIRA ira1=Db.getRecord("IRA","ACN=:ACN, RPASEQ=:IRA, TAXYR=:TEMP+1",1)

 set TEMP3=ira1.c2
	quit

VP6	// Column pre-processor - Variable: TEMP

 type public String TEMP,YEAR
 
 set TEMP="'"_(YEAR.extract(3,4))
	quit

VP7	// Column pre-processor - Variable: TEMP

 type public String TEMP,YEAR
 
 set YEAR=YEAR+1
 set TEMP="'"_(YEAR.extract(3,4))
 set YEAR=YEAR-1
	quit

VP8	// Column pre-processor - Variable: TEMP3

 type public Number ACN,IRA,TEMP3
 type public String YEAR
 type RecordIRA ira=Db.getRecord("IRA","ACN=:ACN, RPASEQ=:IRA, TAXYR=:YEAR+1",1)
 set TEMP3=ira.c2
	quit

VP9	// Column pre-processor - Variable: STAR

 type public String STAR
 type public Number IRA,TEMP3
 
 set STAR=""
 if IRA=4 quit
 if TEMP3>0 set STAR="*"
	quit

VP10	// Column pre-processor - Variable: TEMP

 type public Date FD
 type public Number ACN,ER,IOSL,IRA,VFMQ,VLC
 type public String CONT(),TEMP,VL
 type Number CNT
 type String DESC(),N
 type public RecordIRA ira

 // THE FOLLOWING CODE IS FOR CONTRIBUTION DESCRIPTION.
 set TEMP=FD.toString("MM/DD/YYYY"),TEMP=TEMP.piece("/",3)

 if TEMP.length()<4 do {
	if TEMP>88 set TEMP=19_TEMP
	else  set TEMP=20_TEMP
	}

 set ira=Db.getRecord("IRA","ACN=:ACN, RPASEQ=:IRA, TAXYR=:TEMP",1)
 set CNT=0
 kill CONT

 type ResultSet rs=Db.select("IRACON,DESC","STBLIRACON")
 while rs.next() set DESC(rs.getCol("IRACON"))=rs.getCol("DESC")
	
 if ira.c3>0 set CNT=CNT+1 set CONT(CNT)=DESC(3)_"|"_ira.c3
 if ira.c4>0 set CNT=CNT+1 set CONT(CNT)=DESC(4)_"|"_ira.c4_" *"
 if ira.c5>0 set CNT=CNT+1 set CONT(CNT)=DESC(5)_"|"_ira.c5
 if ira.c7>0 set CNT=CNT+1 set CONT(CNT)=DESC(7)_"|"_ira.c7
 if ira.c8>0 set CNT=CNT+1 set CONT(CNT)=DESC(8)_"|"_ira.c8

 // I18N=OFF
 if 'CNT set CONT(1)="*** NO ACTIVITY ***",CNT=1

 // I18N=ON
 set CNT=CNT+1,CONT(CNT)="***"
 set TEMP=""

 set N="" 
 for  set N=CONT(N).order() quit:N.isNull()  do {

	if CONT(N)="***" quit
	set VL="    "_(CONT(N).piece("|",1))_$J("",25-(CONT(N).piece("|",1)).length())
	set VL=VL_$S($P(CONT(N),"|",1)["*":"",1:$J($P(CONT(N),"|",2),12,2))
	if $P(CONT(N),"|",2)["*" set VL=VL_" *" 
	do VOM
 }
	quit

VP11	// Column pre-processor - Variable: TEMP

 // THE FOLLOWING CODE IS FOR DISTRIBUTION DESCRIPTION.

 type public RecordIRA ira
 type public Date FD
 type public Number ER,IOSL,VFMQ,VLC
 type public String DIST(),DESC(),TEMP,VL
 type Number CNT,I,N,SWITCH
 type String Y

 set TEMP=FD.toString("MM/DD/YYYY"),TEMP=TEMP.piece("/",3)

 if TEMP.length()<4 do {
	if TEMP>88 set TEMP=19_TEMP
	else  set TEMP=20_TEMP
	}

 set CNT=0
 kill DIST

 type ResultSet rs=Db.select("IRACON,DESC","STBLIRACON")
 while rs.next() set DESC(rs.getCol("IRACON"))=rs.getCol("DESC")
        
 if ira.d1>0 set CNT=CNT+1 set DIST(CNT)=DESC(1)_"|"_ira.d1
 if ira.d2>0 set CNT=CNT+1 set DIST(CNT)=DESC(2)_"|"_ira.d2
 if ira.d3>0 set CNT=CNT+1 set DIST(CNT)=DESC(3)_"|"_ira.d3
 if ira.d4>0 set CNT=CNT+1 set DIST(CNT)=DESC(4)_"|"_ira.d4
 if ira.d5>0 set CNT=CNT+1 set DIST(CNT)=DESC(5)_"|"_ira.d5
 if ira.d6>0 set CNT=CNT+1 set DIST(CNT)=DESC(6)_"|"_ira.d6
 if ira.d7>0 set CNT=CNT+1 set DIST(CNT)=DESC(7)_"|"_ira.d7
 if ira.d8>0 set CNT=CNT+1 set DIST(CNT)=DESC(8)_"|"_ira.d8
 if ira.d10>0 set CNT=CNT+1 set DIST(CNT)=DESC(10)_"|"_ira.d10
 if ira.d11>0 set CNT=CNT+1 set DIST(CNT)=DESC(11)_"|"_ira.d11
 if ira.d12>0 set CNT=CNT+1 set DIST(CNT)=DESC(12)_"|"_ira.d12
 if ira.d13>0 set CNT=CNT+1 set DIST(CNT)=DESC(13)_"|"_ira.d13
 if ira.d14>0 set CNT=CNT+1 set DIST(CNT)=DESC(14)_"|"_ira.d14
 if ira.d15>0 set CNT=CNT+1 set DIST(CNT)=DESC(15)_"|"_ira.d15
 if ira.d16>0 set CNT=CNT+1 set DIST(CNT)=DESC(16)_"|"_ira.d16
 if ira.d17>0 set CNT=CNT+1 set DIST(CNT)=DESC(17)_"|"_ira.d17
 if ira.d18>0 set CNT=CNT+1 set DIST(CNT)=DESC(18)_"|"_ira.d18
 if ira.d19>0 set CNT=CNT+1 set DIST(CNT)=DESC(19)_"|"_ira.d19
 if ira.d20>0 set CNT=CNT+1 set DIST(CNT)=DESC(20)_"|"_ira.d20
 if ira.d21>0 set CNT=CNT+1 set DIST(CNT)=DESC(21)_"|"_ira.d21
 if ira.d22>0 set CNT=CNT+1 set DIST(CNT)=DESC(22)_"|"_ira.d22
 if ira.d23>0 set CNT=CNT+1 set DIST(CNT)=DESC(23)_"|"_ira.d23
 if ira.d24>0 set CNT=CNT+1 set DIST(CNT)=DESC(24)_"|"_ira.d24
 if ira.d25>0 set CNT=CNT+1 set DIST(CNT)=DESC(25)_"|"_ira.d25
 if ira.d26>0 set CNT=CNT+1 set DIST(CNT)=DESC(26)_"|"_ira.d26
 if ira.d28>0 set CNT=CNT+1 set DIST(CNT)=DESC(28)_"|"_ira.d28
 if ira.d29>0 set CNT=CNT+1 set DIST(CNT)=DESC(29)_"|"_ira.d29
 if ira.d34>0 set CNT=CNT+1 set DIST(CNT)=DESC(34)_"|"_ira.d34
 if ira.d35>0 set CNT=CNT+1 set DIST(CNT)=DESC(35)_"|"_ira.d35
 if ira.d36>0 set CNT=CNT+1 set DIST(CNT)=DESC(36)_"|"_ira.d36
 if ira.d37>0 set CNT=CNT+1 set DIST(CNT)=DESC(37)_"|"_ira.d37
 if ira.d38>0 set CNT=CNT+1 set DIST(CNT)=DESC(38)_"|"_ira.d38
 if ira.d39>0 set CNT=CNT+1 set DIST(CNT)=DESC(39)_"|"_ira.d39
 if ira.d43>0 set CNT=CNT+1 set DIST(CNT)=DESC(43)_"|"_ira.d43
 if ira.d44>0 set CNT=CNT+1 set DIST(CNT)=DESC(44)_"|"_ira.d44
 if ira.d45>0 set CNT=CNT+1 set DIST(CNT)=DESC(45)_"|"_ira.d45
 if ira.d46>0 set CNT=CNT+1 set DIST(CNT)=DESC(46)_"|"_ira.d46
 if ira.d47>0 set CNT=CNT+1 set DIST(CNT)=DESC(47)_"|"_ira.d47
 if ira.d48>0 set CNT=CNT+1 set DIST(CNT)=DESC(48)_"|"_ira.d48
 if '((ira.PVMAD).isNull()) set CNT=CNT+1 set DIST(CNT)=DESC(30)_"|"_ira.PVMAD
 if '((ira.MAXLIF).isNull()) set CNT=CNT+1 set DIST(CNT)=DESC(31)_"|"_ira.MAXLIF
 if '((ira.MADAMT).isNull()) set CNT=CNT+1 set DIST(CNT)=DESC(32)_"|"_ira.MADAMT
 if '((ira.MADCY).isNull()) set CNT=CNT+1 set DIST(CNT)=DESC(33)_"|"_ira.MADCY
 if '((ira.NEILDTE).isNull()) set CNT=CNT+1 set DIST(CNT)=DESC(40)_"|"_ira.NEILDTE
 if '((ira.RNEI).isNull()) set CNT=CNT+1 set DIST(CNT)=DESC(41)_"|"_ira.RNEI
 if '((ira.UNEI).isNull()) set CNT=CNT+1 set DIST(CNT)=DESC(42)_"|"_ira.UNEI
 if +ira.d49>0 set CNT=CNT+1 set DIST(CNT)=DESC(49)_"|"_ira.d49
 if +ira.d50>0 set CNT=CNT+1 set DIST(CNT)=DESC(50)_"|"_ira.d50
 if +ira.d51>0 set CNT=CNT+1 set DIST(CNT)=DESC(51)_"|"_ira.d51
 if +ira.d52>0 set CNT=CNT+1 set DIST(CNT)=DESC(52)_"|"_ira.d52
 if +ira.d53>0 set CNT=CNT+1 set DIST(CNT)=DESC(53)_"|"_ira.d53
 if +ira.d54>0 set CNT=CNT+1 set DIST(CNT)=DESC(54)_"|"_ira.d54
 if +ira.d55>0 set CNT=CNT+1 set DIST(CNT)=DESC(55)_"|"_ira.d55
 if +ira.d56>0 set CNT=CNT+1 set DIST(CNT)=DESC(56)_"|"_ira.d56
 if +ira.d57>0 set CNT=CNT+1 set DIST(CNT)=DESC(57)_"|"_ira.d57
 if +ira.d58>0 set CNT=CNT+1 set DIST(CNT)=DESC(58)_"|"_ira.d58
 if +ira.d59>0 set CNT=CNT+1 set DIST(CNT)=DESC(59)_"|"_ira.d59
 if +ira.d60>0 set CNT=CNT+1 set DIST(CNT)=DESC(60)_"|"_ira.d60  
 if +ira.d61>0 set CNT=CNT+1 set DIST(CNT)=DESC(61)_"|"_ira.d61
 if +ira.d62>0 set CNT=CNT+1 set DIST(CNT)=DESC(62)_"|"_ira.d62
 if +ira.d63>0 set CNT=CNT+1 set DIST(CNT)=DESC(63)_"|"_ira.d63
 if +ira.d64>0 set CNT=CNT+1 set DIST(CNT)=DESC(64)_"|"_ira.d64
 if +ira.d65>0 set CNT=CNT+1 set DIST(CNT)=DESC(65)_"|"_ira.d65
 if +ira.d66>0 set CNT=CNT+1 set DIST(CNT)=DESC(66)_"|"_ira.d66
 if +ira.d67>0 set CNT=CNT+1 set DIST(CNT)=DESC(67)_"|"_ira.d67
 if +ira.d68>0 set CNT=CNT+1 set DIST(CNT)=DESC(68)_"|"_ira.d68
 if +ira.d69>0 set CNT=CNT+1 set DIST(CNT)=DESC(69)_"|"_ira.d69
 if +ira.d70>0 set CNT=CNT+1 set DIST(CNT)=DESC(70)_"|"_ira.d70
 if +ira.d71>0 set CNT=CNT+1 set DIST(CNT)=DESC(71)_"|"_ira.d71
 if +ira.d72>0 set CNT=CNT+1 set DIST(CNT)=DESC(72)_"|"_ira.d72
 if +ira.d73>0 set CNT=CNT+1 set DIST(CNT)=DESC(73)_"|"_ira.d73
 if +ira.d74>0 set CNT=CNT+1 set DIST(CNT)=DESC(74)_"|"_ira.d74
 if +ira.d75>0 set CNT=CNT+1 set DIST(CNT)=DESC(75)_"|"_ira.d75
 if +ira.d76>0 set CNT=CNT+1 set DIST(CNT)=DESC(76)_"|"_ira.d76
 if +ira.d77>0 set CNT=CNT+1 set DIST(CNT)=DESC(77)_"|"_ira.d77  
 if +ira.d78>0 set CNT=CNT+1 set DIST(CNT)=DESC(78)_"|"_ira.d78
 if +ira.d79>0 set CNT=CNT+1 set DIST(CNT)=DESC(79)_"|"_ira.d79
 if +ira.d80>0 set CNT=CNT+1 set DIST(CNT)=DESC(80)_"|"_ira.d80
 if +ira.d81>0 set CNT=CNT+1 set DIST(CNT)=DESC(81)_"|"_ira.d81
 if +ira.d82>0 set CNT=CNT+1 set DIST(CNT)=DESC(82)_"|"_ira.d82
 if +ira.d83>0 set CNT=CNT+1 set DIST(CNT)=DESC(83)_"|"_ira.d83
 if +ira.d84>0 set CNT=CNT+1 set DIST(CNT)=DESC(84)_"|"_ira.d84
 if +ira.d85>0 set CNT=CNT+1 set DIST(CNT)=DESC(85)_"|"_ira.d85
 if +ira.d86>0 set CNT=CNT+1 set DIST(CNT)=DESC(86)_"|"_ira.d86
 if +ira.d87>0 set CNT=CNT+1 set DIST(CNT)=DESC(87)_"|"_ira.d87  
 if +ira.d88>0 set CNT=CNT+1 set DIST(CNT)=DESC(88)_"|"_ira.d88
 if +ira.d89>0 set CNT=CNT+1 set DIST(CNT)=DESC(89)_"|"_ira.d89
 if +ira.d94>0 set CNT=CNT+1 set DIST(CNT)=DESC(94)_"|"_ira.d94
 if +ira.d95>0 set CNT=CNT+1 set DIST(CNT)=DESC(95)_"|"_ira.d95
 if +ira.d96>0 set CNT=CNT+1 set DIST(CNT)=DESC(96)_"|"_ira.d96
 if +ira.d97>0 set CNT=CNT+1 set DIST(CNT)=DESC(97)_"|"_ira.d97  
 if +ira.d98>0 set CNT=CNT+1 set DIST(CNT)=DESC(98)_"|"_ira.d98
 if +ira.d99>0 set CNT=CNT+1 set DIST(CNT)=DESC(99)_"|"_ira.d99

 // I18N=OFF
 if 'CNT set DIST(1)="*** NO ACTIVITY ***",CNT=1

 // I18N=ON
 set CNT=CNT+1,DIST(CNT)="***"
 set TEMP="",SWITCH=99

 // type ResultSet rs=Db.select("
 // set N="" for  set N=^UTBL("STMT",99,N)) Q:N=""  set CNT=CNT+1,DIST(CNT)=^(N)

 set N="" for  set N=$O(DIST(N)) quit:N.isNull()  do {

        if DIST(N)="***" set DIST(N)="",SWITCH=N
        if N'<SWITCH quit

	set VL="    "_(DIST(N).piece("|",1))_$J("",25-(DIST(N).piece("|",1)).length())
	set VL=VL_$S(DIST(N)["*":"",1:$J($P(DIST(N),"|",2),12,2))
	if VLC+1'>IOSL do VOM quit
	do VOM
 	}
	quit

VP12	// Column pre-processor - Variable: TEMP


 // THE FOLLOWING CODE IS FOR WITHHOLDING DESCRIPTION.

 type public RecordIRA ira
 type public Date FD
 type public Number ER,IOSL,VFMQ,VLC
 type public String DESC(),WITH(),TEMP,VL
 type Number CNT,N,SWITCH

 set TEMP=FD.toString("MM/DD/YYYY"),TEMP=TEMP.piece("/",3)

 if TEMP.length()<4 do {
	if TEMP>88 set TEMP=19_TEMP
	else  set TEMP=20_TEMP
	}

 set CNT=0 
 kill WITH

 if ira.w1>0 set CNT=CNT+1 set WITH(CNT)=DESC(1)_"|"_ira.w1
 if ira.w2>0 set CNT=CNT+1 set WITH(CNT)=DESC(2)_"|"_ira.w2
 if ira.w3>0 set CNT=CNT+1 set WITH(CNT)=DESC(3)_"|"_ira.w3
 if ira.w4>0 set CNT=CNT+1 set WITH(CNT)=DESC(4)_"|"_ira.w4
 if ira.w5>0 set CNT=CNT+1 set WITH(CNT)=DESC(5)_"|"_ira.w5
 if ira.w6>0 set CNT=CNT+1 set WITH(CNT)=DESC(6)_"|"_ira.w6
 if ira.w7>0 set CNT=CNT+1 set WITH(CNT)=DESC(7)_"|"_ira.w7
 if ira.w8>0 set CNT=CNT+1 set WITH(CNT)=DESC(8)_"|"_ira.w8
 if ira.w10>0 set CNT=CNT+1 set WITH(CNT)=DESC(10)_"|"_ira.w10
 if ira.w11>0 set CNT=CNT+1 set WITH(CNT)=DESC(11)_"|"_ira.w11
 if ira.w12>0 set CNT=CNT+1 set WITH(CNT)=DESC(12)_"|"_ira.w12
 if ira.w13>0 set CNT=CNT+1 set WITH(CNT)=DESC(13)_"|"_ira.w13
 if ira.w14>0 set CNT=CNT+1 set WITH(CNT)=DESC(14)_"|"_ira.w14
 if ira.w15>0 set CNT=CNT+1 set WITH(CNT)=DESC(15)_"|"_ira.w15
 if ira.w16>0 set CNT=CNT+1 set WITH(CNT)=DESC(16)_"|"_ira.w16
 if ira.w17>0 set CNT=CNT+1 set WITH(CNT)=DESC(17)_"|"_ira.w17
 if ira.w18>0 set CNT=CNT+1 set WITH(CNT)=DESC(18)_"|"_ira.w18
 if ira.w19>0 set CNT=CNT+1 set WITH(CNT)=DESC(19)_"|"_ira.w19
 if ira.w20>0 set CNT=CNT+1 set WITH(CNT)=DESC(20)_"|"_ira.w20
 if ira.w21>0 set CNT=CNT+1 set WITH(CNT)=DESC(21)_"|"_ira.w21
 if ira.w22>0 set CNT=CNT+1 set WITH(CNT)=DESC(22)_"|"_ira.w22
 if ira.w23>0 set CNT=CNT+1 set WITH(CNT)=DESC(23)_"|"_ira.w23
 if ira.w24>0 set CNT=CNT+1 set WITH(CNT)=DESC(24)_"|"_ira.w24
 if ira.w25>0 set CNT=CNT+1 set WITH(CNT)=DESC(25)_"|"_ira.w25
 if ira.w26>0 set CNT=CNT+1 set WITH(CNT)=DESC(26)_"|"_ira.w26
 if ira.w28>0 set CNT=CNT+1 set WITH(CNT)=DESC(28)_"|"_ira.w28
 if ira.w29>0 set CNT=CNT+1 set WITH(CNT)=DESC(29)_"|"_ira.w29
 if ira.w34>0 set CNT=CNT+1 set WITH(CNT)=DESC(34)_"|"_ira.w34
 if ira.w35>0 set CNT=CNT+1 set WITH(CNT)=DESC(35)_"|"_ira.w35
 if ira.w36>0 set CNT=CNT+1 set WITH(CNT)=DESC(36)_"|"_ira.w36
 if ira.w37>0 set CNT=CNT+1 set WITH(CNT)=DESC(37)_"|"_ira.w37
 if ira.w38>0 set CNT=CNT+1 set WITH(CNT)=DESC(38)_"|"_ira.w38
 if ira.w39>0 set CNT=CNT+1 set WITH(CNT)=DESC(39)_"|"_ira.w39
 if ira.w43>0 set CNT=CNT+1 set WITH(CNT)=DESC(43)_"|"_ira.w43
 if ira.w44>0 set CNT=CNT+1 set WITH(CNT)=DESC(44)_"|"_ira.w44
 if ira.w45>0 set CNT=CNT+1 set WITH(CNT)=DESC(45)_"|"_ira.w45
 if ira.w47>0 set CNT=CNT+1 set WITH(CNT)=DESC(47)_"|"_ira.w47
 if ira.w48>0 set CNT=CNT+1 set WITH(CNT)=DESC(48)_"|"_ira.w48
 if ira.w49>0 set CNT=CNT+1 set WITH(CNT)=DESC(49)_"|"_ira.w49
 if ira.w50>0 set CNT=CNT+1 set WITH(CNT)=DESC(50)_"|"_ira.w50
 if ira.w51>0 set CNT=CNT+1 set WITH(CNT)=DESC(51)_"|"_ira.w51
 if ira.w52>0 set CNT=CNT+1 set WITH(CNT)=DESC(52)_"|"_ira.w52
 if ira.w53>0 set CNT=CNT+1 set WITH(CNT)=DESC(53)_"|"_ira.w53
 if ira.w54>0 set CNT=CNT+1 set WITH(CNT)=DESC(54)_"|"_ira.w54
 if ira.w55>0 set CNT=CNT+1 set WITH(CNT)=DESC(55)_"|"_ira.w55
 if ira.w56>0 set CNT=CNT+1 set WITH(CNT)=DESC(56)_"|"_ira.w56
 if ira.w57>0 set CNT=CNT+1 set WITH(CNT)=DESC(57)_"|"_ira.w57
 if ira.w58>0 set CNT=CNT+1 set WITH(CNT)=DESC(58)_"|"_ira.w58
 if ira.w59>0 set CNT=CNT+1 set WITH(CNT)=DESC(59)_"|"_ira.w59
 if ira.w60>0 set CNT=CNT+1 set WITH(CNT)=DESC(60)_"|"_ira.w60
 if ira.w61>0 set CNT=CNT+1 set WITH(CNT)=DESC(61)_"|"_ira.w61
 if ira.w62>0 set CNT=CNT+1 set WITH(CNT)=DESC(62)_"|"_ira.w62
 if ira.w63>0 set CNT=CNT+1 set WITH(CNT)=DESC(63)_"|"_ira.w63
 if ira.w64>0 set CNT=CNT+1 set WITH(CNT)=DESC(64)_"|"_ira.w64
 if ira.w65>0 set CNT=CNT+1 set WITH(CNT)=DESC(65)_"|"_ira.w65
 if ira.w66>0 set CNT=CNT+1 set WITH(CNT)=DESC(66)_"|"_ira.w66
 if ira.w67>0 set CNT=CNT+1 set WITH(CNT)=DESC(67)_"|"_ira.w67
 if ira.w68>0 set CNT=CNT+1 set WITH(CNT)=DESC(68)_"|"_ira.w68
 if ira.w69>0 set CNT=CNT+1 set WITH(CNT)=DESC(69)_"|"_ira.w69
 if ira.w70>0 set CNT=CNT+1 set WITH(CNT)=DESC(70)_"|"_ira.w70
 if ira.w71>0 set CNT=CNT+1 set WITH(CNT)=DESC(71)_"|"_ira.w71
 if ira.w72>0 set CNT=CNT+1 set WITH(CNT)=DESC(72)_"|"_ira.w72
 if ira.w73>0 set CNT=CNT+1 set WITH(CNT)=DESC(73)_"|"_ira.w73
 if ira.w74>0 set CNT=CNT+1 set WITH(CNT)=DESC(74)_"|"_ira.w74
 if ira.w75>0 set CNT=CNT+1 set WITH(CNT)=DESC(75)_"|"_ira.w75
 if ira.w76>0 set CNT=CNT+1 set WITH(CNT)=DESC(76)_"|"_ira.w76
 if ira.w77>0 set CNT=CNT+1 set WITH(CNT)=DESC(77)_"|"_ira.w77
 if ira.w78>0 set CNT=CNT+1 set WITH(CNT)=DESC(78)_"|"_ira.w78
 if ira.w79>0 set CNT=CNT+1 set WITH(CNT)=DESC(79)_"|"_ira.w79
 if ira.w80>0 set CNT=CNT+1 set WITH(CNT)=DESC(80)_"|"_ira.w80
 if ira.w81>0 set CNT=CNT+1 set WITH(CNT)=DESC(81)_"|"_ira.w81
 if ira.w82>0 set CNT=CNT+1 set WITH(CNT)=DESC(82)_"|"_ira.w82
 if ira.w83>0 set CNT=CNT+1 set WITH(CNT)=DESC(83)_"|"_ira.w83
 if ira.w84>0 set CNT=CNT+1 set WITH(CNT)=DESC(84)_"|"_ira.w84
 if ira.w85>0 set CNT=CNT+1 set WITH(CNT)=DESC(85)_"|"_ira.w85
 if ira.w86>0 set CNT=CNT+1 set WITH(CNT)=DESC(86)_"|"_ira.w86
 if ira.w87>0 set CNT=CNT+1 set WITH(CNT)=DESC(87)_"|"_ira.w87
 if ira.w88>0 set CNT=CNT+1 set WITH(CNT)=DESC(88)_"|"_ira.w88
 if ira.w89>0 set CNT=CNT+1 set WITH(CNT)=DESC(89)_"|"_ira.w89
 if ira.w94>0 set CNT=CNT+1 set WITH(CNT)=DESC(94)_"|"_ira.w94
 if ira.w95>0 set CNT=CNT+1 set WITH(CNT)=DESC(95)_"|"_ira.w95
 if ira.w96>0 set CNT=CNT+1 set WITH(CNT)=DESC(96)_"|"_ira.w96
 if ira.w97>0 set CNT=CNT+1 set WITH(CNT)=DESC(97)_"|"_ira.w97
 if ira.w98>0 set CNT=CNT+1 set WITH(CNT)=DESC(98)_"|"_ira.w98
 if ira.w99>0 set CNT=CNT+1 set WITH(CNT)=DESC(99)_"|"_ira.w99

 // I18N=OFF
 if 'CNT set WITH(1)="*** NO ACTIVITY ***",CNT=1
 set CNT=CNT+1,WITH(CNT)="***"

 // I18N=ON
 set TEMP="",SWITCH=99

 set N="" for  set N=$O(WITH(N))  quit:(N.isNull())  do {

	if WITH(N)="***" set WITH(N)="",SWITCH=N
	if N'<SWITCH quit

	set VL="    "_(WITH(N).piece("|",1))_$J("",25-(WITH(N).piece("|",1)).length())
	set VL=VL_$S(WITH(N)["*":"",1:$J(WITH(N).piece("|",2),12,2))
	do VOM
	}
	quit

VP13	// Column pre-processor - Variable: ADDR(1)

	type public String vc3,vc1
 type public String ADDR()

 set (ADDR(1),ADDR(2),ADDR(3),ADDR(4),ADDR(5))=0

 do ^UTLADDR(,"ADDR",5,1,"IRATYPE",vc3,vc1)
	quit

VP14	// Column pre-processor - Variable: FDT

 type public Date FD,FDT

 set FDT=FD
 
	quit

VP15	// Column post-processor - Variable: PAGE

 type public Number PAGE,RESETPG

 if RESETPG set PAGE=1,RESETPG=0
 else  set PAGE=PAGE+1
	quit
