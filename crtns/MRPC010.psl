MRPC010(String return,Number versn,String name,String cls)	//Public;Customer/Account name alpha lookup
	/*
	   ORIG: CHIANG - 08/18/94

	   Access server ^XALPHA gloabl for account name lookup.

	   [SCATBL5]RPCID=10

	   KEYWORDS: Client/Server, Database , Screen

	   ARGUMENTS:
	       . return 	Account/name list  	/TYP=T/REQ
	        					/MECH=REFNAM:W

	       . versn 		^MRPC010 version number /TYP=N/REQ
	    			Current version = 1  	/MECH=VAL

	       . name 		Customer number/name  /REQ/MECH=VAL/TBL=[DBTBL2]

	       . cls     	Account class   	/TYP=T/REQ/MECH=VAL
	                 	* = CIF Number
	                 	D = Deposit Account
	    			L = Loan Account
	   RETURNS:
	       . $$ 		Error message   	/TYP=T
	    			Null = No error

	   RELATED:
	       . $$^PBSMRPC - MRPC Service Class Driver

	   EXAMPLES:

	   	S RM=$$^MRPC010(.val,1,"SMITH","*")
	   	S RM=$$^MRPC010(.val,1,123,"D")

	        val=account<TAB>name|account<TAB>name|...

	---- Revision History ------------------------------------------------

        07/26/05 - SkariahV- CR16679
	           Removed #WARN directive.
	              
	04/16/03 - GRAY - 51351
		   Corrected SQLFAIL,vOpen0+15^MRPC010,0,Invalid LIKE Syntax
		   error from occurring.

	01/10/03 - GRAY - 51351
		   Converted to PSL.
	

	*/
	
	type Public String %LIBS

	// Version number of client message is not compatible with server
	if versn.get()'=1 quit $$ERRMSG^PBSUTL($$^MSG(2951))


	type Number acn,cid,ER,type
	type String acnnam,nmz,Return,RM
	type String WHERE,XNAME

	set RM=""

	if name?1N.N do { quit $$ERRMSG^PBSUTL($G(RM))
		if cls="*" do { quit
			type RecordCIF cif=Db.getRecord("CIF","ACN=:name",1)
			// Invalid customer number
			if cif.getMode()=0 set RM=$$^MSG(1295) quit
			// Customer name
			set Return=name_$C(9)_cif.nam_"|"_cif.xname
			}

		type RecordACN acn=Db.getRecord("ACN","CID=:name",1)
		// Invalid account ~p1
		if acn.getMode()=0 set RM=$$^MSG(1259,name) quit   

		set acnnam=acn.title1_"|"_acn.title2_"|"_acn.title3_"|"
		set acnnam=acnnam_"|"_acn.title4_"|"_acn.acctname

		// Account title
		set Return=name_$C(9)_acnnam.translate("|"," ")
		}

	set return=""
	
	set nmz=name

	set WHERE="XNAME LIKE '"_nmz_"%'"
 	
	#ACCEPT DATE=04/11/03; PGM=Shaun Gray; CR=Dan Russell
	type ResultSet rs=Db.select("ACN,XNAME","CIF",WHERE)
	while rs.next() do {
		set acn=rs.getCol(1)
		set XNAME=rs.getCol(2)
		if cls="*" set return=return_acn_$C(9)_XNAME_"|" quit

		type ResultSet relrs=Db.select("CID","RELCIF,ACN","ACN=:acn AND CLS=:cls")
		while relrs.next() do {
			set cid=relrs.getCol(1)
			set return=return_cid_$C(9)_XNAME_"|"
			}
		}

	quit ""
 #OPTION ResultClass ON
Public String vSIG()	quit "60107^17673^Viji Skariah^2434"	// Signature - LTD^TIME^USER^SIZE
