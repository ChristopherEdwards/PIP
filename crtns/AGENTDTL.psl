AGENTDTL //;PBS -  Agent Maintenance Routine
	/*
	  ;Copyright(c)2000 Sanchez Computer Associates, Inc.  All Rights Reserved - 08/30/00 11:00:31 - ARPAV
	       ORIG:  V. Arpa
	       DESC: Agent Maintenance Routine
		
		For create, modify, inquire, delete Agents.	

	   ARGUMENTS:
	
	   INPUTS:
	
	   RETURNS:
	
	   EXAMPLE:
	   D UPD^AGENTDTL
	
	
	  ---- Revision History ----------------------------------------------

	07/03/06 - Vanitha Krishnasamy 21741
		   Corrected the call to the screen "AGENTDTL" to 
		   include DRV^USID. Defined NEW,UPD,INQ and DEL sections to 
		   call INIT section with the %ProcessMode. Deleted AGVER() 
		   section since AGTFEE table has been obsoleted and included
		   the deletion process in the VER section. Cleaned up the 
		   code to avoid compiler warnings.
		   		    
	 	   Removed old revision history.
	
	  --------------------------------------------------------------------
	
	*/
	do NEW
	
	quit
	
NEW	//
	do INIT(0)
	
	quit
	
		
UPD	//
	do INIT(1)
	
	quit
	
	
INQ	//
	do INIT(2)
	
	quit
	
	
DEL	//
	do INIT(3)
	
	quit
	
	
INIT(Number %ProcessMode) //

	type Number %PAGE, %PG
	type String OLNTB, VFMQ
	
	set %PG=0
	set %PAGE=1
	
	type RecordAGENT fAGENT
	do VPG(.fAGENT)
	
	kill OLNTB,VFMQ
	quit
	
		
VPG(RecordAGENT fAGENT) 	// Page control
	
	type public Number %PG
	type public String ER, VFMQ
	
	type Boolean FINISH = 0
	
	for  do { quit:FINISH
		if %PG = 0 do VPG00 if ER!(VFMQ="Q") set FINISH = 1 quit
		if %PG > 0 do VPG01(.fAGENT)
		
		if "DFQ" [ VFMQ do VER(.fAGENT) set FINISH = 1 quit
		set %PG = %PG + 1
		}
	quit
	
		
VPG00 	// Set up
	
	type public String %READ, %TAB(), ER, IO, VFMQ
		
	set %TAB("IO")=$$IO^SCATAB($I)
	if %ProcessMode=0 set %TAB("AGENT")="[AGENT]AGENT/TBL=[UTBLBRCD]/XPP=do EXISTS^AGENTDTL"
	else  set %TAB("AGENT")="[AGENT]AGENT/TBL=[AGENT]"
	
	set %READ="@@%FN,"
	if %ProcessMode=2 set %READ=%READ_",IO/REQ"
	set %READ=%READ_",AGENT/REQ"
	
	do ^UTLREAD if VFMQ="Q" quit 
	if %ProcessMode=2,IO'=$I do OPEN^SCAIO if ER set VFMQ = "Q" quit
	quit 


VPG01(RecordAGENT fAGENT) 	// Screen
		
	type public Number AGENT
	type public String ET
	
	type String PGM
		
	set fAGENT = Db.getRecord("AGENT","AGENT=:AGENT",1)
	do DRV^USID(%ProcessMode,"AGENTDTL",.fAGENT,,,,) if PGM.isNull() set ET="INVLDSCR" do ERR quit 
	quit
	
	
ERR     
	type public String ER, VFMQ
	
	set ER=1 //do ^UTLERR
	set VFMQ="Q"
	quit 
	
EXISTS  // If [AGENT]AGENT exists in AGENT b4 create?
	
	type public Number X
	type public String ER
			
	if 'Db.isDefined("AGENT","AGENT=:X") quit
	
	//Record already exists
	do Runtime.setErrMSG("AGENT",2327) quit:ER
	quit

	
VER(RecordAGENT fAGENT)    // Verification
		
	type public Number AGENT
	type public String ER, RM, VFMQ
		
	//set fAGENT = Db.getRecord("AGENT","AGENT=:AGENT",1)
		
	if (%ProcessMode = 2!(%ProcessMode=4)!(VFMQ="Q")!ER) do END quit
	if (%ProcessMode = 3) do Db.delete("AGENT","AGENT=:AGENT") quit
	else  do fAGENT.save()
	
        do END
	quit
	
		
END	// End of processing
	type public String ER, RM, VFMQ
	
	quit:(ER.get())!(%ProcessMode=2)!(%ProcessMode=4) 
	
	if VFMQ="Q" do {
		if %ProcessMode=0 set RM=$$^MSG(6709,"Agent") quit    // Agent not created
		if %ProcessMode=1 set RM=$$^MSG(6710,"Agent") quit    // Agent not modified
		if %ProcessMode=3 set RM=$$^MSG(6711,"Agent") quit    // Agent not deleted
		}
	else  do {
		if %ProcessMode=0 set RM=$$^MSG(6712,"Agent") quit    // Agent created
		if %ProcessMode=1 set RM=$$^MSG(2334) quit    // Recoed modified
		if %ProcessMode=3 set RM=$$^MSG(3028,"Agent") quit    // Agent deleted
		}
	if 'RM.get().isNull() set ER = "W"
	quit 
	
 #OPTION ResultClass ON
Public String vSIG()	quit "60494^43216^Vanitha Krishnasamy^3391"	// Signature - LTD^TIME^USER^SIZE
