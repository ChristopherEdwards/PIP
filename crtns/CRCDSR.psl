CRCDSR  //Related Currency Maintenance
        /*
 
               ORIG:  Programmer Name (I.D.) - MM/DD/YY
 
        ---- Revision History------------------------------------------------
        09/03/02 - SRIVASTAVAN - 49451
                   Converted to PSL
	---------------------------------------------------------------------
        */
 
UPD     //

	do INIT(1) 

	quit

 
INQ     //

	do INIT(2) 

	quit

 
DEL     //

	do INIT(3) 

	quit

 
INIT(%ProcessMode)	//

	new OLNTB,VFMQ

	set CO=%CompanyName

	type RecordCRCD0 fCCSR

	#if 'CUVAR.%mcp
	do { quit
		set ER=1
		set ET="MCPNE" 

		do ^UTLERR 
		}
	#endif

        set %PG=0
        set %PAGE=1

	do VPG(.fCCSR)

        quit

 
VPG(RecordCRCD0 fCCSR)     //Page control

	new FINISH
	set FINISH=0
	for  do { quit:FINISH
                if %PG=0 do VPG00 if ER set FINISH=1 quit
		
		if %PG>0 do VPG01(.fCCSR)
	
		if "DFQ"[VFMQ do VER(.fCCSR) set FINISH=1 quit

		set %PG=%PG+1
                }
	quit

 
VPG00	// Set up

	set %TAB("CRCD")=".CRCD1/HLP=[CRCD]CRCD/TBL=[CRCD]CRCD,DESC:DISTINCT:QU ""[CRCD]CO=<<CO>>"",#1"
	set %TAB("RELCRCD")=".RELCRCD1/HLP=[CRCD0]RELCRCD/XPP=D PPREL^CRCDSR"
 
	if %ProcessMode=1 set %TAB("RELCRCD")=%TAB("RELCRCD")_"/TBL=[CRCD]CRCD,DESC:DISTINCT:QU ""[CRCD]CO=<<CO>>"",#1"
	else  set %TAB("RELCRCD")=%TAB("RELCRCD")_"/TBL=[CRCD0]RELCRCD,DIRCRCD:QU ""[CRCD0]CO=<<CO>> AND [CRCD0]CRCD=<<CRCD>>"""

	if %ProcessMode=2 set %TAB("IO")=$$IO^SCATAB($I)
	set %READ="@@%FN,,,CRCD/REQ,RELCRCD/REQ" 
	set %NOPRMT="N"
	if %ProcessMode=2 set %READ=%READ_",IO/REQ"

	do ^UTLREAD 
	
	if VFMQ="Q" set ER=1

        quit
 

VPG01(RecordCRCD0 fCCSR)   // Screen

	if %ProcessMode=2,IO'=$I do OPEN^SCAIO if ER set VFMQ="Q" quit


	// Check to see if this is Creating or Modifying a special relationship

	set fCCSR=Db.getRecord("CRCD0","CO=:CO,CRCD=:CRCD,RELCRCD=:RELCRCD",1)

	if (%ProcessMode=1),fCCSR.getMode()=0 set %ProcessMode=0

        do DRV^USID(%ProcessMode,"CRCDSR",.fCCSR)

        quit
 

PPREL   // Related currency code post-processor

	//Enter currency code other than ~p1
        if X=CRCD do {
		set ER=1
		set RM=$$^MSG(938,CRCD)          
		}
        quit
	

VER(RecordCRCD0 fCCSR)     //

	if %ProcessMode=2!(%ProcessMode=4)!(VFMQ="Q") do END quit
      
	do FILE(.fCCSR)
 
        do END
 
        quit

 
FILE(RecordCRCD0 fCCSR)    // File data

        if %ProcessMode=3 do Db.delete("CRCD0","CO=:CO AND CRCD=:CRCD AND RELCRCD=:RELCRCD") quit

	do fCCSR.save()

	quit
 

END     //

	if ER!(%ProcessMode=2)!(%ProcessMode=4) quit

	if VFMQ="Q" do {
 
                // Currency code ~p1 relationship not created
		if %ProcessMode=0 set RM=$$^MSG(671,CRCD) quit       
 
		// Currency code ~p1 relationship not modified
		if %ProcessMode=1 set RM=$$^MSG(673,CRCD) quit        
 
		// Currency code ~p1 relationship not deleted
		set RM=$$^MSG(672,CRCD)               
		}
	else  do {
 	
		// Currency code ~p1 relationship created
		if %ProcessMode=0 set RM=$$^MSG(668,CRCD) quit        
 
		// Currency code ~p1 relationship modified
		if %ProcessMode=1 set RM=$$^MSG(670,CRCD) quit       
 
		// Currency code ~p1 relationship deleted
		set RM=$$^MSG(669,CRCD)               
		}
	set ER="W"
	quit
 
 #OPTION ResultClass ON
Public String vSIG()	quit "59886^43500^Sanchez SCM Administrator^3000"	// Signature - LTD^TIME^USER^SIZE
