public LNANAP
  /*
ORIG: hillanbd - 02/22/2005
DESC: Non-Accrual Status Removal

---- Revision History ------------------------------------------------
	
	03/07/07 - PUTTASWH - CR 25683
		   Modified to prevent RDBSAVEFAIL error that occurs 
		   when the DAYENDLNNAO record already exists and to
		   conform to current PSL standards.
		  
	03/07/05 - Hillanbrand - CR 14587
                   Converted M routine to PSL procedure. Additional 
                   modifications per code review.		

 */
 
 	type public Boolean ER
	type public String RM

	type Date EJD
	type Number CID
	type String %READ, %TAB(), VFMQ

	// Set up
	set %TAB("EJD")=".EJD1/HLP=[DAYENDLNNAO]EJD/TBL=[DAYENDLNNAO]EJD:DISTINCT"
	set %TAB("CID")=".CID3/HLP=[DAYENDLNNAO]CID/TBL=[DAYENDLNNAO]CID:DISTINCT:QU ""[DAYENDLNNAO]EJD=<<EJD>>""/XPP=D PCID^LNANAP"

	set %READ="@@%FN,,,EJD/REQ,CID/REQ"
	do ^UTLREAD

	// File data	
	if VFMQ'="Q" do {
		type RecordDAYENDLNNAO delnnao=Db.getRecord("DAYENDLNNAO","EJD=:EJD,CID=:CID")
		set delnnao.auto=0
		set delnnao.rev=1
		set delnnao.uid=%UserID
		do delnnao.bypassSave()
		}		 
	
	set ER="W"

	// Account ~p1 not deleted from automatic processing	
	if VFMQ="Q" set RM=$$^MSG(131,CID.get()) quit  
	
	// Account ~p1 deleted from automatic processing
	set RM=$$^MSG(110,CID) 
	
	quit 
	

PCID	// Post processor to CID

	type public Boolean ER
	type public Date EJD	
	type public Number X

	type RecordDAYENDLNNAO delnnao=Db.getRecord("DAYENDLNNAO","EJD=:EJD,CID=:X",1)
	
	// No DAYEND file created for this date
	if 'delnnao.getMode() do Runtime.setErrSTBLER("DAYENDLNNAO","NODEENT") quit:ER
	
	// Loan not set up for automatic non-accrual	
	if 'delnnao.auto do Runtime.setErrSTBLER("DAYENDLNNAO","LNNSUA") quit:ER

	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "60697^22911^Hema Puttaswamy^1661"	// Signature - LTD^TIME^USER^SIZE
