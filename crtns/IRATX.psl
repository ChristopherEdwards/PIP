IRATX	 /* 
    ORIG: GRAY - 01/17/2000
    DESC: IRA Tax Year Information
    
    ---- Comments --------------------------------------------------------
    
    ---- Revision History ------------------------------------------------

	12/02/05 - DHANALAKSHMI R - 16851
		   Modified section PLNFMV,CYSUM,XC2 by adding 1 to the 
		   getRecord and checking the dep.getMode() instead of 
		   dep.cls.

	11/16/05 - DHANALAKSHMI R - 16851
		   Modified the sections D9 and SW9 by implementing the 
		   project CR1869DS Multiple Distribution Codes for IRS 
		   Form 1099-R.
		   Corrected few warnings.
	
	12/13/02 - ANTONOVS - 51371
		   Modified sections D9 and SW9 to check if IRA record exists
		   before retrieving the information.

	02/14/02 - ANTONOVS - 46454
		   Added New section SW9 to calculate total State Tax Withheld
		   amount.
	
	10/10/00 - KINI - 36760
		   Modified section PLNFMV to accommodate Tax year-end defined 
		   in CUVAR.             	
   
	12/10/99 - GRAY - 32507
		   Removed code no longer needed due to the Elimination
		   of Teller/Branch Character Interface and placed remaining
		   code into PSL'd procedure definition.

 */

	quit
	

Public XC2(ACN,RPASEQ,TAXYR)	// Assignment expression for data item XC2 in file IRA
	
	type RecordIRA ira=Db.getRecord("IRA","ACN,RPASEQ,TAXYR+1",1)
	if 'ira.getMode() quit 0
	quit ira.C2
	
Public CYSUM(ACN,RPASEQ,TAXYR)	// Current year sum (computed value)
	
	type Number CYSUM
	set CYSUM=0

	type RecordIRA ira=Db.getRecord("IRA","ACN,RPASEQ,TAXYR",1)
	if ira.getMode() set CYSUM=ira.c1+ira.c13

	set CYSUM=CYSUM+$$XC2(ACN,RPASEQ,TAXYR)
	
	quit CYSUM
	
Public D9(ACN,RPASEQ,TAXYR)	//
	
	type Number D9
	set D9=0
	
	if 'Db.isDefined("IRA","ACN,RPASEQ,TAXYR") quit D9

	type RecordIRA ira=Db.getRecord("IRA","ACN,RPASEQ,TAXYR")
	
	set D9=D9+ira.w1+ira.w2+ira.w3+ira.w4+ira.w5+ira.w6+ira.w7+ira.w8+ira.w9
	set D9=D9+ira.w10+ira.w11+ira.w12+ira.w13+ira.w14+ira.w15+ira.w16+ira.w17
	set D9=D9+ira.w18+ira.w19+ira.w20+ira.w21+ira.w22+ira.w23+ira.w24+ira.w25
	set D9=D9+ira.w26+ira.w27+ira.w34+ira.w35+ira.w43+ira.w44+ira.w45+ira.w47
	set D9=D9+ira.w49+ira.w50+ira.w51+ira.w52+ira.w53+ira.w54+ira.w55
	set D9=D9+ira.w56+ira.w57+ira.w58+ira.w59+ira.w60+ira.w61+ira.w62+ira.w63
	set D9=D9+ira.w64+ira.w65+ira.w66+ira.w67+ira.w68+ira.w69+ira.w70+ira.w71
	set D9=D9+ira.w72+ira.w73+ira.w74+ira.w75+ira.w76+ira.w77+ira.w78+ira.w79+ira.w80
	set D9=D9+ira.w81+ira.w82+ira.w83+ira.w84+ira.w85+ira.w86+ira.w87+ira.w88
	set D9=D9+ira.w94+ira.w95+ira.w96+ira.w97+ira.w98+ira.w99          
	
	quit D9

Public SW9(ACN,RPASEQ,TAXYR)     // State Tax Withheld amount
 
	/*
	This function calculates the total amount of state tax withholding
	reportable and non-reportable associated with retirement plan
	distributions.
	
	Keywords:  RPA, retirement plan, distribution, state withholding
	
	ARGUMENTS:
		. ACN		Customer number		/TYP=N/REQ
	
		. RPASEQ	RPA sequence		/TYP=N/REQ
	
		. TAXYR		Tax Year		/TYP=N/REQ/LEN=4
	
	RETURNS:
	       . SW9   State Withholding Amount    /TYP=$
	
	RELATED:
	       . $$D9^IRATX - returns Federal W/H Amount
	
	EXAMPLE:
	       S SWA=$$SW9^IRATX(12345,1,2001)
	*/

	type Number SW9
	set SW9=0

	if 'Db.isDefined("IRA","ACN,RPASEQ,TAXYR") quit SW9

	type RecordIRA ira=Db.getRecord("IRA","ACN,RPASEQ,TAXYR")
 
	set SW9=SW9+ira.sw1+ira.sw2+ira.sw3+ira.sw4+ira.sw5+ira.sw6+ira.sw7+ira.sw8
	set SW9=SW9+ira.sw10+ira.sw11+ira.sw12+ira.sw13+ira.sw14+ira.sw15+ira.sw16+ira.sw17
	set SW9=SW9+ira.sw18+ira.sw19+ira.sw20+ira.sw21+ira.sw22+ira.sw23+ira.sw24+ira.sw25
	set SW9=SW9+ira.sw26+ira.sw27+ira.sw34+ira.sw35+ira.sw43+ira.sw44+ira.sw45+ira.sw47
	set SW9=SW9+ira.sw49+ira.sw50+ira.sw51+ira.sw52+ira.sw53+ira.sw54+ira.sw55
	set SW9=SW9+ira.sw56+ira.sw57+ira.sw58+ira.sw59+ira.sw60+ira.sw61+ira.sw62+ira.sw63
	set SW9=SW9+ira.sw64+ira.sw65+ira.sw66+ira.sw67+ira.sw68+ira.sw69+ira.sw70+ira.sw71
	set SW9=SW9+ira.sw72+ira.sw73+ira.sw74+ira.sw75+ira.sw76+ira.sw77+ira.sw78+ira.sw79+ira.sw80
	set SW9=SW9+ira.sw81+ira.sw82+ira.sw83+ira.sw84+ira.sw85+ira.sw86+ira.sw87+ira.sw88
	set SW9=SW9+ira.sw94+ira.sw95+ira.sw96+ira.sw97+ira.sw98+ira.sw99
 
	quit SW9
	 
Public PLNFMV(ACN,IRATYP,TAXYR)  // Plan Fair Market Value
	/*
	INPUT:
             . ACN     Customer number
             . IRATYP  Retirement type
             . TAXYR   Tax year
        */
	
        new CID,IRA,HSEQ,JD,PLNFMV,ROLE,EOTY
        
        set EOTY=$$EOTY^SCADAT(%SystemDate,1)	        // end of tax year
        set JD=$$DSJD^SCADAT($$DAT^%ZM(EOTY,"MM/DD/")_(TAXYR-1))

        set HSEQ=JD
        set PLNFMV=0
        
	new rs
	type ResultSet rs=Db.select("CID","RELCIF","ACN=:ACN")
	
	if rs.isEmpty() quit PLNFMV

	while rs.next() do {
		set CID=rs.getCol(1)
		
		set ROLE=$$ROLE^UCO1(CID,ACN)
		if +ROLE'=1 quit
		type RecordDEP dep=Db.getRecord("DEP","CID=:CID",1)
		if 'dep.getMode() quit
		set IRA=dep.rpaseq if IRA'=IRATYP quit
		if Db.isDefined("HIST0","CID,HSEQ") do {
			new acrcf,bal,hist0
			type RecordHIST0 hist0=Db.getRecord("HIST0","CID,HSEQ")
			set bal=hist0.bal
			set acrcf=hist0.acrcf
			set PLNFMV=PLNFMV+hist0.bal+hist0.acrcf
			}
		}
	
	quit PLNFMV
 #OPTION ResultClass ON
Public String vSIG()	quit "60249^32706^Dhanalakshmi R^4951"	// Signature - LTD^TIME^USER^SIZE
