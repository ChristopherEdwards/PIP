LTYFUNCS	//Library;ACN Filer Functions
	/*
	   ORIG: RUSSELL - 03/14/96

	   ACN Filer Functions, including shared DEP and LN functions
	   Note that these functions are for private use by ACN, DEP, and LN
	   filers only.

	   KEYWORDS: Loans, Deposits

	   LIBRARY:
	   . FREQ     - Validate frequency
	   . TRN      - Validate tran code

          ---- Revision History ------------------------------------------------

	   01/26/05 - TITOVE - CR 13728
	   	      Modified as part of DBI2 project.

	   04/10/02 - KRISHNAG - ARQ # 49794
                      Converted to PSL

	   09/28/00 - HALPINJ - 41961
	              Removed newing of PCM in section FREEQ.  This value is
		      passed in for use in this section but was newed in the
	              first line of code and there was no code resetting it.
		      Updated ^UFRE call to $$NJD^UFRE.

	*/
	// Do not enter from top
	quit


public	TRN(String ETC,Number TRB)	// Validate transaction code

	type public Boolean ER

	type Number DC
	
	if ETC.isNull() quit

	// Lowercase transaction codes protected
	if ETC?.E1L.E do Runtime.setErrMSG("TRN",1663) quit:ER

	type RecordTRN trn = Db.getRecord("TRN","ETC=:ETC",1)
	
	// Invalid transaction code ~p1 
	if 'trn.getMode() do Runtime.setErrMSG("TRN",1498,ETC) quit:ER

	// Get Debit/Credit flag
	set DC = trn.dc
 
	// Validate
	if $$DC^UTRB(DC,TRB) quit

	// Transaction code must be a debit
	if TRB do Runtime.setErrMSG("TRN",2696) quit:ER

	// Transaction code must be a credit
	else  do Runtime.setErrMSG("TRN",2695) quit:ER
	
	quit
	

public	FREQ(String X,String DIST1FRE,String PCM)	// Validate frequency format

	type public Boolean ER

	type String D1, P1, P2

	if X.isNull() quit

	if DIST1FRE.isNull() ! (DIST1FRE = "*") quit

	do EDT^UFRE quit:ER.get()

	// Dates need not correspond
	if 'PCM.get().isNull() do { quit:PCM.extract(2) '= 1
                type RecordSTBLPCM stblpcm = Db.getRecord("STBLPCM", "KEY = :PCM",1)
                if 'stblpcm.getMode() quit
                set PCM = stblpcm.pcmp
                }

	set D1 = "" 

	set D1 = %SystemDate.nextFreqDate(DIST1FRE,,1) quit:ER.get()

	// master payment
	set P1 = $$^MSG(4209)

	// Interest/Dividend change
	set P2 = $$^MSG(4208)

	do VER^LNUSFV(D1,DIST1FRE,P1,"",X,P2)
	
	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "59931^44379^Eugene Titov^2132"	// Signature - LTD^TIME^USER^SIZE
