LNAOT	// LNAOT Maintenance
	/*
	       ORIG:  Neal E. Gorman (5053) - 04/26/87

	---- Revision History ------------------------------------------------
	
	08/01/06 - KELLYP - CR 22234
		   Rewrote most of procedure and eliminated looping VPG logic
		   which was causing UNDEFINED errors.
	
	09/09/05 - Satyanas - CR 16994
		   Modified the code to PSL standards and 
		   Removed the unscoped warnings.	
	
	08/06/02 - TELIV - ARQ 49451
		   Converted to PSL
	
	----------------------------------------------------------------------
	*/
	do NEW
	quit

public NEW 	//

	do INIT(0)
	quit
	

public UPD 	//

	do INIT(1)
	quit
	

public INQ 	//

	do INIT(2)
	quit


INIT(Number %ProcessMode)		// Page control

	type public Boolean ER
	
	type String VFMQ
	
	type RecordLNAOT fLNAOT

	do VPG00
	
	if ER!(VFMQ="Q") quit

	do VPG01(.fLNAOT) 
	
	if "DFQ"[VFMQ do VER(.fLNAOT)

	quit


VPG00	// Set up

	type public String ET,IO,%READ,%TAB(),TYP,UTBL(),VFMQ
		
	// "Type currently on file"
	set %TAB("TYP")=".TYP1/XPP=I '%OSAVE,$$EXISTS^LNAOT(X) set ER=1,RM=$$^MSG(3567)"

	if %ProcessMode set %TAB("TYP")=%TAB("TYP")_"/TBL=[LNAOT]"
	if %ProcessMode=2 set %TAB("IO")=$$IO^SCATAB($I)

	set %READ="@@%FN,,,TYP/REQ"
	if %ProcessMode=2 set %READ=%READ_",IO/REQ"
	do ^UTLREAD 

	if VFMQ="Q" quit

	if %ProcessMode=1 lock +UTBL("AOAMO",TYP):2 else  set ET="RECLOC" do ERR quit

	if %ProcessMode=2,IO'=$I do OPEN^SCAIO

	quit


VPG01(RecordLNAOT fLNAOT)	// Screen

	type public String TYP

	set fLNAOT=Db.getRecord("LNAOT","TYP=:TYP",1)

	do DRV^USID(%ProcessMode,"LNAOT",.fLNAOT) 

	quit


ERR	//----------------------

	type public Boolean ER
	type public String VFMQ
	
	set ER=1
	do ^UTLERR

	set VFMQ="Q"

        quit


VER(RecordLNAOT fLNAOT) 	

	type public String VFMQ
	if %ProcessMode=2!(VFMQ="Q") do END quit
	
	do fLNAOT.save()

	do END

	quit


END	//-------------------------------------

	type public String ER,RM,%TAB,TYP,VFMQ
	
	kill %TAB lock 
	if ER!(%ProcessMode=2) quit

	set TYP=TYP.get()

	if VFMQ="Q" do {

		// Add-on type ~p1 not created
		if %ProcessMode=0 set RM=$$^MSG(225,TYP) quit

		// Add-on type ~p1 not modified
		set RM=$$^MSG(226,TYP)
		}
	else  do {

		// Add-on type ~p1 created
		if %ProcessMode=0 set RM=$$^MSG(223,TYP) quit

		// Add-on type ~p1 modified
		set RM=$$^MSG(224,TYP)
		}

	set ER="W"

	quit


EXISTS(TYP)	//

	if Db.isDefined("LNAOT","TYP=:TYP") quit 1

	quit 0
 #OPTION ResultClass ON
Public String vSIG()	quit "60480^45819^Pat Kelly^2219"	// Signature - LTD^TIME^USER^SIZE
