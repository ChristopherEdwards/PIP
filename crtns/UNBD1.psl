UNBD1	// CREATE NON-BUSINESS DATE TABLE UTILITY
	/*
	       ORIG:  SOMPALLI - 13 MAR 1991		 
	
	 ---- Revision History ------------------------------------------------
	
	06/09/05 - MBUIM - CR15982
		   Modified to clean major PSL code.
		   
	07/31/02 - SRIVASTAVAN - 49451
		   Converted to PSL.	  	      

	 ----------------------------------------------------------------------
	*/
	   
NEW 	//

	do INIT(0) 
	quit 	   


UPD 	//

	do INIT(1) 
	quit	


INQ 	//

	do INIT(2) 
	quit	   


DEL 	//

	do INIT(3) 
	quit

	
INIT(%ProcessMode) //

	new OLNTB,VFMQ
	set %PG=0 
	set %PAGE=1

	type RecordUTBLNBD fUTBLNBD
	
	do VPG(.fUTBLNBD)
	
	quit
      
	
VPG(RecordUTBLNBD fUTBLNBD) //Page Control

	new FINISH
        set FINISH=0

	for  do { quit:FINISH
                if %PG=0 do VPG00 if ER!(VFMQ="Q") set FINISH=1 quit

                if %PG>0 do VPG01(.fUTBLNBD)

                if "DFQ"[VFMQ do VER(.fUTBLNBD) set FINISH=1 quit

                set %PG=%PG+1
                }
        quit


VPG00 	// Set up

	set %TAB("NBDC")=".NBDC1/HLP=[UTBLNBD]NBDC/TBL=[UTBLNBD]/XPP=D POS^UNBD1"
	set %TAB("IO")=$$IO^SCATAB($I)
	set %READ="@@%FN,,,NBDC/REQ"
	if %ProcessMode=2 set %READ=%READ_",,IO/REQ"
	
	do ^UTLREAD 
	
	if VFMQ="Q" quit

	if %ProcessMode=2,IO'=$I do OPEN^SCAIO
	
	quit


POS	// Calendar Prompt Post Processor

	if %OSAVE quit
	set I(3)=""
	if Db.isDefined("UTBLNBD","NBDC=:X") set ET="LNONFIL" do ERR

	quit


VPG01(RecordUTBLNBD fUTBLNBD) // Screen

	set fUTBLNBD=Db.getRecord("UTBLNBD","NBDC=:NBDC",1)

	do DRV^USID(%ProcessMode,"UTBLNBD",.fUTBLNBD)

	quit


ERR	//

	set ER=1 

	do ^UTLERR

	set VFMQ="Q"
	quit


VER(RecordUTBLNBD fUTBLNBD) //

	if %ProcessMode=2!(%ProcessMode=4)!(VFMQ="Q") do END quit
	if %ProcessMode=3 do {
		do Db.delete("UTBLNBD","NBDC=:NBDC")
        	}
	else  do fUTBLNBD.save()

	do END 

	quit


END	//

	if $G(ER)!(%ProcessMode=2)!(%ProcessMode=4) quit
	set NBDC=$G(NBDC)
	if VFMQ="Q" do {

		// Non-business date calendar ~p1 not created
		if %ProcessMode=0 do Runtime.setErrMSG("UTBLNBD",2009,"NBDC") quit:ER

		// Non-business date calendar ~p1 not modified
		if %ProcessMode=1 do Runtime.setErrMSG("UTBLNBD",2011,"NBDC") quit:ER

		// Non-business date calendar ~p1 not deleted
		do Runtime.setErrMSG("UTBLNBD",2010,"NBDC") quit:ER
		}
	else  do {

		// Non-business date calendar ~p1 created
		if %ProcessMode=0 do Runtime.setErrMSG("UTBLNBD",2006,"NBDC") quit:ER

		// Non-business date calendar ~p1 modified
		if %ProcessMode=1 do Runtime.setErrMSG("UTBLNBD",2008,"NBDC") quit:ER

		// Non-business date calendar ~p1 deleted
		do Runtime.setErrMSG("UTBLNBD",2007,"NBDC") quit:ER
		}
	set ER="W"
	
	quit

	
 #OPTION ResultClass ON
Public String vSIG()	quit "60059^75076^Marie Mbui^2458"	// Signature - LTD^TIME^USER^SIZE
