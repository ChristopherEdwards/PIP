private AUDMAN

	/*
	ORIG: chhabris - 12/09/2005
	DESC: AUDIT CNFRMS - MANUAL SELECTION OF ACCTS

	---- Comments --------------------------------------------------------
	08/15/06 - VANITHAK - CR 22163
		   Modified POSCID section to use dynamic SQL from AUDCON to
		   eliminate the use Q(). Modified to eliminate PSL compiler
		   warnings. Deleted the call to ^UTLERR in ERR section.
	
	12/13/05 - chhabris - CR18153
		   Converted to PSL. Removed old revision history.
		   
	---- Revision History ------------------------------------------------

	*/

	do INIT
	
	quit

INIT	//
	type String VFMQ
	type Number %PAGE,%PG,%REPEAT

	set %PG = 1,%PAGE = 99
	set %REPEAT = 20
	
	do VPG
	quit
	

VPG	// Page control
	type public Boolean ER
	type public Number %PG
	type public String VFMQ
	type Boolean FINISH

	type RecordAUDMAN fAUDMAN()

	set FINISH = 0
	for  do { quit:FINISH
		if %PG>0 do VPG01 if ER!(VFMQ = "Q") set FINISH = 1 quit
		if "DFQ"[VFMQ set FINISH = 1 quit
		set %PG = %PG+1
		}

	quit


VPG01	// Screen

	type public Number RUN
	type public String VFMQ
	type Number I
	
	type RecordAUDMAN fAUDMAN()

	for I=1:1:20 set fAUDMAN(I) = Class.new("RecordAUDMAN")

	do DRV^USID(1,"AUDMAN",.fAUDMAN(),,,,)

	if VFMQ = "Q" quit

	for I=1:1:20 do {
		if fAUDMAN(I).cid1 do {
			type RecordACN acn1 = Db.getRecord("ACN","CID=:fAUDMAN(I).cid1",1)
			if acn1.getMode() do {
				type RecordAUDIT audit1 = Db.getRecord("AUDIT","TJD=%SystemDate,RUN=:RUN,CID=:fAUDMAN(I).cid1",1)
				set audit1.bal = acn1.bal
				do audit1.save()
				}
			}
		if fAUDMAN(I).cid2 do {
			type RecordACN acn2 = Db.getRecord("ACN","CID=:fAUDMAN(I).cid2",1)
			if acn2.getMode() do {
				type RecordAUDIT audit2 = Db.getRecord("AUDIT","TJD=%SystemDate,RUN=:RUN,CID=:fAUDMAN(I).cid2",1)
				set audit2.bal = acn2.bal
				do audit2.save()
				}
			}
		if fAUDMAN(I).cid3 do {
			type RecordACN acn3=Db.getRecord("ACN","CID=:fAUDMAN(I).cid3",1)
			if acn3.getMode() do {
				type RecordAUDIT audit3 = Db.getRecord("AUDIT","TJD=%SystemDate,RUN=:RUN,CID=:fAUDMAN(I).cid3",1)
				set audit3.bal = acn3.bal
				do audit3.save()
				}
			}
		if fAUDMAN(I).cid4 do {
			type RecordACN acn4=Db.getRecord("ACN","CID=:fAUDMAN(I).cid4",1)
			if acn4.getMode() do {
				type RecordAUDIT audit4 = Db.getRecord("AUDIT","TJD=%SystemDate,RUN=:RUN,CID=:fAUDMAN(I).cid4",1)
				set audit4.bal = acn4.bal
				do audit4.save()
				}
			}
		if fAUDMAN(I).cid5 do {
			type RecordACN acn5 = Db.getRecord("ACN","CID=:fAUDMAN(I).cid5",1)
			if acn5.getMode() do {
				type RecordAUDIT audit5=Db.getRecord("AUDIT","TJD=%SystemDate,RUN=:RUN,CID=:fAUDMAN(I).cid5",1)
				set audit5.bal = acn5.bal
				do audit5.save()
				}
			}
		if fAUDMAN(I).cid6 do {
			type RecordACN acn6 = Db.getRecord("ACN","CID=:fAUDMAN(I).cid6",1)
			if acn6.getMode() do {
				type RecordAUDIT audit6=Db.getRecord("AUDIT","TJD=%SystemDate,RUN=:RUN,CID=:fAUDMAN(I).cid6",1)
				set audit6.bal = acn6.bal
				do audit6.save()
				}
			}
		}
		
	quit
	

ERR	//
	type public Boolean ER
	type public String VFMQ

	set ER=1 
	set VFMQ="Q"
	quit
	

private	POSCID	// Post processor for screen AUDMAN
	
	type public String WHERECON, X
	type public Boolean ER
		
	type Number CID
	type String WHERE
	
	do CID^UACN1 if ER!('X) quit

	set CID=X
		
	if 'WHERECON.isNull() set WHERE = WHERECON_" AND ACN.CID ="_CID
	else  set WHERE = "ACN.CID = "_CID
			
	#ACCEPT Date=08/14/06; PGM=Vanitha Krishnasamy; CR=22163
	type ResultSet rs = Db.select("CID", "ACN", WHERE, "CID ASC")
	
	// Account ~p1 does not match qualifiers
	if 'rs.next() do Runtime.setErrMSG("ACN", 112, CID) quit
	set WHERE = ""
		 
	quit
	

vSIG()	quit "60495^59303^Vanitha Krishnasamy^3455"	// Signature - LTD^TIME^USER^SIZE
