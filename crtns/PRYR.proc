PRYR		/*
	       ORIG:  Allan R. Mattson (6915) - 08/29/86
	  CALLED BY:
	      CALLS:  ^SCAIO,^UACN,^USID,^UTLERR,^UTLREAD
	   PROJ #'S:
	       DESC:

	       READ:
	        SET:

	      INPUT:
	     OUTPUT:

	  ---- Revision History ------------------------------------------------
	
	  09/15/05 - HAILEYM - CR17143
	  	     Updated to DBI Standards.
	  
	  09/03/02 - TELIV - 49451
	             Converted to PSL.
	 
	  ----------------------------------------------------------------------
	*/
	
	do UPD
	quit
	

public UPD 	//
	
	do INIT(1)
	quit


public INQ	//
	
	do INIT(2)
	quit


INIT(%ProcessMode) //
	
	type Number %PAGE,%PG,CID
	type String ACN(),IO,VFMQ
	
	type RecordDEP DEP

	set %PG=0 
	set %PAGE=1

	do VPG(.DEP)
	quit


VPG(RecordDEP DEP) // Page control

	type public Boolean ER
	type public Number %PG
	type public String VFMQ

	type Number FINISH

	set FINISH=0
	for  do { quit:FINISH
		if %PG=0 do VPG00 if ER set FINISH=1 quit
		if %PG>0 do VPG01(.DEP) 
		if "DFQ"[VFMQ do VER(.DEP) set FINISH=1 quit
		set %PG=%PG+1
		}
	quit


VPG00  	// Set up

	type public Boolean ER
	type public String VFMQ
	
	type String %NOPRMT,%READ,%TAB

	set %NOPRMT="N"
	set %TAB("CID")=".CID1/HLP=[DEP]CID/XPP=S %EXT=1 D ^UACN/XPR=S ZCLS=""D"""
	set %READ="@@%FN,,,CID/REQ"
	
	if %ProcessMode=2 set %TAB("IO")=$$IO^SCATAB($I) set %READ=%READ_",IO/REQ"
			
	do ^UTLREAD 
	
	if VFMQ="Q" set ER=1 quit
	quit


VPG01(RecordDEP DEP) // Screen

	type public Boolean ER
	type public Number CID
	type public String ACN(),IO,VFMQ

	set DEP=Db.getRecord("DEP","CID=:CID")
	if %ProcessMode=1 lock +ACN(CID):2 else  do Runtime.setErrSTBLER("DEP","RECLOC") quit
	if %ProcessMode=2,IO'=$I do OPEN^SCAIO if ER set VFMQ="Q" quit

	do DRV^USID(%ProcessMode,"PRYR",.DEP)
	
	quit


VER(RecordDEP DEP) //

	type public String VFMQ
	
	if %ProcessMode=2!(%ProcessMode=4)!(VFMQ="Q") do END quit
	do DEP.save()
	do END
	quit


END	//
	
	type public Boolean ER
	type public String VFMQ
	
	if ER!(%ProcessMode=2)!(%ProcessMode=4) quit

	// Account ~p1 not modified
	if VFMQ="Q" do Runtime.setErrMSG("DEP",135,"CID")

	// Account ~p1 modified
	else  do Runtime.setErrMSG("DEP",122,"CID")
	set ER="W"
	quit

vSIG()	quit "60197^36861^Marie Hailey^2046"	// Signature - LTD^TIME^USER^SIZE
