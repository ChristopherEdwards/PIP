DEPRCCX
	// Reg 'CC' Exception Inquiry
	/*
	       ORIG:  Wm. Greene (1674) - 06/17/87
	
	  ---- Revision History ------------------------------------------------
	
	  01/13/04 - Erik Scheetz - CR7798
		     Modified code to reference DAYENDRCCX2 table rather
		     than DAYENDRCCX (obsoleted).	  

	  01/12/04 - CARROLLJ - CR7901
		     Remove tostring method.

	  02/05/02 - MBUIM - 43583
		     Converted to PSL.
	
	*/

INQ	// Initialize standard variables
	
	set %ProcessMode=2
	set %PG=0 
	set %PAGE=1
	kill VFMQ
	do VPG 

	quit
	
VPG	// Page control

	type RecordDAYENDRCCX2 dayend()
	
	for  do {  quit:"DFQ"[VFMQ
		if %PG=0 do VPG00(.dayend())
		if %PG>0 do VPG01(.dayend())
		
		// Update page counters
		quit:"DFQ"[VFMQ
		set %PG=%PG+1
		}

	quit
			
VPG00(RecordDAYENDRCCX2 dayend())	// Set up

	new %TAB,N
	
	kill OLNTB
	
	set %TAB("XTJD")=".XJD1/TBL=[DAYENDRCCX2]TJD:DISTINCT"    
	set %TAB("BRCD")=".BRCD1/HLP=[DEP]BOO/TBL=[DAYENDRCCX2]BRCD:DISTINCT:QUERY ""[DAYENDRCCX2]TJD=<<XTJD>>"""
	set %TAB("UID")=".UID1/TBL=[DAYENDRCCX2]UID:DISTINCT:QUERY ""[DAYENDRCCX2]TJD=<<XTJD>> AND [DAYENDRCCX2]BRCD=<<BRCD>>"""
	set %TAB("TSEQ")=".SEQ2/TBL=[DAYENDRCCX2]TSEQ:DISTINCT:QUERY ""[DAYENDRCCX2]TJD=<<XTJD>> AND [DAYENDRCCX2]BRCD=<<BRCD>> AND [DAYENDRCCX2]UID=<<UID>>"""
	set %TAB("IO")=$$IO^SCATAB($I)
	if $G(BRCD)'="" set UID=$G(%UserID)
	
	set %READ="@@%FN,,,XTJD/REQ,BRCD/REQ,UID/REQ,TSEQ/REQ,,IO/REQ" 
	set %NOPRMT="N"
	do ^UTLREAD 
	if VFMQ="Q" set ER=1 quit 
	
	// Load data
	set CNT=0

	type DbSet ds
	set ds=Db.selectDbSet("DAYENDRCCX2","TJD=:XTJD AND BRCD=:BRCD AND UID=:UID AND TSEQ=:TSEQ")
	if ds.isEmpty() quit
	
	while ds.next() do {
		set CNT=CNT+1

		set dayend(CNT)=ds.getRecord()
		}	 
	set %PAGE=CNT\10 
	if CNT#10 set %PAGE=%PAGE+1

	quit 
		
VPG01(RecordDAYENDRCCX2 dayend())	// Input screen

	type String CHKTYP=""
	type Number TAMT=""
	
	type RecordTTX ttx=Db.getRecord("TTX","TJD=:XTJD,BRCD=:BRCD,UID=:UID,TSEQ=:TSEQ",1)
	if ttx.getMode()'=0 do {
		set TAMT=ttx.tamt
		if ttx.chktyp="" quit
		
		type RecordSTBLCHKTYP stbl=Db.getRecord("STBLCHKTYP","CHKTYP=:ttx.chktyp")
		set CHKTYP=stbl.desc
		}
		
	if IO'=$I do OPEN^SCAIO quit:ER
	set %REPEAT=10 
	set %MODS=%PG*%REPEAT-(%REPEAT-1)
	if %REPEAT+%MODS>CNT set %REPEAT=CNT-%MODS+1

	do DRV^USID(%ProcessMode,"REGCCX",.dayend())

	quit 
	
	
ERR	set ER=1 
	do ^UTLERR
	set VFMQ="Q"

	quit 
 #OPTION ResultClass ON
Public String vSIG()	quit "59886^43511^Sanchez SCM Administrator^2253"	// Signature - LTD^TIME^USER^SIZE
