SWIFTTFS ; Procedure SWIFTTFS - Extract TFS Messages
 ;;Copyright(c)2005 Sanchez Computer Associates, Inc.  All Rights Reserved - 08/09/05 10:36 - spatola
 ;
 ; **** This is a DATA-QWIK generated routine (level 25) ****
 ;
	/*  Revision History 

		07/11/00 - REEDD - 41058
			   Convert to PSL.
	
		05/08/00 - REEDD - 36443
			   The code for this procedure was not the correct 
			   code.  The correct code was added, so it can be 
			   officially released.
	*/
	
	set ER=0
	set IO="SCAU$TREAS_SWIFT:IXFSWIFT.INP"
	set X=$$FILE^%ZOPEN(IO,"NEWV")
	
	new DIRECT,RECMSG,ZMSG,ZSWDIRECT,ZTRREFNO,rs 

	type ResultSet rs=Db.select("RECMSG,TRREFNO,MSG,SWDIRECT","SWIFT","SWDIRECT='IN' AND STATUS=8 AND (SERIES=4 OR SERIES=7)")
	if rs.isEmpty() quit
	for  quit:'rs.next()  set data=rs.getRow()  do { quit:ER  
		set RECMSG=$P(data,$C(9),1)
		set ZTRREFNO=$P(data,$C(9),2)
		set ZMSG=$P(data,$C(9),3)
		set ZSWDIRECT=$P(data,$C(9),4)
		set RECMSG=$$TFSIN^SWIFTUTL(ZTRREFNO,ZMSG,RECMSG)
		use IO write RECMSG,!
		//UPDATE STATUS FIELD TO BE COMPLETED
		set DIRECT="IN"
		set ER=0 do Db.update("SWIFT","STATUS=3","SWDIRECT=:ZSWDIRECT AND TRREFNO=:ZTRREFNO AND MSG=:ZMSG")
		}
	close IO
	quit 

vSIG()	quit "59886^43615^Sanchez SCM Administrator^931"	// Signature - LTD^TIME^USER^SIZE
