public I18NV4XE //Create I18NV4X File from DBTBL
  /*
	ORIG: kumarb - 10/21/2005
	DESC: Create I18NV4X File from DBTBL
	CALLED BY:
            CALLS:
             DESC:	Creates I18NV4X global
			Reads through the file level of DBTBL
			If V4X set on file level, reads through field levels
			writes out key to I18NV4X if flags found
        
         GLOBALS -
             READ:	DBTBL
              SET:	I18NV4X
        
            INPUT:
           OUTPUT:
        
        EXT ENTRY:
        
        
        ---- Revision History --------------------------------------------
        
        10/21/05 - KUMARB - CR 16921
        	Converted to PSL.
        
        ------------------------------------------------------------------
        */

	do NEW

	quit
	
NEW 	// Newing and setting

	type Number cnt
	type String field,file,VFMQ

	set file=""
	set cnt=0
	set VFMQ=""

	do SCREEN

	quit

SCREEN // Utlread Screen
	
	type public String VFMQ
	
	type Number logical
	type String HDG1,HDG2,%READ,%TAB()

	set HDG1=$J(" ",29)_$$^MSG(5904)_$J(" ",29)
	set HDG2=$$^MSG(5905)
	set %TAB("logical")="/LEN=1/TYP=L/DES=Create I18NV4X entries ?"
	set %READ="@HDG1#1,,@HDG2,,,logical#1"
	do ^UTLREAD 
	if ("Q"[VFMQ)!(logical='1) do END quit

	do MAIN

	quit

MAIN	// Reading through ^DBTBL file level for V4X flag

	do Db.fastDelete("I18NV4X")

	type public Number cnt
	type public String field,file
	
	type ResultSet rs=Db.select("FID,VAL4EXT","DBTBL1","%LIBS='SYSDEV' AND VAL4EXT=1")
	while rs.next() do {
		set file=rs.getCol("FID")
		type RecordI18NV4X i18nv4x=Db.getRecord("I18NV4X","FID=:file",1)
		set i18nv4x.val4ext=1
		do i18nv4x.bypassSave()
		set cnt=cnt+1
		type ResultSet rs1=Db.select("DI,VAL4EXT","DBTBL1D","%LIBS='SYSDEV' AND FID=:file AND VAL4EXT=1")
		while rs1.next() do {
			set field=rs1.getCol("DI")
			type RecordI18NV4XD i18nv4xd=Db.getRecord("I18NV4XD","FID=:file,DI=:field",1)
			set i18nv4xd.val4ext=1
			do i18nv4xd.bypassSave()
			set cnt=cnt+1
			}
		}
	
	do END
	
	quit

END // Build return message and quit

	type public Number cnt
	type public String ER,RM

	// Number of I18NV4X Records Created ~p1
	set ER="W",RM=$$^MSG(5465,cnt)

	quit

vSIG()	quit "60233^81676^Balasubramonian Sankar^2021"	// Signature - LTD^TIME^USER^SIZE
