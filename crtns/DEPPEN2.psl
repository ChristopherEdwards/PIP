DEPPEN2(RecordDEP dep,RecordTTX ttx,RecordTRN trn)	//Decrease Prior Financial Year Penalty
	/*
	       ORIG:
	       DESC:

	  ---- Revision History ------------------------------------------------

           07/27/05 - SkariahV- CR16679
	              Removed #WARN and #OPTIMIZE directives.
	
	  
	   1/21/03 - Erik Scheetz - 51349
	    	     Made general changes for the following:
		      1. Cleaned up Parameter mismatches
		      2. Cleaned up code by using new PSL methods/properties.
		      3. Added #WARN/#OPTIMIZE compiler switches
	  
	    9/28/02 - Erik Scheetz - 43583
		      PSL conversion cleanup

	    6/05/02 - Erik Scheetz - 43583
		      Convert to PSL, moved from routine to DQ Procedure 
		      Definition.
		      Remove pre-2001 revision history
	
	*/

	
	type Public Number ER
	type Number TAMT
	
	set TAMT=ttx.tamt+0

	// Amount exceeds prior year penalty
	if dep.ppy-TAMT<0 do Runtime.setErrMSG("DEP",270) quit:ER
	if dep.ira do PYRPEN^IRA(.dep,.ttx) quit:ER

	do AUT(.dep)
	if ER quit

	do FILE(.dep,.ttx,.trn)
	quit

FILE(RecordDEP dep,RecordTTX ttx,RecordTRN trn)	// File Data

	type Public Number TAMT	
	
	// Transaction Amount
	set ttx.tamt=TAMT					
	set dep.bal=dep.bal+TAMT		
	set dep.tld=%SystemDate			
	set dep.balcol=dep.balcol+TAMT	
	set dep.ppl=dep.ppl-TAMT	
	set dep.ppy=dep.ppy-TAMT	

	// don't update pr.tax year
	if 'trn.pcfd35 set dep.penpty=dep.penpty-TAMT
	
	do ^UPDSTAT(.dep,.trn)
				
	quit

public EC(RecordDEP dep,RecordTTX ttx,RecordTRN trn)	// Error Correct

	type Public Number ER,TAMT
	
	if ttx.tso["REV#" do ^UPDCCLD(.dep,.ttx)

	set TAMT=ttx.tamt+0
	if dep.ira do PYRPEN^IRA(.dep,.ttx) quit:ER

	do FILE(.dep,.ttx,.trn) quit

AUT(RecordDEP dep)	// Authorization Verification

	type Public Number CID,OVR(,,)
		
	if dep.rflg do ^UFLG(.dep)	
	if dep.stat set OVR(CID,"OVR","STAT"_dep.stat)=""

	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "60108^20734^Viji Skariah^1687"	// Signature - LTD^TIME^USER^SIZE
