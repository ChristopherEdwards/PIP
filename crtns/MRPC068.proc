MRPC068(String return,Number versn,String msg)	//Public;MRPC call to process CMS ISO8583 messages.
	/*
	   ORIG: BAILDONC - 02/04/98
	   DESC: MRPC call to process CMS ISO8583 messages.

	   KEYWORDS:

	   ARGUMENTS:
	   . return 	Value passed to  	/TYP=T/REQ/MECH=VAL
	     		Non-PROFILE system
	     		OM - Out-going Message

	   . versn  	^MRPC068 Version Number /TYP=T/REQ/MECH=VAL
	     		Current version=1

	   . msg  	Incoming Message from  	/TYP=T/REQ/MECH=VAL
	     		Non-PROFILE system

	   EXAMPLE:
	   	S X=$$^MRPC068(.return,1,msg)

	------- Revision History -----------------------------------------------
      
        07/26/05 - SkariahV- CR16679
	           Removed #WARN directive.
		
	01/10/03 - GRAY - 51351
		   Converted to PSL.
	
	12/04/98 - Carrie Baildon - 30540
		   Modified the MRPCMSG to set the SEQ at the date level.

	*/
	
	type Public Number ER
	type Public String ET,RM

	catch vERROR {
		set ET=vERROR.type
		if ET["%GTM" do ZE^UTLERR
		}

	// Version number of client message is not compatible with server
	if versn.get()'=1 quit $$ERRMSG^PBSUTL($$^MSG(2951))

	type Number SEQ
	type Public String MRPCMSG()
	
	set SEQ=""

	lock +MRPCMSG(68):2 else  set ER=1 set ET="RECLOC" quit $$ERRMSG^PBSUTL(RM.get(),ET.get())

	type ResultSet rs=Db.select("SEQ","MRPCMSG","MRPCNO=68 AND TJD=:%SystemDate","SEQ DESC")

	if rs.next() set SEQ=rs.getCol(1)
	set SEQ=SEQ+1

	type RecordMRPCMSG msgi=Class.new("RecordMRPCMSG")
	set msgi.mrpcno=68
	set msgi.tjd=%SystemDate
	set msgi.seq=SEQ
	set msgi.outflg=0
	set msgi.msg=msg
	do msgi.save()

	lock -MRPCMSG(68)

	do {
		type Date TJD
		type Number SEQ
		set return=$$^CMS8583(msg)
		}

	type RecordMRPCMSG msgo=Class.new("RecordMRPCMSG")
	set msgo.mrpcno=68
	set msgo.tjd=%SystemDate
	set msgo.seq=SEQ
	set msgo.outflg=1
	set msgo.msg=return
	do msgo.save()

	quit ""

vSIG()	quit "60107^17756^Viji Skariah^1661"	// Signature - LTD^TIME^USER^SIZE
