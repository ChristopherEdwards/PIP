CRCDMR	//Currency Code Mid-Rate Maintenance
	/*
	       ORIG:  Programmer Name (I.D.) - MM/DD/YY     



	  ---- Revision History -------------------------------------------------
	  
	  05/21/07 - CHAITHRA - CR 27128
	  	     Modified VPG01 section to remove the setting of 
	  	     %ProcessMode to 0 before calling the screen.
	  	     
	  	     
	  09/04/02 - SRIVASTAVAN - 49451
                     Converted to PSL
                    
          -----------------------------------------------------------------------
	*/
	
UPD 	//

	do INIT(1)

	quit


INQ 	//

	do INIT(2)

	quit


DEL	//

	do INIT(3)

	quit


INIT(%ProcessMode)	//

	new OLNTB,VFMQ

	type RecordCRCD fCRCD

	#if 'CUVAR.%mcp
	do { quit
		set ER=1 
		set ET="MCPNE"

		do ^UTLERR
		}
	#endif

	set CO=%CompanyName
	set %PG=0 
	set %PAGE=1
	
	do VPG00(.fCRCD)

	quit
	

VPG00(RecordCRCD fCRCD)	// Set up

	set %TAB("CO")=".CO2/HLP=[CRCD]CO/TBL=[CRCD]CO:DISTINCT"

	//check for CRCD VALUES
	set %TAB("CRCD")=".CRCD1/HLP=[CRCD]CRCD/TBL=[CRCD]:QU ""[CRCD]CO=<<CO>>""/XPP=D EURCHK^CRCDMR"
	set %READ="@@%FN,,,CO/REQ,CRCD/REQ"
	
	do ^UTLREAD 
	
	if VFMQ="Q" set ER=1 quit
	
	do VPG01(.fCRCD)

	quit	
	

VPG01(RecordCRCD fCRCD)	// Input screen

	set fCRCD=Db.getRecord("CRCD","CO=:CO,CRCD=:CRCD")
	
	set (DSP1,DSP2)="" 
	
	set %PG=1
	
	do DRV^USID(%ProcessMode,"CRCDMR",.fCRCD)	

	do VER(.fCRCD) 
	
	quit


VER(RecordCRCD fCRCD)	//

	if %ProcessMode=2!(%ProcessMode=4) quit 
	if VFMQ="Q" do END quit

	do FILE(.fCRCD)

	quit


FILE(RecordCRCD fCRCD)	// File data

	new %EffectiveDate
	set %EffectiveDate=%SystemDate
	if %ProcessMode=3 do {
		set fCRCD.midrate=""
		set fCRCD.spotbid=""
		set fCRCD.spotoffer=""
		set fCRCD.otcbid=""
		set fCRCD.otcoffer=""
		set fCRCD.offbid=""
		set fCRCD.offoffer=""
		set fCRCD.finspot=""
		set fCRCD.avespotaccum=""
		set fCRCD.terms=""
		set fCRCD.dlm=""
		set fCRCD.tlm=""
		}
	do fCRCD.save()
	
	do END

	quit


END	//
	
	if VFMQ="Q" do {
	
		// Currency code ~p1 rates not created
		if %ProcessMode=0 set RM=$$^MSG(665,CRCD) quit

		// Currency code ~p1 rates not modified
		if %ProcessMode=1 set RM=$$^MSG(667,CRCD) quit

		// Currency code ~p1 rates not deleted
		set RM=$$^MSG(666,CRCD)
		}
	else  do {

		// Currency code ~p1 rates created
		if %ProcessMode=0 set RM=$$^MSG(662,CRCD) quit

		// Currency code ~p1 rates modified
		if %ProcessMode=1 set RM=$$^MSG(664,CRCD) quit

		// Currency code ~p1 rates deleted
		set RM=$$^MSG(663,CRCD)
		}
	set ER="W"
	quit

	
DSPRT(X,M)	// Display Rates post processor

	if 'X quit ""

	quit "100.00 "_%SystemCurrency_" = "_$$FN^SCARND($S(M:100*X,1:100/X),",","",CRCD)_" "_CRCD
	

EURCHK	// Currency Code Post Processor

	// Invalid function for IN currency
	type RecordCRCD crcd=Db.getRecord("CRCD","CO=:CO,CRCD=:X",1)
	if crcd.getMode()=0 set ER=1,RM=$$^MSG(1293) quit            
	if crcd.emu=1 do {
		set ER=1 
		set RM=$$^MSG(3230)
		}
	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "60771^36848^Chaithra Bokkasa Shankar^2682"	// Signature - LTD^TIME^USER^SIZE
