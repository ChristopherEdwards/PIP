public LNPTS4A(RecordLN ln,RecordTTX ttx,RecordTRN trn)

	/*

	  CREDIT LIMIT AUTHORIZATION

	       ORIG:
	  CALLED BY:  A^LNTR
	      CALLS:  ^LNICM,^LNPTSU,^UFRE
	   PROJ #'S:
	       DESC:  Update undisbursed balance.  This will always be used
	              in conjunction with  LNPTS7A, hence no need to update
	              BALCOL or BALINT.
	
	   GLOBALS -  ^ACN
	       READ:
	        SET:
	
	      INPUT:
	     OUTPUT:
	
	---- Revision History ------------------------------------------------

	10/04/05 - KELLYP - CR 17399
		   Modified to use 1st bit of trn.itc instead of trn.itc in 
		   the TRB check to prevent an issue from occuring where UDBAL
		   was being set incorrectly.  It was being set to the
		   negative value of ZAMT because 1-10001 will evaluate as
		   true in the first part of the $S.  Also modified entire
		   procedure to comply with current PSL standards and removed
		   pre-2003 revision history.

	04/09/03 - CARROLLJ - 51349
		   Added trn object as parameter to linetage LNPTS4A and
		   removed getRecord of TRN.

	----------------------------------------------------------------------
	
	*/

	type public Boolean ER
	type public Number ZAMT

	type Number TRB,UDBAL,X
	type String TSO

	// Account not coded for undisbursed processing
	if 'ln.aruf do Runtime.setErrMSG("LN","79") quit:ER
		
	set TSO=ttx.tso
	set TSO=$$FIELDIN^UTSO(TSO,"ADJAVCR",1)
	set TSO=$$FIELDIN^UTSO(TSO,"REAPPLY",1)
	set ttx.tso=TSO
	
	set TRB=ln.trb
	set X=$S(TRB-trn.itc.extract(1):-ZAMT,1:ZAMT)
	set UDBAL=ln.udbal+X
	
	do GL^LNPTSU(.ttx,ZAMT,5)
	
	do %HSEQ^LNPTSU(.ttx,"*#U#"_ZAMT)
	
	set ZAMT=0

	set ln.udbal=UDBAL

	quit 

vSIG()	quit "60178^46118^Pat Kelly^1526"	// Signature - LTD^TIME^USER^SIZE
