AGNTCRCD	  /*
ORIG: ARPAV - 10/17/2000
DESC: Agent Currency Code Conversion Utility

      This procedure will be used to define a list of data items to be
      converted when the agent currency code is modified.  The following all
      need to be converted:

	AGENT.COMYTD
	AGENT.COMPPY
	AGENT.COMPL

	AGENTCOM.COMPYTD
	AGENTCOM.COMPLY
	AGENTCOM.GRTHBAL

	AGENTPFT.HBAL
	AGENTPFT.MEBALLM
	AGENTPFT.MEBALPM
	AGENTPFT.QEBALLQ
	AGENTPFT.QEBALPQ
	AGENTPFT.YEBALLY
	AGENTPFT.YEBALPY
	AGENTPFT.AVBLM
	AGENTPFT.AVBPM
	AGENTPFT.AVBLQ
	AGENTPFT.AVBPQ
	AGENTPFT.AVBLY
	AGENTPFT.AVBPY
	AGENTPFT.HQBAL
	AGENTPFT.HMBALLM
	AGENTPFT.HQBALLQ

---- Comments --------------------------------------------------------


---- Revision History ------------------------------------------------

	10/19/00 - ARPAV - 42321
		Created

  */

	quit

  //----------------------------------------------------------------------
PROC(AGENT,BCRCD,CRCD)   // Convert all balances in each table
  //----------------------------------------------------------------------
  /*

	Description:

	        This procedure will be called from the agent filer when
		when the currency code is modified.  This will loop through
		all balances associated with the agent and convert them to
		the new currency.

	Arguments:
		. AGENT	  Agent Number		/TYP=N/REQ/MECH=VAL

		. BCRCD   Base Currency Code	/TYP=T/REQ/MECH=VAL
		
		. CRCD	  Currency Code		/TYP=T/REQ/MECH=VAL

	Returns:

	Example:
		D PROC^AGNTCRCD(1001,"NLG","EUR")

  -------------------------------------------------------------------------*/

  	new CPLAN,PFT,agent,CCODE,ACN

  	// Convert all items on the agent table

	type RecordAGENT agent
	set agent=Db.getRecord("AGENT","AGENT")
	set ACN=agent.cif
	set CCODE=Db.getOneRow("ccode","CIF","ACN")

	set agent.comytd=$$CONVERT(agent.comytd,BCRCD,CRCD,CCODE)
	set agent.comppy=$$CONVERT(agent.comppy,BCRCD,CRCD,CCODE)
	set agent.compl=$$CONVERT(agent.compl,BCRCD,CRCD,CCODE)

	do agent.bypassSave()

	// Loop through all agent commission plans and convert table agentcom

	set CPLAN=""
	for  set CPLAN=Db.nextKey("AGENTCOM","AGENT,CPLAN") quit:CPLAN=""  do {
		new agentcom
		type RecordAGENTCOM agentcom
		set agentcom=Db.getRecord("AGENTCOM","AGENT,CPLAN")
		
		set agentcom.compytd=$$CONVERT(agentcom.compytd,BCRCD,CRCD,CCODE)
        	set agentcom.comply=$$CONVERT(agentcom.comply,BCRCD,CRCD,CCODE)
        	set agentcom.grthbal=$$CONVERT(agentcom.grthbal,BCRCD,CRCD,CCODE)
	
		do agentcom.bypassSave()
		}

	// Loop through all agent portfolios and convert table agentpft

	set PFT=""
	for  set PFT=Db.nextKey("AGENTPFT","AGENT,PFT") quit:PFT=""  do {
		new agentpft
		type RecordAGENTPFT agentpft
		set agentpft=Db.getRecord("AGENTPFT","AGENT,PFT")

		
		set agentpft.hbal=$$CONVERT(agentpft.hbal,BCRCD,CRCD,CCODE)
		set agentpft.meballm=$$CONVERT(agentpft.meballm,BCRCD,CRCD,CCODE)
		set agentpft.mebalpm=$$CONVERT(agentpft.mebalpm,BCRCD,CRCD,CCODE)
		set agentpft.qeballq=$$CONVERT(agentpft.qeballq,BCRCD,CRCD,CCODE)
		set agentpft.qebalpq=$$CONVERT(agentpft.qebalpq,BCRCD,CRCD,CCODE)
		set agentpft.yebally=$$CONVERT(agentpft.yebally,BCRCD,CRCD,CCODE)
		set agentpft.yebalpy=$$CONVERT(agentpft.yebalpy,BCRCD,CRCD,CCODE)
		set agentpft.avblm=$$CONVERT(agentpft.avblm,BCRCD,CRCD,CCODE)
		set agentpft.avbpm=$$CONVERT(agentpft.avbpm,BCRCD,CRCD,CCODE)
		set agentpft.avblq=$$CONVERT(agentpft.avblq,BCRCD,CRCD,CCODE)
		set agentpft.avbpq=$$CONVERT(agentpft.avbpq,BCRCD,CRCD,CCODE)
		set agentpft.avbly=$$CONVERT(agentpft.avbly,BCRCD,CRCD,CCODE)
		set agentpft.avbpy=$$CONVERT(agentpft.avbpy,BCRCD,CRCD,CCODE)
		set agentpft.hqbal=$$CONVERT(agentpft.hqbal,BCRCD,CRCD,CCODE)
		set agentpft.hmballm=$$CONVERT(agentpft.hmballm,BCRCD,CRCD,CCODE)
		set agentpft.hqballq=$$CONVERT(agentpft.hqballq,BCRCD,CRCD,CCODE)

		do agentpft.bypassSave()

		}

	quit

  //----------------------------------------------------------------------
CONVERT(AMT,BCRCD,CRCD,CCODE)   // Convert amount from base to currency and round
  //----------------------------------------------------------------------
  /*

	Description:

	Arguments:
		. AMT	  Amount		/TYP=N/REQ/MECH=VAL

		. BCRCD   Base Currency Code	/TYP=T/REQ/MECH=VAL
		
		. CRCD	  Currency Code		/TYP=T/REQ/MECH=VAL

		. CCODE   Customer Code		/TYP=N/REQ/MECH=VAL

	Returns:

		. Rounded converted amount

	Example:
		set newamt=CONVERT^AGNTCRCD("1000.00","NLG","EUR")

  -------------------------------------------------------------------------*/

	new EXCAMT,NEWAMT

	if (AMT=0)!(AMT="") quit AMT

	do EXC^CRCDUTL(BCRCD,CRCD,AMT,1,1,11,CCODE)
        set NEWAMT=$$^SCARND(EXCAMT,0,,CRCD)
	quit NEWAMT
	
 #OPTION ResultClass ON
Public String vSIG()	quit "59886^43488^Sanchez SCM Administrator^4441"	// Signature - LTD^TIME^USER^SIZE
