DEPNOT(RecordDEP dep)	//;Notice Account Processing
	/*
	  Copyright(c)1998 Sanchez Computer Associates, Inc.  All Rights Reserved
	  ORIG:  Allan R. Mattson (6915) - 09/14/87
	
	  ---- Revision History -------------------------------------------------

	   12/05/03 - CARROLLJ - CR7239
		      Added #ACCEPT prior to dynamic SQL statement in HIST
		      section.

	   09/23/02 - Erik Scheetz - 43583
		      PSL conversion cleanup.

	   06/05/01 - Erik Scheetz - 43583
		      Translated routine into PSL format.  Moved from routine
		      to DQ Procedure Definition.
		      Remove pre-2001 revision history.	
	
	*/
	new X,Y

	set NOTICE=0
	set XJD=%EffectiveDate
	set:XJD="" XJD=%SystemDate
	if dep.notice=2 do NOT90(.dep)
	if NOTICE quit
	set X=dep.notdat
	if $L(dep.notnbc) do NBC(.dep) quit
	if 'X quit
	
	// Notice not effective
	set X=X+dep.notmin
	// Notice period exceeded
	set Y=X+dep.notmax-1
	if XJD<X!(Y<XJD) quit

	do DEP(.dep)
	quit
	
		
public DEP(RecordDEP dep)
	/*
	   Additional qualifying deposits negate notice of withdrawal
	   Not applicable to 90 Day Notice Accounts

	Notice Account Flag
		0)=No Notice Processing
		1)=Standard Notice Processing
		2)=90 Day Notice Account Processing
	*/
	if dep.notice=2 set NOTICE=1 quit      
	
	new VSQL
	do HIST(dep.notdat)
	quit
	

public HIST(NOTDAT)

	new X 
	#ACCEPT DATE=12/02/03;PGM=Erik Scheetz
	type DbSet rs=Db.selectDbSet("HIST","ITC is not null",DESC)
	while rs.next() do { quit:VSQL=0
		type RecordHIST hist=rs.getRecord("HIST")	
		if hist.tjd<NOTDAT do { quit
			set NOTICE=1
			set VSQL=0
			}
		if ($E(hist.itc,7)) quit 
		set X=hist.tamt
		set:X["#" X=+$P(X,"#",2)
		if 'X quit 
		if hist.efd,hist.efd<NOTDAT quit
		if hist.tso="INT" quit 
		set VSQL=0
		}

	quit 
	

NOT90(RecordDEP dep)	// private 90 Day Notice Account grace period (notice not required)
	/*
	   EFD-INT LAST POST ; WITHIN GRACE PERIOD AFTER INT EARNED
	   INT NEXT POSTED - EFD ; WITHIN GRACE PERIOD PRIOR TO INT POSTED
	*/

	if dep.ipld,XJD-dep.ipld<11,XJD-dep.ipld>0 set NOTICE=1 quit
	if dep.inp,dep.inp-XJD<4,dep.inp-XJD>0 set NOTICE=1 quit 
	quit 
	

NBC(RecordDEP dep) // private - non-business date calendar to be used

	// Notice Days Non-Business Date Calendar
	set NBD=$$NBD^UNBD(X,dep.notmin,0,dep.notnbc)  
	if XJD<NBD quit 
	// Notice Days Non-Business Date Calendar
	set NBD=$$NBD^UNBD(NBD,dep.notmax,0,dep.notnbc)        
	if XJD>NBD quit 
	set NOTICE=1
	quit 
 #OPTION ResultClass ON
Public String vSIG()	quit "59886^43510^Sanchez SCM Administrator^2275"	// Signature - LTD^TIME^USER^SIZE
