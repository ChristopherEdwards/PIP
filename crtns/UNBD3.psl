UNBD3	// Copy Non-Business Date Calendar
	/*
	       ORIG:  SOMPALLI - 15 MAR 1991

	---- Revision History ------------------------------------------------
	11/14/05 - Alagarss - CR 16677
		   Modified the FILE section to avoid undefined errors.
		   Also Modified the section END to display proper messages.
		   
        07/26/05 - SkariahV- CR16679
	          Removed #WARN and #OPTIMIZE directives.
	              
	05/22/03 - GRAY - 51351
		   Converted to PSL.

	*/
	
	type Number %PAGE,%PG
	type Number FINISH=0
	type String OLNTB,VFMQ

	set %PG=1 set %PAGE=1 
	set %ProcessMode=0

	// Page control
 
	 for  do { quit:FINISH
		if %PG>0 do VPG01
		if "DFQ"[VFMQ do VER set FINISH=1 quit
		set %PG=%PG+1
		}

	quit


VPG01	// Set up
	
	type String %READ,%TAB
	type Public String VFMQ

	set %TAB("NBDC")=".NBDC2/HLP=[UTBLNBD]NBDC/TBL=[UTBLNBD]"
	set %TAB("NBDC2")=".NBDC21/HLP=[UTBLNBD]NBDC/XPP=D POS^UNBD1"
	set %TAB("CALDES")=".DESC2/HLP=[UTBLNBD]CALDES"

	set %READ="@@%FN,,,NBDC/REQ,NBDC2/REQ,CALDES/REQ"

	do ^UTLREAD if VFMQ="Q" quit

	quit


VER	//
	
	type String TMP1
	type Public String NBDC,VFMQ

	set TMP1=NBDC.get()
	
	if VFMQ="Q" do END quit

	do FILE

	do END

	quit


FILE	// File data

	type Date DATE
	type Public String CALDES,NBDC,NBDC2
	
	type RecordUTBLNBD nbdc=Db.getRecord("UTBLNBD","NBDC=:NBDC",1)

	type RecordUTBLNBD nbdc2
	set nbdc2=nbdc.copy()
	if nbdc2.getMode() do nbdc2.setMode(0)
	set nbdc2.nbdc=NBDC2
	set nbdc2.caldes=CALDES
	do nbdc2.save()
	
	type ResultSet rs=Db.select("NBD","UTBLNBD1","NBDC=:NBDC")
	while rs.next() do {
		type RecordUTBLNBD1 nbdd2
		set DATE=rs.getCol(1)
		type RecordUTBLNBD1 nbdd=Db.getRecord("UTBLNBD1","NBDC=:NBDC,NBD=:DATE")
		set nbdd2=nbdd.copy()
		if nbdd2.getMode() do nbdd2.setMode(0)
		set nbdd2.nbdc=NBDC2
		do nbdd2.bypassSave()
		}

	quit


END	//

	type Public Number ER
	type Public String NBDC2,RM,TMP1,VFMQ

	quit:ER.get()
	
	// Calendar ~p1 not copied to ~p2
	if VFMQ="Q" set RM=$$^MSG(406,TMP1,NBDC2.get())

	// Calendar ~p1 copied to ~p2
	else  set RM=$$^MSG(404,TMP1,NBDC2)

	set ER="W"

	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "60232^33886^Sanjay Chhrabria^1926"	// Signature - LTD^TIME^USER^SIZE
