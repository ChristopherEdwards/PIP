LPRA ; Procedure LPRA - Loan Payment Rounding Procedure
 ;;Copyright(c)2005 Sanchez Computer Associates, Inc.  All Rights Reserved - 08/09/05 10:34 - spatola
 ;
 ; **** This is a DATA-QWIK generated routine (level 25) ****
 ;


	
	/*
	 ORIG: YENDAPALLIS July 15, 1999
	 DESC: Loan Payment Round Up 	
	
	
	 ---- Revision History ------------------------------------------------
	
	06/30/00 - YENDAPALLIS - 39552
		   Modified code in DEPAMT,LPPO and TOTDUE sections to set 
		   TDUE to 0 if total due amount is less than 0.  
		   
	03/30/00 - Yendapallis - 37772	
		   Modified code in DEPAMT and LPPO to return the 	
		   shared deposit amount and loan principal only paymentamount.	

	07/15/99 - YENDAPALLIS - 33546 
	            Created the routine to return Deposit amount,Loan principle
		    only payment amount, savings account from LNSA and 
		    Loan Payment due amount.    
	 
	----------------------------------------------------------------------
	*/
	 
	quit

	 //--------------------------------------------------------------------
DEPAMT() // Returns deposit Amount
	//--------------------------------------------------------------------
	new CID,PMTRDFAC,RAMT,AAMT,PRFAMT,DPAMT,SAVAMT,TDUAMT,TDUE,TAMT,CDEPAMT
	new REM,LNSACID,LNCRCD,LNSACRCD
	set CID=FCID
	set TAMT=$$FIELD^UTSO($P(TR(1),"|",7),"VAMT")
	set LNSACID=$$LNSA
        if LNSACID="" quit 0
	set INFO=Db.getOneRow("TDUE,PMTRDFAC,CDEPAMT,CRCD","LN","CID")
	set TDUE=$P(INFO,$C(9),1)
	if TDUE<0 set TDUE=0
	set PMTRDFAC=$P(INFO,$C(9),2)
	if '$G(PMTRDFAC) quit ""
	set CDEPAMT=$P(INFO,$C(9),3)
	if '$G(CDEPAMT) quit ""
	set LNCRCD=$P(INFO,$C(9),4)
	set LNSACRCD=Db.getOneRow("CRCD","ACN","LNSACID")
	if LNSACID'="",LNCRCD'=LNSACRCD set ER=1,RM=$$^MSG(3972) quit 0
	if TAMT'>TDUE quit 0
	set TDUAMT=(TDUE+CDEPAMT)
	if PMTRDFAC>0 set RAMT=(TDUAMT#PMTRDFAC)
	set AAMT=(PMTRDFAC-RAMT)                //Amount to be added to total due
	set PRFAMT=(TDUAMT+AAMT)
	set DPAMT=(PRFAMT-TDUE)                 //Deposit Amount  
	quit DPAMT
	//---------------------------------------------------------------------
LPPO()  // Returns Loan Principle only payment Amount
	//---------------------------------------------------------------------
	new CID,TAMT,TDUE,TDUAMT,LPP,DPAMT,PRFAMT,AAMT,RAMT,PMTRDFAC,CDEPAMT
	new REM,INFO
	set CID=FCID 
	set TAMT=$$FIELD^UTSO($P(TR(1),"|",7),"VAMT")     
	set INFO=Db.getOneRow("TDUE,PMTRDFAC,CDEPAMT","LN","CID")
	set TDUE=$P(INFO,$C(9),1)
	if TDUE<0 set TDUE=0	
	set PMTRDFAC=$P(INFO,$C(9),2)
	if '$G(PMTRDFAC) quit ""
	set CDEPAMT=$P(INFO,$C(9),3)
	if '$G(CDEPAMT) quit ""
	if TAMT'>TDUE quit 0
	set TDUAMT=(TDUE+CDEPAMT)
	if PMTRDFAC>0 set RAMT=(TDUAMT#PMTRDFAC)
	set AAMT=PMTRDFAC-RAMT
	set PRFAMT=(TDUAMT+AAMT)
	set LPP=TAMT-PRFAMT               //Loan Principle only payment
	quit LPP
TOTDUE() //---------------------------------------------------------------------	
	 //Returns TDUE amount
	 //---------------------------------------------------------------------
	new INFO,CID
	set CID=FCID
	set INFO=Db.getOneRow("TDUE","LN","CID")
	if INFO<0 set INFO=0
	quit INFO
LNSA()  //---------------------------------------------------------------------
	//Returns Savings account from data item LNSA       	
	//---------------------------------------------------------------------
	new INFO,CID
        set CID=FCID
	set INFO=Db.getOneRow("LNSA","LN","CID")
	if '$G(INFO) quit ""
	quit INFO
	//------------------------------------------------------------	

vSIG()	quit "59886^43575^Sanchez SCM Administrator^3141"	// Signature - LTD^TIME^USER^SIZE
