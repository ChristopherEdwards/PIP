public	DEPNSF(RecordDEP dep)

	/*
	UPDATE NSF, NEG BAL, AND RET ITEM COUNTERS

	ORIG:	PETER M. CHENARD
	DESC:	Updates counters for NSF, negative balance, and returned
		items.

	----- Revision History -----------------------------------------------
	
	06/07/06 - PUTTASWH - CR 21285		   
		   Deleted the conditional check on the deposit account 
		   balance before invoking NSF and NEGBAL sections in the
		   main section.
		   
	02/01/06 - SmithCD - CR 19343 (16890)
		   Made top public.

	11/18/05 - HAILEYM - CR18146
		   Updated to DBI Standards.
	

	06/13/02 - ZWITKOWITSM - 43583
		   Converted to PSL.

	----------------------------------------------------------------------
	*/

	type Number DEPNSF(,),EXP,RODT

	do INIT(.EXP,.RODT)

	if dep.grp'="DBD",dep.grp'="WASH" do NSF(.dep,.DEPNSF) do NEGBAL(.dep,.DEPNSF)

	quit 


NEGBAL(RecordDEP dep,		// DEP Record
	Number DEPNSF(,))	// DEPNSF Array

	// Update NEG BAL counters
	
	type Number IMTH,OMTH

	if %EffectiveDate set IMTH=$$DAT^%ZM(%EffectiveDate,"MM")+12
	else  set IMTH=$$DAT^%ZM(%SystemDate,"MM")+12

	set OMTH=IMTH+24

	if dep.odld'=%SystemDate do {

		if OMTH=37 set dep.nego13=dep.nego13+1 set DEPNSF("NEGBAL",OMTH)=dep.nego13 quit
		if OMTH=38 set dep.nego14=dep.nego14+1 set DEPNSF("NEGBAL",OMTH)=dep.nego14 quit
		if OMTH=39 set dep.nego15=dep.nego15+1 set DEPNSF("NEGBAL",OMTH)=dep.nego15 quit
		if OMTH=40 set dep.nego16=dep.nego16+1 set DEPNSF("NEGBAL",OMTH)=dep.nego16 quit
		if OMTH=41 set dep.nego17=dep.nego17+1 set DEPNSF("NEGBAL",OMTH)=dep.nego17 quit
		if OMTH=42 set dep.nego18=dep.nego18+1 set DEPNSF("NEGBAL",OMTH)=dep.nego18 quit
		if OMTH=43 set dep.nego19=dep.nego19+1 set DEPNSF("NEGBAL",OMTH)=dep.nego19 quit
		if OMTH=44 set dep.nego20=dep.nego20+1 set DEPNSF("NEGBAL",OMTH)=dep.nego20 quit
		if OMTH=45 set dep.nego21=dep.nego21+1 set DEPNSF("NEGBAL",OMTH)=dep.nego21 quit
		if OMTH=46 set dep.nego22=dep.nego22+1 set DEPNSF("NEGBAL",OMTH)=dep.nego22 quit
		if OMTH=47 set dep.nego23=dep.nego23+1 set DEPNSF("NEGBAL",OMTH)=dep.nego23 quit
		if OMTH=48 set dep.nego24=dep.nego24+1 set DEPNSF("NEGBAL",OMTH)=dep.nego24 quit
		}

	set dep.odld=%SystemDate

	if IMTH=13 set dep.negi13=dep.negi13+1 set DEPNSF("NEGBAL",IMTH)=dep.negi13 quit
	if IMTH=14 set dep.negi14=dep.negi14+1 set DEPNSF("NEGBAL",IMTH)=dep.negi14 quit
	if IMTH=15 set dep.negi15=dep.negi15+1 set DEPNSF("NEGBAL",IMTH)=dep.negi15 quit
	if IMTH=16 set dep.negi16=dep.negi16+1 set DEPNSF("NEGBAL",IMTH)=dep.negi16 quit
	if IMTH=17 set dep.negi17=dep.negi17+1 set DEPNSF("NEGBAL",IMTH)=dep.negi17 quit
	if IMTH=18 set dep.negi18=dep.negi18+1 set DEPNSF("NEGBAL",IMTH)=dep.negi18 quit
	if IMTH=19 set dep.negi19=dep.negi19+1 set DEPNSF("NEGBAL",IMTH)=dep.negi19 quit
	if IMTH=20 set dep.negi20=dep.negi20+1 set DEPNSF("NEGBAL",IMTH)=dep.negi20 quit
	if IMTH=21 set dep.negi21=dep.negi21+1 set DEPNSF("NEGBAL",IMTH)=dep.negi21 quit
	if IMTH=22 set dep.negi22=dep.negi22+1 set DEPNSF("NEGBAL",IMTH)=dep.negi22 quit
	if IMTH=23 set dep.negi23=dep.negi23+1 set DEPNSF("NEGBAL",IMTH)=dep.negi23 quit
	if IMTH=24 set dep.negi24=dep.negi24+1 set DEPNSF("NEGBAL",IMTH)=dep.negi24 quit

	quit 


NSF(RecordDEP dep,		// DEP Record
	Number DEPNSF(,))	// DEPNSF Array

	// Update NSF counters
	
	type Number IMTH,OMTH

	if %EffectiveDate set IMTH=$$DAT^%ZM(%EffectiveDate,"MM")+12
	else  set IMTH=$$DAT^%ZM(%SystemDate,"MM")+12

	set OMTH=IMTH+24

	if dep.nsfold'=%SystemDate do {

		if OMTH=37 set dep.nsfo13=dep.nsfo13+1 set DEPNSF("NSF",OMTH)=dep.nsfo13 quit
		if OMTH=38 set dep.nsfo14=dep.nsfo14+1 set DEPNSF("NSF",OMTH)=dep.nsfo14 quit
		if OMTH=39 set dep.nsfo15=dep.nsfo15+1 set DEPNSF("NSF",OMTH)=dep.nsfo15 quit
		if OMTH=40 set dep.nsfo16=dep.nsfo16+1 set DEPNSF("NSF",OMTH)=dep.nsfo16 quit
		if OMTH=41 set dep.nsfo17=dep.nsfo17+1 set DEPNSF("NSF",OMTH)=dep.nsfo17 quit
		if OMTH=42 set dep.nsfo18=dep.nsfo18+1 set DEPNSF("NSF",OMTH)=dep.nsfo18 quit
		if OMTH=43 set dep.nsfo19=dep.nsfo19+1 set DEPNSF("NSF",OMTH)=dep.nsfo19 quit
		if OMTH=44 set dep.nsfo20=dep.nsfo20+1 set DEPNSF("NSF",OMTH)=dep.nsfo20 quit
		if OMTH=45 set dep.nsfo21=dep.nsfo21+1 set DEPNSF("NSF",OMTH)=dep.nsfo21 quit
		if OMTH=46 set dep.nsfo22=dep.nsfo22+1 set DEPNSF("NSF",OMTH)=dep.nsfo22 quit
		if OMTH=47 set dep.nsfo23=dep.nsfo23+1 set DEPNSF("NSF",OMTH)=dep.nsfo23 quit
		if OMTH=48 set dep.nsfo24=dep.nsfo24+1 set DEPNSF("NSF",OMTH)=dep.nsfo24 quit
		}

	set dep.nsfold=%SystemDate

	if IMTH=13 set dep.nsfi13=dep.nsfi13+1 set DEPNSF("NSF",IMTH)=dep.nsfi13 quit
	if IMTH=14 set dep.nsfi14=dep.nsfi14+1 set DEPNSF("NSF",IMTH)=dep.nsfi14 quit
	if IMTH=15 set dep.nsfi15=dep.nsfi15+1 set DEPNSF("NSF",IMTH)=dep.nsfi15 quit
	if IMTH=16 set dep.nsfi16=dep.nsfi16+1 set DEPNSF("NSF",IMTH)=dep.nsfi16 quit
	if IMTH=17 set dep.nsfi17=dep.nsfi17+1 set DEPNSF("NSF",IMTH)=dep.nsfi17 quit
	if IMTH=18 set dep.nsfi18=dep.nsfi18+1 set DEPNSF("NSF",IMTH)=dep.nsfi18 quit
	if IMTH=19 set dep.nsfi19=dep.nsfi19+1 set DEPNSF("NSF",IMTH)=dep.nsfi19 quit
	if IMTH=20 set dep.nsfi20=dep.nsfi20+1 set DEPNSF("NSF",IMTH)=dep.nsfi20 quit
	if IMTH=21 set dep.nsfi21=dep.nsfi21+1 set DEPNSF("NSF",IMTH)=dep.nsfi21 quit
	if IMTH=22 set dep.nsfi22=dep.nsfi22+1 set DEPNSF("NSF",IMTH)=dep.nsfi22 quit
	if IMTH=23 set dep.nsfi23=dep.nsfi23+1 set DEPNSF("NSF",IMTH)=dep.nsfi23 quit
	if IMTH=24 set dep.nsfi24=dep.nsfi24+1 set DEPNSF("NSF",IMTH)=dep.nsfi24 quit

	quit 


public RET(RecordDEP dep,	// DEP Record	/TYP=RecordDEP/REQ
	Number TAMT)		// Amount	/TYP=RecordDEP/REQ

	// Update Returned Item counters
	
	type Number DEPNSF(,),EXP,IMTH,OMTH,RODT

	do INIT(.EXP,.RODT)

	if TAMT>+dep.bal do NSF(.dep,.DEPNSF)

	if %EffectiveDate set IMTH=$$DAT^%ZM(%EffectiveDate,"MM")+12
	else  set IMTH=$$DAT^%ZM(%SystemDate,"MM")+12

	set OMTH=IMTH+24

	if dep.retold'=%SystemDate do {

		if OMTH=37 set dep.reto13=dep.reto13+1 set DEPNSF("RET",OMTH)=dep.reto13 quit
		if OMTH=38 set dep.reto14=dep.reto14+1 set DEPNSF("RET",OMTH)=dep.reto14 quit
		if OMTH=39 set dep.reto15=dep.reto15+1 set DEPNSF("RET",OMTH)=dep.reto15 quit
		if OMTH=40 set dep.reto16=dep.reto16+1 set DEPNSF("RET",OMTH)=dep.reto16 quit
		if OMTH=41 set dep.reto17=dep.reto17+1 set DEPNSF("RET",OMTH)=dep.reto17 quit
		if OMTH=42 set dep.reto18=dep.reto18+1 set DEPNSF("RET",OMTH)=dep.reto18 quit
		if OMTH=43 set dep.reto19=dep.reto19+1 set DEPNSF("RET",OMTH)=dep.reto19 quit
		if OMTH=44 set dep.reto20=dep.reto20+1 set DEPNSF("RET",OMTH)=dep.reto20 quit
		if OMTH=45 set dep.reto21=dep.reto21+1 set DEPNSF("RET",OMTH)=dep.reto21 quit
		if OMTH=46 set dep.reto22=dep.reto22+1 set DEPNSF("RET",OMTH)=dep.reto22 quit
		if OMTH=47 set dep.reto23=dep.reto23+1 set DEPNSF("RET",OMTH)=dep.reto23 quit
		if OMTH=48 set dep.reto24=dep.reto24+1 set DEPNSF("RET",OMTH)=dep.reto24 quit
		}

	set dep.retold=%SystemDate

	if IMTH=13 set dep.reti13=dep.reti13+1 set DEPNSF("RET",IMTH)=dep.reti13 quit
	if IMTH=14 set dep.reti14=dep.reti14+1 set DEPNSF("RET",IMTH)=dep.reti14 quit
	if IMTH=15 set dep.reti15=dep.reti15+1 set DEPNSF("RET",IMTH)=dep.reti15 quit
	if IMTH=16 set dep.reti16=dep.reti16+1 set DEPNSF("RET",IMTH)=dep.reti16 quit
	if IMTH=17 set dep.reti17=dep.reti17+1 set DEPNSF("RET",IMTH)=dep.reti17 quit
	if IMTH=18 set dep.reti18=dep.reti18+1 set DEPNSF("RET",IMTH)=dep.reti18 quit
	if IMTH=19 set dep.reti19=dep.reti19+1 set DEPNSF("RET",IMTH)=dep.reti19 quit
	if IMTH=20 set dep.reti20=dep.reti20+1 set DEPNSF("RET",IMTH)=dep.reti20 quit
	if IMTH=21 set dep.reti21=dep.reti21+1 set DEPNSF("RET",IMTH)=dep.reti21 quit
	if IMTH=22 set dep.reti22=dep.reti22+1 set DEPNSF("RET",IMTH)=dep.reti22 quit
	if IMTH=23 set dep.reti23=dep.reti23+1 set DEPNSF("RET",IMTH)=dep.reti23 quit
	if IMTH=24 set dep.reti24=dep.reti24+1 set DEPNSF("RET",IMTH)=dep.reti24 quit

	quit 


INIT(Number EXP,	// Six Months in the Future
	Number RODT)	// Six Months in the Past

	// Initialization
	
	// Six month value = 365/2
	type Literal Number SIXM=182.5

	set EXP=%SystemDate+SIXM
	set RODT=%SystemDate-SIXM

	quit 


Public NSFLOAD(RecordDEP dep)	// DEP Record
	/*
	  This sub-routine will apply the values stored in the DEPNSF array
	  to the appropriate buckets.  This is done after a transaction for
	  an account has been rolled back.

	  INPUTS:
	         dep - Deposit Account object			/TYP=RecordDEP/REQ

	*/

	type Number DEPNSF(,),MTH
	type String TAG

	set (MTH,TAG)=""

	for  set TAG=$O(DEPNSF(TAG)) quit:TAG=""  do {

		for  set MTH=$O(DEPNSF(TAG,MTH)) quit:MTH=""  do {

			if TAG="NEGBAL" do NEGBALLD(.dep,MTH,.DEPNSF)
			if TAG="NSF" do NSFLD(.dep,MTH,.DEPNSF)
			if TAG="RET" do RETLD(.dep,MTH,.DEPNSF)
			}
		}

	kill DEPNSF

	quit


NEGBALLD(RecordDEP dep,		// DEP Record
	Number MTH,		// Month
	Number DEPNSF(,))	// DEPNSF Array
	
	set dep.odld=%SystemDate

	if MTH=13 set dep.negi13=DEPNSF("NEGBAL",MTH) quit
	if MTH=14 set dep.negi14=DEPNSF("NEGBAL",MTH) quit
	if MTH=15 set dep.negi15=DEPNSF("NEGBAL",MTH) quit
	if MTH=16 set dep.negi16=DEPNSF("NEGBAL",MTH) quit
	if MTH=17 set dep.negi17=DEPNSF("NEGBAL",MTH) quit
	if MTH=18 set dep.negi18=DEPNSF("NEGBAL",MTH) quit
	if MTH=19 set dep.negi19=DEPNSF("NEGBAL",MTH) quit
	if MTH=20 set dep.negi20=DEPNSF("NEGBAL",MTH) quit
	if MTH=21 set dep.negi21=DEPNSF("NEGBAL",MTH) quit
	if MTH=22 set dep.negi22=DEPNSF("NEGBAL",MTH) quit
	if MTH=23 set dep.negi23=DEPNSF("NEGBAL",MTH) quit
	if MTH=24 set dep.negi24=DEPNSF("NEGBAL",MTH) quit

	if MTH=37 set dep.nego13=DEPNSF("NEGBAL",MTH) quit
	if MTH=38 set dep.nego14=DEPNSF("NEGBAL",MTH) quit
	if MTH=39 set dep.nego15=DEPNSF("NEGBAL",MTH) quit
	if MTH=40 set dep.nego16=DEPNSF("NEGBAL",MTH) quit
	if MTH=41 set dep.nego17=DEPNSF("NEGBAL",MTH) quit
	if MTH=42 set dep.nego18=DEPNSF("NEGBAL",MTH) quit
	if MTH=43 set dep.nego19=DEPNSF("NEGBAL",MTH) quit
	if MTH=44 set dep.nego20=DEPNSF("NEGBAL",MTH) quit
	if MTH=45 set dep.nego21=DEPNSF("NEGBAL",MTH) quit
	if MTH=46 set dep.nego22=DEPNSF("NEGBAL",MTH) quit
	if MTH=47 set dep.nego23=DEPNSF("NEGBAL",MTH) quit
	if MTH=48 set dep.nego24=DEPNSF("NEGBAL",MTH) quit

	quit


NSFLD(RecordDEP dep,		// DEP Record
	Number MTH,		// Month
	Number DEPNSF(,))	// DEPNSF Array
	
	set dep.nsfold=%SystemDate

	if MTH=13 set dep.nsfi13=DEPNSF("NSF",MTH) quit
	if MTH=14 set dep.nsfi14=DEPNSF("NSF",MTH) quit
	if MTH=15 set dep.nsfi15=DEPNSF("NSF",MTH) quit
	if MTH=16 set dep.nsfi16=DEPNSF("NSF",MTH) quit
	if MTH=17 set dep.nsfi17=DEPNSF("NSF",MTH) quit
	if MTH=18 set dep.nsfi18=DEPNSF("NSF",MTH) quit
	if MTH=19 set dep.nsfi19=DEPNSF("NSF",MTH) quit
	if MTH=20 set dep.nsfi20=DEPNSF("NSF",MTH) quit
	if MTH=21 set dep.nsfi21=DEPNSF("NSF",MTH) quit
	if MTH=22 set dep.nsfi22=DEPNSF("NSF",MTH) quit
	if MTH=23 set dep.nsfi23=DEPNSF("NSF",MTH) quit
	if MTH=24 set dep.nsfi24=DEPNSF("NSF",MTH) quit

	if MTH=37 set dep.nsfo13=DEPNSF("NSF",MTH) quit
	if MTH=38 set dep.nsfo14=DEPNSF("NSF",MTH) quit
	if MTH=39 set dep.nsfo15=DEPNSF("NSF",MTH) quit
	if MTH=40 set dep.nsfo16=DEPNSF("NSF",MTH) quit
	if MTH=41 set dep.nsfo17=DEPNSF("NSF",MTH) quit
	if MTH=42 set dep.nsfo18=DEPNSF("NSF",MTH) quit
	if MTH=43 set dep.nsfo19=DEPNSF("NSF",MTH) quit
	if MTH=44 set dep.nsfo20=DEPNSF("NSF",MTH) quit
	if MTH=45 set dep.nsfo21=DEPNSF("NSF",MTH) quit
	if MTH=46 set dep.nsfo22=DEPNSF("NSF",MTH) quit
	if MTH=47 set dep.nsfo23=DEPNSF("NSF",MTH) quit
	if MTH=48 set dep.nsfo24=DEPNSF("NSF",MTH) quit

	quit


RETLD(RecordDEP dep,		// DEP Record
	Number MTH,		// Month
	Number DEPNSF(,))	// DEPNSF Array
	
	set dep.retold=%SystemDate

	if MTH=13 set dep.reti13=DEPNSF("RET",MTH) quit
	if MTH=14 set dep.reti14=DEPNSF("RET",MTH) quit
	if MTH=15 set dep.reti15=DEPNSF("RET",MTH) quit
	if MTH=16 set dep.reti16=DEPNSF("RET",MTH) quit
	if MTH=17 set dep.reti17=DEPNSF("RET",MTH) quit
	if MTH=18 set dep.reti18=DEPNSF("RET",MTH) quit
	if MTH=19 set dep.reti19=DEPNSF("RET",MTH) quit
	if MTH=20 set dep.reti20=DEPNSF("RET",MTH) quit
	if MTH=21 set dep.reti21=DEPNSF("RET",MTH) quit
	if MTH=22 set dep.reti22=DEPNSF("RET",MTH) quit
	if MTH=23 set dep.reti23=DEPNSF("RET",MTH) quit
	if MTH=24 set dep.reti24=DEPNSF("RET",MTH) quit

	if MTH=37 set dep.reto13=DEPNSF("RET",MTH) quit
	if MTH=38 set dep.reto14=DEPNSF("RET",MTH) quit
	if MTH=39 set dep.reto15=DEPNSF("RET",MTH) quit
	if MTH=40 set dep.reto16=DEPNSF("RET",MTH) quit
	if MTH=41 set dep.reto17=DEPNSF("RET",MTH) quit
	if MTH=42 set dep.reto18=DEPNSF("RET",MTH) quit
	if MTH=43 set dep.reto19=DEPNSF("RET",MTH) quit
	if MTH=44 set dep.reto20=DEPNSF("RET",MTH) quit
	if MTH=45 set dep.reto21=DEPNSF("RET",MTH) quit
	if MTH=46 set dep.reto22=DEPNSF("RET",MTH) quit
	if MTH=47 set dep.reto23=DEPNSF("RET",MTH) quit
	if MTH=48 set dep.reto24=DEPNSF("RET",MTH) quit

	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "60428^4753^Hema Puttaswamy^12254"	// Signature - LTD^TIME^USER^SIZE
