CNV62RSC	  /*
ORIG: LUS
DESC: Rate Schedule Conversion

---- Comments --------------------------------------------------------
This routine will collate through all product types and accounts split 
Rate Schedule into three fields respectively

---- Revision History ------------------------------------------------

 ****** Consider using setAuditFlag for all objects in this procedure
   example :do dep.setAuditFlag(1)

  */

	do DEP                 //convert DEP accounts
	do LN                  //convert LN accounts	
	do CNVDFTD             //convert DEP products
	do CNVDFTL	       //convert LN products	
	quit

	       
CNVDFTD                        // Break out fields at the DEP product type level
     
 	new SCH,RSINTSPR,RSRNDMTD,rs
	new type	
	type ResultSet rs=Db.select("SCH,TYPE","PRODDFTD","SCH IS NOT NULL")
	if 'rs.isEmpty() do {
	       while rs.next() do {
	 		set SCH=rs.getCol(1)
			if SCH=$P(SCH," ",1) quit
			set TYPE=rs.getCol(2)
			
			set RSINTSPR=$P(SCH," ",2),RSRNDMTD=$P(SCH," ",3)
	
			new proddftd
			type RecordPRODDFTD proddftd=Db.getRecord("PRODDFTD","TYPE")
		
			set proddftd.sch=$P(SCH," ",1)
			set proddftd.rsintspr=RSINTSPR
			set proddftd.rsrndmtd=RSRNDMTD
			do proddftd.bypassSave() 

		}
	}
                        
        quit

CNVDFTL                   // Break out fields at the LN product type level
 
        new SCH,RSINTSPR,RSRNDMTD,rs
        type ResultSet rs=Db.select("SCH,TYPE","PRODDFTL","SCH IS NOT NULL")
        if 'rs.isEmpty() do {
               	while rs.next() do {
			set SCH=rs.getCol(1)
                        if SCH=$P(SCH," ",1) quit
			set TYPE=rs.getCol(2)

			set RSINTSPR=$P(SCH," ",2),RSRNDMTD=$P(SCH," ",3)
 
                        new proddftl
			type RecordPRODDFTL proddftl=Db.getRecord("PRODDFTL","TYPE")
 
                        set proddftl.sch=$P(SCH," ",1)

                        set proddftl.rsintspr=RSINTSPR
                        set proddftl.rsrndmtd=RSRNDMTD
                        do proddftl.bypassSave()
 
                }
        }
 
        quit 
       
DEP	// Break out fields at the Dep account level
       
	new SCH,RSINTSPR,RSRNDMTD,CID,rs 
	type ResultSet rs=Db.select("SCH,CID","DEP","SCH IS NOT NULL")
	if 'rs.isEmpty() do {
		while rs.next() do {
                	set SCH=rs.getCol(1)
			if SCH=$P(SCH," ",1) quit
			set CID=rs.getCol(2) 
			set RSINTSPR=$P(SCH," ",2),RSRNDMTD=$P(SCH," ",3)    

                        new dep
                        type RecordDEP dep=Db.getRecord("DEP","CID")

                        set dep.sch=$P(SCH," ",1)
               	        set dep.rsintspr=RSINTSPR
                        set dep.rsrndmtd=RSRNDMTD
        
           		do dep.bypassSave()
			}
		} 
	quit

LN	// Break out fields at the LN account level
 
        new SCH,RSINTSPR,RSRNDMTD,CID,rs
       // set CID=""
        type ResultSet rs=Db.select("SCH,CID","LN","SCH IS NOT NULL")
        if 'rs.isEmpty() do {
        	while rs.next() do {
                	set SCH=rs.getCol(1)
                        if SCH=$P(SCH," ",1) quit
                        set CID=rs.getCol(2)
			set RSINTSPR=$P(SCH," ",2),RSRNDMTD=$P(SCH," ",3)

                        new ln
                        type RecordLN ln=Db.getRecord("LN","CID")
 
                        set ln.sch=$P(SCH," ",1)
                        set ln.rsintspr=RSINTSPR
                        set ln.rsrndmtd=RSRNDMTD

                        do ln.bypassSave()
              }
        }
        quit
 #OPTION ResultClass ON
Public String vSIG()	quit "59886^43497^Sanchez SCM Administrator^3350"	// Signature - LTD^TIME^USER^SIZE
