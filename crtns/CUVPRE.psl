CUVPRE	//	Institution Variables Maintenance
	/*
	        ORIG:  Tom Locke (2424) - 02/21/86
	  ---- Revision History ------------------------------------------------
	  09/09/02 - SRIVASTAVAN - 49451
	             Converted to PSL	 
	
          ---------------------------------------------------------------------
	*/		   

UPD 	//

	do INIT(1)
	quit


INQ	//

	do INIT(2)
	quit


INIT(%ProcessMode)	//

	new OLNTB,VFMQ

	set %PG=$S(%ProcessMode=1:1,1:0) 
	set %PAGE=1

	type RecordCUVAR fCUVAR

	do VPG(.fCUVAR)

	quit


VPG(RecordCUVAR fCUVAR)	// Page control

	new FINISH
        set FINISH=0
        for  do { quit:FINISH
                if %PG=0 do VPG00 if ER set FINISH=1 quit

                if %PG>0 do VPG01(.fCUVAR)

                if "DFQ"[VFMQ do VER(.fCUVAR) set FINISH=1 quit

                set %PG=%PG+1
                }
        quit


VPG00	// Set up

	set %TAB("IO")=$$IO^SCATAB($I)
	set %READ="@@%FN,,,IO/REQ" 
	set %NOPRMT="N"

	do ^UTLREAD 
	
	if VFMQ="Q" set ER=1 

	quit


VPG01(RecordCUVAR fCUVAR)	// Institution variable screen

	if %ProcessMode=1 lock +CUVAR:1 else  set ET="RECLOC" do ERR quit

	if %ProcessMode=2,IO'=$I do OPEN^SCAIO if ER set VFMQ="Q" quit

	set fCUVAR=Db.getRecord("CUVAR")

	do DRV^USID(%ProcessMode,"CUVAR",.fCUVAR)

	quit


ERR	//

	set ER=1 

	do ^UTLERR

	set VFMQ="Q"
	quit


VER(RecordCUVAR fCUVAR) 	//

	if %ProcessMode=2!(%ProcessMode=4)!(VFMQ="Q") do END quit

	do FILE(.fCUVAR)

	do END

	quit


FILE(RecordCUVAR fCUVAR)	// File data

	do fCUVAR.save()
	
	quit


END	//

	if ER!(%ProcessMode=2)!(%ProcessMode=4) quit

	// Institution variables not modified
	if VFMQ="Q" set RM=$$^MSG(1243)

	// Institution variables modified
	else  set RM=$$^MSG(1242)

	set ER="W"

	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "59886^43502^Sanchez SCM Administrator^1575"	// Signature - LTD^TIME^USER^SIZE
