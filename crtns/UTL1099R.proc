UTL1099R		/*
	ORIG: titove - 10/27/2005
	DESC: Utility for 1099-R Reports

	---- Comments --------------------------------------------------------

	I18N=QUIT: Excluded from I18N standards.

	---- Revision History ------------------------------------------------

	09/20/06 - SWARNALP - CR 23178
		   The following changes are made in this procedure as part of 
		   the Year 2006 programming changes for magnetic media 
		   reporting of IRS 1098, 1099 & 5498 forms supported by 
		   Profile.
		   .	Modified section DISTAMT to pass "5" as the parameter 
		   	to the extrinsic function call CD for the two combined 
		   	Profile distribution codes 72 and 95.
		   .	Modified section CD to correct the distribution codes 
		   	that should get displayed on Form 1099R for 
		   	distributions made from Roth or Spousal Roth plans 
		   	(plan type 13 or 15) using the corresponding combined 
		   	Profile distribution code.
	
	08/29/06 - SWARNALP - CR 22583
		   Modified DISTAMT to remove the use of the data item IRA.D9 
		   since D9 is a computed column which is for Federal Tax 
		   Withheld and this amount should not get added to IRA.D1 
		   which is a Normal Distribution and is an inclusive of 
		   Federal Tax Withheld amount. It should be noted that the 
		   code in the lower version uses only the 9th piece of 
		   level 0 for IRA which is not available in the table itself 
		   and hence the use of IRA.D9 is removed from section DISTAMT, 
		   SET and SET1.
	
	05/01/06 - TITOVE - CR 21024
		   Modified DISTAMT not to call SET section twice in a row.

	04/22/06 - TITOVE - CR 20798
		   Made CD function public. Removed unneeded second arguments
		   from extract() function (when they were equal) since
		   compiler removes them anyway. Fixed misspelled variable
		   in SET1 section.
 
        02/28/06 - Hillanbrand CR 20336
                   Modified the procedure to use columns from IRA instead
                   of arrays.  This corrects an issue where the piece of
                   the column was not correct.

	02/02/06 - TITOVE - CR 19366
		   Modified to skip the IRA.D9 and IRA.W9 columns.

	10/27/05 - TITOVE - CR 17287
		   Moved code related to 1099-R IRS processing from SCARPTS
		   procedure. Modified code to only send/accept one argument
		   to/by function CD. The logic for second argument has been
		   eliminated previously. Converted inputs needed by V6P
		   section into arguments.

	*/
	
	quit	// Dummy quit for PSL compiler
	

public	DISTAMT(Number ACN,		// Customer Number or Beneficiary Sequence
	    Number RPASEQ,		// Retirement Plan Account Sequence Number
	    Number TAXYR,		// Tax Year
	    Number BENE)		// Customer Number for Beneficiary
	    
	/*
	  This section determines the distribution amounts to be reported on
	  the Profile 1099-R reports (SCA113 and SCA115).

	  RETURNS:	
		. B()		Distribution boxes
		
		. IRAIND	IRA/SEP indicator
		
		. TAXIND	Taxable Amount Not Determined Indicator
	
	*/
	
	type public String B(), IRAIND, TAXIND
	
	type Number BX, I, IRATYP, PC
	type String CD, IRA(), VAR, X, Y

	set (B(1),B(2),B(3),B(4),B(5),B(6),B(7),B(8),B(15),B(18),B(28),B(48),B("P"),B("D"))=""
	set (B("T8"),B("D1"),B("D2"),B("D4"),B("P1"),B("P2"),B("P4"),B("L1"))=""
	set (B("L2"),B("L4"),B("PT"),B("J "),B("T "),B("PJ"),B("J8"),B("JP"))=""
	set (B("G"),B("4G"),B("J"),B("Q"),B("R"),B("L"),B("M"),B("S"),B("T"),B("N"))=""

	type RecordIRA ira = Db.getRecord("IRA", "ACN=:ACN,RPASEQ=:RPASEQ,TAXYR=:TAXYR", 1)


	if 'BENE do {
			
		type RecordIRATYPE iratype = Db.getRecord("IRATYPE", "ACN=:ACN,RPASEQ=:RPASEQ", 1)
	
		set TAXIND = $S(iratype.taxind:"X",1:"")
		set IRATYP = iratype.iratyp
	
		if (IRATYP=1)!(IRATYP=2)!(IRATYP=4)!(IRATYP=10)!(IRATYP=11)!(IRATYP=16) set IRAIND=1
		else  set IRAIND = " "
		
		if ira.d1+ira.w1 set BX=1,PC=1,CD=$$CD(7) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
		if ira.d4+ira.w4 set BX=1,PC=4,CD=$$CD(1) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
		if ira.d5+ira.w5 set BX=1,PC=5,CD=$$CD(3) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)

		if 'Db.isDefined("IRABEN2","ACN=:ACN,RPASEQ=:RPASEQ") do {
	
			if ira.d6+ira.w6 set BX=1,PC=6,CD=$$CD(4) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
			if ira.d59+ira.w59 set BX=1,PC=59,CD=$$CD(48) do SET(.ira) do SET2(.ira)
			if ira.d60+ira.w60 set BX=1,PC=60,CD=$$CD(48) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
			if ira.d68+ira.w68 set BX=1,PC=68,CD=$$CD("D4") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
			if ira.d75+ira.w75 set BX=1,PC=75,CD=$$CD("L4") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
			if ira.d85+ira.w85 set BX=1,PC=85,CD=$$CD("P4") do SET(.ira) do SET2(.ira)
			if ira.d87+ira.w87 set BX=1,PC=87,CD=$$CD("P4") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
			}
		}

	// Reset amounts for death beneficiaries
	if BENE do {
		
		type RecordIRATYPE iratype = Db.getRecord("IRATYPE", "ACN=:BENE,RPASEQ=:RPASEQ", 1)
		
		set IRATYP = iratype.iratyp
		set IRAIND = " "	
		set TAXIND = ""
		
		type RecordIRABEN1 iraben1 = Db.getRecord("IRABEN1", "ACN=:BENE,RPASEQ=:RPASEQ,BENSEQ=:ACN,CYR=:TAXYR", 1)

		set ira.d6=iraben1.tamt+iraben1.wth+iraben1.totstwh
		set ira.w6=iraben1.wth
		set ira.sw6=iraben1.totstwh
		set ira.d59=iraben1.tamt59+iraben1.wth59+iraben1.totswh59
		set ira.w59=iraben1.wth59
		set ira.sw59=iraben1.totswh59
		set ira.d60=iraben1.tamt60+iraben1.wth60+iraben1.totswh60
		set ira.w60=iraben1.wth60
		set ira.sw60=iraben1.totswh60
		set ira.d68=iraben1.tamt68+iraben1.wth68+iraben1.totswh68
		set ira.w68=iraben1.wth68
		set ira.sw68=iraben1.totswh68
		set ira.d75=iraben1.tamt75+iraben1.wth75+iraben1.totswh75
		set ira.w75=iraben1.wth75
		set ira.sw75=iraben1.totswh75
		set ira.d85=iraben1.tamt85+iraben1.wth85+iraben1.totswh85
		set ira.w85=iraben1.wth85
		set ira.sw85=iraben1.totswh85
		set ira.d87=iraben1.tamt87+iraben1.wth87+iraben1.totswh87
		set ira.w87=iraben1.wth87
		set ira.sw87=iraben1.totswh87
		
		if ira.d6 set BX=1,PC=6,CD=$$CD(4) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
		if ira.d59 set BX=1,PC=59,CD=$$CD(48) do SET(.ira) do SET2(.ira)
		if ira.d60 set BX=1,PC=60,CD=$$CD(48) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
		if ira.d68 set BX=1,PC=68,CD=$$CD("D4") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
		if ira.d75 set BX=1,PC=75,CD=$$CD("L4") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
		if ira.d85 set BX=1,PC=85,CD=$$CD("P4") do SET(.ira) do SET2(.ira)
		if ira.d87 set BX=1,PC=87,CD=$$CD("P4") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
		}

	if ira.d7+ira.w7 set BX=1,PC=7,CD=$$CD(5) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.w9 set BX=1,PC=9,CD=$$CD(7) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d10+ira.w10 set BX=1,PC=10,CD=$$CD(7) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d15+ira.w15 set BX=1,PC=15,CD=$$CD(6) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d17+ira.w17 set BX=1,PC=17,CD=$$CD(2) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d18+ira.w18 set BX=1,PC=18,CD=$$CD(8) do SET1(.ira) do SET2(.ira)
	if ira.d19+ira.w19 set BX=1,PC=19,CD=$$CD("P") do SET1(.ira) do SET2(.ira)
	if ira.d22+ira.w22 set BX=1,PC=22,CD=$$CD(8) do SET(.ira) set BX=2 do SET1(.ira) do SET2(.ira)
	if ira.d23+ira.w23 set BX=1,PC=23,CD=$$CD("P") do SET(.ira) set BX=2 do SET1(.ira) do SET2(.ira)
	if ira.d24+ira.w24 set BX=1,PC=24,CD=$$CD("D") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d26+ira.w26 set BX=1,PC=26,CD=$$CD("4G") do SET(.ira) set B(CD).piece("|",2)=0 do SET2(.ira)
	if ira.d28+ira.w28 set BX=1,PC=28,CD=$$CD("G") do SET(.ira) set B(CD).piece("|",2)=0 do SET2(.ira)
	if ira.d29+ira.w29 set BX=1,PC=29,CD=$$CD("G") do SET(.ira) set B(CD).piece("|",2)=0 do SET2(.ira)
	if ira.d34+ira.w34 set BX=1,PC=34,CD=$$CD(2) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d35+ira.w35 set BX=1,PC=35,CD=$$CD(2) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d36+ira.w36 set BX=1,PC=36,CD=$$CD("S") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d37+ira.w37 set BX=1,PC=37,CD=$$CD("L") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d38+ira.w38 set BX=1,PC=38,CD=$$CD(2) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d39+ira.w39 set BX=1,PC=39,CD=$$CD(2) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d43+ira.w43 set BX=1,PC=43,CD=$$CD("N") do SET(.ira) set B(CD).piece("|",2)=0 do SET2(.ira)
	if ira.d44+ira.w44 set BX=1,PC=44,CD=$$CD(4) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d48+ira.w48 set BX=1,PC=48,CD=$$CD("R") do SET(.ira) set B(CD).piece("|",2)=0 do SET2(.ira)
	if ira.d89+ira.w89 set BX=1,PC=89,CD=$$CD("Q") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)

	if ira.d49+ira.w49 set BX=1,PC=49,CD=$$CD(18) do SET(.ira) do SET2(.ira)
	if ira.d50+ira.w50 set BX=1,PC=50,CD=$$CD(18) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d51+ira.w51 set BX=1,PC=51,CD=$$CD(28) do SET(.ira) do SET2(.ira)
	if ira.d52+ira.w52 set BX=1,PC=52,CD=$$CD(28) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d53+ira.w53 set BX=1,PC=53,CD=$$CD(28) do SET(.ira) do SET2(.ira)
	if ira.d54+ira.w54 set BX=1,PC=54,CD=$$CD(28) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d55+ira.w55 set BX=1,PC=55,CD=$$CD(28) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d56+ira.w56 set BX=1,PC=56,CD=$$CD(28) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d57+ira.w57 set BX=1,PC=57,CD=$$CD(28) do SET(.ira) do SET2(.ira)
	if ira.d58+ira.w58 set BX=1,PC=58,CD=$$CD(28) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d61+ira.w61 set BX=1,PC=61,CD=$$CD(48) do SET(.ira) do SET2(.ira)
	if ira.d62+ira.w62 set BX=1,PC=62,CD=$$CD(48) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d63+ira.w63 set BX=1,PC=63,CD=$$CD("D1") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d64+ira.w64 set BX=1,PC=64,CD=$$CD("D2") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d65+ira.w65 set BX=1,PC=65,CD=$$CD("D2") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d66+ira.w66 set BX=1,PC=66,CD=$$CD("D2") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d67+ira.w67 set BX=1,PC=67,CD=$$CD("D2") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d69+ira.w69 set BX=1,PC=69,CD=$$CD("D4") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d70+ira.w70 set BX=1,PC=70,CD=$$CD("P1") do SET(.ira) do SET2(.ira)
	if ira.d71+ira.w71 set BX=1,PC=71,CD=$$CD("P1") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d72+ira.w72 set BX=1,PC=72,CD=$$CD(5) do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d73+ira.w73 set BX=1,PC=73,CD=$$CD("L1") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d74+ira.w74 set BX=1,PC=74,CD=$$CD("T") do SET(.ira) do SET2(.ira)
	if ira.d76+ira.w76 set BX=1,PC=76,CD=$$CD("L4") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d77+ira.w77 set BX=1,PC=77,CD=$$CD("P2") do SET(.ira) do SET2(.ira)
	if ira.d78+ira.w78 set BX=1,PC=78,CD=$$CD("P2") do SET(.ira) do SET2(.ira)
	if ira.d79+ira.w79 set BX=1,PC=79,CD=$$CD("P2") do SET(.ira) do SET2(.ira)
	if ira.d80+ira.w80 set BX=1,PC=80,CD=$$CD("P2") do SET(.ira) do SET2(.ira)
	if ira.d81+ira.w81 set BX=1,PC=81,CD=$$CD("P2") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d82+ira.w82 set BX=1,PC=82,CD=$$CD("P2") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d83+ira.w83 set BX=1,PC=83,CD=$$CD("P2") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d84+ira.w84 set BX=1,PC=84,CD=$$CD("P2") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d86+ira.w86 set BX=1,PC=86,CD=$$CD("P4") do SET(.ira) do SET2(.ira)
	if ira.d88+ira.w88 set BX=1,PC=88,CD=$$CD("P4") do SET(.ira) set BX=2 do SET(.ira) do SET2(.ira)
	if ira.d94+ira.w94 set BX=1,PC=94,CD=$$CD("J") do SET(.ira) do SET2(.ira)
	if ira.d95+ira.w95 set BX=1,PC=95,CD=$$CD(5) do SET(.ira) do SET2(.ira)
	if ira.d96+ira.w96 set BX=1,PC=96,CD=$$CD("J8") do SET(.ira) do SET2(.ira)
	if ira.d97+ira.w97 set BX=1,PC=97,CD=$$CD("J8") do SET(.ira) do SET2(.ira)
	if ira.d98+ira.w98 set BX=1,PC=98,CD=$$CD("JP") do SET(.ira) do SET2(.ira)
	if ira.d99+ira.w99 set BX=1,PC=99,CD=$$CD("JP") do SET(.ira) do SET2(.ira)

	if B(1).isNull() kill B(1)
	if B(2).isNull() kill B(2)
	if B(3).isNull() kill B(3)
	if B(4).isNull() kill B(4)
	if B(6).isNull() kill B(6)
	if B(7).isNull() kill B(7)
	if B(8).isNull() kill B(8)
	if B("P").isNull() kill B("P")
	if B("D").isNull() kill B("D")
	if B("4G").isNull() kill B("4G")
	if B("G").isNull() kill B("G")
	if B("J").isNull() kill B("J")
	if B("Q").isNull() kill B("Q")
	if B("R").isNull() kill B("R")
	if B("M").isNull() kill B("M")
	if B("N").isNull() kill B("N")
	if B("T").isNull() kill B("T")
	if B("J8").isNull() kill B("J8")
	if B("JP").isNull() kill B("JP")
	if B(18).isNull() kill B(18)
	if B(28).isNull() kill B(28)
	if B("T8").isNull() kill B("T8")
	if B(48).isNull() kill B(48)
	if B("D1").isNull() kill B("D1")
	if B("D2").isNull() kill B("D2")
	if B("D4").isNull() kill B("D4")
	if B("P1").isNull() kill B("P1")
	if B("P2").isNull() kill B("P2")
	if B("P4").isNull() kill B("P4")
	if B(15).isNull() kill B(15)
	if B("L1").isNull() kill B("L1")
	if B("L2").isNull() kill B("L2")
	if B("L4").isNull() kill B("L4")
	if B("PT").isNull() kill B("PT")
	if B("J ").isNull() kill B("J ")
	if B("T ").isNull() kill B("T ")
	if B("PJ").isNull() kill B("PJ")
	
	quit
	

SET(RecordIRA ira)	// IRA object		/REF:RW	
	
	type public Number BX, CD, IRATYP, PC, X
	type public String B()
	type String PCD

	if (BX = 2),((IRATYP = 13)!(IRATYP = 12)!(IRATYP = 15)) quit
	
	if PC=9 quit
	
	set PCD = "d"_PC
	
	set B(CD).piece("|",BX) = B(CD).piece("|",BX) + ira.@PCD
	
	quit
	

SET1(RecordIRA ira)	// IRA object		/REF:RW	
	
	type public Number BX, CD, PC, X
	type public String B()
	type String PCD
	
	if PC=9 quit
	
	set PCD = "d"_PC
	set B(CD).piece("|",BX) = B(CD).piece("|",BX) + ira.@PCD
	
	quit
	

SET2(RecordIRA ira)	// IRA object		/REF:RW
	// Set up boxes 4,5 for Federal and State W/H

	type public Number CD, IRA(), PC
	type public String B()
	type String PCW, PCSW 
	
	set PCW = "w"_PC
	set PCSW = "sw"_PC
	
	set B(CD).piece("|",4) = B(CD).piece("|",4) + ira.@PCW
	
	set B(CD).piece("|",5) = B(CD).piece("|",5) + ira.@PCSW
	
	quit
	

public CD(String CD)		// IRS distribution document code

	// This function converts a generic IRS distribution code into
	// the appropriate code for IRS Form 1099-R (original or corrections).
	type public Number IRATYP
	
	type Number TEMP
	
	if ((IRATYP = 13) ! (IRATYP = 15)) do {
		
		if (CD = "Q8") ! (CD = "QP") ! (CD = "Q") quit
		
		if (CD = "D1") ! (CD = "15") ! (CD = "L1") set CD = "J " quit
		
		if (CD = "D2") ! (CD = "L2") ! (CD = "L4") ! (CD = "D4") set CD = "T " quit

		if (CD.extract(1) = 1) ! (CD.extract(1) = 2) ! (CD.extract(1) = 4) set CD.extract(1) = "J" quit

		if (CD.extract(2) = 1) ! ((CD.extract(1) = "P") & ((CD.extract(2) = 2) ! (CD.extract(2) = 4))) set CD.extract(2) = "J" quit
		
		}


	if (CD.extract(1) = CD.extract(2)) set CD.extract(2) = " "
	
	if CD.extract()?1N , CD.extract(2)?1A do {
		
		set TEMP = CD.extract(1)
		
		set CD.extract(1) = CD.extract(2)
		
		set CD.extract(2) = TEMP
		}
	
	quit CD
	

vSIG()	quit "60528^29149^P.R. Swarnalatha^14830"	// Signature - LTD^TIME^USER^SIZE
