HISTUCG1 //
 /*
ORIG: MATTSON - 05/27/2003
DESC: History Row Definitions

 ---- Comments --------------------------------------------------------
 This procedure is used to build routine HISTDEF.  HISTDEF is a library
 program that provides the following functions that return the row
 definitions used by history utility HISTUTL.
 
	$$EURO		Row definition for object 'EURO'
	$$HIST		Row definition for object 'hist'
	$$HIST0		Row definition for object 'hist0'
	$$HISTSB	Row definition for object 'histsb'
	$$HISTDST	Row definition for object 'histdst'
	$$HISTLST	Row definition for object 'histlst'

 ---- Revision History ------------------------------------------------
           
 	12/28/05 - TITOVE - CR 18748
 		   Replaced the usage of PSL array with ARR() 
 		   (PSL is a restricted keyword).

        07/28/05 - SkariahV- CR16679
	           Removed #WARN directive.
	
  */
	quit


public	HISTDEF(String DEF())
	/*
	Compile routine HISTDEF (row definitions).  Called by procedure
	definition HISTUCG.
	
	ARGUMENTS:
	     . DEF	Definitions		/NOREQ/MECH=REFARR:W
	     
	     		Row definition
	     		DEF(table)=column_list

	     		Row definitions include keys but do not include
	     		computed data items or sub-fields.
	     		
			Column definition
	     		DEF(table,field_position,column)=sub-field definition
	     		
	     		Column definitions include columns and sub-fields
	     		that are of data type $ (currency) but do not
	     		include keys and computed data items.
	*/

	type String ARR()

	do COL("HIST",.DEF)
	do COL("HIST0",.DEF)
	do COL("HISTSB",.DEF)
	do COL("HISTDST",.DEF)
	do COL("HISTLST",.DEF)
	
	set ARR(ARR("").order(-1)+1)="HISTDEF // History row definitions"
	set ARR(ARR("").order(-1)+1)="	quit"
	set ARR(ARR("").order(-1)+1)=""

	set ARR(ARR("").order(-1)+1)="Public EURO() // EURO row definition"
	set ARR(ARR("").order(-1)+1)="	quit ""CID,CRCD,RATE,DECP,EURCNVD,EUREVDT,ORGCRCD"""
	set ARR(ARR("").order(-1)+1)=""

	set ARR(ARR("").order(-1)+1)="Public HIST() // HIST row definition"
	set ARR(ARR("").order(-1)+1)="	quit """_DEF("HIST")_""""
	set ARR(ARR("").order(-1)+1)=""

	set ARR(ARR("").order(-1)+1)="Public HIST0() // HIST0 row definition"
	set ARR(ARR("").order(-1)+1)="	quit """_DEF("HIST0")_""""
	set ARR(ARR("").order(-1)+1)=""

	set ARR(ARR("").order(-1)+1)="Public HISTDST() // HISTDST row definition"
	set ARR(ARR("").order(-1)+1)="	quit """_DEF("HISTDST")_""""
	set ARR(ARR("").order(-1)+1)=""

	set ARR(ARR("").order(-1)+1)="Public HISTLST() // HISTLST row definition"
	set ARR(ARR("").order(-1)+1)="	quit """_DEF("HISTLST")_""""
	set ARR(ARR("").order(-1)+1)=""

	set ARR(ARR("").order(-1)+1)="Public HISTSB() // HISTSB row definition"
	set ARR(ARR("").order(-1)+1)="	quit """_DEF("HISTSB")_""""
	set ARR(ARR("").order(-1)+1)=""

	// ----- Compile HISTDEF -----
	do BUILDRTN^UCGM(.ARR,"HISTDEF")
	quit


COL(String FID,String DEF())	// Column definition

	type Number POS
	type String ACCKEYS,DI,KEY,SFD,TYP
	
	type RecordDBTBL1 dbtbl1=Db.getRecord("DBTBL1","%LIBS='SYSDEV',FID=:FID")

	set ACCKEYS=dbtbl1.acckeys
	set KEY=ACCKEYS.piece(",",ACCKEYS.length(","))
	
	type ResultSet rs=Db.select("DI,TYP,POS,SFD","DBTBL1D","%LIBS='SYSDEV' AND FID=:FID AND NOD=:KEY","POS")

	set DEF(FID)=ACCKEYS
	while rs.next() do {
		set DI=rs.getCol("DI")
		set POS=rs.getCol("POS")
		set SFD=rs.getCol("SFD")
		set TYP=rs.getCol("TYP")
		
		if SFD="" do {
			set DEF(FID,POS)=DI
			set DEF(FID)=DEF(FID)_","_DI
			}
			
		if TYP="$" set DEF(FID,POS,DI)=SFD
		}
	quit

vSIG()	quit "60262^43131^Eugene Titov^3383"	// Signature - LTD^TIME^USER^SIZE
