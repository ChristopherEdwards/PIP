ITSHOLDS		/*
	       ORIG:  HOFFMAN - 25 NOV 1992
	       DESC:  Enhanced Hold functionality linking holds to transactions

	---- Revision History ------------------------------------------------

	12/13/02 - ZWITKOWITSM - 51349
		   Removed isDefined method.

	06/13/02 - ZWITKOWITSM - 43583
		   Converted to PSL.

	----------------------------------------------------------------------
	*/

	quit


Public EXPHOLD(CID,HOLDSEQ,AMOUNT,REAPPLY)
	/*
	DESCRIPTION:
	   This routine will expire a permanent hold.  It is designed to be
	   used in the midst of transaction processing.

	ARGUMENTS:
	   . CID  The account number to expire
	   . HOLDSEQ  The hold sequence number to expire
	   . AMOUNT  The amount to expire
	   . REAPPLY  Reapply leftover funds under same
	      hold sequence number?

	RETURNS:
	   Upon error:   -1
	   Success with no reapply:  0
	   Success with reapply:  0|Remaining Hold amount
	*/

	if $G(CID)="" quit -1
	if $G(HOLDSEQ)="" quit -1
	if $G(AMOUNT)="" quit -1
	if $G(REAPPLY)="" quit -1

	new RET

	set RET=0

	type RecordPHLD phld=Db.getRecord("PHLD","CID,HOLDSEQ",1)
	if phld.getMode()=0 quit -1

	if REAPPLY=1 do {
		// Calculate remaining hold
		set phld.amt=phld.amt-AMOUNT

		if phld.amt<0 set phld.amt=0

		set $P(RET,"|",2)=phld.amt
		}

	// Set the expiration date to today
	else  set phld.expdt=%SystemDate

	do phld.bypassSave()

	quit RET
 #OPTION ResultClass ON
Public String vSIG()	quit "59886^43522^Sanchez SCM Administrator^1308"	// Signature - LTD^TIME^USER^SIZE
