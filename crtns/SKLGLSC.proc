SKLGLSC	// Maintain user tables GLSC and GLSCX
	/*
	       ORIG:  David Caliendo (5527) 2/7/89
	  ---- Revision History ------------------------------------------------

	  01/17/05 - KINI - CR13991
	  	     Removed #WARN and #OPTIMIZE since these are managed 
	  	     globally.
		     Modified DEL and FILE sections to prevent deletion of 
		     G/L set code record. Deleted related error messages from
		     END section.
		     Removed UTBLGLSCX index table as obsoleted.
		     
	  08/13/04 - KELLYP - CR 11521
		     Modified to conform to current PSL standards and added to
		     source control.

	  10/03/02 - KESHAVANN - 49451
		     Converted to PSL
	   
	  06/08/00 - Anna Maltepes 35996
	             Modified SID for loans to call new linkage screen
	             UTBLGLSCL00.
          ---------------------------------------------------------------------
	*/
	
	quit
		
	 
NEW    //

       do INIT(0)
       quit		


UPD    //	

       do INIT(1)
       quit
	
	
INQ	//

    	do INIT(2)
	quit
	
	
DEL	//
	
	type Public String ER
	
	// Deletion of G/L set code is not allowed
	do Runtime.setErrMSG("UTBLGLSC",807) quit:ER

	quit


INIT(Number %ProcessMode)	//

	type RecordUTBLGLSC fUTBLGLS

	do VPG(.fUTBLGLS)
	
	quit


VPG(RecordUTBLGLSC fUTBLGLS)	// Page control

	type Public String ER

	type Boolean FINISH
	type Number %PAGE,%PG
	type String CLS,GLSC,GRP,IO,OLNTB,VFMQ
	
	set %PG=0 
	set %PAGE=1
	set FINISH=0

	for  do { quit:FINISH 
		if %PG=0 do VPG00(.fUTBLGLS) if ER!(VFMQ="Q") set FINISH=1 quit
                
		if %PG>0 do VPG01(.fUTBLGLS)
	
		if "DFQ"[VFMQ do VER(.fUTBLGLS) set FINISH=1 quit
  		set %PG=%PG+1
		}
	quit


VPG00(RecordUTBLGLSC fUTBLGLS)	// Set up

	type Public String ET,GLSC,VFMQ

	type String %NOPRMT,%READ,%TAB()

	if %ProcessMode=0 do {
		set %TAB("GLSC")=".GLSC1"
		set %TAB("CLS")=".CLS3/TBL=[STBLCLS]"
		set %TAB("GRP")=".GRP1/TBL=[STBLGRP]GRP,DES:DISTINCT:QU ""[STBLGRP]CLS=<<CLS>>"""
		}
	else  do {
		set %TAB("GLSC")=".GLSC1/TBL=[UTBLGLSC]GLSC,DESC:DISTINCT"
		if %ProcessMode=2 set %TAB("IO")=$$IO^SCATAB($I)
		}

	set %READ="@@%FN,,,GLSC/REQ" 
	set %NOPRMT="N"
	if %ProcessMode=0 set %READ=%READ_",CLS/REQ,GRP/REQ"
	if %ProcessMode=2 set %READ=%READ_",IO/REQ"

	do ^UTLREAD 

	if VFMQ="Q" quit
	if %ProcessMode,'Db.isDefined("UTBLGLSC","GLSC=:GLSC") set ET="RECNOF" do ERR quit
	if '%ProcessMode,Db.isDefined("UTBLGLSC","GLSC=:GLSC") set ET="RECOF" do ERR quit

    	set fUTBLGLS=Db.getRecord("UTBLGLSC","GLSC=:GLSC",1)	

	quit


VPG01(RecordUTBLGLSC fUTBLGLS)	// Screen
	
	type Public String CLS,ER,GLSC,GRP,IO,VFMQ
	
	type String SID
	
	if %ProcessMode do {
		set CLS=fUTBLGLS.cls 
		set GRP=fUTBLGLS.grp
		}

	set SID=$S(CLS="D":"UTBLGLSCD",1:"UTBLGLSCL00")

	if %ProcessMode=2,IO'=$I do OPEN^SCAIO if ER set VFMQ="Q" quit

	set fUTBLGLS=Db.getRecord("UTBLGLSC","GLSC=:GLSC",1)	 			
	set fUTBLGLS.grp=GRP

	do fUTBLGLS.setAuditFlag(1)
 	      		
	do DRV^USID(%ProcessMode,SID,.fUTBLGLS)
	
	quit


ERR	//

	type Public String ER,VFMQ

	set ER=1 

	do DSPBP^UTLERR

	set VFMQ="Q"

	quit

	
VER(RecordUTBLGLSC fUTBLGLS)     //

	type Public String VFMQ

	if %ProcessMode=2!(%ProcessMode=4)!(VFMQ="Q") do END quit
	do FILE(.fUTBLGLS)
	
	do END 
 	
	quit


FILE(RecordUTBLGLSC fUTBLGLS)	// File data

	type Public String CLS,GLSC,GRP

	if %ProcessMode=0 do {
		set fUTBLGLS.cls=CLS
		set fUTBLGLS.grp=GRP
		}

	do fUTBLGLS.save()
	
	quit
	

END	//

	type Public String ER,GLSC,RM,VFMQ

	if (ER.get())!(%ProcessMode=2)!(%ProcessMode=4) quit  

	if VFMQ="Q" do {	
		// G/L set code ~p1 not created
		if %ProcessMode=0 do Runtime.setErrMSG("UTBLGLSC",1159,GLSC) quit:ER
		
		// G/L set code ~p1 not modified
		if %ProcessMode=1 do Runtime.setErrMSG("UTBLGLSC",1161,GLSC) quit:ER
		}
	else  do {
		// G/L set code ~p1 created
		if %ProcessMode=0 do Runtime.setErrMSG("UTBLGLSC",1156,GLSC) quit:ER
		
		// G/L set code ~p1 modified
		if %ProcessMode=1 do Runtime.setErrMSG("UTBLGLSC",1158,GLSC) quit:ER
		}
		
	set ER="W"
	
	quit

	

vSIG()	quit "59949^64200^Irina Kin^3732"	// Signature - LTD^TIME^USER^SIZE
