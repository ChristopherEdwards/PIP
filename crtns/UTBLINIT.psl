UTBLINIT /*
	 DESC: User Table Initialization
	
	---- Comments --------------------------------------------------------
	
	---- Revision History ------------------------------------------------
	12/10/06 - chhabris - CR23089
		   Converted M routine to PSL.
	----------------------------------------------------------------------	
	*/
	
	do INIT
	quit

INIT	// Initialization section
	type public Number %PG,%PAGE

	set %PG=0,%PAGE=1
	do VPG

	quit

VPG	//
	type public String VFMQ
	type public Number %PG
	type Boolean FINISH
	type String TABLE
	set TABLE=""

	set FINISH=0
	
	for  do { quit:FINISH
                if %PG=0 do VPG00 if VFMQ="Q" set FINISH=1 quit

                if %PG>0 do VPG01

                if "DFQ"[VFMQ do VER set FINISH=1 quit

		set %PG=%PG+1
                }
        quit
        
VPG00	// Set up

	type public Boolean ER
	type public String TABLE,VFMQ
	type String HDG1,HDG2,HDG3,%READ,%TAB,TABLE1()
	
	set %TAB("TABLE")=".TABLE3/TBL=TABLE1("
	
	// Caution, this function will reinitialize the selected user table
	set HDG1=$$^MSG("5354")
	
	// to its original state when it was released.  Any previous
	set HDG2=$$^MSG("5356")
	
	// modifications to this table will be overwritten.
	set HDG3=$$^MSG("5355")
	set %READ="@@%FN,,,@HDG1,@HDG2,@HDG3,,,TABLE/REQ"
	
	// Integrity Error Overrides
	set TABLE1("XBAD")=$$^MSG("5357")
	
	do ^UTLREAD if VFMQ="Q" set ER=1
	quit

	
VPG01	// Screen
	type public String TABLE
	type public String VFMQ
	
	do @TABLE
	set VFMQ="F"
	quit


XBAD	// Initialize UTBLINT, UTBLET tables
	
	type String CLS,DESC,ERR,GRP,GRP(),TABLE()
	
	type RecordUTBLET fUTBLET
	type RecordUTBLINT fUTBLINT
	
	set (CLS,GRP)="",TABLE("XBAD")=""
	
	type ResultSet rs = Db.select("CLS,GRP,DES","STBLGRP",,"CLS,GRP")
	while rs.next() do {
		set GRP(rs.getCol("GRP"))= rs.getCol("DES")
		}

	set ERR=""

	type ResultSet rs2 = Db.select("KEY,DESC","STBLXBAD")
	while rs2.next() do {
		set ERR = rs2.getCol("KEY")
	        set DESC = rs2.getCol("DESC")
	        
		set fUTBLET=Db.getRecord("UTBLET","KEY=:ERR",1)
		set fUTBLET.batch = 1
		set fUTBLET.online = 1
		do fUTBLET.save()

		for  set GRP=GRP(GRP).order() quit:GRP.isNull()  do {
											
			set fUTBLINT=Db.getRecord("UTBLINT","ETYPE=:ERR,UCLS='SCA'",1)
			set fUTBLINT.ucls="SCA"
			do fUTBLINT.bypassSave()	

			set fUTBLINT=Db.getRecord("UTBLINT","ETYPE=:ERR,UCLS='MGR'",1)
			set fUTBLINT.ucls="MGR"
			do fUTBLINT.bypassSave()
			}
		}	
	
	quit

VER	//
	type public Boolean ER
	type public String RM,TABLE,VFMQ

	if ER!(%ProcessMode=2)!(%ProcessMode=4) quit 
	
	set ER="W"

	// User table ~p1 not initialized
	if VFMQ="Q" set RM=$$^MSG("2866",TABLE)

	// User table ~p1 initialized
	else  set RM=$$^MSG("2865",TABLE)

	quit	
 #OPTION ResultClass ON
Public String vSIG()	quit "60614^7051^Sanjay Chhabria^2588"	// Signature - LTD^TIME^USER^SIZE
