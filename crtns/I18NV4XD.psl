public I18NV4XD //Delete All V4X Flags from DBTBL File
  /*
	ORIG: kumarb - 10/21/2005
	DESC: Delete All V4X Flags from DBTBL File

        CALLED BY:
            CALLS:
             DESC:	Deletes all VAL4EXT flags from DBTBL
			Reads file level DBTBL(1)
			If V4X, deletes then  goes to field level
			If V4X on field, deletes
       		
         GLOBALS -
             READ:	DBTBL
              SET:	DBTBL
        
            INPUT:
           OUTPUT:
        
        EXT ENTRY:
	
	-------- Revision History -----------------------------------------
	
	10/21/05 - KUMARB - CR 16921
		Converted to PSL.

	-------------------------------------------------------------------
	*/

	do NEW

	quit
	
NEW 	// Newing and setting

	type Number cnt
	type String file,VFMQ

	set file=""
	set cnt=0
	set VFMQ=""

	do SCREEN

	quit

SCREEN // Utlread Screen
	
	type public String VFMQ
	
	type Number logical	
	type String HDG1,HDG2,%READ,%TAB()
	
	set HDG1=$J(" ",26)_$$^MSG(5902)_$J(" ",26)
	set HDG2=$$^MSG(5903)
	set %TAB("logical")="/LEN=1/TYP=L/DES=Are you sure ?" 
	set %READ="@HDG1#1,,,@HDG2,,,logical#1" 
	do ^UTLREAD 
	if ("Q"[VFMQ)!(logical='1) do END quit
	
	do Main
	
	quit
	
Main	// Reading through ^DBTBL file level for V4X flag
	
	type public Number cnt
	type public String file
	
	type DbSet ds=Db.selectDbSet("DBTBL1","%LIBS='SYSDEV' AND VAL4EXT=1")
	while ds.next() do {
		type RecordDBTBL1 dbtbl1=ds.getRecord("DBTBL1")
		set file=dbtbl1.fid
		set dbtbl1.val4ext=0
		do dbtbl1.save()
		set cnt=cnt+1
		type DbSet ds1=Db.selectDbSet("DBTBL1D","%LIBS='SYSDEV' AND FID=:file AND VAL4EXT=1")
		while ds1.next() do {
			type RecordDBTBL1D dbtbl1d=ds1.getRecord("DBTBL1D")
			set dbtbl1d.val4ext=0
			do dbtbl1d.save()
			set cnt=cnt+1
			}
		}
	
	do END
	
	quit
	
END // Build return message and quit

	type public Number cnt
	type public String ER,RM

	// Number of DBTBL Records Deleted ~p1
	set ER="W",RM=$$^MSG(5464,cnt)

	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "60235^24984^Balasubramonian Sankar^1784"	// Signature - LTD^TIME^USER^SIZE
