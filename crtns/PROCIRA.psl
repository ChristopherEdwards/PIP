PROCIRA		/*
	   Revision History 

	   05/30/07 - DHANALAKSHMI R - CR25413
	              Modified the section AGE to use XBAD message RPAMAXAGE
	              instead of STBLMSG 1089. 

	   08/30/01 - ARCILLAZ - 47271
		      Moving IRA to IRAPROC. Obsoleting procedure definition
		      IRA in this version.

	   08/02/99 - CHOK - 33890
		      Converted procedure code to PSL.

	   12/17/97 - ARPAV - 27204
	              Modified section TRIGGER to prevent the call into the
	              routine IRA4.  This will allow SEP plans after 1/1/97.
	
	   01/03/97 - Bob Chiang - 23018
	              Modified TRIGGER section to process IRA type 4 (SEP)
	              logic in create mode only.
	
	   01/02/97 - CANFIELDS - 23018
	              Modified AGE section to compare max age with MAXPAR,
		      rather than MAXAGE.

	   LIBRARY
	   $$TRIGGER
	   $$RPASEQ
	   $$AGE
	   $$IRA7
	   $$ERR
	*/

	quit 
		
TRIGGER(CID,RecordDEP dep)
	/*
	   ARGUMENTS:
	
	   . CID  Deposit account number /TYP=N/REQ/MECH=VAL
	
	   INPUTS:
	   . TJD  System date  /TYP=D/DEF=[CUVAR]TJD
	
	   RETURNS:
	
	   . ER  Error flag
	   . RM  Error message
	
	*/

	// Need to be changed after Trigger converted to PSL

	if 'dep.ira quit                       // Not IRA account
	
	set ER=0

	if dep.rpaseq="" do Runtime.setErrMSG("DEP",1767,"DEP.RPASEQ") do ERR quit:ER        // Required

	do AGE(CID,.dep) quit:ER 
	
	do IRA7(CID,.dep) quit:ER 

	quit 
	
	
AGE(CID,RecordDEP dep)	// Validate minimum and maximum age
	// validate age range
	
	new age,dob,max,min,v,D,XIRATYP,ACN
	
	set XIRATYP=dep.ira
	if 'XIRATYP quit                       // Not IRA account
	set ACN=Db.getOneRow("ACN","ACN","CID")
	set dob=Db.getOneRow("DOB","CIF","ACN")
	if 'dob quit                           // Commercial CIF
	
	set age=$$^SCARND($$NOY^SCADAT(dob,%SystemDate,1),,,,2)        // Calc age
	
	//	Get min and max value
	set v=Db.getOneRow("MINAGE,MAXPAR","UTBLRSPDEF","XIRATYP")
	
	if 'v quit                            // Table not defined
	
	set min=$P(v,$C(9),1) set max=$P(v,$C(9),2)    // Age range
	
	if min'="",age<min do Runtime.setErrMSG("DEP",1088,min) do ERR quit:ER        // Less than min age
	
	// Plan owner's age exceeds maximum limit of ~p1
	if max'="",age>max do Runtime.setErrXBAD("DEP","RPAMAXAGE",max)
	
	quit 
	
	
IRA7(CID,RecordDEP dep)	// Provincial Jurisdiction required for IRA type 7 (LIF)
	
	if dep.ira'=7 quit                     // Not LIF type
	if dep.lifjur="" do Runtime.setErrMSG("DEP",1767,"DEP.LIFJUR") do ERR quit:ER        // Required
	quit 
	
	
ERR	// Error logic
	
	if $G(RM)'="",%ProcessMode'=2 set ER=1 quit    // Create/Modify mode
	quit 
 #OPTION ResultClass ON
Public String vSIG()	quit "60787^21200^Dhanalakshmi R^2534"	// Signature - LTD^TIME^USER^SIZE
