GLACN	/*	GL Account Maintenance

		ORIG:  Pete Chenard (6904) 4/26/89

	  ---- Revision History ------------------------------------------------
  	   09/02/02 - DATTAR - 49451
	              Converted to PSL

	  ----------------------------------------------------------------------	
	
	*/

NEW	//

	do INIT(0) 
	quit 


UPD	//

	do INIT(1)
	quit 


DEL	//

	do INIT(3)
	quit 
	

INIT(%ProcessMode) // 

	new OLNTB,VFMQ

	set %PG=0 
	set %PAGE=1
	type RecordGLAD fGLAD

	do VPG(.fGLAD)

	quit
	

VPG(RecordGLAD fGLAD) //Page control

	new FINISH
        set FINISH=0
        for  do { quit:FINISH
                if %PG=0 do VPG00 if ER set FINISH=1 quit

                if %PG>0 do VPG01(.fGLAD)

                if "DFQ"[VFMQ do VER(.fGLAD) set FINISH=1 quit

                set %PG=%PG+1
                }
        quit


VPG00   //Set up

	if '%ProcessMode set %TAB("ACN")=".ACN5/HLP=[GLAD]ACN/XPP=D PPACN^GLACN"
	else  set %TAB("ACN")=".ACN5/HLP=[GLAD]ACN/TBL=[GLAD]/XPP=D PPACN^GLACN"

	if %ProcessMode=2 set %TAB("IO")=$$IO^SCATAB($I)
	
	set %READ="@@%FN,,,ACN/REQ"
	if %ProcessMode=2 set %READ=%READ_",IO/REQ"

	do ^UTLREAD 

	if VFMQ="Q" set ER=1 quit 

	quit 
	

VPG01(RecordGLAD fGLAD)	//Screen

	set fGLAD=Db.getRecord("GLAD","ACN=:ACN",1)
	
	do DRV^USID(%ProcessMode,"GLACN",.fGLAD)

	quit 

	
PPACN	// Post processor on ACN

	// Account does not exist
	if %OSAVE=3!(%OSAVE=2),'Db.isDefined("GLAD","ACN=:X") do { quit
		set ER=1 
		set RM=$$^MSG(57) 
		}

	// Account already exists
	if '%OSAVE,Db.isDefined("GLAD","ACN=:X") set ER=1 set RM=$$^MSG(53)    

	quit 
	

VER(RecordGLAD fGLAD) //

  	if %ProcessMode=2!(%ProcessMode=4)!(VFMQ="Q") do END quit

	if %ProcessMode=3 do {
		do Db.delete("GLAD","ACN=:ACN")
		}
	else  do fGLAD.save()
	
	do END 

	quit

	
END	//

	if ER!(%ProcessMode=2)!(%ProcessMode=4) quit
	
	if VFMQ="Q" do {
		
		// Account ~p1 not created
		if %ProcessMode=0 set RM=$$^MSG(129,ACN) quit 

		// Account ~p1 not modified
		if %ProcessMode=1 set RM=$$^MSG(135,ACN) quit       

		// Account ~p1 not deleted
		set RM=$$^MSG(130,ACN)   
		}

	else  do {

		// Account ~p1 created
		if %ProcessMode=0 set RM=$$^MSG(107,ACN) quit  

		// Account ~p1 modified
		if %ProcessMode=1 set RM=$$^MSG(122,ACN) quit    

		// Account ~p1 deleted
		set RM=$$^MSG(109,ACN)       
		}

	set ER="W"

	quit 

 #OPTION ResultClass ON
Public String vSIG()	quit "59886^43518^Sanchez SCM Administrator^2155"	// Signature - LTD^TIME^USER^SIZE
