LNACRS	
	/*
	       ORIG:  Neal E. Gorman (5053) - 03/10/87
	       DESC:
	      INPUT:
	     OUTPUT:

	---- Revision History ------------------------------------------------
	30/11/05 - Radhika P CR 18279
		   .Modified ACT.exists() to ACT.get() which cause
		    %ACM to overridden with prodctl.payacm.
		   .Modified %ACT document to indicate pass by reference.		      
		   	
	05/25/05 - Carol Scott	CR 13236
		   Remove references to DQ screens in section ACRCLC.		
		   These screens will be obsoleted in version 6.4.
		   
	11/18/04 - TITOVE - CR 13197
		   Replaced XTYPE variable with reference to ln.type, to
		   prevent undefined. Added two new arguments to ACRCLS.
		   Removed several unused variables.

	12/18/03 - CARROLLJ - CR7239
		   Corrected compile errors.
	   			  
	07/25/02 - JANGIRA - 49451
		   Converted to PSL.
	 
	----------------------------------------------------------------------
	*/

ACRCLC(RecordLN ln,		// Loan object			/MECH=REFNAM:RW
       String %LNACR,		// Accrual Support Status Data	/MECH=REFNAM:W
       Number %ACM)		// Int Accrual Calc Method	/MECH=REFNAM:RW

	type public Boolean %PLDF, ACT, ER
	type public String RM
	type public String PCM
	
	type Boolean PLDF	
	type Number A
	
	type RecordPRODDFTL proddftl = Db.getRecord("PRODDFTL", "TYPE = :ln.type")
	
	// If Account Linkage Group is set, use account-level Payment 
	// Calculation Method, otherwise use product type default value
	if 'ln.acngrp.isNull() set PCM = ln.pcm
	else  set PCM = proddftl.pcm
	
	type RecordSTBLPCM stblpcm = Db.getRecord("STBLPCM", "KEY = :PCM")
	set PCM = stblpcm.pcmp		// Pmt Calc Method Parameter

	// Payoff - Include Payoff Date Flag
	set PLDF = ln.pldf

	type RecordPRODCTL prodctl = Db.getRecord("PRODCTL", "TYPE = :ln.type")
	
	if ACT.get() = 1 do {
		if 'prodctl.aacm.isNull() set A = prodctl.aacm, %ACM = A
		else  set A = %ACM
		set PLDF = 1
	}

	do { quit:ER

		type String SID

		set %PLDF = PLDF

		// Simple Interest Loans
		if ('%ACM) ! ('PCM.extract(2)) do OL^LNACR0(.ln) quit

		// Amortized loans (%ACM = 1,2 or 4)
		if (%ACM < 3) ! (%ACM = 4) do OL^LNACR1(.ln) quit

		// Add-on/Discount Loan
		if (%ACM = 3) do { quit
			type RecordLNACR3 lnacr3 = Db.getRecord("LNACR3", "EFD = :%EffectiveDate, GRP = :ln.grp, TYPE = :ln.type, CID = :ln.cid", 1)
			do OL^LNACR3(.ln, .lnacr3)
		}

		// Invalid payoff accrual method ~p1
		set ER = 1 set RM = $$^MSG("1424", %ACM)
	}
	
	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "60235^22151^Radhika Panchanathan^2334"	// Signature - LTD^TIME^USER^SIZE
