OVR	//System-generated Restriction Maintenence
	/*
	       ORIG:

	  ---- Revision History ------------------------------------------------

          07/27/05 - SkariahV- CR16679
	             Removed #WARN and #OPTIMIZE directives.
	

	  05/26/04 - KELLYP - CR 8493
		     Added this procedure to source control.  Also cleaned
		     up procedure and brought it into compliance with newer
		     standards.

          07/08/02 - SRIVASTAVAN - 49451
                     Converted to PSL           

	 ----------------------------------------------------------------------
	*/


UPD	//

	do INIT(1)

      	quit

 
INQ	//

	do INIT(2)

      	quit


INIT(%ProcessMode)	//

	type String OLNTB,VFMQ
	type Number %PAGE,%PG

	set %PG=0
        set %PAGE=1

	type RecordUTBLOVR fUTBLOVR
	type RecordOVRLIT fOVRLIT

	do VPG(.fUTBLOVR,.fOVRLIT)
       	
	quit


VPG(RecordUTBLOVR fUTBLOVR,RecordOVRLIT fOVRLIT)	// Page control

	type Number FINISH
	type Public Number ER,%PG
	type Public String VFMQ

	set FINISH=0
	for  do { quit:FINISH
	        if %PG=0 do VPG00 if ER!(VFMQ="Q") set FINISH=1 quit
                
        	if %PG>0 do VPG01(.fUTBLOVR,.fOVRLIT)
	
		if "DFQ"[VFMQ do VER(.fUTBLOVR) set FINISH=1 quit
        	
		set %PG=%PG+1      
		}
        quit

	
VPG00	// Set up

	type String %READ,%TAB
	type Public String VFMQ

	set %TAB("GRP")=".GRP1/TBL=[STBLLIBS]"

	set %TAB("OVR")=".OVR1/TBL=[UTBLOVR]/XPR=D CHECK^OVR(GRP)"
	set %READ="@@%FN,,,GRP/REQ,OVR/REQ"
	
	do ^UTLREAD 

	if VFMQ="Q" quit

        // set KEYL(1)="OVR"
        // set KEYL(3)=OVR

        quit	


VPG01(RecordUTBLOVR fUTBLOVR,RecordOVRLIT fOVRLIT)	// Restrict screen

	type Public String GRP,OLNTB,OVR,SAVTR

	kill OLNTB,SAVTR
	set fUTBLOVR=Db.getRecord("UTBLOVR","GRP=:GRP,OVR=:OVR",1)
	set fOVRLIT=Db.getRecord("OVRLIT","OVR=:OVR",1)
	
	do DRV^USID(%ProcessMode,"UTBLOVR1",.fUTBLOVR,.fOVRLIT)
	
	quit


VER(RecordUTBLOVR fUTBLOVR)     //

	type Public String VFMQ

	if %ProcessMode=2!(VFMQ="Q") do END quit

	do fUTBLOVR.save()

	do END
        
	quit


END	//

	type Public Number ER
	type Public String RM,VFMQ

	if ER!(%ProcessMode=2) quit  

	// System-generated restriction not modified
	if VFMQ="Q" set RM=$$^MSG(2577)
	
	// System-generated restriction modified
	else  set RM=$$^MSG(2576)

	set ER="W"

	quit


OVRDESC(TEMP,OVR)	// Get description based on the class	

	type String CLS,DESC,ER

	set ER=0
	set DESC=""	

	type RecordOVRLIT ovrlit=Db.getRecord("OVRLIT","OVR=:OVR")
	set DESC(1)=ovrlit.desc1
	set DESC(2)=ovrlit.desc2
	set DESC(3)=ovrlit.desc3
	set DESC=ovrlit.desc

	if TEMP="*" quit DESC(2)

	type ResultSet rs=Db.select("CLS","STBLGRP","GRP=:TEMP")
	if rs.next() do {
		set CLS=rs.getCol(1)
		if CLS="D" quit
		else  if CLS="L" set DESC=DESC(1)
		else  if CLS="M" set DESC=DESC(3)
		}

	quit DESC


CHECK(GRP)	//

	type String DATA,DESC
	type Number POS
	type Public Number ER
	type Public String OVRLOOK,RM

	kill OVRLOOK

	set DESC=""
	set POS=0
        set ER=0
        set RM=""

	do CHECK01(GRP)

	// Invalid option
   	if POS=0 set ER=1,RM=$$^MSG(1411) quit

	type ResultSet rs=Db.select("DESC,DESC1,DESC2,DESC3,OVR","OVRLIT")

	// Invalid option
	if rs.isEmpty() set ER=1,RM=$$^MSG(1411) quit
        else  do {
		  while rs.next() do {
			set DATA=rs.getRow()
	    		set DESC=DATA.piece($C(9),POS)
		        if DESC="" quit
			set OVRLOOK(DATA.piece($C(9),5))=DESC
	    		}
		 }
	quit	


CHECK01(GRP)	//

	type String CLS
	type Public Number POS

	if GRP="*" set POS=3 quit

	type ResultSet rs=Db.select("CLS","STBLGRP","GRP=:GRP")
	if rs.next() do {
		set CLS=rs.getCol(1)
		if CLS="D" set POS=1
		else  if CLS="L" set POS=2
		else  if CLS="M" set POS=4
		}
	quit

vSIG()	quit "60108^21025^Viji Skariah^3424"	// Signature - LTD^TIME^USER^SIZE
