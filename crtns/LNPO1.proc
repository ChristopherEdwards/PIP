LNPO1	 /* 
    ORIG: GRAY - 02/02/2000
    DESC: Loan Payoff Status
    
    ---- Comments --------------------------------------------------------
    
    ---- Revision History ------------------------------------------------
   
	  09/10/2003 - CARROLLJ - 51630
		     Removed resultset on LNCYC and changed call to RB^LNPO2 to
		     PREREB^LNPO2.

	  02/12/2003 - CARROLLJ - 51349
		     Removed the use of the to and from array's for transaction
		     processing to PSL.

	  2/1/2000 - GRAY - 32507
		     Removed code no longer needed due to the Elimination
		     of Teller/Branch Character Interface and placed remaining
		     code into PSL'd procedure definition.

 */
	
	quit
	
	
Public EXT	//
	/*
	External line tag for MRPC078, Loan Payoff Status, and MRPC079,
	Loan Rebate Support Status.  Prior to calling this line tag
	variables PAMT (Negotiated Prepayment amount),
	OPCHG (Other Payoff Charges), and EFD (Payoff Effective Date)
	need values.
	*/
	new ln,ACN,BAL,EPPENDAT,PPDPL,PPF,PYTD,TYPE
	type RecordLN ln=Db.getRecord("LN","CID")
	
	set PPF=ln.ppf			// loading of node 49
	set TYPE=ln.type		// loading of node 50

	set BAL=ln.bal			// loading of node 51
	set PYTD=ln.pytd		// loading of node 55
	set PPDPL=ln.ppdpl		// loading of node 56
	set EPPENDAT=ln.eppendat	// loading of node 71
	set ACN=ln.acn			// loading of node 99
	
	new ACR,AMBAS,BNDT,BOO,DIP,DISAPR,IRN,PMTDIST,PVAR
	
	set BOO=ln.boo			// loading of node 52
	set AMBAS=ln.ambas		// loading of node 53
	set ACR=ln.acr			// loading of node 54
	set IRN=ln.irn			// loading of node 57
	set PVAR=ln.pvar		// loading of node 58
	set PMTDIST=ln.pmtdist		// loading of node 64
	set DISAPR=ln.disapr		// loading of node 66
	set DIP=ln.dip			// loading of node 70
	set BNDT=ln.bndt		// loading of node 101
	set ln.opchg=+OPCHG
	
	set CNT=0
	set %GRBF=""
	set PREREB=0
	do PREREB^LNPO2(.ln)
	
	// Remove any add-ons which are not being rebated to the borrower
	
	set T=""
	for  set T=$O(RB(CID,T)) quit:T=""  if '$P(RB(CID,T),"|",7) kill RB(CID,T) set CNT=CNT-1
	for  set T=$O(RB1(CID,T)) quit:T=""  if '$P(RB1(CID,T),"|",7) kill RB1(CID,T)
	
	set N=0
	for  quit:$O(RB1(CID,N))=""  set N=N+1 if '$D(RB1(CID,N)) do {
		set X=$O(RB1(CID,N)),RB1(CID,N)=RB1(CID,X)
		kill RB1(CID,X)
		}
	quit

vSIG()	quit "59886^43539^Sanchez SCM Administrator^2180"	// Signature - LTD^TIME^USER^SIZE
