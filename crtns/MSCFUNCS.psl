MSCFUNCS		//Library;Miscellaneous Filer Functions
	/*
	   ORIG: HILLANBRAND - 05/01/96
	
	   Miscellaneous Filer Functions.
	   Note that thess functions are for private use by filers only.
	
	   KEYWORDS:
	
	   LIBRARY:
	   . STMGRP   - Comment field for statement group (create)
	   . TCMT     - Comment field for statement group (modify)
	   . GLFLTR   - GL set code filter
	   . GRP      - Return group
	   . HISTBLD  - Common call to file history
	   . TCMTFM   - Comment field for maintenance
	   . RAMT     - Remittance amounts per remittance date

	   Revision History
	   
	   03/13/06 - Skariahv - CR19599
		      Modified CMBSTMVF section for account verification.
	   
	   10/26/05 - RussellDS - CR17834
 		      Replaced call to EXT^DBSFILER with direct calls to the
 		      filers.
 		      
 		      Fixed scope warnings.

	   01/13/00 - CHOK - 31126
		      Change CMBSTFIL call to DBSFILER
 
	   09/20/99 - CHOK - 31126
		      Converted to PSL

	   09/23/97 - LAMY - ARQ25913
	              Added a check in CMBSTMVF section to set an integrity
		      if STMGRP equals null.
	*/

	quit                                   // Do not enter from top

STMGRP(STMGRP)
	/*
	   Returns appropriate comment field (TCMT) for creation of
	   statement group for journal of CMBCID
	
	   ARGUMENTS:
	         . STMGRP Statement Group		/TYP=N/REQ
	
	   RETURNS:
	         . $$            Comment field		/TYP=T
	
	   EXAMPLE:
	         S X=$$STMGRP^DEPFUNCS(CMBGRP.STMGRP)
	*/

	quit "[CMBGRP]STMGRP:"_$$^MSG(4832,STMGRP)_":"_$$^MSG(7054)    //Group ~p1
	
TCMT(key,table,column,old,new,grp)
	/*
	   Returns appropriate comment field (TCMT) for file maintenance
	   activity for use by the LN file journal for DTJFM
	
	   ARGUMENTS:
	   . key  Account number or	/TYP=T/REQ
	     customer number
	
	   . table  Table name		/TYP=T/REQ
	
	   . column Column name		/TYP=T/REQ
	
	   . old  Old value		/REQ
	
	   . new  New value		/REQ
	
	   . grp  Statement group	/TYP=T/REQ
	
	   RETURNS:
	   . $$  Comment field		/TYP=T
	
	   EXAMPLE:
	   S X=$$TCMT^MSCFUNCS(CID,"CMBGRP","IRN",12,13,56565)
	*/
	
	new TCMT
	set TCMT=key_"["_table_"]"_column_":"_old_":"_new	// Comment
	set TCMT=$$^MSG(3156,TCMT,grp)         			//~p1:Group ~p2
	quit TCMT
	
RAMT(REMND,OLDREMND,CID,TYP,FRE,OLD,NEW)
	/*
	   Called by After Update Trigger AU_REMDT by the TRTYPE filer routine
	   when remittance next date or borrower remittance frequency is
	   updated.  The OLD and NEW arrays will be passed back to the trigger
	   so the trigger knows the rows of RAMT that should be deleted and
	   inserted.
	*/
 
	new JD,N
	set JD=REMND
	set N=OLDREMND
	if JD<N set N=REMND
	if FRE=""!('JD) quit 
	set N=N-1
	for  set N=Db.nextKey("RAMT","CID,TYP,N") quit:'N  set OLD(N)=Db.getOneRow("REMAMT,ESTFLG","RAMT","CID,TYP,N")
	for  set N=$O(OLD(N)) quit:'N  do {
		set NEW(JD)=OLD(N)
		set JD=$$NJD^UFRE(JD,FRE)
		}
	quit 
	
CMBSTMVF(CID)
	/*
	   Called by both the deposit and loan filer After Trigger to run
	   verification of the statement groups attached to a account. This
	   coding is required for batch processing generally associated with
	   conversion processing.
	*/

	type Number ACN, STMGRP, XCID

	set XCID=CID

	type ResultSet rs=Db.select("STMGRP,ACN","CMBCID","CID=:XCID")

	while rs.next() do {
		set STMGRP=rs.getCol(1)
		set ACN=rs.getCol(2)
		
		// Account in Statement Group Does Not Exist		
		if STMGRP="" do Runtime.setErrXBAD("CIF","CIFSTMCID") quit

		// ACN,CID,STMGRP are required for verification
		type RecordCMBSTM cmbstm = Db.getRecord("CMBSTM", "ACN=:ACN,STMGRP=:STMGRP,CID=:CID",1)

		// Account in Statement Group Does Not Exist
		if cmbstm.getMode()=0 do Runtime.setErrXBAD("CIF","CIFSTMCID") quit
		
		do cmbstm.setMode(2)
		do ^CMBSTFIL(.cmbstm)
	}
	
	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "60351^36098^Viji Skariah^3570"	// Signature - LTD^TIME^USER^SIZE
