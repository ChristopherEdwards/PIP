UBAL06
	/*
	ORIG:  Neal E. Gorman
	
	----- Revision History -----------------------------------------------
	
	09/26/06 - Ravindra Rathi - CR 22011
	           Modified the END section to add the VFMQ'=1 check  
	           so that the UBAL06A report does not get executed when 
	           the output is directed to the screen.
	
	06/03/06 - SmithCD - CR 21450
		   Removed QUIT variable since it serves no purpose in p04.
		   Additional minor cleanup.

	03/20/06 - KinI - CR 20108
	   	   Modified TYPE section to restore UTBLCRCDX processing.
		   
	01/15/05 - RussellDS - CR13817
		   Correct call to report.  Clean up PSL warnings.
		   
		   Removed old revision history.
		   
	----------------------------------------------------------------------

	*/
	
	type public Boolean ER
	
	type Boolean SIN
	type Date %EffectiveDate
	type Number %NOPRMT, %PAGE, %PG, CID, MAXL, OLNTB, PN, TYPE
	type String %ED, %READ, %TAB(), CLS, CRCD, DTJ, GRP, IO, RID
	type String VFMQ, VRWOPT()

	set %ED = %SystemDate.toString()
	set %EffectiveDate = %SystemDate - 1 
	set MAXL = 4

	set %PG = 0
	set %PAGE = 1
	set %ProcessMode = 0
	set %NOPRMT = "C"

	set PN = 1

	for  if %PG < 2 do {  quit:%PG.get().isNull() ! (VFMQ = "Q")
		if %PG = 0 do { quit:VFMQ = "Q"
			
			set %TAB("IO") = $$IO^SCATAB($I)
			set %TAB("EFD") = ".EFD1"
			set %TAB("SIN") = ".SIN1"
	
			set %READ = "@@%FN,,,IO/REQ,EFD/REQ,SIN/REQ"
			do ^UTLREAD
			}
		
		if %PG = 1, SIN = 1 do {
			set %PG = 1
			do {
				// Screen - Single Account
				set OLNTB = 6000
				set %TAB("SIN1") = ".CID1/XPP=set %EXT=1 do ^UACN"
				set %READ = "SIN1/REQ"
				do ^UTLREAD
				}
			}
		else  if %PG = 1 do {
			
			// Screen - Product Type
			type String CRCDARRY()

			set OLNTB = 6000
			set CRCD = %SystemCurrency
			set %TAB("TYPE") = ".TYPE2/TBL=[PRODCTL]/XPP=D TYPE^UBAL06"
			set %TAB("CRCD") = ".CRCD1/HLP=[DEP]CRCD/TBL=CRCDARRY("
			set %TAB("DTJ") = ".DTJ1/XPP=I 'X set %PG=%PAGE"

			#if CUVAR.%MCP
				set %READ = "TYPE/REQ,CRCD/REQ,DTJ/REQ"
			#ELSE
				set %READ = "TYPE/REQ,DTJ/REQ"
			#ENDIF

			do ^UTLREAD
			}
			
		if "DFQ".isLike("%"_VFMQ_"%") do {
			
			if (VFMQ = "Q") do END quit
			
			if SIN do {
				
				type RecordACN acn = Db.getRecord("ACN", "CID=:CID")
				set TYPE = acn.type
				set CRCD = acn.crcd
				set DTJ = ""
				set CLS = acn.cls
				}
			else  do {
				
				type RecordPRODCTL prodctl = Db.getRecord("PRODCTL", "TYPE=:TYPE")
				set CLS = prodctl.cls
				set GRP = prodctl.grp
				}
			
			if IO '= $I do OPEN^SCAIO quit:ER
	
			set RID = "SCA192"
			do ^URID

			// Invalid report linkage <<RID>>
			if ER do { quit
				type String ET = "INVLDRPT"
				do ^UTLERR
				}
	
			set VRWOPT("NOOPEN") = 1
			set VRWOPT("NOCLOSE") = 1
			do V0^@PGM

			do END
			}

		else  set %PG = %PG + 1
		}
	
	quit 
	

ERR	
	type public Boolean ER = 1
	type public String VFMQ

	do ^UTLERR
	
	quit 
	
	
VER	
	quit
	
TYPE
	type public String CRCDARRY()
	
	#if CUVAR.%MCP.isNull() quit 
	
	type ResultSet rs = Db.select("CRCD,DESC", "CRCD,UTBLCRCDX")	
	while rs.next() set CRCDARRY(rs.getCol("CRCD")) = rs.getCol("DESC")

	quit 
	
END

	type public Boolean ER, SIN
	type public Date EFD
	type public String IO, TYPE, VFMQ
	
	if '((VFMQ = "Q")!(VFMQ = 1)), 'SIN.get() & (TYPE.get() > 0) do {
		
		type String ET, PGM, RID, VIN1, VRWOPT()
		
		set RID="UBAL06A"
		do ^URID
		
		// Invalid report linkage <<RID>>
		if ER do { quit
			type String ET = "INVLDRPT"
			do ^UTLERR
			}
	
		set VRWOPT("NOOPEN") = 1
		set VRWOPT("NOCLOSE") = 1
		set VIN1 = EFD				// Report input
		do V0^@PGM
		}
	
	if (IO '= $P) do CLOSE^SCAIO

	quit 
 #OPTION ResultClass ON
Public String vSIG()	quit "60541^23494^Ravindra Rathi^3418"	// Signature - LTD^TIME^USER^SIZE
