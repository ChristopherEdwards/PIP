public MRPC085(return,versn,accts,primflgs,acn,crdnum,crdtyp)
        /*
        Procedure ID: MRPC085
        DESC: Card/Account Validation
        KEYWORDS: RPC,Card
 
        ARGUMENTS:
		. return	Validation Error Message  /TYP=N/REQ/MECH=REFNAM
				Null= No Validation Error

		. versn		^MRPC084 version number   /TYP=N/REQ/MECH=VAL
				current version=1
 
		. accts		Accounts Linked		  /TYP=T/REQ/MECH=VAL
				- list of all accounts linked to the card

		. primflgs	Primary account flags	  /TYP=T/REQ/MECH=VAL
				- list of primary account flags that correspond
				to the above list of accounts in the same order

				0 = Not a Primary Account
				1 = Primary Account

		. acn		Customer Number		  /TYP=T/REQ/MECH=VAL
				- CIF number linked to card

		. crdnum	Card Number		  /TYP=T/REQ/MECH=VAL

		. crdtyp  	Card Type		  /TYP=T/REQ/MECH=VAL
 
	RETURNS:
                . $$		Error Message		  /TYP=T
				Null= No Error
 
	RELATED:
		. $$^PBSMRPC - MRPC Service Class Driver
 
        EXAMPLE:
                S RM=$$^MRPC085(.return,1,"1111,2222","1,0","1234","9999","ATM")
 
	---- Revision History ------------------------------------------------

	07/31/06 - KELLYP - CR 22048
		   Modified to eliminate PRECEDENCE warnings and cleaned up
		   procedure.
		   
	12/12/03 - CARROLLJ - CR7239
		   Added #ACCEPT prior to xecute command to correct compile
		   errors.

	02/17/00 - Carrie Baildon - 37002
		   Retrieve the card/account validation subroutine out of
		   CUVAR and execute it rather than calling CMSAVAL directly.
		   Some clients may not wish to use the rules in CMSAVAL or
		   may wish to specify their own instead.

	----------------------------------------------------------------------
        */ 
 	// Ensure version number is compatible with server
 	if $G(versn)'=1 quit $$ERRMSG^PBSUTL($$^MSG(2951))

 	new str,xaccts,xacn,xcrdnum,xcrdtyp,pgm,excmnd

 	// Ensure parameters are not null, then parse out accts and primflags
 	if ((accts.get().isNull())!(primflgs.get().isNull())!(acn.get().isNull())!(crdnum.get().isNull())!(crdtyp.get().isNull())) set return=""
 	else  do {	
		for cntr=1:1 quit:($P(accts,$C(9),cntr)="")  do {
			set xaccts($P(accts,$C(9),cntr))=$P(primflgs,$C(9),cntr)
			}
 		set xacn=acn
		set xcrdtyp=crdtyp
		set xcard=crdnum
	
		set pgm=CUVAR.cmsavalr
		if pgm="" set str=""
		else  do {
			set excmnd="set str=$$^"_pgm_"(.xaccts,xcard,xcrdtyp,xacn)"
			#ACCEPT DATE=12/12/03;PGM=John Carroll;CR=7239
			xecute excmnd
			}
	
 		}
 
 	if RM.get()!ER.get() quit $$ERRMSG^PBSUTL(RM.get())
 
 	set return=$$V2LV^MSG($G(str))
 
 	quit ""

vSIG()	quit "60477^65456^Pat Kelly^2440"	// Signature - LTD^TIME^USER^SIZE
