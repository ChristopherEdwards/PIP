DEPIADJ		/*
	   ORIG: ESTERLYP - 03/08/99
	   DESC: Defer Posting Interest Adjustments - file deferred

	---- Revision History -------------------------------------------------
	
	08/15/05 - SmithCD - CR 16724
		   . Removed all non-public sections into BCHINTPOST
		   . Conform to current PSL standards
		   . Removed old revision history

	01/12/04 - CARROLLJ - CR7901
		   Corrected parameter mismatch error.

	*/

	quit


public EXT(RecordDEP dep,		// Deposit account		/REF:RW
	   Boolean CTL,			// Control indicator		/NOREQ
	   Number TPOSINT,		// Total def positive interest	/REF:W
	   Number TNEGINT,		// Total def negative interest	/REF:W
	   Number TRESINT,		// Total def residual interest	/REF:W
	   Number TBWA)			// Total def withholding	/REF:W

	/*
	Execute deferred int posting

	External entry point for posting deferred interest. Called by
	closeout processing.

	Additional notes on ARGUMENTS:

	   . CTL	No longer needed

	   EXAMPLE:

	   do EXT^DEPIADJ(.dep, , .DPOSINT, .DNEGINT, .DRESINT, .DBWA) quit:ER
	*/
	
	type public Number BRCD, CID
	type public Boolean ER
	
	do EXTERN^BCHINTPS(CID, , .dep) quit:ER

	quit


public DEFINADJ(RecordDEFINP definp,	// Deferred interest posting	/REF:RW
		Number POSINT,		// Positive interest amount
		Number NEGINT,		// Negative interest amount
		Number RESINT,		// Residual interest amount
		Number BWA)		// Backup withholding amount

	// Move current deferred to paid

	if POSINT do {
		set definp.dcur = definp.dcur - POSINT
		set definp.dpaid = definp.dpaid + POSINT
		}

	if NEGINT do {
		set definp.dcurneg = definp.dcurneg - NEGINT
		set definp.dpaidneg = definp.dpaidneg + NEGINT
		}

	if RESINT set definp.respost = definp.respost + RESINT

	if BWA do {
		set definp.awcd = definp.awcd - BWA
		set definp.awpd = definp.awpd + BWA
		}
		
	do definp.bypassSave()

	quit


public	TSODEF(Number POSTING,		// Posting type
       	       Date INP)		// Posting date
       
	/*
	   POS: 0 / 1 - Posting positive deferred
	        2 - Posting negative deferred
	*/
	
	type public String TSO

	type Number AMT, SEQ
	type String DEFINT

	set TSO = "NOADJ#1"
	set DEFINT = ""

	type ResultSet rs = Db.select("SEQ,POSINT,NEGINT", "DEFDTL", "CID=:CID AND INP=:INP")

	while rs.next() do {

		set SEQ = rs.getCol("SEQ")

		if 'POSTING = 2 set AMT = rs.getCol("NEGINT")
		else  set AMT = rs.getCol("POSINT")

		if 'AMT quit

		if DEFINT.isNull() set DEFINT = SEQ_":"_AMT
		else  set DEFINT = DEFINT_","_SEQ_":"_AMT
		}

	set TSO = $$FIELDIN^UTSO(TSO, "DEFINT", DEFINT)

	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "60128^63276^Chad Smith^2406"	// Signature - LTD^TIME^USER^SIZE
