V01S237(%ProcessMode,RecordDEAL1 fDEAL1)   // -  - SID= <DEAL1SI1> Deal Settlement Instruction Screen 1
 ;;Copyright(c)2007 Sanchez Computer Associates, Inc.  All Rights Reserved - 01/31/2007 11:53 - shetyes
  /*
ORIG: CHENARDP - 03/03/2003
DESC: PSL Screen Compiler Template

---- Comments --------------------------------------------------------
	This procedure is used as the base template for the PSL screen compiler.
	It is referenced by the PSL screen compiler - procedure DBS2PSL4
	
	
---- Revision History ------------------------------------------------
	02/23/06 - Pete Chenard - CR19551
		   Fixed routine label.
		   
	05/19/05 - Pete Chenard - CR 14146
		   Modified to type variables.
		   
	12/1/03 - Spier -cr7178
	   	     Modifications to correct dead code warnings and
	   	     other issues that occurred during mass compile of screens.

	09/24/03 - Pete Chenard - 45497
		       Created screen template for compiler.
----------------------------------------------------------------------

 */

 #WARN SCOPE OFF
	type Public String %MODS,%PAGE,%PG,%REPEAT,ER,RM
	type String KEYS(),KVAR,VFSN(),VO,VODFT,VPGM,vPSL,VSID,VSNAME

	// %O (0-Create  1-Modify  2-Inquiry  3-Delete  4-Print  5-Blank screen)

	set:'$D(%ProcessMode) %ProcessMode=5
 set KVAR="kill %TAB,VFSN,VO,VPTBL,vtab",VSID="DEAL1SI1",VPGM=$T(+0),VSNAME="Deal Settlement Instruction Screen 1"
 set VFSN("DEAL1")="zfDEAL1"
 set vPSL=1
 set KEYS(1)=fDEAL1.NOINT
 //
	// ==================== Display blank screen         (%O=5)

 if %ProcessMode=5 do VPR(.fDEAL1),VDA1(.fDEAL1),^DBSPNT()

 if '%ProcessMode do VNEW(.fDEAL1),VPR(.fDEAL1),VDA1(.fDEAL1)
 if %ProcessMode do VLOD(.fDEAL1) quit:$G(ER)  do VPR(.fDEAL1),VDA1(.fDEAL1)

	// ====================  Display Form
	do ^DBSPNT()
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	if %ProcessMode=2!(%ProcessMode=3) do ^DBSCRT8A X:'$D(%PAGE) KVAR quit  // Inquiry/Delete
	// ====================  Set up data entry control table


 if %ProcessMode<2 do VTAB(.fDEAL1)
	quit


VNEW(RecordDEAL1 fDEAL1) // Initialize arrays if %O=0
 
 do VDEF(.fDEAL1)
 do VLOD(.fDEAL1)
 #ACCEPT Date=11/5/03;PGM=Screen Compiler
 quit
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit
	
VDEF(RecordDEAL1 fDEAL1)
 if fDEAL1.EDT="" set fDEAL1.EDT=TJD
 if fDEAL1.MT202PRI="" set fDEAL1.MT202PRI="N"
 if fDEAL1.MT210PRI="" set fDEAL1.MT210PRI="N"
 if fDEAL1.MT300PRI="" set fDEAL1.MT300PRI="N"
 if fDEAL1.STATUS="" set fDEAL1.STATUS=2
 if fDEAL1.TDT="" set fDEAL1.TDT=TJD
 #ACCEPT Date=11/5/03;PGM=Screen Compiler
 quit
 ;
VLOD(RecordDEAL1 fDEAL1) // Load data from disc - %O = (1-5)
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit


	type Public String %MODS,%REPEAT
	quit
	

VPR(RecordDEAL1 fDEAL1) // Display screen prompts
 set VO="17||13|"
 set VO(0)="|0"
 set VO(1)=$C(2,4,14,0,0,0,0,0,0,0)_"01T Instructions:"
 set VO(2)=$C(2,19,3,2,0,0,0,0,0,0)_"01TPay"
 set VO(3)=$C(2,38,13,0,0,0,0,0,0,0)_"01T Beneficiary:"
 set VO(4)=$C(3,10,8,0,0,0,0,0,0,0)_"01T Amount:"
 set VO(5)=$C(3,41,10,0,0,0,0,0,0,0)_"01T Currency:"
 set VO(6)=$C(5,1,16,0,0,0,0,0,0,0)_"01TPayable to (57):"
 set VO(7)=$C(5,30,4,1,0,0,0,0,0,0)_"01TOpt:"
 set VO(8)=$C(10,9,9,0,0,0,0,0,0,0)_"01T Account:"
 set VO(9)=$C(11,10,8,1,0,0,0,0,0,0)_"01T Nostro:"
 set VO(10)=$C(11,36,15,0,0,0,0,0,0,0)_"01T Paid by (53A):"
 set VO(11)=$C(13,1,15,0,0,0,0,0,0,0)_"01TInter (S) (56):"
 set VO(12)=$C(13,30,4,0,0,0,0,0,0,0)_"01TOpt:"
 set VO(13)=$C(18,2,15,0,0,0,0,0,0,0)_"01TRec Corr (54A):"
 set VO(14)=$C(18,29,5,0,0,0,0,0,0,0)_"01T Opt:"
 set VO(15)=$C(22,6,12,1,0,0,0,0,0,0)_"01T DS1 Symbol:"
 set VO(16)=$C(23,6,12,1,0,0,0,0,0,0)_"01T DS2 Symbol:"
 set VO(17)=$C(23,34,17,0,0,0,0,0,0,0)_"01T Constant Symbol:"
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit


VDA1(RecordDEAL1 fDEAL1)  // Display screen data
 new V
 //
 set VO="48|18|13|"
 set VO(18)=$C(1,1,80,1,0,0,0,0,0,0)_"01T"_$S(%ProcessMode=5:"",1:$$BANNER^DBSGETID($G(%FN)))
 set VO(19)=$C(2,52,20,2,0,0,0,0,0,0)_"01T"_$E(fDEAL1.ACNNAM,1,20)
 set V=$S(fDEAL1.AMTS="":"",1:$J(fDEAL1.AMTS,0,2)) set VO(20)=$C(3,19,19,2,0,0,0,0,0,0)_"01$"_$S(fDEAL1.AMTS="":"",1:$J(fDEAL1.AMTS,0,2))
 set VO(21)=$C(3,52,3,2,0,0,0,0,0,0)_"01T"_$E(fDEAL1.CRCDS,1,3)
 set VO(22)=$C(5,18,11,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.PAYTOS,1,11)
 set VO(23)=$C(5,35,1,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.PAYTOSOPT,1,1)
 set VO(24)=$C(5,39,40,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.PAYTOS1,1,40)
 set VO(25)=$C(6,39,40,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.PAYTOS2,1,40)
 set VO(26)=$C(7,39,40,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.PAYTOS3,1,40)
 set VO(27)=$C(8,39,40,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.PAYTOS4,1,40)
 set VO(28)=$C(9,39,40,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.PAYTOS5,1,40)
 set VO(29)=$C(10,19,20,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.PDTOCIDS,1,20)
 set VO(30)=$C(11,19,12,2,0,0,0,0,0,0)_"00N"_fDEAL1.NOSTROS
 set VO(31)=$C(11,52,11,2,0,0,0,0,0,0)_"01T"_$E(fDEAL1.PAIDBYS,1,11)
 set VO(32)=$C(12,52,25,2,0,0,0,0,0,0)_"01T"_$E(fDEAL1.CORREDSC,1,25)
 set VO(33)=$C(13,18,11,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.INTERS,1,11)
 set VO(34)=$C(13,35,1,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.INTERSOPT,1,1)
 set VO(35)=$C(13,39,40,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.INTERS1,1,40)
 set VO(36)=$C(14,39,40,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.INTERS2,1,40)
 set VO(37)=$C(15,39,40,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.INTERS3,1,40)
 set VO(38)=$C(16,39,40,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.INTERS4,1,40)
 set VO(39)=$C(17,39,40,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.INTERS5,1,40)
 set VO(40)=$C(18,18,11,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.RECVCORR,1,11)
 set VO(41)=$C(18,35,1,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.RECVCORROPT,1,1)
 set VO(42)=$C(18,39,35,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.RECV1,1,35)
 set VO(43)=$C(19,39,35,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.RECV2,1,35)
 set VO(44)=$C(20,39,35,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.RECV3,1,35)
 set VO(45)=$C(21,39,35,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.RECV4,1,35)
 set VO(46)=$C(22,19,10,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.DS1S,1,10)
 set VO(47)=$C(23,19,10,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.DS2S,1,10)
 set VO(48)=$C(23,52,10,2,0,0,0,0,0,0)_"00T"_$E(fDEAL1.CONSTANTS,1,10)
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit
	
	
VTAB(RecordDEAL1 fDEAL1)
 
 kill VSCRPP,REQ,%TAB,%MOD,%MODOFF,%MODGRP,%REPREQ,vtab
 set %MAX=30,VPT=1,VPB=23,PGM=$T(+0),DLIB="SYSDEV",DFID="DEAL1"
 set OLNTB=23052
 
 set VFSN("DEAL1")="zfDEAL1"
 //
 // 
	
	
 set %TAB(1)=$C(1,51,20)_"20T12407|1|[DEAL1]ACNNAM"
 set %TAB(2)=$C(2,18,19)_"20$12415|1|[DEAL1]AMTS|||||||2"
 set %TAB(3)=$C(2,51,3)_"20T12413|1|[DEAL1]CRCDS|[CRCD]:QU ""[CRCD]CO=<<CO>>"""
 set %TAB(4)=$C(4,17,11)_"00T12406|1|[DEAL1]PAYTOS|[UTBLCORRE]||do VP1^V01S237(.fDEAL1)|do VP2^V01S237(.fDEAL1)"
 set %TAB(5)=$C(4,34,1)_"01T12407|1|[DEAL1]PAYTOSOPT|,A#Institution with acocunt,J#J,D#Name and Address||do VP3^V01S237(.fDEAL1)"
 set %TAB(6)=$C(4,38,40)_"00T12407|1|[DEAL1]PAYTOS1|||do VP4^V01S237(.fDEAL1)"
 set %TAB(7)=$C(5,38,40)_"00T12408|1|[DEAL1]PAYTOS2|||do VP5^V01S237(.fDEAL1)"
 set %TAB(8)=$C(6,38,40)_"00T12409|1|[DEAL1]PAYTOS3|||do VP6^V01S237(.fDEAL1)"
 set %TAB(9)=$C(7,38,40)_"00T12410|1|[DEAL1]PAYTOS4|||do VP7^V01S237(.fDEAL1)"
 set %TAB(10)=$C(8,38,40)_"00T12413|1|[DEAL1]PAYTOS5|||do VP8^V01S237(.fDEAL1)"
 set %TAB(11)=$C(9,18,20)_"00T12411|1|[DEAL1]PDTOCIDS||||do VP9^V01S237(.fDEAL1)"
 set %TAB(12)=$C(10,18,12)_"01N12418|1|[DEAL1]NOSTROS|[DEP]CID:QU ""[DEP]CORRE > """"""""""||do VP10^V01S237(.fDEAL1)"
 set %TAB(13)=$C(10,51,11)_"20T12401|1|[DEAL1]PAIDBYS|[UTBLCORRE]"
 set %TAB(14)=$C(11,51,25)_"21T|*CORREDSC|[DEAL1]CORREDSC"
 set %TAB(15)=$C(12,17,11)_"00T12401|1|[DEAL1]INTERS|[UTBLCORRE]||do VP11^V01S237(.fDEAL1)"
 set %TAB(16)=$C(12,34,1)_"00T12413|1|[DEAL1]INTERSOPT|,A#Institution with account,J#J,D#Name and Address||do VP12^V01S237(.fDEAL1)"
 set %TAB(17)=$C(12,38,40)_"00T12402|1|[DEAL1]INTERS1|||do VP13^V01S237(.fDEAL1)"
 set %TAB(18)=$C(13,38,40)_"00T12403|1|[DEAL1]INTERS2|||do VP14^V01S237(.fDEAL1)"
 set %TAB(19)=$C(14,38,40)_"00T12404|1|[DEAL1]INTERS3|||do VP15^V01S237(.fDEAL1)"
 set %TAB(20)=$C(15,38,40)_"00T12405|1|[DEAL1]INTERS4|||do VP16^V01S237(.fDEAL1)"
 set %TAB(21)=$C(16,38,40)_"00T12406|1|[DEAL1]INTERS5|||do VP17^V01S237(.fDEAL1)"
 set %TAB(22)=$C(17,17,11)_"00T12444|1|[DEAL1]RECVCORR|[UTBLCORRE]||do VP18^V01S237(.fDEAL1)"
 set %TAB(23)=$C(17,34,1)_"00T12411|1|[DEAL1]RECVCORROPT|,A#Institution with account,B#Bank ID,D#Name and Address"
 set %TAB(24)=$C(17,38,35)_"00T12402|1|[DEAL1]RECV1|||do VP19^V01S237(.fDEAL1)"
 set %TAB(25)=$C(18,38,35)_"00T12403|1|[DEAL1]RECV2|||do VP20^V01S237(.fDEAL1)"
 set %TAB(26)=$C(19,38,35)_"00T12404|1|[DEAL1]RECV3|||do VP21^V01S237(.fDEAL1)"
 set %TAB(27)=$C(20,38,35)_"00T12405|1|[DEAL1]RECV4|||do VP22^V01S237(.fDEAL1)"
 set %TAB(28)=$C(21,18,10)_"01T12418|1|[DEAL1]DS1S|[UTBLFOREX]"
 set %TAB(29)=$C(22,18,10)_"01T12419|1|[DEAL1]DS2S|[STBLCNTRY]"
 set %TAB(30)=$C(22,51,10)_"00T12420|1|[DEAL1]CONSTANTS|[UTBLECOACT]"
 do VTBL(.fDEAL1)
	do ^DBSCRT8 	// data entry
	quit


VREQ   // Create REQ() array
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit


VTBL(RecordDEAL1 fDEAL1) //Create %TAB(array)
 	// 1 2 3  4 5   6   7-9 10-11
 	// DY,DX,SZ PT REQ TYPE DEL POS |NODE|ITEM NAME|TBL|FMT|PP|PRE|MIN|MAX|DEC

	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit


	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit


  //user-defined post procs
 //
VP1(RecordDEAL1 fDEAL1) //
	type public String X
	type public Boolean ER

	if X.isNull() quit

	// Must be at least 8 characters in length
	if X.length()<8 do Runtime.setErrMSG("DEAL1",7642) quit:ER

	type String line1, line2, line3, line4, line5
	set (line1,line2,line3,line4,line5)=""

	// get UTBLCORRE info
	do CORRPP^DEALSINT(X,.line1,.line2,.line3,.line4)	

	do DEFAULT^DBSMACRO("DEAL1.PAYTOSOPT","A")

	if (V=X) , ('fDEAL1.paytos1.isNull()) do GOTO^DBSMACRO("DEAL1.PAYTOS1") 

	set fDEAL1.paytos1=line1
	set fDEAL1.paytos2=line2
	set fDEAL1.paytos3=line3
	set fDEAL1.paytos4=line4
	set fDEAL1.paytos5=""

	do DISPLAY^DBSMACRO("DEAL1.PAYTOS1")
	do DISPLAY^DBSMACRO("DEAL1.PAYTOS2")
	do DISPLAY^DBSMACRO("DEAL1.PAYTOS3")
	do DISPLAY^DBSMACRO("DEAL1.PAYTOS4")
	do DISPLAY^DBSMACRO("DEAL1.PAYTOS5")

	// SWIFT Character Checking
	type String SAVX
	set SAVX=X
	
	set X=fDEAL1.paytos1 do CHECKUP^SWFTEDIT if ER do GOTO^DBSMACRO("DEAL1.PAYTOS1") quit 

	set X=fDEAL1.paytos2 do CHECKUP^SWFTEDIT if ER do GOTO^DBSMACRO("DEAL1.PAYTOS2") quit 

	set X=fDEAL1.paytos3 do CHECKUP^SWFTEDIT if ER do GOTO^DBSMACRO("DEAL1.PAYTOS3") quit

	set X=fDEAL1.paytos4 do CHECKUP^SWFTEDIT if ER do GOTO^DBSMACRO("DEAL1.PAYTOS4") quit

	set X=fDEAL1.paytos5 do CHECKUP^SWFTEDIT if ER do GOTO^DBSMACRO("DEAL1.PAYTOS4") quit

	set X=SAVX

	do VPO1(.fDEAL1)
	
	do GOTO^DBSMACRO("DEAL1.PDTOCIDS")

	quit 				
VPO1(RecordDEAL1 fDEAL1)  // user library DEAL1_PTSPOS
	type String PAYRECV, PDT
	
	set PDT="FX"
	set PAYRECV="P"
	type RecordSINSTR sinstr=Db.getRecord("SINSTR","ACN=:fDEAL1.acn,CRCD=:fDEAL1.crcds,FXPROD=:PDT,PAYRECV=:PAYRECV",1)
	if fDEAL1.pdtocids.isNull() do {
		set fDEAL1.pdtocids=sinstr.cid
		do DEFAULT^DBSMACRO("DEAL1.PDTOCIDS",sinstr.cid)
		}	
	do DISPLAY^DBSMACRO("DEAL1.PDTOCIDS",fDEAL1.pdtocids)
	quit
 #ACCEPT DATE=11/05/03;pgm=screen compiler
 quit
 #ACCEPT Date=11/5/03;PGM=Screen Compiler
 quit
 #ACCEPT Date=11/5/03;PGM=Screen Compiler
 quit
VP2(RecordDEAL1 fDEAL1) //
	if ('fDEAL1.paytos.isNull()) ! ('fDEAL1.paytosopt.isNull()) quit

	type String FXPROD, PAYRECV

	set FXPROD="FX"
	set PAYRECV="P"

	type RecordSINSTR sinstr=Db.getRecord("SINSTR","ACN=:fDEAL1.acn,CRCD=:fDEAL1.crcds,FXPROD=:FXPROD,PAYRECV=:PAYRECV",1)	
	
	do DEFAULT^DBSMACRO("DEAL1.PAYTOS",sinstr.corre)
	do DISPLAY^DBSMACRO("DEAL1.PAYTOS")

	quit
VP3(RecordDEAL1 fDEAL1) //
	type public String X
	type public Boolean ER

	// Complete previous field to select option A
	if (X="A") & (fDEAL1.paytos.isNull()) do Runtime.setErrMSG("DEAL1",2746) quit:ER

	quit
VP4(RecordDEAL1 fDEAL1) //
	type public String X
	type public Boolean ER

	// SWIFT character checking
	if 'X.isNull() do CHECKUP^SWFTEDIT quit:ER
	
	/*  Check for the presence of option A for Pay To , and ensure that if 
	    option A is being used, this field must begin with a slash / or 
	    must be empty.
	    If the user does fill in something for this field, and option A 
	    is being used, skip the rest of the information lines by jumping 
	    to PDTOCIDS.
	*/

	// When using this line for option A, enter an account number beginning with /
 	if (fDEAL1.paytosopt="A") & ('X.extract()="/") & ('X.isNull()) do Runtime.setErrMSG("DEAL1",2631) quit:ER

	if fDEAL1.paytosopt="A" do GOTO^DBSMACRO("DEAL1.PDTOCIDS")

	quit
VP5(RecordDEAL1 fDEAL1) //
	type public String X
	type public Boolean ER

	if (fDEAL1.paytosopt="D") & ('X.isNull()) do CHECKUP^SWFTEDIT quit:ER

	if fDEAL1.paytosopt="A" do {
		set X=""
		do DISPLAY^DBSMACRO("DEAL1.PAYTOS2")
		do GOTO^DBSMACRO("DEAL1.PDTOCIDS")
		}
	quit
VP6(RecordDEAL1 fDEAL1) //
	type public String X
	type public Boolean ER

	if (fDEAL1.paytosopt="D") & ('X.isNull()) do CHECKUP^SWFTEDIT quit:ER

	if fDEAL1.paytosopt="A" do {
		set X=""
		do DISPLAY^DBSMACRO("DEAL1.PAYTOS3")
		do GOTO^DBSMACRO("DEAL1.PDTOCIDS")
		}
	quit
VP7(RecordDEAL1 fDEAL1) //
	type public String X
	type public Boolean ER

	if (fDEAL1.paytosopt="D") & ('X.isNull()) do CHECKUP^SWFTEDIT quit:ER

	if fDEAL1.paytosopt="A" do {
		set X=""
		do DISPLAY^DBSMACRO("DEAL1.PAYTOS4")
		do GOTO^DBSMACRO("DEAL1.PDTOCIDS")
		}
	quit
VP8(RecordDEAL1 fDEAL1) //
	// Check for the presence of invalid characters for SWIFT and 
	// prevent the field from being used with option A or D.

	type public String X
	type public Boolean ER

	if 'X.isNull() do CHECKUP^SWFTEDIT quit:ER

	if (fDEAL1.paytosopt="D") ! (fDEAL1.paytosopt="A") do {
		set X=""
		do DISPLAY^DBSMACRO("DEAL1.PAYTOS5")
		do GOTO^DBSMACRO("DEAL1.PDTOCIDS")
 		}
	quit
VP9(RecordDEAL1 fDEAL1) //
	if ('fDEAL1.pdtocids.isNull()) ! (%ProcessMode'=0) quit
	
	type String FXPROD, PAYRECV
	
	set FXPROD="FX"

	if fDEAL1.dealps="P" set PAYRECV="P"
	else  set PAYRECV="R"
		
	type RecordSINSTR sinstr=Db.getRecord("SINSTR","ACN=fDEAL1.acn,CRCD=:fDEAL1.crcds,FXPROD=:FXPROD,PAYRECV=:PAYRECV",1)

	do DEFAULT^DBSMACRO("DEAL1.PDTOCIDS",sinstr.cid)
	do DISPLAY^DBSMACRO("DEAL1.PDTOCIDS")

	quit
VP10(RecordDEAL1 fDEAL1) //
	type public String CO, X
	type public Boolean ER

	if X.isNull() quit

	do DEFAULT^DBSMACRO("DEAL1.PAIDBYSOPT","A")

	// Verify that the nostro account is the same currency as the deal 
	// currency, and that it isn't closed.
	do NOSSPP^DEAL(X,fDEAL1.crcds) quit:ER

	type RecordACN acn=Db.getRecord("ACN","CID=:X",1)

	do DEFAULT^DBSMACRO("DEAL1.PAIDBYS",acn.corre)
	do DISPLAY^DBSMACRO("DEAL1.PAIDBYS")

	if 'acn.corre.isNull() do {

		type RecordUTBLCORRE utbl=Db.getRecord("UTBLCORRE","KEY=:acn.corre",1)

		do DISPLAY^DBSMACRO("DEAL1.CORREDSC",utbl.name.extract(1,25))
		}

	quit

VP11(RecordDEAL1 fDEAL1) //
	/* If this field is filled in, default the option field to A, and 
	   set the information lines to blanks.  This is done so that if 
	   the user had filled in information using option D or J, and then 
	   goes back to use this field (and change the option to A), they 
	   will see that the information fields are not used with option A, 
	   except possibly the first one, for an account number.
 	*/

	type public String X
	type public Boolean ER

	if X.isNull() quit

	// Must be at least 8 characters in length
	if X.length()<8 do Runtime.setErrMSG("DEAL1",7642) quit:ER
	
	type String line1, line2, line3, line4, line5
	set (line1,line2,line3,line4,line5)=""

	do DEFAULT^DBSMACRO("DEAL1.INTERSOPT","A")

	if (V=X) , ('fDEAL1.inters1.isNull()) do GOTO^DBSMACRO("DEAL1.INTERS1")

	set fDEAL1.inters1=line1
	set fDEAL1.inters2=line2	
	set fDEAL1.inters3=line3
	set fDEAL1.inters4=line4
	set fDEAL1.inters5=line5

	do DISPLAY^DBSMACRO("DEAL1.INTERS1")
	do DISPLAY^DBSMACRO("DEAL1.INTERS2")
	do DISPLAY^DBSMACRO("DEAL1.INTERS3")
	do DISPLAY^DBSMACRO("DEAL1.INTERS4")
	do DISPLAY^DBSMACRO("DEAL1.INTERS5")

	// SWIFT Character Checking
	type String SAVX

	set SAVX=X

	set X=fDEAL1.inters1 do CHECKUP^SWFTEDIT if ER do GOTO^DBSMACRO("DEAL1.INTERS1") quit

	set X=fDEAL1.inters2 do CHECKUP^SWFTEDIT if ER do GOTO^DBSMACRO("DEAL1.INTERS2") quit

	set X=fDEAL1.inters3 do CHECKUP^SWFTEDIT if ER do GOTO^DBSMACRO("DEAL1.INTERS3") quit

	set X=fDEAL1.inters4 do CHECKUP^SWFTEDIT if ER do GOTO^DBSMACRO("DEAL1.INTERS4") quit

	set X=fDEAL1.inters5 do CHECKUP^SWFTEDIT if ER do GOTO^DBSMACRO("DEAL1.INTERS5") quit

	set X=SAVX 

	do VPO1(.fDEAL1)

	do GOTO^DBSMACRO("DEAL1.INTERS1")

	quit
 
VP12(RecordDEAL1 fDEAL1) //
	type public String X
	type public Boolean ER

	// Complete previous field to select option A
	if (X="A") & (fDEAL1.inters.isNull()) do Runtime.setErrMSG("DEAL1",2746) quit:ER

	quit
VP13(RecordDEAL1 fDEAL1) //
	type public String X
	type public Boolean ER

	// SWIFT Character Checking
	if ('X.isNull()) do CHECKUP^SWFTEDIT quit:ER

	// When using this line for option A, enter an account number beginning with /
	if (fDEAL1.intersopt="A") & ('X.extract()="/") & ('X.isNull()) do Runtime.setErrMSG("DEAL1",2631) quit:ER

	if (fDEAL1.intersopt="D") ! (fDEAL1.intersopt="J") do GOTO^DBSMACRO("DEAL1.INTERS2") quit

	if fDEAL1.intersopt="A" do GOTO^DBSMACRO("DEAL1.RECVCORR") quit

	quit
VP14(RecordDEAL1 fDEAL1) //
	type public String X
	type public Boolean ER

	// SWIFT Character Checking
	if 'X.isNull() do CHECKUP^SWFTEDIT quit:ER

	if fDEAL1.intersopt="A" set X="" do GOTO^DBSMACRO("DEAL1.RECVCORR") quit

	if (fDEAL1.inters.isNull()) & ('X.isNull()) do CHECKUP^SWFTEDIT quit:ER

	quit

VP15(RecordDEAL1 fDEAL1) //
	type public String X
	type public Boolean ER

	if 'X.isNull() do CHECKUP^SWFTEDIT quit:ER

	if fDEAL1.intersopt="A" set X="" do GOTO^DBSMACRO("DEAL1.RECVCORR") quit

	if (fDEAL1.inters.isNull()) & ('X.isNull()) do CHECKUP^SWFTEDIT quit:ER

	quit
VP16(RecordDEAL1 fDEAL1) //
	type public String X
	type public Boolean ER

	if 'X.isNull() do CHECKUP^SWFTEDIT quit:ER

	if fDEAL1.intersopt="A" set X="" do GOTO^DBSMACRO("DEAL1.RECVCORR") quit

	if (fDEAL1.inters.isNull()) & ('X.isNull()) do CHECKUP^SWFTEDIT quit:ER

	quit

VP17(RecordDEAL1 fDEAL1) //
	/*  Check for the presence of invalid characters for SWIFT and prevent
	    the field from being used with option A or D.
	    Also, if the option field for Party A is left blank, but the 
	    information lines have been filled in, the option field will be 
	    defaulted to option D, or option J, depending on whether the last 
	    line has been filled in.
	    If the last line has been filled in, the option is defaulted to J.
	*/

	type public String X
	type String BIGSTRING

	if (fDEAL1.intersopt="D") ! (fDEAL1.intersopt="A") do {
		set X=""
		do DISPLAY^DBSMACRO("DEAL1.INTERS5")
		do GOTO^DBSMACRO("DEAL1.RECVCORR")
		}

	set BIGSTRING=fDEAL1.inters1_fDEAL1.inters2_fDEAL1.inters3_fDEAL1.inters4

	if (fDEAL1.intersopt.isNull()) & (X.isNull()) & ('BIGSTRING.isNull()) do {
		set fDEAL1.intersopt="D"
		do DISPLAY^DBSMACRO("DEAL1.INTERSOPT")
		}

	if (fDEAL1.intersopt.isNull()) & ('X.isNull()) do {
		set fDEAL1.intersopt="J"
		do DISPLAY^DBSMACRO("DEAL1.INTERSOPT")
		}

	quit
VP18(RecordDEAL1 fDEAL1) //
	type public String X
	type public Boolean ER

	if X.isNull() quit

	// Must be at least 8 characters in length
	if X.length()<8 do Runtime.setErrMSG("DEAL1",7642) quit:ER

	do DEFAULT^DBSMACRO("DEAL1.RECVCORROPT","A")
	do GOTO^DBSMACRO("DEAL1.RECV1")

	quit	
VP19(RecordDEAL1 fDEAL1) //
	type public String X
	type public Boolean ER

	if X.isNull() quit
	
	do CHECKUP^SWFTEDIT quit:ER

	if fDEAL1.recvcorropt="B" do GOTO^DBSMACRO("END") 
	
	quit
VP20(RecordDEAL1 fDEAL1) //
	type public String X
	type public Boolean ER

	if 'X.isNull() do CHECKUP^SWFTEDIT quit:ER

	quit
VP21(RecordDEAL1 fDEAL1) //
	type public String X
	type public Boolean ER

	if 'X.isNull() do CHECKUP^SWFTEDIT quit:ER

	quit
VP22(RecordDEAL1 fDEAL1) //
	type public String X
	type public Boolean ER

	if 'X.isNull() do CHECKUP^SWFTEDIT quit:ER

	quit
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit								// User defined post processor's


VRV(V,L) quit V_$J("",L-$L(V))
VREPRNT
 type Public RecordDEAL1 fDEAL1
 do VPR(.fDEAL1)
 do VDA1(.fDEAL1)
 do ^DBSPNT()
 quit

VW(RecordDEAL1 fDEAL1)
 do VDA1(.fDEAL1)
 do ^DBSPNT(10)
 quit

VDAPNT(RecordDEAL1 fDEAL1)
 do VDA1(.fDEAL1)
 do ^DBSPNT(0,2)
 quit

VDA
 type Public RecordDEAL1 fDEAL1
 do VDA1(.fDEAL1)
 quit

	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit
 
vSET(sn,di,X)
 type Public RecordDEAL1 fDEAL1
 if sn="DEAL1" do vSET1(.fDEAL1,di,X)
 #ACCEPT Date=11/5/03;PGM=Screen Compiler
 quit
vSET1(RecordDEAL1 fDEAL1,di,X)
 do fDEAL1.setAuditFlag(1)
 set fDEAL1.@di=X
 #ACCEPT Date=11/5/03;PGM=Screen Compiler
 quit
	
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit
vREAD(fid,di)
 type Public RecordDEAL1 fDEAL1
 if fid="DEAL1" quit $$vREAD1(.fDEAL1,di)
 quit ""
vREAD1(RecordDEAL1 fDEAL1,di)
 quit fDEAL1.@di
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit
