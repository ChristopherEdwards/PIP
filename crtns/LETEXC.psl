LETEXC	  /*
ORIG: burnsm - 06/16/2000
DESC: Rejected/Failed Transaction Letters

---- Comments --------------------------------------------------------

---- Revision History ------------------------------------------------

	01/30/06 Radhika - CR 17423
		 .Eliminated PSL deprecated features and warnings.
		 .Removed revision history prior to 2004.

 */
	//Variable Definition
	type public String %FN
	type Date DATES(),FORMTJD,PRBDDT(),PRBD(),REALTJD
	type Number DAY
	type String SAVFN,XFORM,XFID,XTJD(),zz
	
	set XFID="EXC"
	set SAVFN=%FN
	type ResultSet rs=Db.select("FORM","STBLFORMBCH","FID=:XFID")
	if rs.isEmpty() quit
	while rs.next() do {
		set XFORM=rs.getCol("FORM")
		type ResultSet rs1=Db.select("TJDVAL,CAL","UTBLFORMVAR","FORM=:XFORM")
		if rs1.isEmpty() quit
		while rs1.next() set XTJD(rs1.getCol("TJDVAL"))=rs1.getCol(2)		
		} //end of while

	set REALTJD=%SystemDate
        set zz=""
        for  set zz=XTJD(zz).order() quit:zz.isNull()  do {
                set PRBD=""
                set DAY=$S(zz["T":zz.piece("T",2),1:1)
                if 'XTJD(zz).isNull() set PRBD=$$PRBD^UNBD(REALTJD,DAY,XTJD(zz))
                set FORMTJD=$S('PRBD.isNull():PRBD,1:REALTJD+DAY)
       		set DATES(FORMTJD)=SAVFN_"_"_zz
		if 'PRBD.isNull() set PRBDDT(FORMTJD)=FORMTJD
		}

	set FORMTJD=""
	for  set FORMTJD=DATES(FORMTJD).order() quit:FORMTJD.isNull()  do {
 		set PRBD=PRBDDT(FORMTJD).get()
		set %FN=DATES(FORMTJD).get()
		do DRV^UBCHID("BCHLETEXC")
                }
 #OPTION ResultClass ON
Public String vSIG()	quit "60298^29649^Radhika Panchanathan^1430"	// Signature - LTD^TIME^USER^SIZE
