public	LNPTS5(RecordDEP dep, RecordTTX ttx, RecordTRN trn)

	/*
	       ORIG:  David Caliendo (5527) - 06/11/86
	  CALLED BY:
	      CALLS:
	   PROJ #'S:
	       DESC:

	   GLOBALS -  ^ACN
	       READ:
	        SET:

	      INPUT: 
	     OUTPUT:


	---- Revision History ------------------------------------------------
	
	01/31/06 - SmithCD - CR 19343 (16890)
		   Modified to only load ln object from the database if it's 
		   not already. Prevents changes from being overlaid. 
		   Cleaned up code.

	*/

	type public RecordLN ln

	type Number BALINT, TAMT

	if 'ln.exists() set ln = Db.getRecord("LN", "CID=:dep.aref")
	
	set TAMT = ttx.prin
	set ttx.tamt = TAMT

	// Adjusted Balance for Accrual Calculation
	set BALINT=ln.balint
	
	type RecordUTBLICPA utblicpa = Db.getRecord("UTBLICPA", "KEY=:ln.icpa")
	if utblicpa.prio.extract(4) set BALINT = BALINT - TAMT

	set ln.balint = BALINT
	
	do GL^LNPTSU(.ttx, TAMT, 2, 7)

	// Ledger Balance
	set dep.bal = dep.bal + TAMT

	// Collected Balance
	set dep.balcol = dep.balcol + TAMT

	// Total Escrow Balance
	set ln.teb = dep.bal

	quit

vSIG()	quit "60297^70602^Chad Smith^979"	// Signature - LTD^TIME^USER^SIZE
