public LNPTS7A(RecordLN ln,RecordTTX ttx)	// CONSTRUCTION LOAN CREDIT LIMIT AUTHORIZATION
	/*
	       ORIG:  David Caliendo (5527) - 06/24/86
	       DESC:  Update undisbursed balance.  This will always be used
		      in conjunction with  LNPTS4A, hence no need to update
		      BALCOL or BALINT.

	---- Revision History ------------------------------------------------
	
	01/05/07 - KUMARB - CR24680
		   Modified below the update on ln.bal to update the principal
		   amounts on loans with Segments Allowed (LN.SEGMENTS)
		   selected by calling PURCHASE^LNSEG.
	
	10/24/05 - KELLYP - CR 17929
		   Modified to set ln.bal correctly. Previously, code was 
		   checking the value of ITC instead of ITC1 which would 
		   set X (and therefore BAL) incorrectly.  Also modified
		   entire procedure to conform to current PSL standards
		   and removed pre-2003 revision history.
	
	04/09/03 - CARROLLJ - 51349
		   Cached trn.

	*/
 
 	type public Boolean ER
	type public Cache %CACHE()
	type public Number ZAMT

	type Number BAL,X
	type String TSO

	// Account not coded for undisbursed processing
	if 'ln.aruf do Runtime.setErrMSG("LN",79) quit:ER

     	// Transaction Source of Funds
	set TSO=ttx.tso
	set TSO=$$FIELDIN^UTSO(TSO,"ADJAVCR",1)
	set TSO=$$FIELDIN^UTSO(TSO,"REAPPLY",1)
    	set ttx.tso=TSO

	// Ledger Balances
	set BAL=ln.bal

	do GL^LNPTSU(.ttx,ZAMT,2)

	type RecordTRN trn=%CACHE("TRN").getRecord("TRN","ETC=:ttx.etc")      		
	set X=$S(ln.trb-trn.itc.extract(1)=0:-ZAMT,1:ZAMT)
	set BAL=BAL+X

	do %HSEQ^LNPTSU(.ttx,"*#P#"_ZAMT)
	set ZAMT=0

	// Ledger Balance
	set ln.bal=BAL
	
	#IF ('CUVAR.NOSEGMENTS!(CUVAR.NOSEGMENTS=3))!($$SEGUSE^BTTOPTMZ("L"))
		if ln.segments do PURCHASE^LNSEG(.ln, .ttx, X)
	#ENDIF

	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "60670^61824^Balasubramonian Sankar^1587"	// Signature - LTD^TIME^USER^SIZE
