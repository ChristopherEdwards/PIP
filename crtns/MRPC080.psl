MRPC080(return,versn,CID,%EffectiveDate,PERIOD,OTHERPC)	//Public;Deceased/Disabled Customer account Calculations
	/*
	   ORIG: SCHWARTZC - 02/04/99
	   DESC: Roll a loan account back to EFD.  Calculate values required for
	   the Deceased/Disabled Payoff Status Report

	   KEYWORDS: Deceased,Disabled,Payoff,MRPC

	   ARGUMENTS:
	   	 . return - Either an Error or a tab delimited array containing:
	     			 Payments After DOD
	     			 Payments Before DOD
	     			 Delinquent at DOD
	    			 Reversals After DOD
	    			 Withdrawals After DOD
	    			 Withdrawals Within Period

	  	 . versn 	 MRPC Version Number
	    			 Current Version = 1

	  	 . CID

	  	 . EFD

	  	 . PERIOD	 Months before EFD to include withdrawals

	  	 . OTHERPC	 Other Payoff Charges

	   RETURNS:
	  	 . $$		 Error Message  /TYP=T
	   			 Null = No Error
	   EXAMPLE:
	   	 $$^MRPC(.RTN,1,40509,56450,6)

	---- Revision History ------------------------------------------------
	
	01/04/06 - S.Krishnan - CR 16885
		 . Removed the ORDER BY occurences.
		 . The code calling routine EXEC^LNUEFD is modified to pass only 
		   7 parameters instead of 8.

	02/05/03 - GRAY - 51349
		   Prevented %GTM-E-QUITARGREQD error from occurring when
		   the account record is not on file.
	   
	11/04/02 - SRIVASTAVAN - 49794	
	  	   Converted to PSL
	 	 
	*/

	new AD,DATA,PA,PB,RA,WA,WPEFD,WW
	new DONE,HEFD,HSEQ,ITC,TRB,TSEQ
	new CURBAL,DODBAL,DELINQ,DIFF,FIRST
	type Boolean ER
	type String RM
	
	set (PA,PB,AD,RA,WA,WW)=0
	set CID=$G(CID)
	set %EffectiveDate=$G(%EffectiveDate)

	// Set withdrawal period date
	set PERIOD=-PERIOD 
	
	set DATA=$$ADDMJD^SCADAT(%EffectiveDate,PERIOD,1)
	
	set WPEFD=DATA

	type RecordLN ln=Db.getRecord("LN","CID",1)
 	if ln.getMode()=0 set RM=$$^MSG(5046) quit $$ERRMSG^PBSUTL($G(RM))
	
	set CURBAL=ln.bal

	do EXEC^LNUEFD(.ln,,,%EffectiveDate,,,.DATA)	

	if ER quit $$ERRMSG^PBSUTL($G(RM))

	//This section was previously handeled by UHFETCH.

	set DONE=0
	type ResultSet rs=Db.select("TSEQ","HIST","CID=:CID","TSEQ DESC")
	if 'rs.isEmpty() while rs.next() do { quit:DONE
		set HSEQ=rs.getCol(1)
		type RecordHIST hist=Db.getRecord("HIST","CID,HSEQ")
		set ITC=hist.itc
		set HEFD=hist.tjd if hist.efd set HEFD=hist.efd
		set TRB=ln.trb
                if $G(ITC)'="",$E(ITC,1)'=TRB,('($E(ITC,6)!$E(ITC,12))) do {
                        set DONE=1
                        if $G(WPEFD)'="",HEFD'<WPEFD,HEFD'>%EffectiveDate set FIRST="*"
                        }
                }

	if 'FIRST.get().isNull() set FIRST=" "
	set DODBAL=ln.bal
	set DELINQ=ln.unin+ln.unpr+ln.unes
	if $G(OTHERPC)="" set OTHERPC=0

	set DIFF=$P(DATA,$C(9),1)+$P(DATA,$C(9),2)
	set DIFF=DIFF-($P(DATA,$C(9),3)+$P(DATA,$C(9),4)+$P(DATA,$C(9),5)+$P(DATA,$C(9),6)+OTHERPC)

	set DATA=DATA_$C(9)_$G(DELINQ)_$C(9)_$G(CURBAL)_$C(9)_$G(DODBAL)
	set DATA=DATA_$C(9)_$G(DIFF)_$C(9)_$G(FIRST)_$C(9)_OTHERPC_$C(13,10)

	// Format Return
	set return=$$V2LV^MSG($G(DATA))
	quit ""
		
 #OPTION ResultClass ON
Public String vSIG()	quit "60305^29204^Radhika Panchanathan^2739"	// Signature - LTD^TIME^USER^SIZE
