DAYCRLMT	
	/*
	----Revision History--------------------------------------------------
	04/05/06 - ArpaVC - CR 20568
                   Changed error handling logic.  Filers always call the
                   catch block, so there is no reason to call EXC
                   twice.  Only call ZE^UTLERR if a GTM error occurs.

	05/24/05 - RussellDS - CR16071
		   Converted M TP commands to PSL Runtime methods.
		   
		   Removed old revision history.
	*/
	
	// set error trap
	catch vERROR {
		type String ET		// Make ET local

		set ET=vERROR.type	// Set ET from the implicit error object

		// Log Mumps error
		if ET.get()["%GTM-" do ZE^UTLERR
		do EXC
		}
	
	new LNIFO,XCID,XCRLMT,%UserID,TLO
	set (%UserID,%UserStation)="BATCH"
	new rs
	type ResultSet rs=Db.select("CID","LNCOL","PLDGACN IS NOT NULL AND COLTYP=70")
	if rs.isEmpty() quit
	while rs.next()  do {
		set XCID=rs.getCol(1)
		new ER set ER=0
		set linfo=Db.getOneRow("ADJCRLMT,CRLMT","LN","XCID")
		if '$P(linfo,$C(9),1) quit
		set XCRLMT=$$PLDGCRLMT^LNCDI(XCID) if $G(ER) do EXC quit
		if XCRLMT'=$P(linfo,$C(9),2) do UPDATE
		}
	quit
	
UPDATE	// Update credit limit

	do Runtime.start("BA")
	do Db.update("LN","CRLMT=:XCRLMT","CID=:XCID")
	if ER do Runtime.rollback()  quit
	do Runtime.commit()
	quit

EXC	// Log error to DAYEND

	do LOG^UTLEXC($T(+0),"*",$G(RM),$G(XCID),$G(%ZTSEQ),$G(ET))
	kill ET,%ZTSEQ
	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "60361^38577^Vincent Arpa^1320"	// Signature - LTD^TIME^USER^SIZE
