V00S534(%ProcessMode,RecordUSRFRE fUSRFRE)   // -  - SID= <USRFRE> Regular Frequency
 ;;Copyright(c)2006 Sanchez Computer Associates, Inc.  All Rights Reserved - 08/24/2006 12:17 - kini
 // /*
 // This screen contains fields used to specify attributes for regular user
 // frequencies (Type 0).  It is displayed when a user runs the New User-Defined
 // Frequency (UFRE001), User-Defined Frequency Maintenance (UFRE002), User-Defined
 // Frequency Inquiry (UFRE003), or User-Defined Frequency Deletion (UFRE004)
 // function for a frequency type of 0.
 // See the Frequencies/Calendars Manual for further information.
 // */
  /*
ORIG: CHENARDP - 03/03/2003
DESC: PSL Screen Compiler Template

---- Comments --------------------------------------------------------
	This procedure is used as the base template for the PSL screen compiler.
	It is referenced by the PSL screen compiler - procedure DBS2PSL4
	
	
---- Revision History ------------------------------------------------
	02/23/06 - Pete Chenard - CR19551
		   Fixed routine label.
		   
	05/19/05 - Pete Chenard - CR 14146
		   Modified to type variables.
		   
	12/1/03 - Spier -cr7178
	   	     Modifications to correct dead code warnings and
	   	     other issues that occurred during mass compile of screens.

	09/24/03 - Pete Chenard - 45497
		       Created screen template for compiler.
----------------------------------------------------------------------

 */

 #WARN SCOPE OFF
	type Public String %MODS,%PAGE,%PG,%REPEAT,ER,RM
	type String KEYS(),KVAR,VFSN(),VO,VODFT,VPGM,vPSL,VSID,VSNAME

	// %O (0-Create  1-Modify  2-Inquiry  3-Delete  4-Print  5-Blank screen)

	set:'$D(%ProcessMode) %ProcessMode=5
 set KVAR="kill %TAB,VFSN,VO,VPTBL,vtab",VSID="USRFRE",VPGM=$T(+0),VSNAME="Regular Frequency"
 set VFSN("USRFRE")="zfUSRFRE"
 set vPSL=1
 set KEYS(1)=fUSRFRE.UFRE
 //
	// ==================== Display blank screen         (%O=5)

 if %ProcessMode=5 do VPR(.fUSRFRE),VDA1(.fUSRFRE),^DBSPNT()

 if '%ProcessMode do VNEW(.fUSRFRE),VPR(.fUSRFRE),VDA1(.fUSRFRE)
 if %ProcessMode do VLOD(.fUSRFRE) quit:$G(ER)  do VPR(.fUSRFRE),VDA1(.fUSRFRE)

	// ====================  Display Form
	do ^DBSPNT()
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	if %ProcessMode=2!(%ProcessMode=3) do ^DBSCRT8A X:'$D(%PAGE) KVAR quit  // Inquiry/Delete
	// ====================  Set up data entry control table


 if %ProcessMode<2 do VTAB(.fUSRFRE)
	quit


VNEW(RecordUSRFRE fUSRFRE) // Initialize arrays if %O=0
 
 do VDEF(.fUSRFRE)
 do VLOD(.fUSRFRE)
 #ACCEPT Date=11/5/03;PGM=Screen Compiler
 quit
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit
	
VDEF(RecordUSRFRE fUSRFRE)
 if fUSRFRE.BD="" set fUSRFRE.BD="A"
 #ACCEPT Date=11/5/03;PGM=Screen Compiler
 quit
 ;
VLOD(RecordUSRFRE fUSRFRE) // Load data from disc - %O = (1-5)
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit


	type Public String %MODS,%REPEAT
	quit
	

VPR(RecordUSRFRE fUSRFRE) // Display screen prompts
 set VO="7||13|"
 set VO(0)="|0"
 set VO(1)=$C(1,25,23,1,0,0,0,0,0,0)_"01T     Regular Frequency "
 set VO(2)=$C(3,20,16,0,0,0,0,0,0,0)_"01T User Frequency:"
 set VO(3)=$C(4,17,19,1,0,0,0,0,0,0)_"01T PROFILE Frequency:"
 set VO(4)=$C(5,20,16,0,0,0,0,0,0,0)_"01T Starting Month:"
 set VO(5)=$C(6,14,22,0,0,0,0,0,0,0)_"01TFind First Full Cycle:"
 set VO(6)=$C(7,9,27,0,0,0,0,0,0,0)_"01TNon-Business Date Calendar:"
 set VO(7)=$C(8,13,23,1,0,0,0,0,0,0)_"01T Frequency Description:"
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit


VDA1(RecordUSRFRE fUSRFRE)  // Display screen data
 new V
 //
 set VO="13|8|13|"
 set VO(8)=$C(3,37,12,2,0,0,0,0,0,0)_"01T"_$E(fUSRFRE.UFRE,1,12)
 set VO(9)=$C(4,37,8,2,0,0,0,0,0,0)_"00T"_$E(fUSRFRE.FRE,1,8)
 set VO(10)=$C(5,37,2,2,0,0,0,0,0,0)_"00N"_fUSRFRE.SM
 set VO(11)=$C(6,37,1,2,0,0,0,0,0,0)_"00L"_$S(fUSRFRE.FC:"Y",1:"N")
 set VO(12)=$C(7,37,6,2,0,0,0,0,0,0)_"00U"_$E(fUSRFRE.NBDC,1,6)
 set VO(13)=$C(8,37,30,2,0,0,0,0,0,0)_"00T"_$E(fUSRFRE.DESC,1,30)
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit
	
	
VTAB(RecordUSRFRE fUSRFRE)
 
 kill VSCRPP,REQ,%TAB,%MOD,%MODOFF,%MODGRP,%REPREQ,vtab
 set %MAX=6,VPT=1,VPB=8,PGM=$T(+0),DLIB="SYSDEV",DFID="USRFRE"
 set OLNTB=8037
 
 set VFSN("USRFRE")="zfUSRFRE"
 //
 // 
	
	
 set %TAB(1)=$C(2,36,12)_"21T12401|1|[USRFRE]UFRE"
 set %TAB(2)=$C(3,36,8)_"01T12402|1|[USRFRE]FRE|||do VP1^V00S534(.fUSRFRE)"
 set %TAB(3)=$C(4,36,2)_"00N12403|1|[USRFRE]SM|||do VP2^V00S534(.fUSRFRE)||1|12"
 set %TAB(4)=$C(5,36,1)_"00L12404|1|[USRFRE]FC"
 set %TAB(5)=$C(6,36,6)_"00U12409|1|[USRFRE]NBDC|[UTBLNBD]"
 set %TAB(6)=$C(7,36,30)_"01T12401|1|[USRFRE]DESC"
 do VTBL(.fUSRFRE)
	do ^DBSCRT8 	// data entry
	quit


VREQ   // Create REQ() array
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit


VTBL(RecordUSRFRE fUSRFRE) //Create %TAB(array)
 	// 1 2 3  4 5   6   7-9 10-11
 	// DY,DX,SZ PT REQ TYPE DEL POS |NODE|ITEM NAME|TBL|FMT|PP|PRE|MIN|MAX|DEC

	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit


	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit


  //user-defined post procs
 //
VP1(RecordUSRFRE fUSRFRE) //
 // Make sure that frequency entered isn't user-defined - MRR
 if X="" quit
 if Db.isDefined("USRFRE","UFRE=:X") do { quit
	type RecordSTBLER stbler=Db.getRecord("STBLER","KEY='FREPRO'")
 	set ER=1
	set RM=stbler.rm_"|22000" quit
	}

 set JD=TJD
 set FRE=X
 new X

 do ^UFRE

 if ER set RM=$$^MSG(1353) quit
 
 // Starting month only valid if FRETYP=0 and Q, 2M, 3M, 4M, or 6M
 
 do UNPROT^DBSMACRO("USRFRE.SM ")

 new DAY,PER,I
 for I=1:1 quit:$E(FRE,I)?1A
 set PER=$E(FRE,I)
 if FRETYP=0,PER="Q" quit
 set DAY=+FRE
 if FRETYP=0,PER="M","/2/3/4/6/"[("/"_DAY_"/") quit
 do DEFAULT^DBSMACRO("USRFRE.SM","","1","0","0")
 do PROTECT^DBSMACRO("USRFRE.SM")

 quit
VP2(RecordUSRFRE fUSRFRE) //
 // Only allow starting month if FRETYP=0 and either *Q, 2M,3M,4M, or 6M
 if X="" quit
 new FRE,I,PER
 set FRE=fUSRFRE.FRE
 for I=1:1 quit:$E(FRE,I)?1A
 set PER=$E(FRE,I)
 if '(PER="Q"!(PER="M")) set ER=1
 if PER="M" do {
        new DAY
        set DAY=+FRE
        quit:"/2/3/4/6/"[("/"_DAY_"/")
        set ER=1
        }
 if FRETYP'=0 set ER=1
 
 // Invalid frequency format
 if ER set RM=$$^MSG(1354)              
 quit
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit								// User defined post processor's


VRV(V,L) quit V_$J("",L-$L(V))
VREPRNT
 type Public RecordUSRFRE fUSRFRE
 do VPR(.fUSRFRE)
 do VDA1(.fUSRFRE)
 do ^DBSPNT()
 quit

VW(RecordUSRFRE fUSRFRE)
 do VDA1(.fUSRFRE)
 do ^DBSPNT(10)
 quit

VDAPNT(RecordUSRFRE fUSRFRE)
 do VDA1(.fUSRFRE)
 do ^DBSPNT(0,2)
 quit

VDA
 type Public RecordUSRFRE fUSRFRE
 do VDA1(.fUSRFRE)
 quit

	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit
 
vSET(sn,di,X)
 type Public RecordUSRFRE fUSRFRE
 if sn="USRFRE" do vSET1(.fUSRFRE,di,X)
 #ACCEPT Date=11/5/03;PGM=Screen Compiler
 quit
vSET1(RecordUSRFRE fUSRFRE,di,X)
 do fUSRFRE.setAuditFlag(1)
 set fUSRFRE.@di=X
 #ACCEPT Date=11/5/03;PGM=Screen Compiler
 quit
	
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit
vREAD(fid,di)
 type Public RecordUSRFRE fUSRFRE
 if fid="USRFRE" quit $$vREAD1(.fUSRFRE,di)
 quit ""
vREAD1(RecordUSRFRE fUSRFRE,di)
 quit fUSRFRE.@di
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit
