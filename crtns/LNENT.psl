LNENT	 /*
    ORIG: GRAY - 01/17/2000
    DESC: Loan Budgeting Sub-System
    
    ---- Comments --------------------------------------------------------
    
    ---- Revision History ------------------------------------------------
 
	02/12/03 - CARROLLJ - 51349
		   Removed from array and removed the use of Db.nextkey.

	12/21/99 - GRAY - 32507
		   Removed code no longer needed due to the Elimination
		   of Teller/Branch Character Interface and placed remaining
		   code into PSL'd procedure definition.

 */
	
	quit
	
	
Public CMP	// Computed Data Items for Unassigned Loan Budget Values
	
	set XLN23="" N %X,U,E,BAL
	
	type RecordLN ln=Db.getRecord("LN","CID")
	
	// Sum of the Projected, Actual, Add Back or Repayment Amount
	
	new BUDTOT,ACTTOT,ADDTOT,REPTOT
	set (BUDTOT,ACTTOT,ADDTOT,REPTOT)=0
	Type DbSet rs=Db.selectDbSet("LNENT","CID=:CID")
	while rs.next() do {
		type RecordLNENT lnent=rs.getRecord("LNENT")
		set BUDTOT=BUDTOT+lnent.bud		// E(1)
		set ACTTOT=ACTTOT+lnent.act		// E(2)
		set ADDTOT=ADDTOT+lnent.add		// E(3)
		set REPTOT=REPTOT+lnent.rep		// E(4)
		}
	
	set BAL=ln.bal+0 if ln.aruf set BAL=BAL-ln.udbal
	
	/*
	Unassigned Projected Amount =
	    Account Credit Limit ([LN]CRLMT)
	    - Sum of the Projected Amount
	*/
	
	set $P(XLN23,"|",1)=ln.crlmt-BUDTOT
	
	/*
	Unassigned Actual Disbursement Amount =
	    Total Disbursements ([LN]TDR)
	    - Sum of the Actual Disbursement Amount
	*/
	
	set $P(XLN23,"|",2)=ln.tdr-ACTTOT
	
	/*
	Unassigned Add Back Amount = 
	  now use [LNENT]REP - [LNENT]ADD
	  instead of following items
	      Total Disbursements ([LN]TDR) 
	    - Principal Balance ([LN]BAL) 
	    - Sum of Add Back Amount
	  ** if non-revolving account, Unassigned Add Back amount will be zero.
	*/
	
	set $P(XLN23,"|",3)=$S(ln.revf:REPTOT-ADDTOT,1:0)
	
	/*
	Unassigned Repayment Amount =
	     Total Disbursements ([LN]TDR
	   - Principal Balance ([LN]BAL)
	   - Sum of Repayment Amount
	   + Debit amounts added back to principal
	*/
	
	new DRAMT
	set DRAMT=Db.getOneRow("DRAMT","LNENT0","CID")
	set $P(XLN23,"|",4)=ln.tdr-BAL-REPTOT+DRAMT
	
	quit
	
Public RSN(VAL)	// Create the RSN entry for the journal files 
	
	quit "RSN#"_VAL 
 #OPTION ResultClass ON
Public String vSIG()	quit "60184^56139^Brian J. Doherty^2085"	// Signature - LTD^TIME^USER^SIZE
