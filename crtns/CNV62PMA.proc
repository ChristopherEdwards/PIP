CNV62PMA ; Procedure CNV62PMAXBAL - Previous Largest Loan Bal - Conversion
 ;;Copyright(c)2005 Sanchez Computer Associates, Inc.  All Rights Reserved - 08/09/05 10:30 - spatola
 ;
 ; **** This is a DATA-QWIK generated routine (level 25) ****
 ;
 // 
 // ORIG: SKLYUTD - 12/01/1999
 // DESC: Previous Largest Loan Bal - Conversion
 // 
 // ---- Comments --------------------------------------------------------
 // 
 // ---- Revision History ------------------------------------------------
 // 12/23/99 - sklyutd - 33756::018
 //		Fixed an undefined variable error.  Added initialization
 //		of variables TJD and UID (in case there is a general before or
 //		after update trigger).
 quit
cnv  
 // conversion line tag
 // this line tag is used to populate pmaxbal data item
 // with the value in the LN.HBAL1.
 new rs1,stop
 if $g(TJD)="" set TJD=Db.getOneRow("TJD","CUVAR")
 if $g(UID)="" set UID=$g(UID)
 type ResultSet rs1
 set rs1=Db.select("ACN","CIF")

 if rs1.isEmpty() quit
 for  quit:'rs1.next()  do {
	new ACN
	set ACN=rs1.getCol(1)

	new rs2
	type ResultSet rs2
	set rs2=Db.select("HABL1","LN","ACN=:ACN","HABL1 DESC")
	set stop=0

	for  quit:('rs2.next())!(stop=1)  do {
		set stop=1	// only want the highest HBAL1

		new NEWMAX
		set NEWMAX=rs2.getCol(1)
		if NEWMAX="" quit

		do Db.update("CIF","PMAXBAL=:NEWMAX","ACN=:ACN")
	}
 }
 quit

vSIG()	quit "59886^43497^Sanchez SCM Administrator^1066"	// Signature - LTD^TIME^USER^SIZE
