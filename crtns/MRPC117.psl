MRPC117(return,VERSN,ACN,TYPE,HHTYP)

  /*
 ORIG: 	JERUCHIMC - 06/16/2001
 DESC:  Householding Detail.  This MRPC will return information to PFW
        to populate data windows that display detailed information
        for direct, indirect, and related accounts.

 ---- Comments --------------------------------------------------------

  ARGUMENTS:
        . return     Data formatted to fit a data window  /TYP=T/REQ/MECH=REFNAM:W
 
        . VERSN      version number                  	  /TYP=N/REQ/MECH=VAL
                     current version=1
 
        . ACN        Customer Number         		  /TYP=N/REQ/MECH=VAL
 
        . TYPE       Type of data to return               /TYP=N/REQ/MECH=VAL
	  
	             Type 1 - Direct Account Detail datawindow
        	     Type 2 - Indirect Account Detail datawindow
        	     Type 3 - Related Account Detail datawindow
        	     Type 4 - Account Relationship Summary datawindow
                     Type 5 - Total Account Detail datawindow
 
        . HHTYP      Household type                       /TYP=N/REQ/MECH=VAL

 ---- Revision History ------------------------------------------------
	09/16/05  - SREERAM - 16682
		   Initialized Unscoped Variables and Cleanup for DBI3.

  */

MAIN

	// Version number of client message is not compatible with server
        if 'VERSN.get()=1 quit $$ERRMSG^PBSUTL($$^MSG(2951))

	type Public Boolean ER
	type Public String ET,RM
	type Number TOTALD,TOTALL,TOTAL,X
	type String fld,RTSTRN,RTSTRD,RTSTRI,RTSTRR
	// Set up header information 	
	type ResultSet rs=Db.select("RELCODE,RELCODOVR,NAM","CIF","ACN=:ACN")
	if rs.next() do {
		set fld(2)=rs.getCol("RELCODE")
		set fld(3)=rs.getCol("RELCODOVR")
		set fld(4)=rs.getCol("NAM")
		}
	
	// If returning direct or indirect data...
	if TYPE<3 set X=$$TCUSTBAL^CIFCDI(ACN,,(TYPE-1),HHTYP,.RTSTRN)

	// If returning related account data...
	if TYPE=3 set X=$$THHBAL^CIFCDI(ACN,,HHTYP,.RTSTRN)

	// If returning account summary data...
	if TYPE=4 do {
		// First get direct and indirect deposit and loan
		type ResultSet rs=Db.select("THDBAL,THDLBAL,THIBAL,THILBAL","CIF","ACN=:ACN")
		if rs.next() set X=rs.getCol("THDBAL")_$CHAR(9)_rs.getCol("THDLBAL")_$CHAR(9)_rs.getCol("THIBAL")_$CHAR(9)_rs.getCol("THILBAL")

		// Then get related for deposit and loan
		set X=X_$CHAR(9)_$$THHBAL^CIFCDI(ACN,"D",HHTYP)_$CHAR(9)_$$THHBAL^CIFCDI(ACN,"L",HHTYP)

		// Then get summary totals
		set TOTALD=X.piece($CHAR(9),1)+X.piece($CHAR(9),3)+X.piece($CHAR(9),5)
		set TOTALL=X.piece($CHAR(9),2)+X.piece($CHAR(9),4)+X.piece($CHAR(9),6)
		set X=X_$CHAR(9)_TOTALD_$CHAR(9)_TOTALL_$CHAR(13,10)
		}
	
	// If returning total detail data...
	if TYPE=5 do {
		set X=$$TCUSTBAL^CIFCDI(ACN,,0,HHTYP,.RTSTRD)
		set X=$$TCUSTBAL^CIFCDI(ACN,,1,HHTYP,.RTSTRI)
		set X=$$THHBAL^CIFCDI(ACN,,HHTYP,.RTSTRR)
		}
	
	// Set value for return string - RTSTRN is set up in CIFCDI.

	if TYPE<4 do {
		// If no data, force a summary line to appear on datawindow by
		// returning empty line
		if RTSTRN("D").get()="" set RTSTRN("D")=$CHAR(9)_$CHAR(9)_$CHAR(9)_$CHAR(9)_$CHAR(9)_"D"_$CHAR(9)_$CHAR(13,10)
		if RTSTRN("L").get()="" set RTSTRN("L")=$CHAR(9)_$CHAR(9)_$CHAR(9)_$CHAR(9)_$CHAR(9)_"L"_$CHAR(9)_$CHAR(13,10)
		set fld(1)=RTSTRN("D")_RTSTRN("L")
		}

	// Return account summary data
	if TYPE=4 set fld(1)=X

	// Return account total detail data
	if TYPE=5 do {
		// If no data, force a summary line to appear on datawindow by
                // returning empty line
		if RTSTRD("D").get()="" set RTSTRD("D")=$CHAR(9)_$CHAR(9)_$CHAR(9)_$CHAR(9)_$CHAR(9)_"D"_$CHAR(9)_"1"_$CHAR(13,10)
		if RTSTRD("L").get()="" set RTSTRD("L")=$CHAR(9)_$CHAR(9)_$CHAR(9)_$CHAR(9)_$CHAR(9)_"L"_$CHAR(9)_"1"_$CHAR(13,10)
		if RTSTRI("D").get()="" set RTSTRI("D")=$CHAR(9)_$CHAR(9)_$CHAR(9)_$CHAR(9)_$CHAR(9)_"D"_$CHAR(9)_"2"_$CHAR(13,10)
                if RTSTRI("L").get()="" set RTSTRI("L")=$CHAR(9)_$CHAR(9)_$CHAR(9)_$CHAR(9)_$CHAR(9)_"L"_$CHAR(9)_"2"_$CHAR(13,10)
		if RTSTRR("D").get()="" set RTSTRR("D")=$CHAR(9)_$CHAR(9)_$CHAR(9)_$CHAR(9)_$CHAR(9)_"D"_$CHAR(9)_"3"_$CHAR(13,10)
                if RTSTRR("L").get()="" set RTSTRR("L")=$CHAR(9)_$CHAR(9)_$CHAR(9)_$CHAR(9)_$CHAR(9)_"L"_$CHAR(9)_"3"_$CHAR(13,10)
		set fld(1)=RTSTRD("D")_RTSTRD("L")_RTSTRI("D")_RTSTRI("L")_RTSTRR("D")_RTSTRR("L")
		}

	set return=$$V2LV^MSG(.fld,"",0)	
	if ER>0 quit $$ERRMSG^PBSUTL(RM,ET)
	quit ""
 #OPTION ResultClass ON
Public String vSIG()	quit "60165^30788^Panyaram, Sreeram^4246"	// Signature - LTD^TIME^USER^SIZE
