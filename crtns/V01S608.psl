V01S608(Number %ProcessMode,RecordUSRFRE fUSRFRE,RecordUSRFRER fUSRFRER())   //PBS - LN - SID= <USRFRE1> Irregular Frequency - Repeats Yearly
 ;;Copyright(c)2007 Sanchez Computer Associates, Inc.  All Rights Reserved - 08/30/2007 14:35 - joynerd
 // /*
 // This screen contains fields used to specify attributes for irregular user
 // frequencies that repeat yearly (Type 1).  It is displayed when a user runs the
 // New User-Defined Frequency (UFRE001), User-Defined Frequency Maintenance
 // (UFRE002), User-Defined Frequency Inquiry (UFRE003), or User-Defined Frequency
 // Deletion (UFRE004) function for a frequency type of 1.
 // See the Frequencies/Calendars Manual for further information.
 // */
  /*
ORIG: CHENARDP - 03/03/2003
DESC: PSL Screen Compiler Template

---- Comments --------------------------------------------------------
	This procedure is used as the base template for the PSL screen compiler.
	It is referenced by the PSL screen compiler - procedure DBS2PSL4
	
	
---- Revision History ------------------------------------------------
	02/18/07 - Pete Chenard - CR23555
		   Corrected compiler warnings.
		   
	02/23/06 - Pete Chenard - CR19551
		   Fixed routine label.
		   
	05/19/05 - Pete Chenard - CR 14146
		   Modified to type variables.
		   
	12/1/03 - Spier -cr7178
	   	     Modifications to correct dead code warnings and
	   	     other issues that occurred during mass compile of screens.

	09/24/03 - Pete Chenard - 45497
		       Created screen template for compiler.
----------------------------------------------------------------------

 */

 #WARN SCOPE OFF
	type Public String %MODS,%PAGE,%PG,%REPEAT,ER,RM
	type String KEYS(),KVAR,VFSN(),VO,VODFT,VPGM,vPSL,VSID,VSNAME

	// %O (0-Create  1-Modify  2-Inquiry  3-Delete  4-Print  5-Blank screen)

	set:'%ProcessMode.exists() %ProcessMode=5
 if (%ProcessMode = 5) do {
  if 'fUSRFRE.exists() set fUSRFRE = Class.new("RecordUSRFRE")
  if 'fUSRFRER(1).exists() set fUSRFRER(1) = Class.new("RecordUSRFRER")
 }
 set KVAR="kill %TAB,VFSN,VO,VPTBL,vtab",VSID="USRFRE1",VPGM=$T(+0),VSNAME="Irregular Frequency - Repeats Yearly"
 set VFSN("USRFRE")="zfUSRFRE",VFSN("USRFRER")="zfUSRFRER"
 set vPSL=1
 //
	// ==================== Display blank screen         (%O=5)

 if %ProcessMode=5 set %MODS=1,%REPEAT=15 do VPR(.fUSRFRE,.fUSRFRER()),VDA1(.fUSRFRE,.fUSRFRER()),V5^DBSPNT quit

 if '%ProcessMode do VNEW(.fUSRFRE,.fUSRFRER()),VPR(.fUSRFRE,.fUSRFRER()),VDA1(.fUSRFRE,.fUSRFRER())
 if %ProcessMode do VLOD(.fUSRFRE,.fUSRFRER()) quit:$G(ER)  do VPR(.fUSRFRE,.fUSRFRER()),VDA1(.fUSRFRE,.fUSRFRER())

	// ====================  Display Form
	do ^DBSPNT()
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=XECUTE
	if %ProcessMode=2!(%ProcessMode=3) do ^DBSCRT8A X:'$D(%PAGE) KVAR quit  // Inquiry/Delete
	// ====================  Set up data entry control table


 if %ProcessMode<2 do VTAB(.fUSRFRE,.fUSRFRER())
	quit


VNEW(RecordUSRFRE fUSRFRE,RecordUSRFRER fUSRFRER()) // Initialize arrays if %O=0
 
 do VDEF(.fUSRFRE,.fUSRFRER())
 do VLOD(.fUSRFRE,.fUSRFRER())
 #ACCEPT Date=11/5/03;PGM=Screen Compiler;CR=UNKNOWN;GROUP=SYNTAX
 quit
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEAD
	quit
	
VDEF(RecordUSRFRE fUSRFRE,RecordUSRFRER fUSRFRER())
 quit:fUSRFRE.UFRE.isNull() 
 quit:%ProcessMode  set ER=0 if (fUSRFRE.UFRE="") set ER=1,RM=$$^MSG(1767,"UFRE") Q
 if Db.isDefined("USRFRE","USRFRE.UFRE=:fUSRFRE.UFRE") S ER=1,RM=$$^MSG(2327) Q
 do fUSRFRE.setAuditFlag(1)
 if fUSRFRE.BD="" set fUSRFRE.BD="A"
 #ACCEPT Date=11/5/03;PGM=Screen Compiler;CR=UNKNOWN;GROUP=SYNTAX
 quit
 ;
VLOD(RecordUSRFRE fUSRFRE,RecordUSRFRER fUSRFRER()) // Load data from disc - %O = (1-5)
 if '$D(%REPEAT) set %REPEAT=15
 if '$D(%MODS) set %MODS=1
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEAD
	quit


	type Public String %MODS,%REPEAT
	quit
	

VPR(RecordUSRFRE fUSRFRE,RecordUSRFRER fUSRFRER()) // Display screen prompts
 set VO="4||13|"
 set VO(0)="|0"
 set VO(1)=$C(1,21,36,1,0,0,0,0,0,0)_"01TIrregular Frequency - Repeats Yearly"
 set VO(2)=$C(4,13,10,0,0,0,0,0,0,0)_"01TFrequency:"
 set VO(3)=$C(5,10,13,1,0,0,0,0,0,0)_"01T Description:"
 set VO(4)=$C(6,1,22,1,0,0,0,0,0,0)_"01T Business Date Option:"
 if '%MODS.exists() set %MODS=1
 set DY=8 for I=%MODS:1:%REPEAT+%MODS-1 do VRPR(.fUSRFRE,.fUSRFRER())
 set VO=(+VO)_"|"_(VO+1)_"|13" quit  // BOD pointer
 
VRPR(RecordUSRFRE fUSRFRE,RecordUSRFRER fUSRFRER())  // Display prompts %REPEAT times
 
 set VO(VO+1)=$C(DY,15,1,0,0,0,0,0,0,0)_"01T:"
 set VO=VO+1,DY=DY+1
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEAD
	quit


VDA1(RecordUSRFRE fUSRFRE,RecordUSRFRER fUSRFRER())  // Display screen data
 new V
 //
 set VX=$P(VO,"|",2)
 set VO(VX+0)=$C(4,24,12,2,0,0,0,0,0,0)_"01T"_$E(fUSRFRE.UFRE,1,12)
 set VO(VX+1)=$C(5,24,30,2,0,0,0,0,0,0)_"00T"_$E(fUSRFRE.DESC,1,30)
 set VO(VX+2)=$C(6,24,1,2,0,0,0,0,0,0)_"00U"_$E(fUSRFRE.BD,1,1)
  
 set:'%MODS.exists() %MODS=1 set VX=VO.piece("|",2)+2,DY=8 for I=%MODS:1:%REPEAT+%MODS-1 do VRDA(.fUSRFRE,.fUSRFRER())
 set VO.piece("|",1)=VX quit  // EOD pointer
 
VRDA(RecordUSRFRE fUSRFRE,RecordUSRFRER fUSRFRER())  // Display data %REPEAT times
 //instantiate new object if necessary
  #ACCEPT;DATE=08/08/06; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEPRECATED
  if 'fUSRFRER(I).getPointer() do {
     set fUSRFRER(I)=Class.new("RecordUSRFRER","")
     }
 set VO(VX+1)=$C(DY,5,10,2,0,0,0,0,0,0)_"01T"_$E(fUSRFRER(I).MONNAME,1,10)
 set VO(VX+2)=$C(DY,20,2,2,0,0,0,0,0,0)_"00T"_$E(fUSRFRER(I).DATE1,1,2)
 set VO(VX+3)=$C(DY,30,2,2,0,0,0,0,0,0)_"00T"_$E(fUSRFRER(I).DATE2,1,2)
 set VO(VX+4)=$C(DY,40,2,2,0,0,0,0,0,0)_"00T"_$E(fUSRFRER(I).DATE3,1,2)
 set VO(VX+5)=$C(DY,50,2,2,0,0,0,0,0,0)_"00T"_$E(fUSRFRER(I).DATE4,1,2)
 set VO(VX+6)=$C(DY,60,2,2,0,0,0,0,0,0)_"00T"_$E(fUSRFRER(I).DATE5,1,2)
 set VO(VX+7)=$C(DY,70,2,2,0,0,0,0,0,0)_"00T"_$E(fUSRFRER(I).DATE6,1,2)
 set DY=DY+1,VX=VX+7
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEAD
	quit
	
	
VTAB(RecordUSRFRE fUSRFRE,RecordUSRFRER fUSRFRER())
 
 kill VSCRPP,REQ,%TAB,%MOD,%MODOFF,%MODGRP,%REPREQ,vtab set %MODGRP=1
 set %MODOFF=3,%MOD=7,%MAX=(%MOD*%REPEAT)+%MODOFF,VPT=1,VPB=7+%REPEAT,BLKSIZ=(22*%REPEAT)+43,PGM=$T(+0),DLIB="SYSDEV",DFID="USRFRE,USRFRER"
 set OLNTB=VPB*1000
 
 set VFSN("USRFRE")="zfUSRFRE",VFSN("USRFRER")="zfUSRFRER"
 //
 for I=11:1:%MAX set %TAB(I)=""
	
	
 set %TAB(1)=$C(3,23,12)_"21T12401|1|[USRFRE]UFRE"
 set %TAB(2)=$C(4,23,30)_"01T12401||[USRFRE]DESC"
 set %TAB(3)=$C(5,23,1)_"01U12407||[USRFRE]BD|[STBLBUSOPT]"
 set %TAB(4)=$C(7,4,10)_"20T12401|1|[USRFRER]MONNAME"
 set %TAB(5)=$C(7,19,2)_"00T12402|1|[USRFRER]DATE1||if X?1""e""!(X?1""E"")!(X?1N.N)|||1"
 set %TAB(6)=$C(7,29,2)_"00T12403|1|[USRFRER]DATE2||if X?1""e""!(X?1""E"")!(X?1N.N)|||1"
 set %TAB(7)=$C(7,39,2)_"00T12404|1|[USRFRER]DATE3||if X?1""e""!(X?1""E"")!(X?1N.N)|||1"
 set %TAB(8)=$C(7,49,2)_"00T12405|1|[USRFRER]DATE4||if X?1""e""!(X?1""E"")!(X?1N.N)|||1"
 set %TAB(9)=$C(7,59,2)_"00T12406|1|[USRFRER]DATE5||if X?1""e""!(X?1""E"")!(X?1N.N)|||1"
 set %TAB(10)=$C(7,69,2)_"00T12407|1|[USRFRER]DATE6||if X?1""e""!(X?1""E"")!(X?1N.N)|||1"
 do VTBL(.fUSRFRE,.fUSRFRER())
	do ^DBSCRT8 	// data entry
	quit


VREQ   // Create REQ() array
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEAD
	quit


VTBL(RecordUSRFRE fUSRFRE,RecordUSRFRER fUSRFRER()) //Create %TAB(array)
 	// 1 2 3  4 5   6   7-9 10-11
 	// DY,DX,SZ PT REQ TYPE DEL POS |NODE|ITEM NAME|TBL|FMT|PP|PRE|MIN|MAX|DEC

	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEAD
	quit


	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEAD
	quit


	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEAD
	quit								// User defined post processor's


VRV(V,L) quit V_$J("",L-$L(V))
VREPRNT
 type Public RecordUSRFRE fUSRFRE
 type Public RecordUSRFRER fUSRFRER()
 do VPR(.fUSRFRE,.fUSRFRER())
 do VDA1(.fUSRFRE,.fUSRFRER())
 do ^DBSPNT()
 quit

VW(RecordUSRFRE fUSRFRE,RecordUSRFRER fUSRFRER())
 do VDA1(.fUSRFRE,.fUSRFRER())
 do ^DBSPNT(10)
 quit

VDAPNT(RecordUSRFRE fUSRFRE,RecordUSRFRER fUSRFRER())
 do VDA1(.fUSRFRE,.fUSRFRER())
 do ^DBSPNT(0,2)
 quit

VDA
 type Public RecordUSRFRE fUSRFRE
 type Public RecordUSRFRER fUSRFRER()
 do VDA1(.fUSRFRE,.fUSRFRER())
 quit

	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEAD
	quit
 
vSET(sn,di,X)
 type Public RecordUSRFRE fUSRFRE
 if sn="USRFRE" do vSET1(.fUSRFRE,di,X)
 type Public RecordUSRFRER fUSRFRER()
 if sn="USRFRER" do vSET2(fUSRFRER(I(1)),di,X)
 #ACCEPT Date=11/5/03;PGM=Screen Compiler;CR=UNKNOWN;GROUP=SYNTAX
 quit
vSET1(RecordUSRFRE fUSRFRE,di,X)
 do fUSRFRE.setAuditFlag(1)
 set fUSRFRE.@di=X
 #ACCEPT Date=11/5/03;PGM=Screen Compiler;CR=UNKNOWN;GROUP=SYNTAX
 quit
vSET2(RecordUSRFRER fUSRFRER,di,X)
 do fUSRFRER.setAuditFlag(1)
 set fUSRFRER.@di=X
 #ACCEPT Date=11/5/03;PGM=Screen Compiler;CR=UNKNOWN;GROUP=SYNTAX
 quit
	
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEAD
	quit
vREAD(fid,di)
 type Public RecordUSRFRE fUSRFRE
 if fid="USRFRE" quit $$vREAD1(.fUSRFRE,di)
 type Public RecordUSRFRER fUSRFRER()
 if fid="USRFRER" quit $$vREAD2(fUSRFRER(I(1)),di)
 quit ""
vREAD1(RecordUSRFRE fUSRFRE,di)
 quit fUSRFRE.@di
vREAD2(RecordUSRFRER fUSRFRER,di)
 quit fUSRFRER.@di
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEAD
	quit
