public LNCALFP(RecordLN ln)	// Model Fixed Principal/Interest Loan
	/*


	---- Revision History ------------------------------------------------
  
	10/13/05 - S.Krishnan - CR16885
		   Top of the procedure is made as Public.

        07/26/05 - SkariahV- CR16679
	           Removed #WARN and #OPTIMIZE directives.
	              
	12/09/03 - CARROLLJ - CR7239
		   Corrected precedence error.

	03/27/03 - GRAY - 51351
		   Converted to PSL.


	*/


	type Number CID,DISAMF,FV,PRODIRC
	type String %PR(),CLS,GRP,LNP()

	// Account Class
	set CLS=ln.cls

	// Product Group
	set GRP=ln.grp

	// Original Disbursement Date
	set ln.odd=%SystemDate

	set LNP(1)=""
	set CID=ln.cid
	set FV=0

	do DIS1^LNCALC(.ln)

	// Disclosure - Prepaid Interest Amount
	set DISAMF=ln.crlmt-ln.orgfa-ln.comfa-ln.disppi

	// Distribution 1 Next Due
	set ln.schnd=ln.dist1nd

	// Distribution 1 Last Due
	set ln.schld=ln.dist1ld

	set PRODIRC=1

	set %PR(1)="I|1|1"
	set %PR(2)="P|1|"

	if '(ln.dist2fre).length() set %PR(2)=%PR(2)_1 do APR(.ln) quit

	if ln.dist1fre=ln.dist2fre set %PR(2)=%PR(2)_1 do APR(.ln) quit

	set %PR(2)=%PR(2)_2
	
	do APR(.ln)
	quit


Public APR(RecordLN ln)	// Calculate APR

	type Boolean AMOPT
	type Number IRR
	type Public String CF(),LNP()
	set AMOPT=1
	do CLS^LNAPR(.ln)

	/*
	Calculate net investment yield

	If the loan is modeled without deferred costs, skip the NINV calcula-
	tion and use APR (which should be the same as NINV).
	*/

	// Original Int/Div Rate
	if 'LNP(1).piece("|",4) set ln.iro=+ln.disapr quit

	set CF(0)=(((((ln.crlmt-ln.orgfa)-ln.comfa)-ln.aprapp)-ln.aprapp1)+LNP(1).piece("|",4))*(-1)
	set IRR=$$^UIRR(.CF,ln.dist1fre,ln.piacm,ln.iacm,ln.schld)

	// Original Int/Div Rate
	set ln.iro=IRR

	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "60186^24536^S. Krishnan^1580"	// Signature - LTD^TIME^USER^SIZE
