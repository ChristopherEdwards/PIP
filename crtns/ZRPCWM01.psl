ZRPCWM01( String RETURN, Number VERSN, String CTL, String CRDNUM, String CRDTYP, String CPINBLOCK, String NPINBLOCK, String CVV, String CVVTYP)
	/*
	Procedure ID: ZRPCWM01
	ORIG: 1141 - 02/16/2007
	DESC: Custom RPC to interface with ZHSMAPI for card PIN functions
	 
	ARGUMENTS:
                . RETURN	Return value		/TYP=T/REQ/MECH=REFNAM:W
                . VERSN		Version number		/TYP=N/REQ/MECH=VAL
                . CTL		Control	Flag		/TYP=N/REQ/MECH=VAL
				  	0 - Create PIN
				  	1 - Change PIN
				  	2 - Verify PIN
				  	3 - Verify CVV
                . CRDNUM	Card Number		/TYP=T/REQ/MECH=VAL
                . CRDTYP	Card Type		/TYP=T/REQ/MECH=VAL
                . CPINBLOCK	Current Pinblock	/TYP=T/NOREQ/MECH=VAL
                . NPINBLOCK	New Pinblock		/TYP=T/NOREQ/MECH=VAL
		. CVV		CVV			/TYP=T/NOREQ/MECH=VAL
		. CVVTYP	CVV Type		/TYP=T/NOREQ/MECH=VAL
					"CVV" 	- Verify CVV1
					"CVV2"	- Verify CVV2

         RETURNS:
                . $$     Error Message                  /TYP=T
                  Null= No Error
 
                . RETURN                                /TYP=T

 	
	 ---- Comments --------------------------------------------------------
	
	 ---- Revision History ------------------------------------------------
	
	 ****** Consider using setAuditFlag for all objects in this procedure
	   example :do dep.setAuditFlag(1)
	
	*/
	
	type public Boolean ER
	type Boolean ERV
	type public String ET,RM
 	type String ERRMSG
 
	set (ER,ERV)=0
	set (ERRMSG,RM)=""
	set RETURN=""
 
	do PROC(VERSN.get(),CTL.get(),CRDNUM.get(),CRDTYP.get(),CPINBLOCK.get(),NPINBLOCK.get(),CVV.get(), CVVTYP.get())
 
	if ERV set ER=1,RM=ERRMSG
 
	if ER quit $$ERRMSG^PBSUTL(RM)
 
	// Build return value
	set RETURN=$$V2LV^MSG(.RETURN)
 
	quit ""
	
public PROC( Number VERSN, String CTL, String CRDNUM, String CRDTYP, String CPINBLOCK, String NPINBLOCK, String CVV, String CVVTYP)

	type public String RETURN
	type public Boolean ER
	// Version number of client message is not compatible with server
	if VERSN'=1 do Runtime.setErrMSG("MSG","2951") quit:ER
 
 	set RETURN=""
 	
	if CTL="0" do {
		set RETURN=$$PINOFST^ZHSMAPI(CRDNUM,CRDTYP,NPINBLOCK)
	}
	else  if CTL="1" do {
		set RETURN=$$PINCHG^ZHSMAPI(CRDNUM,CRDTYP,CPINBLOCK,NPINBLOCK)
	}
	else  if CTL="2" do {
		set RETURN=$$VEROFST^ZHSMAPI(CRDNUM,CRDTYP,CPINBLOCK, "TERM")
	}
	else  if CTL="3" do {
		set RETURN=$$CVVCMP^ZHSMAPI(CRDNUM, CRDTYP, CVV, CVVTYP)
	}
	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "60802^57435^Mike Appleyard^2218"	// Signature - LTD^TIME^USER^SIZE
