V00S267(%ProcessMode,RecordDEP DEP,RecordLN LN)   //PBS - DBS - SID= <LNANE2> Single Account Escrow Re-Analysis 
 ;;Copyright(c)2006 Sanchez Computer Associates, Inc.  All Rights Reserved - 08/24/2006 11:28 - kini
  /*
ORIG: CHENARDP - 03/03/2003
DESC: PSL Screen Compiler Template

---- Comments --------------------------------------------------------
	This procedure is used as the base template for the PSL screen compiler.
	It is referenced by the PSL screen compiler - procedure DBS2PSL4
	
	
---- Revision History ------------------------------------------------
	02/23/06 - Pete Chenard - CR19551
		   Fixed routine label.
		   
	05/19/05 - Pete Chenard - CR 14146
		   Modified to type variables.
		   
	12/1/03 - Spier -cr7178
	   	     Modifications to correct dead code warnings and
	   	     other issues that occurred during mass compile of screens.

	09/24/03 - Pete Chenard - 45497
		       Created screen template for compiler.
----------------------------------------------------------------------

 */

 #WARN SCOPE OFF
	type Public String %MODS,%PAGE,%PG,%REPEAT,ER,RM
	type String KEYS(),KVAR,VFSN(),VO,VODFT,VPGM,vPSL,VSID,VSNAME

	// %O (0-Create  1-Modify  2-Inquiry  3-Delete  4-Print  5-Blank screen)

	set:'$D(%ProcessMode) %ProcessMode=5
 set KVAR="kill %TAB,VFSN,VO,VPTBL,vtab,CUSHO,CUSHF,CUSHA,SDO,SDA,ODA,DDA,SDML,ODML,SDMG,ODMG,DDML,DDMG,YN",VSID="LNANE2",VPGM=$T(+0),VSNAME="Single Account Escrow Re-Analysis "
 set VFSN("DEP")="zDEP",VFSN("LN")="zLN"
 set vPSL=1
 set KEYS(1)=DEP.CID
 //
	// ==================== Display blank screen         (%O=5)

 if %ProcessMode=5 do VPR(.DEP,.LN),VDA1(.DEP,.LN),^DBSPNT()

 set ER=0 do VSCRPRE(.DEP,.LN) if ER quit  // Screen Pre-Processor
 
 if '%ProcessMode do VNEW(.DEP,.LN),VPR(.DEP,.LN),VDA1(.DEP,.LN)
 if %ProcessMode do VLOD(.DEP,.LN) quit:$G(ER)  do VPR(.DEP,.LN),VDA1(.DEP,.LN)

	// ====================  Display Form
	do ^DBSPNT()
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	if %ProcessMode=2!(%ProcessMode=3) do ^DBSCRT8A X:'$D(%PAGE) KVAR quit  // Inquiry/Delete
	// ====================  Set up data entry control table


 if %ProcessMode<2 do VTAB(.DEP,.LN)
	quit


VNEW(RecordDEP DEP,RecordLN LN) // Initialize arrays if %O=0
 
 do VDEF(.DEP,.LN)
 do VLOD(.DEP,.LN)
 #ACCEPT Date=11/5/03;PGM=Screen Compiler
 quit
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit
	
VDEF(RecordDEP DEP,RecordLN LN)
 if DEP.AOMCODE="" set DEP.AOMCODE=0
 if DEP.NRNEGIPTY="" set DEP.NRNEGIPTY=0
 if DEP.NRPOSIPTY="" set DEP.NRPOSIPTY=0
 if DEP.NRPPTY="" set DEP.NRPPTY=0
 if DEP.NRWHPTY="" set DEP.NRWHPTY=0
 if DEP.ODT="" set DEP.ODT=TJD
 #ACCEPT Date=11/5/03;PGM=Screen Compiler
 quit
 ;
VLOD(RecordDEP DEP,RecordLN LN) // Load data from disc - %O = (1-5)
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit


	type Public String %MODS,%REPEAT
	quit
	

VPR(RecordDEP DEP,RecordLN LN) // Display screen prompts
 set VO="16||13|"
 set VO(0)="|0"
 set VO(1)=$C(1,28,24,1,0,0,0,0,0,0)_"01T Update Escrow Analysis "
 set VO(2)=$C(3,8,16,0,0,0,0,0,0,0)_"01TRounding Option:"
 set VO(3)=$C(5,9,15,0,0,0,0,0,0,0)_"01TCushion Option:"
 set VO(4)=$C(5,48,15,0,0,0,0,0,0,0)_"01TCushion Factor:"
 set VO(5)=$C(6,48,15,0,0,0,0,0,0,0)_"01TCushion Amount:"
 set VO(6)=$C(8,1,23,0,0,0,0,0,0,0)_"01TShtg/Deficiency Option:"
 set VO(7)=$C(9,8,16,0,0,0,0,0,0,0)_"01TShortage Amount:"
 set VO(8)=$C(9,48,15,0,0,0,0,0,0,0)_"01TOverage Amount:"
 set VO(9)=$C(10,6,18,0,0,0,0,0,0,0)_"01TDeficiency Amount:"
 set VO(10)=$C(12,4,20,0,0,0,0,0,0,0)_"01TShtg < Shortage Amt:"
 set VO(11)=$C(12,45,18,0,0,0,0,0,0,0)_"01TOvg < Overage Amt:"
 set VO(12)=$C(13,3,21,0,0,0,0,0,0,0)_"01TShtg >= Shortage Amt:"
 set VO(13)=$C(13,44,19,0,0,0,0,0,0,0)_"01TOvg >= Overage Amt:"
 set VO(14)=$C(15,3,21,0,0,0,0,0,0,0)_"01TDef < Deficiency Amt:"
 set VO(15)=$C(16,2,22,0,0,0,0,0,0,0)_"01TDef >= Deficiency Amt:"
 set VO(16)=$C(18,13,11,0,0,0,0,0,0,0)_"01TRe-Analyze:"
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit


VDA1(RecordDEP DEP,RecordLN LN)  // Display screen data
 new V
 s CUSHA=$G(CUSHA)
 s CUSHF=$G(CUSHF)
 s CUSHO=$G(CUSHO)
 s DDA=$G(DDA)
 s DDMG=$G(DDMG)
 s DDML=$G(DDML)
 s ODA=$G(ODA)
 s ODMG=$G(ODMG)
 s ODML=$G(ODML)
 s SDA=$G(SDA)
 s SDMG=$G(SDMG)
 s SDML=$G(SDML)
 s SDO=$G(SDO)
 s YN=$G(YN)
 //
 set VO="31|17|13|"
 set VO(17)=$C(3,25,1,2,0,0,0,0,0,0)_"00N"_LN.ROPT
 set VO(18)=$C(5,25,1,2,0,0,0,0,0,0)_"00N"_$G(CUSHO)
 set VO(19)=$C(5,64,12,2,0,0,0,0,0,0)_"00$"_$S($G(CUSHF)="":"",1:$J($G(CUSHF),0,9))
 set VO(20)=$C(6,64,12,2,0,0,0,0,0,0)_"00$"_$S($G(CUSHA)="":"",1:$J($G(CUSHA),0,2))
 set VO(21)=$C(8,25,1,2,0,0,0,0,0,0)_"00N"_$G(SDO)
 set VO(22)=$C(9,25,12,2,0,0,0,0,0,0)_"00$"_$S($G(SDA)="":"",1:$J($G(SDA),0,2))
 set VO(23)=$C(9,64,12,2,0,0,0,0,0,0)_"00$"_$S($G(ODA)="":"",1:$J($G(ODA),0,2))
 set VO(24)=$C(10,25,12,2,0,0,0,0,0,0)_"00$"_$S($G(DDA)="":"",1:$J($G(DDA),0,2))
 set VO(25)=$C(12,25,4,2,0,0,0,0,0,0)_"00T"_$G(SDML)
 set VO(26)=$C(12,64,1,2,0,0,0,0,0,0)_"00N"_$G(ODML)
 set VO(27)=$C(13,25,4,2,0,0,0,0,0,0)_"00T"_$G(SDMG)
 set VO(28)=$C(13,64,1,2,0,0,0,0,0,0)_"00N"_$G(ODMG)
 set VO(29)=$C(15,25,4,2,0,0,0,0,0,0)_"00T"_$G(DDML)
 set VO(30)=$C(16,25,4,2,0,0,0,0,0,0)_"00T"_$G(DDMG)
 set VO(31)=$C(18,25,1,2,0,0,0,0,0,0)_"00L"_$G(YN)
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit
	
	
VTAB(RecordDEP DEP,RecordLN LN)
 
 kill VSCRPP,REQ,%TAB,%MOD,%MODOFF,%MODGRP,%REPREQ,vtab
 set %MAX=15,VPT=1,VPB=18,PGM=$T(+0),DLIB="SYSDEV",DFID="DEP"
 set OLNTB=18025
 
 set VFSN("DEP")="zDEP",VFSN("LN")="zLN"
 //
 // 
	
	
 set %TAB(1)=$C(2,24,1)_"00N12427|1|[LN]ROPT|[STBLROPT]||do VP1^V00S267(.DEP,.LN)"
 set %TAB(2)=$C(4,24,1)_"00N|*CUSHO|[*]@CUSHO|[STBLCUSHO]||do VP2^V00S267(.DEP,.LN)"
 set %TAB(3)=$C(4,63,12)_"00$|*CUSHF|[*]@CUSHF|||do VP3^V00S267(.DEP,.LN)||||9"
 set %TAB(4)=$C(5,63,12)_"00$|*CUSHA|[*]@CUSHA|||do VP4^V00S267(.DEP,.LN)||||2"
 set %TAB(5)=$C(7,24,1)_"00N|*SDO|[*]@SDO|[STBLSDO]||do VP5^V00S267(.DEP,.LN)"
 set %TAB(6)=$C(8,24,12)_"00$|*SDA|[*]@SDA|||do VP6^V00S267(.DEP,.LN)||||2"
 set %TAB(7)=$C(8,63,12)_"00$|*ODA|[*]@ODA|||do VP7^V00S267(.DEP,.LN)||||2"
 set %TAB(8)=$C(9,24,12)_"00$|*DDA|[*]@DDA|||do VP8^V00S267(.DEP,.LN)||||2"
 set %TAB(9)=$C(11,24,4)_"00T|*SDML|[*]@SDML|[STBLTRDD]||do VP9^V00S267(.DEP,.LN)"
 set %TAB(10)=$C(11,63,1)_"00N|*ODML|[*]@ODML|[STBLODM]||do VP10^V00S267(.DEP,.LN)"
 set %TAB(11)=$C(12,24,4)_"00T|*SDMG|[*]@SDMG|[STBLTRDD]||do VP11^V00S267(.DEP,.LN)"
 set %TAB(12)=$C(12,63,1)_"00N|*ODMG|[*]@ODMG|[STBLODM]||do VP12^V00S267(.DEP,.LN)"
 set %TAB(13)=$C(14,24,4)_"00T|*DDML|[*]@DDML|[STBLTRDD]||do VP13^V00S267(.DEP,.LN)"
 set %TAB(14)=$C(15,24,4)_"00T|*DDMG|[*]@DDMG|[STBLTRDD]||do VP14^V00S267(.DEP,.LN)"
 set %TAB(15)=$C(17,24,1)_"00L|*YN|[*]@YN||||do VP15^V00S267(.DEP,.LN)"
 do VTBL(.DEP,.LN)
	do ^DBSCRT8 	// data entry
	quit


VREQ   // Create REQ() array
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit


VTBL(RecordDEP DEP,RecordLN LN) //Create %TAB(array)
 	// 1 2 3  4 5   6   7-9 10-11
 	// DY,DX,SZ PT REQ TYPE DEL POS |NODE|ITEM NAME|TBL|FMT|PP|PRE|MIN|MAX|DEC

	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit


	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit


  //user-defined post procs
 //
VP1(RecordDEP DEP,RecordLN LN) //
 type public String X
 type RecordLN ln=Db.getRecord("LN","CID=:CID",1)

 if ln.ropt'=X set ln.ropt=X
VP2(RecordDEP DEP,RecordLN LN) //
 type public Number CUSHO,X,SCUSHO,CUSHF,SCUSHF,CUSHA,SCUSHA 
 if CUSHO'=X do {
 		if '({String}SCUSHO.get().length()) set SCUSHO=CUSHO
       		if UX("LN","CUSHO").exists() set UX("LN","CUSHO")=SCUSHO_"|"_X_"|114|11",LN.CUSHO=X
      		else  set UX("DEP","CUSHO")=SCUSHO_"|"_X_"|114|11",DEP.CUSHO=X
       		set CUSHO=X
		}
 if X=1 do {
 		if {String}CUSHF.length() do {
			if '({String}SCUSHF.get().length()) set SCUSHF=CUSHF
       			if UX("LN","CUSHF").exists() set UX("LN","CUSHF")=SCUSHF_"||114|13",LN.CUSHF=""
      			else  set UX("DEP","CUSHF")=SCUSHF_"||114|13",DEP.CUSHF=""
			}
			do DELETE^DBSMACRO("@CUSHF","1","0")
			do GOTO^DBSMACRO("@CUSHA")
		}
 if X=0 do {
 		if {String}CUSHA.length() do {
                	if '({String}SCUSHA.get().length()) set SCUSHA=CUSHA
       			if UX("LN","CUSHA").exists() set UX("LN","CUSHA")=SCUSHA_"||114|12",LN.CUSHA=""
       			else  set UX("DEP","CUSHA")=SCUSHA_"||114|28",DEP.CUSHA=""
			}
       		do DELETE^DBSMACRO("@CUSHA","1","0")
		do GOTO^DBSMACRO("@CUSHF")
			
		}
 quit
VP3(RecordDEP DEP,RecordLN LN) //
 type public Number CUSHF,SCUSHF,X
 if CUSHF'=X do {
                 if '{String}SCUSHF.get().length() set SCUSHF=CUSHF
       		 if UX("LN","CUSHF").exists() set UX("LN","CUSHF")=SCUSHF_"|"_X_"|114|13",LN.CUSHF=X
        	 else  set UX("DEP","CUSHF")=SCUSHF_"|"_X_"|114|13",DEP.CUSHF=X
                 set CUSHF=X
                 }

 if X?.N1"/".N do {
       		type String Z

		#ACCEPT DATE=01/23/06;PGM=Srinivar
       		set Z="S X="_X xecute Z
       		set X=X.roundDec()
		set X=X.roundDec()
		}
 quit
VP4(RecordDEP DEP,RecordLN LN) //
 type public Number CUSHA,SCUSHA,X,CUSH
 if CUSHA'=X do {
		 if '{String}SCUSHA.get().length() set SCUSHA=CUSHA
 		 if UX("LN","CUSHA").exists() set UX("LN","CUSHA")=SCUSHA_"|"_X_"|114|12",LN.CUSHA=X
		 else  set UX("DEP","CUSHA")=SCUSHA_"|"_X_"|114|12",DEP.CUSHA=X
		 set CUSHA=X,CUSH=CUSHA
		}
 quit  
VP5(RecordDEP DEP,RecordLN LN) //
 type public Number X,SDO
 if SDO'=X do {
       		if UX("LN","SDO").exists() set UX("LN","SDO")=SDO.get()_"|"_X_"|114|10",LN.SDO=X
      		else  set UX("DEP","SDO")=SDO.get()_"|"_X_"|114|10",DEP.SDO=X
 		}
 quit
VP6(RecordDEP DEP,RecordLN LN) //
 type public Number SDA
 set SDA=SDA.get()
 type public Number SSDA,SDA,X
 if SDA'=X do {
               	if '({String}SSDA.get().length()) set SSDA=SDA
       		if UX("LN","SDA").exists() set UX("LN","SDA")=SSDA_"|"_X_"|114|8",LN.SDA=X
      		else  set UX("DEP","SDA")=SSDA_"|"_X_"|114|8",DEP.SDA=X
                set SDA=X
		}
 quit
VP7(RecordDEP DEP,RecordLN LN) //
 type public Number ODA,SODA,X
 if ODA'=X do {
  		if '({String}SODA.get().length()) set SODA=ODA
       		if UX("LN","ODA").exists() set UX("LN","ODA")=SODA_"|"_X_"|114|7",LN.ODA=X
      		else  set UX("DEP","ODA")=SODA_"|"_X_"|114|7",DEP.ODA=X
       		set ODA=X
		}
 quit
VP8(RecordDEP DEP,RecordLN LN) //
 type public String DDA,SDDA,X
 if DDA'=X do {
     		if '({String}SDDA.get().length()) set SDDA=DDA
      		if UX("LN","DDA").exists() set UX("LN","DDA")=SDDA_"|"_X_"|114|9",LN.DFDA=X
                else  set UX("DEP","DDA")=SDDA_"|"_X_"|114|9",DEP.DFDA=X
       		set DDA=X
		} 
 quit

VP9(RecordDEP DEP,RecordLN LN) //
 type public Number SDML,SSDML

 if SDML'=X do {
       		if '({String}SSDML.get().length()) set SSDML=SDML
       		if UX("LN","SDML").exists() set UX("LN","SDML")=SSDML_"|"_X_"|114|2",LN.SDML=X
		else  set UX("DEP","SDML")=SSDML_"|"_X_"|114|2",DEP.SDML=X
		}
 quit
VP10(RecordDEP DEP,RecordLN LN) //
 type public Number ODML,SODML,X
 if ODML'=X do {
       		if '({String}SODML.get().length()) set SODML=ODML

		if UX("LN","ODML").exists() set UX("LN","ODML")=SODML_"|"_X_"|114|6",LN.ODML=X
                else  set UX("DEP","ODML")=SODML_"|"_X_"|114|6",DEP.ODML=X
		}
 quit
VP11(RecordDEP DEP,RecordLN LN) //
 type public String DDMG,SSDMG,X
 if SDMG'=X do {
                if '(SSDMG.get().length()) set SSDMG=SDMG
       		if UX("LN","SDMG").exists() set UX("LN","SDMG")=SSDMG_"|"_X_"|114|1",LN.SDMG=X
      		else  set UX("DEP","SDMG")=SSDMG_"|"_X_"|114|1",DEP.SDMG=X
		}
 quit
VP12(RecordDEP DEP,RecordLN LN) //
 type public Number ODMG,SODMG,X
 if ODMG'=X do {
       		if '({String}SODMG.get().length()) set SODMG=ODMG
      		if UX("LN","ODMG").exists() set UX("LN","ODMG")=SODMG_"|"_X_"|114|5",LN.ODMG=X
       		else  set UX("DEP","ODMG")=SODMG_"|"_X_"|114|5",DEP.ODMG=X
 		}
 quit
VP13(RecordDEP DEP,RecordLN LN) //
 type public String DDML,SDDML,X
 if DDML'=X do {
   		if '(SDDML.get().length()) set SDDML=DDML
       		if UX("LN","DDML").exists() set UX("LN","DDML")=SDDML_"|"_X_"|114|4",LN.DDML=X
       		else  set UX("DEP","DDML")=SDDML_"|"_X_"|114|4",DEP.DDML=X
      		}
 quit
VP14(RecordDEP DEP,RecordLN LN) //
 if DDMG'=X do {
       		if '(SDDMG.get().length()) set SDDMG=DDMG
      		if UX("LN","DDMG").exists() set UX("LN","DDMG")=SDDMG_"|"_X_"|114|3",LN.DDMG=X
                else  set UX("DEP","DDMG")=SDDMG_"|"_X_"|114|3",DEP.DDMG=X
		}
 quit
VP15(RecordDEP DEP,RecordLN LN) //
 type public String X,YN

 set (X,YN)="N"
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit								// User defined post processor's


VRV(V,L) quit V_$J("",L-$L(V))
VREPRNT
 type Public RecordDEP DEP
 type Public RecordLN LN
 do VPR(.DEP,.LN)
 do VDA1(.DEP,.LN)
 do ^DBSPNT()
 quit

VW(RecordDEP DEP,RecordLN LN)
 do VDA1(.DEP,.LN)
 do ^DBSPNT(10)
 quit

VDAPNT(RecordDEP DEP,RecordLN LN)
 do VDA1(.DEP,.LN)
 do ^DBSPNT(0,2)
 quit

VDA
 type Public RecordDEP DEP
 type Public RecordLN LN
 do VDA1(.DEP,.LN)
 quit

	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit
 
vSET(sn,di,X)
 type Public RecordDEP DEP
 if sn="DEP" do vSET1(.DEP,di,X)
 type Public RecordLN LN
 if sn="LN" do vSET2(.LN,di,X)
 #ACCEPT Date=11/5/03;PGM=Screen Compiler
 quit
vSET1(RecordDEP DEP,di,X)
 do DEP.setAuditFlag(1)
 set DEP.@di=X
 #ACCEPT Date=11/5/03;PGM=Screen Compiler
 quit
vSET2(RecordLN LN,di,X)
 do LN.setAuditFlag(1)
 set LN.@di=X
 #ACCEPT Date=11/5/03;PGM=Screen Compiler
 quit
	
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit
vREAD(fid,di)
 type Public RecordDEP DEP
 if fid="DEP" quit $$vREAD1(.DEP,di)
 type Public RecordLN LN
 if fid="LN" quit $$vREAD2(.LN,di)
 quit ""
vREAD1(RecordDEP DEP,di)
 quit DEP.@di
vREAD2(RecordLN LN,di)
 quit LN.@di
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler
	quit
 //
VSCRPRE(RecordDEP DEP,RecordLN LN)  // Screen Pre-Processor
 new %TAB,vtab // Disable .MACRO. references to %TAB()
 //
 type public String YN
 set YN="N"
 #ACCEPT date=11/05/03;PGM=Screen Compiler
 quit
