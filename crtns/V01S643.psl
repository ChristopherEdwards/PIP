V01S643(Number %ProcessMode,RecordUTBLCOMINDX fCOMINDX)   // -  - SID= <UTBLCOMINDX> Commission Index User Table Maintenance
 ;;Copyright(c)2007 Sanchez Computer Associates, Inc.  All Rights Reserved - 08/30/2007 14:35 - joynerd
  /*
ORIG: CHENARDP - 03/03/2003
DESC: PSL Screen Compiler Template

---- Comments --------------------------------------------------------
	This procedure is used as the base template for the PSL screen compiler.
	It is referenced by the PSL screen compiler - procedure DBS2PSL4
	
	
---- Revision History ------------------------------------------------
	02/18/07 - Pete Chenard - CR23555
		   Corrected compiler warnings.
		   
	02/23/06 - Pete Chenard - CR19551
		   Fixed routine label.
		   
	05/19/05 - Pete Chenard - CR 14146
		   Modified to type variables.
		   
	12/1/03 - Spier -cr7178
	   	     Modifications to correct dead code warnings and
	   	     other issues that occurred during mass compile of screens.

	09/24/03 - Pete Chenard - 45497
		       Created screen template for compiler.
----------------------------------------------------------------------

 */

 #WARN SCOPE OFF
	type Public String %MODS,%PAGE,%PG,%REPEAT,ER,RM
	type String KEYS(),KVAR,VFSN(),VO,VODFT,VPGM,vPSL,VSID,VSNAME

	// %O (0-Create  1-Modify  2-Inquiry  3-Delete  4-Print  5-Blank screen)

	set:'%ProcessMode.exists() %ProcessMode=5
 if (%ProcessMode = 5) do {
  if 'fCOMINDX.exists() set fCOMINDX = Class.new("RecordUTBLCOMINDX")
 }
 set KVAR="kill %TAB,VFSN,VO,VPTBL,vtab",VSID="UTBLCOMINDX",VPGM=$T(+0),VSNAME="Commission Index User Table Maintenance"
 set VFSN("UTBLCOMINDX")="zfCOMINDX"
 set vPSL=1
 set KEYS(1)=fCOMINDX.CINDEX
 //
	// ==================== Display blank screen         (%O=5)

 if %ProcessMode=5 do VPR(.fCOMINDX),VDA1(.fCOMINDX),^DBSPNT() quit

 if '%ProcessMode do VNEW(.fCOMINDX),VPR(.fCOMINDX),VDA1(.fCOMINDX)
 if %ProcessMode do VLOD(.fCOMINDX) quit:$G(ER)  do VPR(.fCOMINDX),VDA1(.fCOMINDX)

	// ====================  Display Form
	do ^DBSPNT()
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=XECUTE
	if %ProcessMode=2!(%ProcessMode=3) do ^DBSCRT8A X:'$D(%PAGE) KVAR quit  // Inquiry/Delete
	// ====================  Set up data entry control table


 if %ProcessMode<2 do VTAB(.fCOMINDX)
	quit


VNEW(RecordUTBLCOMINDX fCOMINDX) // Initialize arrays if %O=0
 
 do VDEF(.fCOMINDX)
 do VLOD(.fCOMINDX)
 #ACCEPT Date=11/5/03;PGM=Screen Compiler;CR=UNKNOWN;GROUP=SYNTAX
 quit
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEAD
	quit
	
VDEF(RecordUTBLCOMINDX fCOMINDX)
 #ACCEPT Date=11/5/03;PGM=Screen Compiler;CR=UNKNOWN;GROUP=SYNTAX
 quit
 ;
VLOD(RecordUTBLCOMINDX fCOMINDX) // Load data from disc - %O = (1-5)
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEAD
	quit


	type Public String %MODS,%REPEAT
	quit
	

VPR(RecordUTBLCOMINDX fCOMINDX) // Display screen prompts
 set VO="5||13|0"
 set VO(0)="|0"
 set VO(1)=$C(4,15,18,0,0,0,0,0,0,0)_"01T Commission Index:"
 set VO(2)=$C(5,20,13,0,0,0,0,0,0,0)_"01T Description:"
 set VO(3)=$C(6,14,19,0,0,0,0,0,0,0)_"01T Tiered Index Type:"
 set VO(4)=$C(7,16,17,0,0,0,0,0,0,0)_"01T Commission Type:"
 set VO(5)=$C(8,18,15,0,0,0,0,0,0,0)_"01T Currency Code:"
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEAD
	quit


VDA1(RecordUTBLCOMINDX fCOMINDX)  // Display screen data
 new V
 //
 set VO="11|6|13|0"
 set VO(6)=$C(1,1,80,1,0,0,0,0,0,0)_"01T"_$S(%ProcessMode=5:"",1:$$BANNER^UTLREAD(%FN.get()))
 set VO(7)=$C(4,34,12,0,0,0,0,0,0,0)_"01T"_$E(fCOMINDX.CINDEX,1,12)
 set VO(8)=$C(5,34,40,0,0,0,0,0,0,0)_"00T"_$E(fCOMINDX.DESCR,1,40)
 set VO(9)=$C(6,34,1,0,0,0,0,0,0,0)_"00T"_$E(fCOMINDX.INDTYP,1,1)
 set VO(10)=$C(7,34,1,0,0,0,0,0,0,0)_"00N"_fCOMINDX.COMTYPE
 set VO(11)=$C(8,34,3,0,0,0,0,0,0,0)_"00T"_$E(fCOMINDX.CRCD,1,3)
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEAD
	quit
	
	
VTAB(RecordUTBLCOMINDX fCOMINDX)
 
 kill VSCRPP,REQ,%TAB,%MOD,%MODOFF,%MODGRP,%REPREQ,vtab
 set %MAX=5,VPT=1,VPB=8,PGM=$T(+0),DLIB="SYSDEV",DFID="UTBLCOMINDX"
 set OLNTB=8034
 
 set VFSN("UTBLCOMINDX")="zfCOMINDX"
 //
 // 
	
	
 set %TAB(1)=$C(3,33,12)_"21T12401|1|[UTBLCOMINDX]CINDEX"
 set %TAB(2)=$C(4,33,40)_"00T12401|1|[UTBLCOMINDX]DESCR"
 set %TAB(3)=$C(5,33,1)_"01T12402|1|[UTBLCOMINDX]INDTYP|[STBLINDTYP]"
 set %TAB(4)=$C(6,33,1)_"01N12403|1|[UTBLCOMINDX]COMTYPE|[STBLCOMTYPE]||do VP1^V01S643(.fCOMINDX)"
 set %TAB(5)=$C(7,33,3)_"01T12404|1|[UTBLCOMINDX]CRCD|[CRCD]"
 do VTBL(.fCOMINDX)
	do ^DBSCRT8 	// data entry
	quit


VREQ   // Create REQ() array
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEAD
	quit


VTBL(RecordUTBLCOMINDX fCOMINDX) //Create %TAB(array)
 	// 1 2 3  4 5   6   7-9 10-11
 	// DY,DX,SZ PT REQ TYPE DEL POS |NODE|ITEM NAME|TBL|FMT|PP|PRE|MIN|MAX|DEC

	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEAD
	quit


	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEAD
	quit


  //user-defined post procs
 //
VP1(RecordUTBLCOMINDX fCOMINDX) //
 /* If this is changed and values are already set up in the user table for 
    an effective date, then this needs to be removed and added again
    in order to change the commission type.
 */
 
 type public Number CINDEX,V,X
 type Date EFD

 if X=V quit
 set EFD=""

 type ResultSet rs=Db.select("EFD","UTBLCOMINDX1", "CINDEX=:CINDEX","EFD DESC") 
 if rs.next() set EFD=rs.getCol("EFD")

 if EFD.isNull() quit
 // Remove tier data items from index before maintaining index type
 do Runtime.setErrMSG("UTBLCOMINDX",905)
 set X=V
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEAD
	quit								// User defined post processor's


VRV(V,L) quit V_$J("",L-$L(V))
VREPRNT
 type Public RecordUTBLCOMINDX fCOMINDX
 do VPR(.fCOMINDX)
 do VDA1(.fCOMINDX)
 do ^DBSPNT()
 quit

VW(RecordUTBLCOMINDX fCOMINDX)
 do VDA1(.fCOMINDX)
 do ^DBSPNT(10)
 quit

VDAPNT(RecordUTBLCOMINDX fCOMINDX)
 do VDA1(.fCOMINDX)
 do ^DBSPNT(0,2)
 quit

VDA
 type Public RecordUTBLCOMINDX fCOMINDX
 do VDA1(.fCOMINDX)
 quit

	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEAD
	quit
 
vSET(sn,di,X)
 type Public RecordUTBLCOMINDX fCOMINDX
 if sn="UTBLCOMINDX" do vSET1(.fCOMINDX,di,X)
 #ACCEPT Date=11/5/03;PGM=Screen Compiler;CR=UNKNOWN;GROUP=SYNTAX
 quit
vSET1(RecordUTBLCOMINDX fCOMINDX,di,X)
 do fCOMINDX.setAuditFlag(1)
 set fCOMINDX.@di=X
 #ACCEPT Date=11/5/03;PGM=Screen Compiler;CR=UNKNOWN;GROUP=SYNTAX
 quit
	
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEAD
	quit
vREAD(fid,di)
 type Public RecordUTBLCOMINDX fCOMINDX
 if fid="UTBLCOMINDX" quit $$vREAD1(.fCOMINDX,di)
 quit ""
vREAD1(RecordUTBLCOMINDX fCOMINDX,di)
 quit fCOMINDX.@di
	#ACCEPT DATE=11/05/03; PGM=Screen Compiler;CR=UNKNOWN;GROUP=DEAD
	quit
