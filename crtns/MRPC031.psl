MRPC031(RETURN,VERSN,ACN,RPASEQ,PLAN)	//Public;MRPC call for Minimum Annual Distriubtion Modeler (RPA006)
	/*
	   DESC: Minimum Annual Distribution Modeler
	   KEYWORDS: RPC

	   ARGUMENTS:
	         . RETURN        Minimum Annual Distribution.	/TYP=T/REQ/MECH=REFNAM:W

	         . VERSN         ^MRPC031 version number	/TYP=N/REQ/MECH=VAL
	                         current version=1

	         . ACN           Customer Number		/TYP=N/REQ/MECH=VAL

	         . RPASEQ        RPA Sequence Number		/TYP=N/REQ/MECH=VAL

	   . PLAN          Jan 1 Plan Value			/TYP=N/REQ/MECH=VAL

	   RETURNS:
	         . $$    Error Message				/TYP=T
	                 Null= No Error

	   RELATED:
	         . $$^PBSMRPC - MRPC Service Class Driver

	   EXAMPLE:
	         set RM=$$^MRPC031(.VAL,1,ACN,RPASEQ,PLAN)
	-----  Revision History -----------------------------------------------
	
	04/27/07 - Mugilvannan - CR26823
		   Modified to set the variable X for the return value, which was
		   originally done in RSPMADA.PROC.
		   
	11/14/02 - ZWITKOWITSM - 43583
		   Convert to PSL.

	*/

	new ET,IAR,LIVE,MODELER,Q,RSPTYP,SWITCH
	type String X

	set (IAR,LIVE,%ProcessMode,SWITCH)=0

	// Version number of client message is not compatible with server
	if $G(VERSN)'=1 quit $$ERRMSG^PBSUTL($$^MSG(2951))

	type RecordCIF cif=Db.getRecord("CIF","ACN",1)

	// Invalid customer number
	if cif.getMode()=0 quit $$ERRMSG^PBSUTL($$^MSG(1295))

	// Verify RPASEQ
	set X=$G(RPASEQ)
	do RSPPP^RSPMADA
	if ER quit $$ERRMSG^PBSUTL(RM)

	// Verify PLAN
	if PLAN'="" set MODELER=1

	do EXEC^RSPMADA(.cif)
	if ER quit $$ERRMSG^PBSUTL(RM)
	
	type RecordMADCALC madcalc=Db.getRecord("MADCALC","ACN=:ACN,RPASEQ=:RPASEQ")

	set $P(X,"|",1)=madcalc.iratyp
	set $P(X,"|",2)=madcalc.nam
	set $P(X,"|",3)=madcalc.taxid
	set $P(X,"|",4)=madcalc.planid
	set $P(X,"|",5)=madcalc.planman
	set $P(X,"|",6)=madcalc.madamt
	set $P(X,"|",7)=madcalc.rspmado
	set $P(X,"|",8)=madcalc.rspmadb
	set $P(X,"|",9)=madcalc.pvmad
	set $P(X,"|",10)=madcalc.dob
	set $P(X,"|",11)=madcalc.madsdob
	set $P(X,"|",12)=madcalc.autupd
	set $P(X,"|",13)=madcalc.autamt
	set $P(X,"|",14)=madcalc.autfre
	set $P(X,"|",15)=madcalc.autdnd
	set $P(X,"|",16)=madcalc.madsat
	set $P(X,"|",17)=madcalc.origmad
	set $P(X,"|",18)=madcalc.maxlif
	set $P(X,"|",19)=madcalc.maxaut
	set $P(X,"|",20)=madcalc.maxlifp
	

	// Create formatted output string
	set TAB=$C(9)
	set CRLF=$C(13,10)
	set STR=""
	// IRATYP,NAM,TAXID,PLANID,PLANMAN,MADAMT,RSPMAD0,RSPMADB,PVMAD,DOB
	// MADSDOB,AUTUPD,AUTAMT,AUTFRE,AUTDND,MADSAT,ORIGMAD,MAXLIF,MAXAUT,MAXLIFP
	set STR=STR_$TR(X,"|",TAB)_CRLF
	set RETURN=$$V2LV^MSG(STR)

	quit ""
 #OPTION ResultClass ON
Public String vSIG()	quit "60747^38341^Saravanamuthu Mugilvannan^2444"	// Signature - LTD^TIME^USER^SIZE
