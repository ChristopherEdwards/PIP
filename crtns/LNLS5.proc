LNLS5	 /*
    ORIG: GRAY - 01/17/2000
    DESC: Post Participation Pool
    
    ---- Comments --------------------------------------------------------
    
    ---- Revision History ------------------------------------------------

	07/12/06 - KELLYP - CR 22154
		   Modified FILE section to prevent UNDEFINED errors from
		   occurring on variables that are only used for contra
		   account processing.

        07/26/05 - SkariahV- CR16679
	           Removed #WARN directive.
	              
	01/09/03 - GRAY - 51351
		   Modified as a result of MRPC059 being PSL'd.

	05/17/02 - GRAY - 43583
		   Removed global reference from lock and unlock of
		   UTBL("INCD",INCD,PL).
		
	12/21/99 - GRAY - 32507
		   Removed code no longer needed due to the Elimination
		   of Teller/Branch Character Interface and placed remaining
		   code into PSL'd procedure definition.

 */
	
	quit
		
public PLPP(pl,INCD) 	// Pool prompt post processor

	type public Number ER
	type public String ET,RM

	// Called from MRPC059
	
	set pl=$G(pl) if pl="" quit
	if 'Db.isDefined("LNLS2","INCD=:INCD,PL=:pl") quit
	
	type ResultSet rs=Db.select("GRP,CID","LNLS4","INCD=:INCD AND PL=:pl")
	if 'rs.isEmpty() quit

	// No sale pending for investor ~p1, pool ~p2
	set ER=1,RM=$$^MSG(1984,INCD,pl)

	quit

	
ERR	//

	type Public Number ER

	set ER=1 do ^UTLERR

	quit
	

public FILE(String PL,String INCD)	// File data

	type public Number ER
	type public String ET,RM,UTBL(,,)

	type Date TPD	
	type Number BRCD
	type String SVUID

	lock +UTBL("INCD",INCD,PL):2 else  set ET="RECLOC" do ERR quit
	
	type RecordLNLS2 pl=Db.getRecord("LNLS2","INCD=:INCD,PL=:PL")
	
	// Contra account processing
	if pl.picm=6 do {
		set TPD=%SystemDate
		set BRCD=CUVAR.bobr
		set SVUID=%UserID
		}
	else  do {	// Variables only used for contra account processing
		set TPD=""
		set BRCD=""
		set SVUID=""
		}
	
	do ^LNLS5A(.pl,TPD,BRCD,SVUID,INCD,PL)
	
	lock -UTBL("INCD",INCD,PL)
	
	if ER do ERR
	
	quit

vSIG()	quit "60458^42662^Pat Kelly^1865"	// Signature - LTD^TIME^USER^SIZE
