PRODCDI		/* Return Computed Data Items for the Product defaults or control files
	
	   Revision History
	   
	   01/06/05 - ARPAVC - 13861
		      Fixed compile errors due to conversion.  
		      - Removed unreferenced variable SQLCNT   	      
	
	   02/02/00 - RAJARAMD - 35311:012
		      In DESC line tag changed the code to quit with 
		      Product type description with 40 characters rather than
		      20 characters.             
	
	   07/15/99 - CHOK - 33890
		      Converted procedure code to PSL
	
	   08/11/98 - JIAQ - 26685
	              Modified  CNT section.
	
	   03/11/98 - SPIER - 26685 New
	
	   LIBRARY:
	   $$ CNT       - Product defaults number of accounts
	   $$ DESC      - Product description
	   $$ FUNDAVL   - PRODDFTL Funds Available
	   $$ FNDUSED   - PRODDFTL Funds Used
	*/

	quit

CNT(CLS,GRP,TYPE)
	/* Public ; Compute number of accounts for [PRODDFTD]CNT or [PRODDFTL]CNT.
	   Based on the prior day values in ^TTL setup by accrual processing.
	   Return the number of accounts in the system fot this product type.
	   KEYWORDS: Data dictionary
	
	   ARGUMENTS:
	   . CLS  Class   /TYP=T/REQ
	
	   . GRP  Group   /TYP=T/REQ
	
	   . TYPE  Product type  /TYP=N/REQ
	
	   RETURNS:
	   . $$  Count of accounts /TYP=N
	
	   EXAMPLE:
	   S COUNT=$$CNT^PRODCDI(CLS,GRP,TYPE)
	*/

	new TTLDATE,CNT,FIELDS
	set CNT=0
	set TTLDATE=%SystemDate-1       //Find total from yesterday's accruals
	new rs 
	type ResultSet rs=Db.select("CLOSED,OPEN","TTL","TJD=:TTLDATE AND TYPE=:TYPE") 
	if 'rs.isEmpty() while rs.next() do { 
	       set FIELDS=rs.getRow()
	       set CNT=CNT+$P(FIELDS,$C(9),1)+$P(FIELDS,$C(9),2) 
	} 
	quit CNT
	
DESC(TYPE)	
	/* Public;Return Product description field
	
	   Return product description. This function is called from product
	   defaults data item DES (files (PRODDFTL,PRODDFTD,PRODDFTC)
	
	   KEYWORDS:
	
	   ARGUMENTS:
	   . TYPE Product Account Type  /TYP=T/REQ/MECH=VAL
	
	   RETURNS:
	   . $$ Product Type description /TYP=T
	
	
	   EXAMPLE:
	   $$DESC^PRODCDI(400)

	*/
	
	new DATA
	set DATA=Db.getOneRow("DES","PRODCTL","TYPE")
	quit $E(DATA,1,40)				
	
FUNDAVL(TYPE)	
	/* Public;Return PRODDFTL funds available
	
	   Return Funds available field from Credit limits by product type file.
	
	   KEYWORDS:
	
	   ARGUMENTS:
	   . MAXFND Maximum Funding Limit /TYP=$/REQ/MECH=VAL
	
	   . TYPE  Product TYPE  /TYP=T/REQ/MECH=VAL
	
	   RETURNS:
	   . $$ Funds Available  /TYP=$
	
	   EXAMPLE:
	   $$FUNDAVL^PROCOMP(700)
	*/
	
	new CRLMT,MAXFND
	if $G(TYPE)="" set CRLMT=0
	else  set CRLMT=Db.getOneRow("CRLMT","HTBLLTYPE","TYPE")
	set MAXFND=Db.getOneRow("MAXFND","PRODCTL","TYPE")
	set CRLMT=MAXFND-CRLMT
	quit $S(CRLMT>0:CRLMT,1:0)
	
FNDUSED(TYPE)	
	/* Public;return PRODDFTL FNDUSD
	
	   Return Funds used field from Credit limits by product type file.
	
	   KEYWORDS:
	
	   ARGUMENTS:
	   . TYPE Product TYPE   /TYP=T/REQ/MECH=VAL
	
	
	   RETURNS:
	   . $$  Funds Used   /TYP=$
	
	
	   EXAMPLE:
	   $$FNDUSED^PROCOMP(700)
	   $$FNDUSED^PROCOMP([PRODDFTL]TYPE)
	*/

	if $G(TYPE)="" quit ""
	new CRLMT
	set CRLMT=Db.getOneRow("CRLMT","HTBLLTYPE","TYPE")
	quit CRLMT
	
 #OPTION ResultClass ON
Public String vSIG()	quit "59932^39218^Vincent Arpa^2911"	// Signature - LTD^TIME^USER^SIZE
