RPADNOTP	// RSP Deposit Notice File Purge
	/*
	   ORIG: SCHEETZE - 06/04/96
	   DESC: RPA Deposit Notice File Purge

	-----  Revision History  ---------------------------------------------

        07/26/05 - SkariahV- CR16679
	           Removed #WARN and #OPTIMIZE directives.
	              
	05/21/03 - GRAY - 51351
		   Converted to PSL.

	
	*/
	

	type Number ACN,CID,HSEQ,RPASEQ
	type String %READ,%TAB,VFMQ
	type Public Date CUTOFF
	type Public String RM

	set %TAB("CUTOFF")=".CUTOFF/XPP=D XPP^RPADNOTP"
	set %READ="@@%FN,,,CUTOFF/REQ"
	do ^UTLREAD
	if VFMQ="Q" quit

	type DbSet ds=Db.selectDbSet("RSPDNOT","EFD NOT >:CUTOFF")
	while ds.next() do {
		type RecordRSPDNOT dnot=ds.getRecord("RSPDNOT")
		set ACN=dnot.acn
		set RPASEQ=dnot.rpaseq
		set CID=dnot.cid
		set HSEQ=dnot.tseq

		if dnot.ndate do Db.delete("RSPDNOT","ACN=:ACN AND RPASEQ=:RPASEQ AND CID=:CID AND TSEQ=:HSEQ") quit

		// History sequence ~p1 has not generated a notice.  Sequence not purged.
		set RM=$$^MSG(1167,HSEQ)
		do LOG^UTLEXC(%RoutineName,"*",RM.get(),CID)
		}

	quit

	
XPP	//

	type Public Date X
	type Public Number ER=0
	type Public String RM

	// Must be prior to today
	if X>%SystemDate set ER=1 set RM=$$^MSG(5762)

	quit
 #OPTION ResultClass ON
Public String vSIG()	quit "60107^27454^Viji Skariah^1124"	// Signature - LTD^TIME^USER^SIZE
