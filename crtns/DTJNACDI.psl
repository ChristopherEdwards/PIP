DTJNACDI	 /* 
  ORIG: ofaltr - 06/27/2000
  DESC: Computed Fields for DTJNA
  
  ---- Comments --------------------------------------------------------
 
   LIBRARY:
    $$ STAT		Account Status
    $$ CNTCR		Number of Credits 
    $$ PREEXIST		Pre-existing Customer
    $$ ACN		Primary Customer Number
    $$ NATYPES		Product Types Opened
    $$ OSGNCRDC		Online Sign. Card Completed Indicator
    $$ SGNCRD		Signature Card Indicator
    $$ PSGNCRDR		Paper Signature Card Returned Indicator


  ---- Revision History ------------------------------------------------

   02/15/01 - MYERSK - 43728
	Added SJD to where clause in NATYPES.  This limits the types returned
	by this data item to the account types opened on the same day as this
	account.

   10/04/00 - HAILEYK - 42178
	Added computed data items OSGNCRDC,SGNCRD,PSGNCRDR for AMEX
	Thank You letters.

   08/31/00 - BURNSM - 41701
	Added computed data items PREEXIST, ACN, NATYPES for AMEX 
	welcome letters.

 */

	quit  

STAT(XCID,XCLS)	//Account Status
	/*
        The function is used to compute [DTJNA]STAT field.
        
        ARGUMENTS:
               CID     Account Number          /TYPE=N/REQ/MECH=VAL
               CLS     Product Class           /TYPE=T/REQ/MECH=VAL
        
         RETURNS:  Account Status
        
         EXAMPLE: $$STAT^DTJNACDI(CID,CLS)
	*/
	
	new XSTAT
	if XCLS="*" quit ""
	set XSTAT=Db.getOneRow("STAT","ACN","XCID")
	quit XSTAT
	
CNTCR(XCID,XCLS)	//Number of Credits
	/*
        The function is used to compute [DTJNA]CNTCR field.
        
        ARGUMENTS:
               CID     Account Number          /TYPE=N/REQ/MECH=VAL
               CLS     Product Class           /TYPE=T/REQ/MECH=VAL
        
         RETURNS:  Number of Credits
        
         EXAMPLE: $$CNTCR^DTJNACDI(CID,CLS)
	*/
	
	new XCNTCR
	set XCNTCR=Db.getOneRow("CNTCR","DEP","XCID")
	if XCLS="D" quit XCNTCR
	quit ""
	
PREEXIST(XCID,XCLS)  // Pre-Existing Customer
        /*
	 The function is used to compute [DTJNA]PREEXIST field.
 
         ARGUMENTS:
                CID     Account Number          /TYPE=N/REQ/MECH=VAL
		CLS     Product Class           /TYPE=T/REQ/MECH=VAL 

         RETURNS:
                $$      1 - Customer had a business relationship before a
                        Profile relationship.
                        0 - Customer had no prior relationship

	 EXAMPLE:
		$$PREEXIST^DTJNACDI(CID,CLS)
        */
 
        new cifdata,XACN,XDAO,XINCPT
 
	if XCLS="*" set XACN=XCID
	else  set XACN=Db.getOneRow("ACN","ACN","XCID")

        set cifdata=Db.getOneRow("INCPDT,DAO","CIF","XACN")
        set XINCPDT=$P(cifdata,$C(9),1)
        set XDAO=$P(cifdata,$C(9),2)
 
        if XINCPDT="" quit 0
        if XINCPDT<XDAO quit 1
        quit 0

ACN(XCID,XCLS)	// Primary Customer Number
	/*
	 The function is used to compute [DTJNA]ACN field.

	 ARGUMENTS:
		CID	Account Number		/TYPE=N/REQ/MECH=VAL
		CLS	Product Class		/TYPE=T/REQ/MECH=VAL

	 RETURNS:
		Primary Customer Number

	 EXAMPLE:
		$$ACN^DTJNACDI(CID,CLS)
	*/

	new XACN
	if XCLS="*" quit XCID
	set XACN=Db.getOneRow("ACN","ACN","XCID")
	quit XACN

NATYPES(XSJD,XCID)	// Product Types Opened
	/*
	 The function is used to compute [DTJNA]NATYPES field.

	 ARGUMENTS:
		SJD	System Accounting Date	/TYPE=D/REQ/MECH=VAL
                CID     Account Number          /TYPE=N/REQ/MECH=VAL
 
         RETURNS:
                A '#' delimited string of the product types opened by the
			Primary Owner of the account.
		For example: #300#  - product type 300 was opened (1 or more)
			     #300#400#600# - product types 300, 400 and 600
         EXAMPLE:
                $$NATYPES^DTJNACDI(TJD,CID)
        */

	new string,TEST,XACN,XTYPE
	set string="#"

	type ResultSet rs=Db.select("ACN","DTJNA","TJD=:XSJD AND CID=:XCID")
	if 'rs.isEmpty() while rs.next() do {
		set XACN=rs.getCol(1)

		// myersk 43728 - added SJD=:XSJD to where clause
		type ResultSet rs1=Db.select("TYPE","DTJNAACN","SJD=:XSJD AND ACN=:XACN")
		if 'rs1.isEmpty() while rs1.next() do {
			set XTYPE=rs1.getCol(1)
			set TEST="#"_XTYPE_"#"
			// Only want to include the TYPE once.
			if string[TEST quit
			set string=string_XTYPE_"#"
			}
		}
	quit string


OSGNCRDC(XCID)      // Online Sign. Card Completed Indicator

	/*
	The function is used to compute [DTJNA]OSGNCRDC field.

	ARGUMENTS:
                CID	Account Number          /TYPE=N/REQ/MECH=VAL

	RETURNS:
		Online Sign. Card Completed Indicator

	EXAMPLE:
		$$OSGNCRDC^DTJNACDI(CID)

	*/

	new VAL
	set VAL=Db.getOneRow("OSGNCRDC","DEP","XCID")

	quit VAL


SGNCRD(XCID)      // Signature Card Indicator

	/*
	The function is used to compute [DTJNA]SGNCRD field.

	ARGUMENTS:
		CID	Account Number		/TYPE=N/REQ/MECH=VAL

	RETURNS:
		Signature Card Indicator

	EXAMPLE:
		$$SGNCRD^DTJNACDI(CID)

	*/

	new VAL
	set VAL=Db.getOneRow("SGNCRD","DEP","XCID")

	quit VAL


PSGNCRDR(XCID)      // Paper Signature Card Returned Indicator

	/*
	The function is used to compute [DTJNA]PSGNCRDR field.

	ARGUMENTS:
		CID     Account Number          /TYPE=N/REQ/MECH=VAL

	RETURNS:
		Paper Signature Card Returned Indicator

	EXAMPLE:
		$$PSGNCRDR^DTJNACDI(CID)

	*/

	new VAL
	set VAL=Db.getOneRow("PSGNCRDR","DEP","XCID")

	quit VAL
 #OPTION ResultClass ON
Public String vSIG()	quit "59886^43513^Sanchez SCM Administrator^4986"	// Signature - LTD^TIME^USER^SIZE
