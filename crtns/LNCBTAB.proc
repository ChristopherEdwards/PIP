LNCBTAB	// MAINTENANCE FOR COUPON BOOK PROD TABLE
	/*
	       ORIG:  Kathie Jalbuena (7070) - 11/09/87

	  ---- Revision History ------------------------------------------------
	   09/24/02 - TELIV - 49451
		      Converting to PSL

	  ----------------------------------------------------------------------

	*/


NEW 	//

	do INIT(0)
	quit


UPD 	//

	do INIT(1)
	quit


INQ 	//

	do INIT(2)
	quit


DEL 	//

	do INIT(3)
	quit


INIT(%ProcessMode)	//

	new VFMQ

	set %PG=0 
	set %PAGE=1

	type RecordUTBLCBPROD fUTBLCBP

	do VPG(.fUTBLCBP)

	quit


VPG(RecordUTBLCBPROD fUTBLCBP)	// Page control

	new FINISH
	set FINISH=0
	
	for  do { quit:FINISH
		if %PG=0 do VPG00 

		if (ER!(VFMQ="Q")) set FINISH=1 quit
		
		if %PG>0 do VPG01(.fUTBLCBP) 
		
		if (ER!(VFMQ="Q")) set FINISH=1 quit

		if "DFQ"[VFMQ do VER(.fUTBLCBP) set FINISH=1 quit

		set %PG=%PG+1
		}
	quit


VPG00	// Set up

	set %TAB("VENDR")=".VENDR1/XPP=D POST^LNCBTAB"

	if %ProcessMode set %TAB("VENDR")=%TAB("VENDR")_"/TBL=[UTBLCBPROD]"
	set %READ="@@%FN,,,VENDR/REQ"

	do ^UTLREAD

	quit


VPG01(RecordUTBLCBPROD fUTBLCBP)	// Screen

	set fUTBLCBP=Db.getRecord("UTBLCBPROD","VENDR=:VENDR",1)

	do DRV^USID(%ProcessMode,"LNCBTAB",.fUTBLCBP)

	quit


ERR	//

	set ER=1 
	do ^UTLERR
	
	set VFMQ="Q"
	quit


VER(RecordUTBLCBPROD fUTBLCBP) 	//

	if %ProcessMode=2!(%ProcessMode=4)!(VFMQ="Q") do END quit
	
	if %ProcessMode=3 do {
		do Db.delete("UTBLCBPROD","VENDR=:VENDR")
		}
	else  do fUTBLCBP.save()

	do END

	quit


END	//

	kill %TAB lock 
	if ER!(%ProcessMode=2)!(%ProcessMode=4) quit

	set VENDR=$G(VENDR)

	if VFMQ="Q" do {

		// Vendor for ~p1 not created
		if %ProcessMode=0 set RM=$$^MSG(2941,VENDR) quit

		// Vendor for ~p1 not modified
		if %ProcessMode=1 set RM=$$^MSG(2942,VENDR) quit

		// Vendor for ~p1 not deleted
		set RM=$$^MSG(8420,VENDR)
		}
	else  do {

		// Vendor for ~p1 created
		if %ProcessMode=0 set RM=$$^MSG(2939,VENDR) quit

		// Vendor for ~p1 modified
		if %ProcessMode=1 set RM=$$^MSG(2940,VENDR) quit

		// Vendor for ~p1 deleted
		set RM=$$^MSG(8419,VENDR)
		}

	set ER="W"

	quit


POST	// Post processor for key

	if '%OSAVE,Db.isDefined("UTBLCBPROD","VENDR=:X") do {
		set ET="LNONFIL" 
		do ERR^LNCBTAB
		}

	quit

vSIG()	quit "59886^43529^Sanchez SCM Administrator^2016"	// Signature - LTD^TIME^USER^SIZE
