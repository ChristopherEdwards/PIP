LNANAP	  /*
ORIG: hillanbd - 02/22/2005
DESC: Non-Accrual Status Removal

---- Revision History ------------------------------------------------
	03/07/05 - Hillanbrand - CR14587
                   Converted M routine to PSL procedure. Additional 
                   modifications per code review.		

 */
 

	
	type public String ER, RM

	type Date EJD
	type Number %PAGE, %PG, CID, X 
	type String %READ, %TAB(), VFMQ

	set (%PG,%PAGE)=1

	// Set up

	set %TAB("EJD")=".EJD1/HLP=[DAYENDLNNAO]EJD/TBL=[DAYENDLNNAO]EJD:DISTINCT"
	set %TAB("CID")=".CID3/HLP=[DAYENDLNNAO]CID/TBL=[DAYENDLNNAO]CID:DISTINCT:QU ""[DAYENDLNNAO]EJD=<<EJD>>""/XPP=D PCID^LNANAP"
	

	set %READ="@@%FN,,,EJD/REQ,CID/REQ"
	do ^UTLREAD


	// File data	
	if VFMQ'="Q" do {
		type RecordDAYENDLNNAO delnnao=Class.new("RecordDAYENDLNNAO","EJD=:EJD,CID=:CID")  
		set delnnao.auto=0
		set delnnao.rev=1 
		set delnnao.uid=%UserID 
		do delnnao.bypassSave() 
	}		 
	
	set ER="W"

	// Account ~p1 not deleted from automatic processing	
	if VFMQ="Q" set RM=$$^MSG(131,$G(CID)) quit  
	
	// Account ~p1 deleted from automatic processing
	set RM=$$^MSG(110,CID) 
	
	quit 
	

PCID	// Post processor to CID

	type public Boolean ER
	type public Date EJD	
	type public Number X
	type public String ET


	// No DAYEND file created for this date
	if 'Db.isDefined("DAYENDLNNAO","EJD,X") set ER=1 set ET="NODEENT" do ERR quit 
	
	type RecordDAYENDLNNAO delnnao=Db.getRecord("DAYENDLNNAO","EJD=:EJD,CID=:X",1)
	
	//Loan not set up for automatic non-accrual	
	if 'delnnao.auto set ER=1 set ET="LNNSUA" do ERR 

	quit
	
ERR	
	type public Boolean ER = 1
	type public String VFMQ
	
	D ^UTLERR
	S VFMQ="Q"
	Q
	
	
	
	

vSIG()	quit "59966^47885^Laura Hillanbrand^1576"	// Signature - LTD^TIME^USER^SIZE
